{"version":"2.0.8","type":"application/json","title":"$:/plugins/Gk0Wk/echarts-gl","plugin-type":"plugin","name":"ECharts GL","list":"readme","description":"ECharts-GL provides 3D plots, globe visualization and WebGL acceleration","source":"https://github.com/tiddly-gittly/tw-echarts/tree/master/plugins/Gk0Wk/echarts-gl","parent-plugin":"$:/plugins/Gk0Wk/echarts","dependents":"$:/plugins/Gk0Wk/echarts","text":"{\"tiddlers\":{\"$:/plugins/Gk0Wk/echarts-gl/echarts-gl.min.js\":{\"title\":\"$:/plugins/Gk0Wk/echarts-gl/echarts-gl.min.js\",\"text\":\"!function(e,t){\\\"object\\\"==typeof exports&&\\\"object\\\"==typeof module?module.exports=t(require(\\\"$:/plugins/Gk0Wk/echarts/echarts.min.js\\\")):\\\"function\\\"==typeof define&&define.amd?define([\\\"$:/plugins/Gk0Wk/echarts/echarts.min.js\\\"],t):\\\"object\\\"==typeof exports?exports[\\\"echarts-gl\\\"]=t(require(\\\"$:/plugins/Gk0Wk/echarts/echarts.min.js\\\")):e[\\\"echarts-gl\\\"]=t(e.echarts)}(self,function(t){return(()=>{\\\"use strict\\\";var r={468:(C,D,L)=>{L.r(D);var F=L(83);function P(l,e,t){\\\"object\\\"==typeof e&&(t=e,e=null);var h,u=this;if(!(l instanceof Function))for(var r in h=[],l)l.hasOwnProperty(r)&&h.push(r);var c=function(e){if(u.apply(this,arguments),l instanceof Function)O(this,l.call(this,e));else for(var t=this,r=l,i=h,n=0;n<i.length;n++){var a=i[n];t[a]=r[a]}if(this.constructor===c)for(var o=c.__initializers__,s=0;s<o.length;s++)o[s].apply(this,arguments)},i=((c.__super__=u).__initializers__?c.__initializers__=u.__initializers__.slice():c.__initializers__=[],e&&c.__initializers__.push(e),function(){});return i.prototype=u.prototype,c.prototype=new i,O((c.prototype.constructor=c).prototype,t),c.extend=u.extend,c.derive=u.extend,c}function O(e,t){if(t)for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])}var N={extend:P,derive:P};function I(e,t){this.action=e,this.context=t}var V={trigger:function(e){if(this.hasOwnProperty(\\\"__handlers__\\\")&&this.__handlers__.hasOwnProperty(e)){var t=this.__handlers__[e],r=t.length,i=-1,n=arguments;switch(n.length){case 1:for(;++i<r;)t[i].action.call(t[i].context);return;case 2:for(;++i<r;)t[i].action.call(t[i].context,n[1]);return;case 3:for(;++i<r;)t[i].action.call(t[i].context,n[1],n[2]);return;case 4:for(;++i<r;)t[i].action.call(t[i].context,n[1],n[2],n[3]);return;case 5:for(;++i<r;)t[i].action.call(t[i].context,n[1],n[2],n[3],n[4]);return;default:for(;++i<r;)t[i].action.apply(t[i].context,Array.prototype.slice.call(n,1));return}}},on:function(e,t,r){if(e&&t){var i=this.__handlers__||(this.__handlers__={});if(i[e]){if(this.has(e,t))return}else i[e]=[];var n=new I(t,r||this);return i[e].push(n),this}},once:function(e,t,r){var i;if(e&&t)return(i=this).on(e,function r(){i.off(e,r),t.apply(this,arguments)},r)},before:function(e,t,r){if(e&&t)return this.on(e=\\\"before\\\"+e,t,r)},after:function(e,t,r){if(e&&t)return this.on(e=\\\"after\\\"+e,t,r)},success:function(e,t){return this.once(\\\"success\\\",e,t)},error:function(e,t){return this.once(\\\"error\\\",e,t)},off:function(e,t){var r=this.__handlers__||(this.__handlers__={});if(t){if(r[e]){for(var i=r[e],n=[],a=0;a<i.length;a++)t&&i[a].action!==t&&n.push(i[a]);r[e]=n}return this}r[e]=[]},has:function(e,t){var r=this.__handlers__;if(!r||!r[e])return!1;for(var i=r[e],n=0;n<i.length;n++)if(i[n].action===t)return!0}},H=0,W=Array.prototype.forEach,j={genGUID:function(){return++H},relative2absolute:function(e,t){if(!t||e.match(/^\\\\//))return e;for(var r=e.split(\\\"/\\\"),i=t.split(\\\"/\\\"),n=r[0];\\\".\\\"===n||\\\"..\\\"===n;)\\\"..\\\"===n&&i.pop(),r.shift(),n=r[0];return i.join(\\\"/\\\")+\\\"/\\\"+r.join(\\\"/\\\")},extend:function(e,t){if(t)for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},defaults:function(e,t){if(t)for(var r in t)void 0===e[r]&&(e[r]=t[r]);return e},extendWithPropList:function(e,t,r){if(t)for(var i=0;i<r.length;i++){var n=r[i];e[n]=t[n]}return e},defaultsWithPropList:function(e,t,r){if(t)for(var i=0;i<r.length;i++){var n=r[i];null==e[n]&&(e[n]=t[n])}return e},each:function(e,t,r){if(e&&t)if(e.forEach&&e.forEach===W)e.forEach(t,r);else if(e.length===+e.length)for(var i=0,n=e.length;i<n;i++)t.call(r,e[i],i,e);else for(var a in e)e.hasOwnProperty(a)&&t.call(r,e[a],a,e)},isObject:function(e){return e===Object(e)},isArray:function(e){return Array.isArray(e)},isArrayLike:function(e){return!!e&&e.length===+e.length},clone:function(e){if(j.isObject(e)){if(j.isArray(e))return e.slice();if(j.isArrayLike(e)){for(var t=new e.constructor(e.length),r=0;r<e.length;r++)t[r]=e[r];return t}return j.extend({},e)}return e}};const X=j;var e=function(){this.__uid__=X.genGUID()},N=(e.__initializers__=[function(e){X.extend(this,e)}],X.extend(e,N),X.extend(e.prototype,V),e),q=[\\\"OES_texture_float\\\",\\\"OES_texture_half_float\\\",\\\"OES_texture_float_linear\\\",\\\"OES_texture_half_float_linear\\\",\\\"OES_standard_derivatives\\\",\\\"OES_vertex_array_object\\\",\\\"OES_element_index_uint\\\",\\\"WEBGL_compressed_texture_s3tc\\\",\\\"WEBGL_depth_texture\\\",\\\"EXT_texture_filter_anisotropic\\\",\\\"EXT_shader_texture_lod\\\",\\\"WEBGL_draw_buffers\\\",\\\"EXT_frag_depth\\\",\\\"EXT_sRGB\\\",\\\"ANGLE_instanced_arrays\\\"],Y=[\\\"MAX_TEXTURE_SIZE\\\",\\\"MAX_CUBE_MAP_TEXTURE_SIZE\\\"];const K=function(r){for(var i={},t={},e=0;e<q.length;e++)a(q[e]);for(e=0;e<Y.length;e++){var n=Y[e];t[n]=r.getParameter(r[n])}function a(e){var t;r.getExtension&&(t=(t=(t=r.getExtension(e))||r.getExtension(\\\"MOZ_\\\"+e))||r.getExtension(\\\"WEBKIT_\\\"+e),i[e]=t)}this.getExtension=function(e){return e in i||a(e),i[e]},this.getParameter=function(e){return t[e]}},Q=1028,J=1029,$=2304,ee=2305,te=5121,re=5126,ie=6402,ne=6408,ae=9728,oe=9729,se=9984,le=9985,he=9986,ue=9987,ce=10497,de=33071,fe=33306,pe={get:function(r){var t=new XMLHttpRequest;t.open(\\\"get\\\",r.url),t.responseType=r.responseType||\\\"text\\\",r.onprogress&&(t.onprogress=function(e){var t;e.lengthComputable?(t=e.loaded/e.total,r.onprogress(t,e.loaded,e.total)):r.onprogress(null)}),t.onload=function(e){400<=t.status?r.onerror&&r.onerror():r.onload&&r.onload(t.response)},r.onerror&&(t.onerror=r.onerror),t.send(null)}};var me,e={supportWebGL:function(){if(null==me)try{var e;if(!(e=document.createElement(\\\"canvas\\\")).getContext(\\\"webgl\\\")&&!e.getContext(\\\"experimental-webgl\\\"))throw new Error}catch(e){me=!1}return me}},ge=(e.Int8Array=\\\"undefined\\\"==typeof Int8Array?Array:Int8Array,e.Uint8Array=\\\"undefined\\\"==typeof Uint8Array?Array:Uint8Array,e.Uint16Array=\\\"undefined\\\"==typeof Uint16Array?Array:Uint16Array,e.Uint32Array=\\\"undefined\\\"==typeof Uint32Array?Array:Uint32Array,e.Int16Array=\\\"undefined\\\"==typeof Int16Array?Array:Int16Array,e.Float32Array=\\\"undefined\\\"==typeof Float32Array?Array:Float32Array,e.Float64Array=\\\"undefined\\\"==typeof Float64Array?Array:Float64Array,{});\\\"undefined\\\"!=typeof window?ge=window:void 0!==L.g&&(ge=L.g),e.requestAnimationFrame=ge.requestAnimationFrame||ge.msRequestAnimationFrame||ge.mozRequestAnimationFrame||ge.webkitRequestAnimationFrame||function(e){setTimeout(e,16)},e.createCanvas=function(){return document.createElement(\\\"canvas\\\")},e.createImage=function(){return new ge.Image},e.request={get:pe.get},e.addEventListener=function(e,t,r,i){e.addEventListener(t,r,i)},e.removeEventListener=function(e,t,r){e.removeEventListener(t,r)};const _e=e;var ve=function(){this.head=null,this.tail=null,this._length=0};ve.prototype.insert=function(e){var t=new ve.Entry(e);return this.insertEntry(t),t},ve.prototype.insertAt=function(e,t){if(!(e<0)){for(var r,i,n=this.head,a=0;n&&a!=e;)n=n.next,a++;n?(r=new ve.Entry(t),(i=n.prev)?(i.next=r).prev=i:this.head=r,(r.next=n).prev=r):this.insert(t)}},ve.prototype.insertBeforeEntry=function(e,t){var r=new ve.Entry(e),i=t.prev;i?(i.next=r).prev=i:this.head=r,(r.next=t).prev=r,this._length++},ve.prototype.insertEntry=function(e){this.head?((this.tail.next=e).prev=this.tail,this.tail=e):this.head=this.tail=e,this._length++},ve.prototype.remove=function(e){var t=e.prev,r=e.next;t?t.next=r:this.head=r,r?r.prev=t:this.tail=t,e.next=e.prev=null,this._length--},ve.prototype.removeAt=function(e){if(!(e<0)){for(var t=this.head,r=0;t&&r!=e;)t=t.next,r++;return t?(this.remove(t),t.value):void 0}},ve.prototype.getHead=function(){if(this.head)return this.head.value},ve.prototype.getTail=function(){if(this.tail)return this.tail.value},ve.prototype.getAt=function(e){if(!(e<0)){for(var t=this.head,r=0;t&&r!=e;)t=t.next,r++;return t.value}},ve.prototype.indexOf=function(e){for(var t=this.head,r=0;t;){if(t.value===e)return r;t=t.next,r++}},ve.prototype.length=function(){return this._length},ve.prototype.isEmpty=function(){return 0===this._length},ve.prototype.forEach=function(e,t){for(var r=this.head,i=0,n=void 0!==t;r;)n?e.call(t,r.value,i):e(r.value,i),r=r.next,i++},ve.prototype.clear=function(){this.tail=this.head=null,this._length=0},ve.Entry=function(e){this.value=e,this.next=null,this.prev=null};const ye=ve;e=function(e){this._list=new ye,this._map={},this._maxSize=e||10};e.prototype.setMaxSize=function(e){this._maxSize=e},e.prototype.put=function(e,t){var r;this._map.hasOwnProperty(e)||((r=this._list.length())>=this._maxSize&&0<r&&(r=this._list.head,this._list.remove(r),delete this._map[r.key]),(r=this._list.insert(t)).key=e,this._map[e]=r)},e.prototype.get=function(e){var t=this._map[e];if(this._map.hasOwnProperty(e))return t!==this._list.tail&&(this._list.remove(t),this._list.insertEntry(t)),t.value},e.prototype.remove=function(e){var t=this._map[e];void 0!==t&&(delete this._map[e],this._list.remove(t))},e.prototype.clear=function(){this._list.clear(),this._map={}};const xe=e;var h={},be={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function we(e){return(e=Math.round(e))<0?0:255<e?255:e}function Te(e){return e<0?0:1<e?1:e}function Se(e){return e.length&&\\\"%\\\"===e.charAt(e.length-1)?we(parseFloat(e)/100*255):we(parseInt(e,10))}function Me(e){return e.length&&\\\"%\\\"===e.charAt(e.length-1)?Te(parseFloat(e)/100):Te(parseFloat(e))}function Ae(e,t,r){return r<0?r+=1:1<r&&--r,6*r<1?e+(t-e)*r*6:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}function Ee(e,t,r){return e+(t-e)*r}function Ce(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function De(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}var Le=new xe(20),Pe=null;function Oe(e,t){Pe&&De(Pe,t),Pe=Le.put(e,Pe||t.slice())}function Ne(e,t){var r=(parseFloat(e[0])%360+360)%360/360,i=Me(e[1]),n=Me(e[2]),i=n<=.5?n*(i+1):n+i-n*i,n=2*n-i;return Ce(t=t||[],we(255*Ae(n,i,r+1/3)),we(255*Ae(n,i,r)),we(255*Ae(n,i,r-1/3)),1),4===e.length&&(t[3]=e[3]),t}h.parse=function(e,t){if(e){t=t||[];var r=Le.get(e);if(r)return De(t,r);r=(e+=\\\"\\\").replace(/ /g,\\\"\\\").toLowerCase();if(r in be)return De(t,be[r]),Oe(e,t),t;if(\\\"#\\\"===r.charAt(0))return 4===r.length?0<=(i=parseInt(r.substr(1),16))&&i<=4095?(Ce(t,(3840&i)>>4|(3840&i)>>8,240&i|(240&i)>>4,15&i|(15&i)<<4,1),Oe(e,t),t):void Ce(t,0,0,0,1):7===r.length?0<=(i=parseInt(r.substr(1),16))&&i<=16777215?(Ce(t,(16711680&i)>>16,(65280&i)>>8,255&i,1),Oe(e,t),t):void Ce(t,0,0,0,1):void 0;var i=r.indexOf(\\\"(\\\"),n=r.indexOf(\\\")\\\");if(-1!==i&&n+1===r.length){var a=r.substr(0,i),o=r.substr(i+1,n-(i+1)).split(\\\",\\\"),s=1;switch(a){case\\\"rgba\\\":if(4!==o.length)return void Ce(t,0,0,0,1);s=Me(o.pop());case\\\"rgb\\\":return 3!==o.length?void Ce(t,0,0,0,1):(Ce(t,Se(o[0]),Se(o[1]),Se(o[2]),s),Oe(e,t),t);case\\\"hsla\\\":return 4!==o.length?void Ce(t,0,0,0,1):(o[3]=Me(o[3]),Ne(o,t),Oe(e,t),t);case\\\"hsl\\\":return 3!==o.length?void Ce(t,0,0,0,1):(Ne(o,t),Oe(e,t),t);default:return}}Ce(t,0,0,0,1)}},h.parseToFloat=function(e,t){if(t=h.parse(e,t))return t[0]/=255,t[1]/=255,t[2]/=255,t},h.lift=function(e,t){var r=h.parse(e);if(r){for(var i=0;i<3;i++)r[i]=t<0?r[i]*(1-t)|0:(255-r[i])*t+r[i]|0;return h.stringify(r,4===r.length?\\\"rgba\\\":\\\"rgb\\\")}},h.toHex=function(e){var t=h.parse(e);if(t)return((1<<24)+(t[0]<<16)+(t[1]<<8)+ +t[2]).toString(16).slice(1)},h.fastLerp=function(e,t,r){var i,n,a,o;if(t&&t.length&&0<=e&&e<=1)return r=r||[],o=e*(t.length-1),i=Math.floor(o),a=Math.ceil(o),n=t[i],a=t[a],r[0]=we(Ee(n[0],a[0],o=o-i)),r[1]=we(Ee(n[1],a[1],o)),r[2]=we(Ee(n[2],a[2],o)),r[3]=Te(Ee(n[3],a[3],o)),r},h.fastMapToColor=h.fastLerp,h.lerp=function(e,t,r){var i,n,a,o,s,l;if(t&&t.length&&0<=e&&e<=1)return i=e*(t.length-1),n=Math.floor(i),a=Math.ceil(i),l=h.parse(t[n]),o=h.parse(t[a]),l=h.stringify([we(Ee(l[0],o[0],s=i-n)),we(Ee(l[1],o[1],s)),we(Ee(l[2],o[2],s)),Te(Ee(l[3],o[3],s))],\\\"rgba\\\"),r?{color:l,leftIndex:n,rightIndex:a,value:i}:l},h.mapToColor=h.lerp,h.modifyHSL=function(e,t,r,i){if(e=h.parse(e))return e=function(e){var t,r,i,n,a,o,s,l,h,u;if(e)return u=e[0]/255,r=e[1]/255,i=e[2]/255,s=Math.min(u,r,i),a=((n=Math.max(u,r,i))+s)/2,0==(h=n-s)?o=t=0:(o=a<.5?h/(n+s):h/(2-n-s),s=((n-u)/6+h/2)/h,l=((n-r)/6+h/2)/h,h=((n-i)/6+h/2)/h,u===n?t=h-l:r===n?t=1/3+s-h:i===n&&(t=2/3+l-s),t<0&&(t+=1),1<t&&--t),u=[360*t,o,a],null!=e[3]&&u.push(e[3]),u}(e),null!=t&&(e[0]=(n=Math.round(t))<0?0:360<n?360:n),null!=r&&(e[1]=Me(r)),null!=i&&(e[2]=Me(i)),h.stringify(Ne(e),\\\"rgba\\\");var n},h.modifyAlpha=function(e,t){if((e=h.parse(e))&&null!=t)return e[3]=Te(t),h.stringify(e,\\\"rgba\\\")},h.stringify=function(e,t){var r;if(e&&e.length)return r=e[0]+\\\",\\\"+e[1]+\\\",\\\"+e[2],\\\"rgba\\\"!==t&&\\\"hsva\\\"!==t&&\\\"hsla\\\"!==t||(r+=\\\",\\\"+e[3]),t+\\\"(\\\"+r+\\\")\\\"};var Ie=h.parseToFloat,Re={};function Be(e){var t=Object.keys(e);t.sort();for(var r=[],i=0;i<t.length;i++){var n=t[i],a=e[n];r.push(null===a?n:n+\\\" \\\"+a.toString())}return r.join(\\\"\\\\n\\\")}const Fe=N.extend(function(){return{name:\\\"\\\",depthTest:!0,depthMask:!0,transparent:!1,blend:null,autoUpdateTextureStatus:!0,uniforms:{},vertexDefines:{},fragmentDefines:{},_textureStatus:{},_enabledUniforms:null}},function(){this.name||(this.name=\\\"MATERIAL_\\\"+this.__uid__),this.shader&&this.attachShader(this.shader,!0)},{precision:\\\"highp\\\",setUniform:function(e,t){void 0===t&&console.warn('Uniform value \\\"'+e+'\\\" is undefined');var r=this.uniforms[e];r&&(\\\"string\\\"==typeof t&&(t=Ie(t)||t),r.value=t,this.autoUpdateTextureStatus)&&\\\"t\\\"===r.type&&(t?this.enableTexture(e):this.disableTexture(e))},setUniforms:function(e){for(var t in e){var r=e[t];this.setUniform(t,r)}},isUniformEnabled:function(e){return 0<=this._enabledUniforms.indexOf(e)},getEnabledUniforms:function(){return this._enabledUniforms},getTextureUniforms:function(){return this._textureUniforms},set:function(e,t){if(\\\"object\\\"==typeof e)for(var r in e){var i=e[r];this.setUniform(r,i)}else this.setUniform(e,t)},get:function(e){var t=this.uniforms[e];if(t)return t.value},attachShader:function(e,t){var r=this.uniforms,i=(this.uniforms=e.createUniforms(),this.shader=e,this.uniforms),n=(this._enabledUniforms=Object.keys(i),this._enabledUniforms.sort(),this._textureUniforms=this._enabledUniforms.filter(function(e){var t=this.uniforms[e].type;return\\\"t\\\"===t||\\\"tv\\\"===t},this),this.vertexDefines),a=this.fragmentDefines;if(this.vertexDefines=X.clone(e.vertexDefines),this.fragmentDefines=X.clone(e.fragmentDefines),t){for(var o in r)i[o]&&(i[o].value=r[o].value);X.defaults(this.vertexDefines,n),X.defaults(this.fragmentDefines,a)}var s,l={};for(s in e.textures)l[s]={shaderType:e.textures[s].shaderType,type:e.textures[s].type,enabled:!(!t||!this._textureStatus[s])&&this._textureStatus[s].enabled};this._textureStatus=l,this._programKey=\\\"\\\"},clone:function(){var e,t=new this.constructor({name:this.name,shader:this.shader});for(e in this.uniforms)t.uniforms[e].value=this.uniforms[e].value;return t.depthTest=this.depthTest,t.depthMask=this.depthMask,t.transparent=this.transparent,t.blend=this.blend,t.vertexDefines=X.clone(this.vertexDefines),t.fragmentDefines=X.clone(this.fragmentDefines),t.enableTexture(this.getEnabledTextures()),t.precision=this.precision,t},define:function(e,t,r){var i=this.vertexDefines,n=this.fragmentDefines;\\\"vertex\\\"!==e&&\\\"fragment\\\"!==e&&\\\"both\\\"!==e&&arguments.length<3&&(r=t,t=e,e=\\\"both\\\"),r=null!=r?r:null,\\\"vertex\\\"!==e&&\\\"both\\\"!==e||i[t]!==r&&(i[t]=r,this._programKey=\\\"\\\"),\\\"fragment\\\"!==e&&\\\"both\\\"!==e||n[t]!==r&&(n[t]=r,\\\"both\\\"!==e)&&(this._programKey=\\\"\\\")},undefine:function(e,t){\\\"vertex\\\"!==e&&\\\"fragment\\\"!==e&&\\\"both\\\"!==e&&arguments.length<2&&(t=e,e=\\\"both\\\"),\\\"vertex\\\"!==e&&\\\"both\\\"!==e||this.isDefined(\\\"vertex\\\",t)&&(delete this.vertexDefines[t],this._programKey=\\\"\\\"),\\\"fragment\\\"!==e&&\\\"both\\\"!==e||this.isDefined(\\\"fragment\\\",t)&&(delete this.fragmentDefines[t],\\\"both\\\"!==e)&&(this._programKey=\\\"\\\")},isDefined:function(e,t){switch(e){case\\\"vertex\\\":return void 0!==this.vertexDefines[t];case\\\"fragment\\\":return void 0!==this.fragmentDefines[t]}},getDefine:function(e,t){switch(e){case\\\"vertex\\\":return this.vertexDefines[t];case\\\"fragment\\\":return this.fragmentDefines[t]}},enableTexture:function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this.enableTexture(e[t]);else{var r=this._textureStatus[e];!r||r.enabled||(r.enabled=!0,this._programKey=\\\"\\\")}},enableTexturesAll:function(){var e,t=this._textureStatus;for(e in t)t[e].enabled=!0;this._programKey=\\\"\\\"},disableTexture:function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this.disableTexture(e[t]);else{var r=this._textureStatus[e];!r||r.enabled&&(r.enabled=!1,this._programKey=\\\"\\\")}},disableTexturesAll:function(){var e,t=this._textureStatus;for(e in t)t[e].enabled=!1;this._programKey=\\\"\\\"},isTextureEnabled:function(e){var t=this._textureStatus;return!!t[e]&&t[e].enabled},getEnabledTextures:function(){var e,t=[],r=this._textureStatus;for(e in r)r[e].enabled&&t.push(e);return t},dirtyDefines:function(){this._programKey=\\\"\\\"},getProgramKey:function(){return this._programKey||(this._programKey=function(e,t,r){r.sort();for(var i=[],n=0;n<r.length;n++){var a=r[n];i.push(a)}var o,s=Be(e)+\\\"\\\\n\\\"+Be(t)+\\\"\\\\n\\\"+i.join(\\\"\\\\n\\\");return Re[s]||(o=X.genGUID(),Re[s]=o)}(this.vertexDefines,this.fragmentDefines,this.getEnabledTextures())),this._programKey}});var ze,Ge=Array,Ue=Math.random,e={create:function(){var e=new Ge(2);return e[0]=0,e[1]=0,e},clone:function(e){var t=new Ge(2);return t[0]=e[0],t[1]=e[1],t},fromValues:function(e,t){var r=new Ge(2);return r[0]=e,r[1]=t,r},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e},set:function(e,t,r){return e[0]=t,e[1]=r,e},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e},subtract:function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}};e.sub=e.subtract,e.multiply=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e},e.mul=e.multiply,e.divide=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e},e.div=e.divide,e.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},e.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},e.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e},e.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e},e.distance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)},e.dist=e.distance,e.squaredDistance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i},e.sqrDist=e.squaredDistance,e.length=function(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)},e.len=e.length,e.squaredLength=function(e){var t=e[0],r=e[1];return t*t+r*r},e.sqrLen=e.squaredLength,e.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},e.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},e.normalize=function(e,t){var r=t[0],i=t[1],r=r*r+i*i;return 0<r&&(r=1/Math.sqrt(r),e[0]=t[0]*r,e[1]=t[1]*r),e},e.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},e.cross=function(e,t,r){var i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e},e.lerp=function(e,t,r,i){var n=t[0],a=t[1];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e},e.random=function(e,t){t=t||1;var r=2*GLMAT_RANDOM()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},e.transformMat2=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e},e.transformMat2d=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n+r[4],e[1]=r[1]*i+r[3]*n+r[5],e},e.transformMat3=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e},e.transformMat4=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[4]*n+r[12],e[1]=r[1]*i+r[5]*n+r[13],e},e.forEach=(ze=e.create(),function(e,t,r,i,n,a){var o,s;for(t=t||2,r=r||0,s=i?Math.min(i*t+r,e.length):e.length,o=r;o<s;o+=t)ze[0]=e[o],ze[1]=e[o+1],n(ze,ze,a),e[o]=ze[0],e[o+1]=ze[1];return e});const n=e;var t=function(e,t){e=e||0,t=t||0,this.array=n.fromValues(e,t),this._dirty=!0};t.prototype={constructor:t,add:function(e){return n.add(this.array,this.array,e.array),this._dirty=!0,this},set:function(e,t){return this.array[0]=e,this.array[1]=t,this._dirty=!0,this},setArray:function(e){return this.array[0]=e[0],this.array[1]=e[1],this._dirty=!0,this},clone:function(){return new t(this.x,this.y)},copy:function(e){return n.copy(this.array,e.array),this._dirty=!0,this},cross:function(e,t){return n.cross(e.array,this.array,t.array),e._dirty=!0,this},dist:function(e){return n.dist(this.array,e.array)},distance:function(e){return n.distance(this.array,e.array)},div:function(e){return n.div(this.array,this.array,e.array),this._dirty=!0,this},divide:function(e){return n.divide(this.array,this.array,e.array),this._dirty=!0,this},dot:function(e){return n.dot(this.array,e.array)},len:function(){return n.len(this.array)},length:function(){return n.length(this.array)},lerp:function(e,t,r){return n.lerp(this.array,e.array,t.array,r),this._dirty=!0,this},min:function(e){return n.min(this.array,this.array,e.array),this._dirty=!0,this},max:function(e){return n.max(this.array,this.array,e.array),this._dirty=!0,this},mul:function(e){return n.mul(this.array,this.array,e.array),this._dirty=!0,this},multiply:function(e){return n.multiply(this.array,this.array,e.array),this._dirty=!0,this},negate:function(){return n.negate(this.array,this.array),this._dirty=!0,this},normalize:function(){return n.normalize(this.array,this.array),this._dirty=!0,this},random:function(e){return n.random(this.array,e),this._dirty=!0,this},scale:function(e){return n.scale(this.array,this.array,e),this._dirty=!0,this},scaleAndAdd:function(e,t){return n.scaleAndAdd(this.array,this.array,e.array,t),this._dirty=!0,this},sqrDist:function(e){return n.sqrDist(this.array,e.array)},squaredDistance:function(e){return n.squaredDistance(this.array,e.array)},sqrLen:function(){return n.sqrLen(this.array)},squaredLength:function(){return n.squaredLength(this.array)},sub:function(e){return n.sub(this.array,this.array,e.array),this._dirty=!0,this},subtract:function(e){return n.subtract(this.array,this.array,e.array),this._dirty=!0,this},transformMat2:function(e){return n.transformMat2(this.array,this.array,e.array),this._dirty=!0,this},transformMat2d:function(e){return n.transformMat2d(this.array,this.array,e.array),this._dirty=!0,this},transformMat3:function(e){return n.transformMat3(this.array,this.array,e.array),this._dirty=!0,this},transformMat4:function(e){return n.transformMat4(this.array,this.array,e.array),this._dirty=!0,this},toString:function(){return\\\"[\\\"+Array.prototype.join.call(this.array,\\\",\\\")+\\\"]\\\"},toArray:function(){return Array.prototype.slice.call(this.array)}},Object.defineProperty&&(e=t.prototype,Object.defineProperty(e,\\\"x\\\",{get:function(){return this.array[0]},set:function(e){this.array[0]=e,this._dirty=!0}}),Object.defineProperty(e,\\\"y\\\",{get:function(){return this.array[1]},set:function(e){this.array[1]=e,this._dirty=!0}})),t.add=function(e,t,r){return n.add(e.array,t.array,r.array),e._dirty=!0,e},t.set=function(e,t,r){return n.set(e.array,t,r),e._dirty=!0,e},t.copy=function(e,t){return n.copy(e.array,t.array),e._dirty=!0,e},t.cross=function(e,t,r){return n.cross(e.array,t.array,r.array),e._dirty=!0,e},t.distance=t.dist=function(e,t){return n.distance(e.array,t.array)},t.divide=t.div=function(e,t,r){return n.divide(e.array,t.array,r.array),e._dirty=!0,e},t.dot=function(e,t){return n.dot(e.array,t.array)},t.len=function(e){return n.length(e.array)},t.lerp=function(e,t,r,i){return n.lerp(e.array,t.array,r.array,i),e._dirty=!0,e},t.min=function(e,t,r){return n.min(e.array,t.array,r.array),e._dirty=!0,e},t.max=function(e,t,r){return n.max(e.array,t.array,r.array),e._dirty=!0,e},t.multiply=t.mul=function(e,t,r){return n.multiply(e.array,t.array,r.array),e._dirty=!0,e},t.negate=function(e,t){return n.negate(e.array,t.array),e._dirty=!0,e},t.normalize=function(e,t){return n.normalize(e.array,t.array),e._dirty=!0,e},t.random=function(e,t){return n.random(e.array,t),e._dirty=!0,e},t.scale=function(e,t,r){return n.scale(e.array,t.array,r),e._dirty=!0,e},t.scaleAndAdd=function(e,t,r,i){return n.scaleAndAdd(e.array,t.array,r.array,i),e._dirty=!0,e},t.squaredDistance=t.sqrDist=function(e,t){return n.sqrDist(e.array,t.array)},t.squaredLength=t.sqrLen=function(e){return n.sqrLen(e.array)},t.subtract=t.sub=function(e,t,r){return n.subtract(e.array,t.array,r.array),e._dirty=!0,e},t.transformMat2=function(e,t,r){return n.transformMat2(e.array,t.array,r.array),e._dirty=!0,e},t.transformMat2d=function(e,t,r){return n.transformMat2d(e.array,t.array,r.array),e._dirty=!0,e},t.transformMat3=function(e,t,r){return n.transformMat3(e.array,t.array,r.array),e._dirty=!0,e},t.transformMat4=function(e,t,r){return n.transformMat4(e.array,t.array,r.array),e._dirty=!0,e};const ke=t;var Ve={};function He(e,t,r){if(!e.getShaderParameter(t,e.COMPILE_STATUS))return[e.getShaderInfoLog(t),function(e){for(var t=e.split(\\\"\\\\n\\\"),r=0,i=t.length;r<i;r++)t[r]=r+1+\\\": \\\"+t[r];return t.join(\\\"\\\\n\\\")}(r)].join(\\\"\\\\n\\\")}var We=new _e.Float32Array(16);const je=N.extend({uniformSemantics:{},attributes:{}},function(){this._locations={},this._textureSlot=0,this._program=null},{bind:function(e){this._textureSlot=0,e.gl.useProgram(this._program)},hasUniform:function(e){return null!=this._locations[e]},useTextureSlot:function(e,t,r){t&&(e.gl.activeTexture(e.gl.TEXTURE0+r),t.isRenderable()?t.bind(e):t.unbind(e))},currentTextureSlot:function(){return this._textureSlot},resetTextureSlot:function(e){this._textureSlot=e||0},takeCurrentTextureSlot:function(e,t){var r=this._textureSlot;return this.useTextureSlot(e,t,r),this._textureSlot++,r},setUniform:function(e,t,r,i){var n=this._locations[r];if(null==n)return!1;switch(t){case\\\"m4\\\":if(!(i instanceof Float32Array)){for(var a=0;a<i.length;a++)We[a]=i[a];i=We}e.uniformMatrix4fv(n,!1,i);break;case\\\"2i\\\":e.uniform2i(n,i[0],i[1]);break;case\\\"2f\\\":e.uniform2f(n,i[0],i[1]);break;case\\\"3i\\\":e.uniform3i(n,i[0],i[1],i[2]);break;case\\\"3f\\\":e.uniform3f(n,i[0],i[1],i[2]);break;case\\\"4i\\\":e.uniform4i(n,i[0],i[1],i[2],i[3]);break;case\\\"4f\\\":e.uniform4f(n,i[0],i[1],i[2],i[3]);break;case\\\"1i\\\":e.uniform1i(n,i);break;case\\\"1f\\\":e.uniform1f(n,i);break;case\\\"1fv\\\":e.uniform1fv(n,i);break;case\\\"1iv\\\":e.uniform1iv(n,i);break;case\\\"2iv\\\":e.uniform2iv(n,i);break;case\\\"2fv\\\":e.uniform2fv(n,i);break;case\\\"3iv\\\":e.uniform3iv(n,i);break;case\\\"3fv\\\":e.uniform3fv(n,i);break;case\\\"4iv\\\":e.uniform4iv(n,i);break;case\\\"4fv\\\":e.uniform4fv(n,i);break;case\\\"m2\\\":case\\\"m2v\\\":e.uniformMatrix2fv(n,!1,i);break;case\\\"m3\\\":case\\\"m3v\\\":e.uniformMatrix3fv(n,!1,i);break;case\\\"m4v\\\":if(Array.isArray(i)&&Array.isArray(i[0])){for(var o=new _e.Float32Array(16*i.length),s=0,a=0;a<i.length;a++)for(var l=i[a],h=0;h<16;h++)o[s++]=l[h];e.uniformMatrix4fv(n,!1,o)}else e.uniformMatrix4fv(n,!1,i)}return!0},setUniformOfSemantic:function(e,t,r){var i=this.uniformSemantics[t];return!!i&&this.setUniform(e,i.type,i.symbol,r)},enableAttributes:function(e,t,r){for(var i=e.gl,n=this._program,a=this._locations,o=(o=r?r.__enabledAttributeList:Ve[e.__uid__])||(r?r.__enabledAttributeList=[]:Ve[e.__uid__]=[]),s=[],l=0;l<t.length;l++){var h=t[l];if(this.attributes[h]){var u=a[h];if(null==u){if(-1===(u=i.getAttribLocation(n,h))){s[l]=-1;continue}a[h]=u}o[s[l]=u]?o[u]=2:o[u]=1}else s[l]=-1}for(l=0;l<o.length;l++)switch(o[l]){case 1:i.enableVertexAttribArray(l),o[l]=3;break;case 2:o[l]=3;break;case 3:i.disableVertexAttribArray(l),o[l]=0}return s},getAttribLocation:function(e,t){var r=this._locations,i=r[t];return null==i&&(i=e.getAttribLocation(this._program,t),r[t]=i),i},buildProgram:function(e,t,r,i){var n=e.createShader(e.VERTEX_SHADER),a=e.createProgram(),o=(e.shaderSource(n,r),e.compileShader(n),e.createShader(e.FRAGMENT_SHADER)),s=(e.shaderSource(o,i),e.compileShader(o),He(e,n,r));if(s)return s;if(s=He(e,o,i))return s;if(e.attachShader(a,n),e.attachShader(a,o),t.attributeSemantics.POSITION?e.bindAttribLocation(a,0,t.attributeSemantics.POSITION.symbol):(s=Object.keys(this.attributes),e.bindAttribLocation(a,0,s[0])),e.linkProgram(a),e.deleteShader(n),e.deleteShader(o),this._program=a,this.vertexCode=r,this.fragmentCode=i,!e.getProgramParameter(a,e.LINK_STATUS))return\\\"Could not link program\\\\n\\\"+e.getProgramInfoLog(a);for(var l=0;l<t.uniforms.length;l++){var h=t.uniforms[l];this._locations[h]=e.getUniformLocation(a,h)}}});var Xe=/for\\\\s*?\\\\(int\\\\s*?_idx_\\\\s*\\\\=\\\\s*([\\\\w-]+)\\\\;\\\\s*_idx_\\\\s*<\\\\s*([\\\\w-]+);\\\\s*_idx_\\\\s*\\\\+\\\\+\\\\s*\\\\)\\\\s*\\\\{\\\\{([\\\\s\\\\S]+?)(?=\\\\}\\\\})\\\\}\\\\}/g;function qe(e,o,t){var r,s={};for(r in t)s[r+\\\"_COUNT\\\"]=t[r];return e.replace(Xe,function(e,t,r,i){var n=\\\"\\\";isNaN(t)&&(t=(t in o?o:s)[t]),isNaN(r)&&(r=(r in o?o:s)[r]);for(var a=parseInt(t);a<parseInt(r);a++)n+=\\\"{\\\"+i.replace(/float\\\\s*\\\\(\\\\s*_idx_\\\\s*\\\\)/g,a.toFixed(1)).replace(/_idx_/g,a)+\\\"}\\\";return n})}function Ze(e,t,r){var i=[];if(t)for(var n in t){var a=t[n];0<a&&i.push(\\\"#define \\\"+n.toUpperCase()+\\\"_COUNT \\\"+a)}if(r)for(var o=0;o<r.length;o++){var s=r[o];i.push(\\\"#define \\\"+s.toUpperCase()+\\\"_ENABLED\\\")}for(s in e){var l=e[s];i.push(null===l?\\\"#define \\\"+s:\\\"#define \\\"+s+\\\" \\\"+l.toString())}return i.join(\\\"\\\\n\\\")}function Ye(e){this._renderer=e,this._cache={}}Ye.prototype.getProgram=function(e,t,r){var i,n,a,o,s,l,h=this._cache,u=e.isSkinnedMesh&&e.isSkinnedMesh(),c=e.isInstancedMesh&&e.isInstancedMesh(),d=\\\"s\\\"+t.shader.shaderID+\\\"m\\\"+t.getProgramKey();return r&&(d+=\\\"se\\\"+r.getProgramKey(e.lightGroup)),u&&(d+=\\\",sk\\\"+e.joints.length),c&&(d+=\\\",is\\\"),(o=h[d])||(i=r?r.getLightsNumbers(e.lightGroup):{},a=(n=this._renderer).gl,s=t.getEnabledTextures(),l=\\\"\\\",u&&(u={SKINNING:null,JOINT_COUNT:e.joints.length},e.joints.length>n.getMaxJointNumber()&&(u.USE_SKIN_MATRICES_TEXTURE=null),l+=\\\"\\\\n\\\"+Ze(u)+\\\"\\\\n\\\"),c&&(l+=\\\"\\\\n#define INSTANCING\\\\n\\\"),u=l+Ze(t.vertexDefines,i,s),c=l+Ze(t.fragmentDefines,i,s),l=u+\\\"\\\\n\\\"+t.shader.vertex,0<=(s=[\\\"OES_standard_derivatives\\\",\\\"EXT_shader_texture_lod\\\"].filter(function(e){return null!=n.getGLExtension(e)})).indexOf(\\\"EXT_shader_texture_lod\\\")&&(c+=\\\"\\\\n#define SUPPORT_TEXTURE_LOD\\\"),0<=s.indexOf(\\\"OES_standard_derivatives\\\")&&(c+=\\\"\\\\n#define SUPPORT_STANDARD_DERIVATIVES\\\"),s=function(e){for(var t=[],r=0;r<e.length;r++)t.push(\\\"#extension GL_\\\"+e[r]+\\\" : enable\\\");return t.join(\\\"\\\\n\\\")}(s)+\\\"\\\\n\\\"+[\\\"precision\\\",u=t.precision,\\\"float\\\"].join(\\\" \\\")+\\\";\\\\n\\\"+[\\\"precision\\\",u,\\\"int\\\"].join(\\\" \\\")+\\\";\\\\n\\\"+[\\\"precision\\\",u,\\\"sampler2D\\\"].join(\\\" \\\")+\\\";\\\\n\\\\n\\\"+c+\\\"\\\\n\\\"+t.shader.fragment,u=qe(l,t.vertexDefines,i),c=qe(s,t.fragmentDefines,i),(o=new je).uniformSemantics=t.shader.uniformSemantics,o.attributes=t.shader.attributes,l=o.buildProgram(a,t.shader,u,c),o.__error=l,h[d]=o),o};const Ke=Ye;var Qe=/uniform\\\\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\\\\s+([\\\\s\\\\S]*?);/g,Je=/attribute\\\\s+(float|int|vec2|vec3|vec4)\\\\s+([\\\\s\\\\S]*?);/g,$e=/#define\\\\s+(\\\\w+)?(\\\\s+[\\\\d-.]+)?\\\\s*;?\\\\s*\\\\n/g,et={bool:\\\"1i\\\",\\\"int\\\":\\\"1i\\\",sampler2D:\\\"t\\\",samplerCube:\\\"t\\\",\\\"float\\\":\\\"1f\\\",vec2:\\\"2f\\\",vec3:\\\"3f\\\",vec4:\\\"4f\\\",ivec2:\\\"2i\\\",ivec3:\\\"3i\\\",ivec4:\\\"4i\\\",mat2:\\\"m2\\\",mat3:\\\"m3\\\",mat4:\\\"m4\\\"};function tt(e){for(var t=[],r=0;r<e;r++)t[r]=0;return t}var rt={bool:function(){return!0},\\\"int\\\":function(){return 0},\\\"float\\\":function(){return 0},sampler2D:function(){return null},samplerCube:function(){return null},vec2:function(){return tt(2)},vec3:function(){return tt(3)},vec4:function(){return tt(4)},ivec2:function(){return tt(2)},ivec3:function(){return tt(3)},ivec4:function(){return tt(4)},mat2:function(){return tt(4)},mat3:function(){return tt(9)},mat4:function(){return tt(16)},array:function(){return[]}},it=[\\\"POSITION\\\",\\\"NORMAL\\\",\\\"BINORMAL\\\",\\\"TANGENT\\\",\\\"TEXCOORD\\\",\\\"TEXCOORD_0\\\",\\\"TEXCOORD_1\\\",\\\"COLOR\\\",\\\"JOINT\\\",\\\"WEIGHT\\\"],nt=[\\\"SKIN_MATRIX\\\",\\\"VIEWPORT_SIZE\\\",\\\"VIEWPORT\\\",\\\"DEVICEPIXELRATIO\\\",\\\"WINDOW_SIZE\\\",\\\"NEAR\\\",\\\"FAR\\\",\\\"TIME\\\"],at=[\\\"WORLD\\\",\\\"VIEW\\\",\\\"PROJECTION\\\",\\\"WORLDVIEW\\\",\\\"VIEWPROJECTION\\\",\\\"WORLDVIEWPROJECTION\\\",\\\"WORLDINVERSE\\\",\\\"VIEWINVERSE\\\",\\\"PROJECTIONINVERSE\\\",\\\"WORLDVIEWINVERSE\\\",\\\"VIEWPROJECTIONINVERSE\\\",\\\"WORLDVIEWPROJECTIONINVERSE\\\",\\\"WORLDTRANSPOSE\\\",\\\"VIEWTRANSPOSE\\\",\\\"PROJECTIONTRANSPOSE\\\",\\\"WORLDVIEWTRANSPOSE\\\",\\\"VIEWPROJECTIONTRANSPOSE\\\",\\\"WORLDVIEWPROJECTIONTRANSPOSE\\\",\\\"WORLDINVERSETRANSPOSE\\\",\\\"VIEWINVERSETRANSPOSE\\\",\\\"PROJECTIONINVERSETRANSPOSE\\\",\\\"WORLDVIEWINVERSETRANSPOSE\\\",\\\"VIEWPROJECTIONINVERSETRANSPOSE\\\",\\\"WORLDVIEWPROJECTIONINVERSETRANSPOSE\\\"],ot={vec4:4,vec3:3,vec2:2,\\\"float\\\":1},st={},lt={};function ht(e){return e.replace(/[ \\\\t]*\\\\/\\\\/.*\\\\n/g,\\\"\\\").replace(/[ \\\\t]*\\\\/\\\\*[\\\\s\\\\S]*?\\\\*\\\\//g,\\\"\\\")}function ut(){console.error(\\\"Wrong uniform/attributes syntax\\\")}function ct(e,t){for(var r=/[,=\\\\(\\\\):]/,i=t.replace(/:\\\\s*\\\\[\\\\s*(.*)\\\\s*\\\\]/g,\\\"=\\\"+e+\\\"($1)\\\").replace(/\\\\s+/g,\\\"\\\").split(/(?=[,=\\\\(\\\\):])/g),n=[],a=0;a<i.length;a++)i[a].match(r)?n.push(i[a].charAt(0),i[a].slice(1)):n.push(i[a]);var o,s=0,l={},h=null;function u(e){e||ut();var t=e.match(/\\\\[(.*?)\\\\]/);o=e.replace(/\\\\[(.*?)\\\\]/,\\\"\\\"),l[o]={},t&&(l[o].isArray=!0,l[o].arraySize=t[1])}for(u((i=n)[0]),a=1;a<i.length;a++){var c,d=i[a];if(d)if(\\\"=\\\"!==d)if(\\\":\\\"!==d)if(\\\",\\\"!==d)if(\\\")\\\"!==d)if(\\\"(\\\"!==d)if(0<=d.indexOf(\\\"vec\\\")){if(1!==s&&4!==s){ut();break}s=2,h=[]}else 1!==s?4!==s?(u(d),s=0):0<=it.indexOf(c=d)||0<=nt.indexOf(c)||0<=at.indexOf(c)?l[o].semantic=c:\\\"ignore\\\"===c||\\\"unconfigurable\\\"===c?l[o].ignore=!0:l[o].value=\\\"bool\\\"===e?\\\"true\\\"===c:parseFloat(c):(l[o].value=\\\"bool\\\"===e?\\\"true\\\"===d:parseFloat(d),h=null);else{if(2!==s){ut();break}if(!(h instanceof Array)){ut();break}h.push(+i[++a])}else l[o].value=new _e.Float32Array(h),h=null,s=5;else if(2===s){if(!(h instanceof Array)){ut();break}h.push(+i[++a])}else s=5;else s=4;else{if(0!==s&&3!==s){ut();break}s=1}}return l}function dt(e,t){var r,i,n,a;\\\"object\\\"==typeof e&&(t=e.fragment,e=e.vertex),e=ht(e),t=ht(t),this._shaderID=st[a=\\\"vertex:\\\"+(r=e)+\\\"fragment:\\\"+(i=t)]||(n=X.genGUID(),st[a]=n,lt[n]={vertex:r,fragment:i},n),this._vertexCode=dt.parseImport(e),this._fragmentCode=dt.parseImport(t),this.attributeSemantics={},this.matrixSemantics={},this.uniformSemantics={},this.matrixSemanticKeys=[],this.uniformTemplates={},this.attributes={},this.textures={},this.vertexDefines={},this.fragmentDefines={},this._parseAttributes(),this._parseUniforms(),this._parseDefines()}dt.prototype={constructor:dt,createUniforms:function(){var e,t={};for(e in this.uniformTemplates){var r=this.uniformTemplates[e];t[e]={type:r.type,value:r.value()}}return t},_parseImport:function(){this._vertexCode=dt.parseImport(this.vertex),this._fragmentCode=dt.parseImport(this.fragment)},_addSemanticUniform:function(e,t,r){var i,n;0<=it.indexOf(r)?this.attributeSemantics[r]={symbol:e,type:t}:0<=at.indexOf(r)?(i=!1,(n=r).match(/TRANSPOSE$/)&&(i=!0,n=r.slice(0,-9)),this.matrixSemantics[r]={symbol:e,type:t,isTranspose:i,semanticNoTranspose:n}):0<=nt.indexOf(r)&&(this.uniformSemantics[r]={symbol:e,type:t})},_addMaterialUniform:function(e,t,r,i,n,a){a[e]={type:r,value:n?rt.array:i||rt[t],semantic:null}},_parseUniforms:function(){var c={},d=this;function e(e,t,r){var i,n=ct(t,r),a=[];for(i in n){var o=n[i],s=o.semantic,l=i,h=et[t],u=function(e){return null!=e?function(){return e}:null}(n[i].value);n[i].isArray&&(l+=\\\"[\\\"+n[i].arraySize+\\\"]\\\",h+=\\\"v\\\"),a.push(l),d._uniformList.push(i),o.ignore||(\\\"sampler2D\\\"!==t&&\\\"samplerCube\\\"!==t||(d.textures[i]={shaderType:\\\"fragment\\\",type:t}),s?d._addSemanticUniform(i,h,s):d._addMaterialUniform(i,t,h,u,n[i].isArray,c))}return 0<a.length?\\\"uniform \\\"+t+\\\" \\\"+a.join(\\\",\\\")+\\\";\\\\n\\\":\\\"\\\"}this._uniformList=[],this._vertexCode=this._vertexCode.replace(Qe,e),this._fragmentCode=this._fragmentCode.replace(Qe,e),d.matrixSemanticKeys=Object.keys(this.matrixSemantics),this.uniformTemplates=c},_parseAttributes:function(){var l={},h=this;this._vertexCode=this._vertexCode.replace(Je,function(e,t,r){var i,n=ct(t,r),a=ot[t]||1,o=[];for(i in n){var s=n[i].semantic;if(l[i]={type:\\\"float\\\",size:a,semantic:s||null},s){if(it.indexOf(s)<0)throw new Error('Unkown semantic \\\"'+s+'\\\"');h.attributeSemantics[s]={symbol:i,type:t}}o.push(i)}return\\\"attribute \\\"+t+\\\" \\\"+o.join(\\\",\\\")+\\\";\\\\n\\\"}),this.attributes=l},_parseDefines:function(){var n=this;function e(e,t,r){var i=n.fragmentDefines;return i[t]||(i[t]=\\\"false\\\"!==r&&(\\\"true\\\"===r||(r?isNaN(parseFloat(r))?r.trim():parseFloat(r):null))),\\\"\\\"}this._vertexCode=this._vertexCode.replace($e,e),this._fragmentCode=this._fragmentCode.replace($e,e)},clone:function(){var e=lt[this._shaderID];return new dt(e.vertex,e.fragment)}},Object.defineProperty&&(Object.defineProperty(dt.prototype,\\\"shaderID\\\",{get:function(){return this._shaderID}}),Object.defineProperty(dt.prototype,\\\"vertex\\\",{get:function(){return this._vertexCode}}),Object.defineProperty(dt.prototype,\\\"fragment\\\",{get:function(){return this._fragmentCode}}),Object.defineProperty(dt.prototype,\\\"uniforms\\\",{get:function(){return this._uniformList}}));var ft=/(@import)\\\\s*([0-9a-zA-Z_\\\\-\\\\.]*)/g,pt=(dt.parseImport=function(e){return e.replace(ft,function(e,t,r){return(e=dt.source(r))?dt.parseImport(e):(console.error('Shader chunk \\\"'+r+'\\\" not existed in library'),\\\"\\\")})},/(@export)\\\\s*([0-9a-zA-Z_\\\\-\\\\.]*)\\\\s*\\\\n([\\\\s\\\\S]*?)@end/g);dt[\\\"import\\\"]=function(e){e.replace(pt,function(e,t,r,i){if(i=i.replace(/(^[\\\\s\\\\t\\\\xa0\\\\u3000]+)|([\\\\u3000\\\\xa0\\\\s\\\\t]+\\\\x24)/g,\\\"\\\")){for(var n,a=r.split(\\\".\\\"),o=dt.codes,s=0;s<a.length-1;)o[n=a[s++]]||(o[n]={}),o=o[n];o[n=a[s]]=i}return i})},dt.codes={},dt.source=function(e){for(var t=e.split(\\\".\\\"),r=dt.codes,i=0;r&&i<t.length;)r=r[t[i++]];return\\\"string\\\"!=typeof r?(console.error('Shader \\\"'+e+'\\\" not existed in library'),\\\"\\\"):r};const S=dt,mt=\\\"@export clay.prez.vertex\\\\nuniform mat4 WVP : WORLDVIEWPROJECTION;\\\\nattribute vec3 pos : POSITION;\\\\nattribute vec2 uv : TEXCOORD_0;\\\\nuniform vec2 uvRepeat : [1.0, 1.0];\\\\nuniform vec2 uvOffset : [0.0, 0.0];\\\\n@import clay.chunk.skinning_header\\\\n@import clay.chunk.instancing_header\\\\nvarying vec2 v_Texcoord;\\\\nvoid main()\\\\n{\\\\n vec4 P = vec4(pos, 1.0);\\\\n#ifdef SKINNING\\\\n @import clay.chunk.skin_matrix\\\\n P = skinMatrixWS * P;\\\\n#endif\\\\n#ifdef INSTANCING\\\\n @import clay.chunk.instancing_matrix\\\\n P = instanceMat * P;\\\\n#endif\\\\n gl_Position = WVP * P;\\\\n v_Texcoord = uv * uvRepeat + uvOffset;\\\\n}\\\\n@end\\\\n@export clay.prez.fragment\\\\nuniform sampler2D alphaMap;\\\\nuniform float alphaCutoff: 0.0;\\\\nvarying vec2 v_Texcoord;\\\\nvoid main()\\\\n{\\\\n if (alphaCutoff > 0.0) {\\\\n if (texture2D(alphaMap, v_Texcoord).a <= alphaCutoff) {\\\\n discard;\\\\n }\\\\n }\\\\n gl_FragColor = vec4(0.0,0.0,0.0,1.0);\\\\n}\\\\n@end\\\";var gt={create:function(){var e=new Ge(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},clone:function(e){var t=new Ge(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},transpose:function(e,t){var r,i,n,a,o,s;return e===t?(r=t[1],i=t[2],n=t[3],a=t[6],o=t[7],s=t[11],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=a,e[11]=t[14],e[12]=n,e[13]=o,e[14]=s):(e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15]),e},invert:function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=t[6],h=t[7],u=t[8],c=t[9],d=t[10],f=t[11],p=t[12],m=t[13],g=t[14],_=t[15],v=r*s-i*o,y=r*l-n*o,x=r*h-a*o,b=i*l-n*s,w=i*h-a*s,T=n*h-a*l,S=u*m-c*p,M=u*g-d*p,A=u*_-f*p,E=c*g-d*m,C=c*_-f*m,D=d*_-f*g,L=v*D-y*C+x*E+b*A-w*M+T*S;return L?(e[0]=(s*D-l*C+h*E)*(L=1/L),e[1]=(n*C-i*D-a*E)*L,e[2]=(m*T-g*w+_*b)*L,e[3]=(d*w-c*T-f*b)*L,e[4]=(l*A-o*D-h*M)*L,e[5]=(r*D-n*A+a*M)*L,e[6]=(g*x-p*T-_*y)*L,e[7]=(u*T-d*x+f*y)*L,e[8]=(o*C-s*A+h*S)*L,e[9]=(i*A-r*C-a*S)*L,e[10]=(p*w-m*x+_*v)*L,e[11]=(c*x-u*w-f*v)*L,e[12]=(s*M-o*E-l*S)*L,e[13]=(r*E-i*M+n*S)*L,e[14]=(m*y-p*b-g*v)*L,e[15]=(u*b-c*y+d*v)*L,e):null},adjoint:function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=t[6],h=t[7],u=t[8],c=t[9],d=t[10],f=t[11],p=t[12],m=t[13],g=t[14],_=t[15];return e[0]=s*(d*_-f*g)-c*(l*_-h*g)+m*(l*f-h*d),e[1]=-(i*(d*_-f*g)-c*(n*_-a*g)+m*(n*f-a*d)),e[2]=i*(l*_-h*g)-s*(n*_-a*g)+m*(n*h-a*l),e[3]=-(i*(l*f-h*d)-s*(n*f-a*d)+c*(n*h-a*l)),e[4]=-(o*(d*_-f*g)-u*(l*_-h*g)+p*(l*f-h*d)),e[5]=r*(d*_-f*g)-u*(n*_-a*g)+p*(n*f-a*d),e[6]=-(r*(l*_-h*g)-o*(n*_-a*g)+p*(n*h-a*l)),e[7]=r*(l*f-h*d)-o*(n*f-a*d)+u*(n*h-a*l),e[8]=o*(c*_-f*m)-u*(s*_-h*m)+p*(s*f-h*c),e[9]=-(r*(c*_-f*m)-u*(i*_-a*m)+p*(i*f-a*c)),e[10]=r*(s*_-h*m)-o*(i*_-a*m)+p*(i*h-a*s),e[11]=-(r*(s*f-h*c)-o*(i*f-a*c)+u*(i*h-a*s)),e[12]=-(o*(c*g-d*m)-u*(s*g-l*m)+p*(s*d-l*c)),e[13]=r*(c*g-d*m)-u*(i*g-n*m)+p*(i*d-n*c),e[14]=-(r*(s*g-l*m)-o*(i*g-n*m)+p*(i*l-n*s)),e[15]=r*(s*d-l*c)-o*(i*d-n*c)+u*(i*l-n*s),e},determinant:function(e){var t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],o=e[5],s=e[6],l=e[7],h=e[8],u=e[9],c=e[10],d=e[11],f=e[12],p=e[13],m=e[14],g=e[15];return(t*o-r*a)*(c*g-d*m)-(t*s-i*a)*(u*g-d*p)+(t*l-n*a)*(u*m-c*p)+(r*s-i*o)*(h*g-d*f)-(r*l-n*o)*(h*m-c*f)+(i*l-n*s)*(h*p-u*f)},multiply:function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],h=t[6],u=t[7],c=t[8],d=t[9],f=t[10],p=t[11],m=t[12],g=t[13],_=t[14],v=t[15],y=r[0],x=r[1],b=r[2],w=r[3];return e[0]=y*i+x*s+b*c+w*m,e[1]=y*n+x*l+b*d+w*g,e[2]=y*a+x*h+b*f+w*_,e[3]=y*o+x*u+b*p+w*v,y=r[4],x=r[5],b=r[6],w=r[7],e[4]=y*i+x*s+b*c+w*m,e[5]=y*n+x*l+b*d+w*g,e[6]=y*a+x*h+b*f+w*_,e[7]=y*o+x*u+b*p+w*v,y=r[8],x=r[9],b=r[10],w=r[11],e[8]=y*i+x*s+b*c+w*m,e[9]=y*n+x*l+b*d+w*g,e[10]=y*a+x*h+b*f+w*_,e[11]=y*o+x*u+b*p+w*v,y=r[12],x=r[13],b=r[14],w=r[15],e[12]=y*i+x*s+b*c+w*m,e[13]=y*n+x*l+b*d+w*g,e[14]=y*a+x*h+b*f+w*_,e[15]=y*o+x*u+b*p+w*v,e},multiplyAffine:function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[4],s=t[5],l=t[6],h=t[8],u=t[9],c=t[10],d=t[12],f=t[13],p=t[14],m=r[0],g=r[1],_=r[2];return e[0]=m*i+g*o+_*h,e[1]=m*n+g*s+_*u,e[2]=m*a+g*l+_*c,m=r[4],g=r[5],_=r[6],e[4]=m*i+g*o+_*h,e[5]=m*n+g*s+_*u,e[6]=m*a+g*l+_*c,m=r[8],g=r[9],_=r[10],e[8]=m*i+g*o+_*h,e[9]=m*n+g*s+_*u,e[10]=m*a+g*l+_*c,m=r[12],g=r[13],_=r[14],e[12]=m*i+g*o+_*h+d,e[13]=m*n+g*s+_*u+f,e[14]=m*a+g*l+_*c+p,e}};gt.mul=gt.multiply,gt.mulAffine=gt.multiplyAffine,gt.translate=function(e,t,r){var i,n,a,o,s,l,h,u,c,d,f,p,m=r[0],g=r[1],_=r[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*_+t[12],e[13]=t[1]*m+t[5]*g+t[9]*_+t[13],e[14]=t[2]*m+t[6]*g+t[10]*_+t[14],e[15]=t[3]*m+t[7]*g+t[11]*_+t[15]):(i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],h=t[6],u=t[7],c=t[8],d=t[9],f=t[10],p=t[11],e[0]=i,e[1]=n,e[2]=a,e[3]=o,e[4]=s,e[5]=l,e[6]=h,e[7]=u,e[8]=c,e[9]=d,e[10]=f,e[11]=p,e[12]=i*m+s*g+c*_+t[12],e[13]=n*m+l*g+d*_+t[13],e[14]=a*m+h*g+f*_+t[14],e[15]=o*m+u*g+p*_+t[15]),e},gt.scale=function(e,t,r){var i=r[0],n=r[1],a=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},gt.rotate=function(e,t,r,i){var n,a,o,s,l,h,u,c,d,f,p,m,g,_,v,y,x,b,w,T,S,M=i[0],A=i[1],E=i[2],C=Math.sqrt(M*M+A*A+E*E);return Math.abs(C)<1e-6?null:(M*=C=1/C,A*=C,E*=C,C=Math.sin(r),n=1-(_=Math.cos(r)),a=t[0],o=t[1],s=t[2],l=t[3],h=t[4],u=t[5],c=t[6],d=t[7],f=t[8],p=t[9],m=t[10],g=t[11],y=M*A*n-E*C,x=A*A*n+_,b=E*A*n+M*C,w=M*E*n+A*C,T=A*E*n-M*C,S=E*E*n+_,e[0]=a*(_=M*M*n+_)+h*(v=A*M*n+E*C)+f*(E=E*M*n-A*C),e[1]=o*_+u*v+p*E,e[2]=s*_+c*v+m*E,e[3]=l*_+d*v+g*E,e[4]=a*y+h*x+f*b,e[5]=o*y+u*x+p*b,e[6]=s*y+c*x+m*b,e[7]=l*y+d*x+g*b,e[8]=a*w+h*T+f*S,e[9]=o*w+u*T+p*S,e[10]=s*w+c*T+m*S,e[11]=l*w+d*T+g*S,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},gt.rotateX=function(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[4],o=t[5],s=t[6],l=t[7],h=t[8],u=t[9],c=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*n+h*i,e[5]=o*n+u*i,e[6]=s*n+c*i,e[7]=l*n+d*i,e[8]=h*n-a*i,e[9]=u*n-o*i,e[10]=c*n-s*i,e[11]=d*n-l*i,e},gt.rotateY=function(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[0],o=t[1],s=t[2],l=t[3],h=t[8],u=t[9],c=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n-h*i,e[1]=o*n-u*i,e[2]=s*n-c*i,e[3]=l*n-d*i,e[8]=a*i+h*n,e[9]=o*i+u*n,e[10]=s*i+c*n,e[11]=l*i+d*n,e},gt.rotateZ=function(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[0],o=t[1],s=t[2],l=t[3],h=t[4],u=t[5],c=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n+h*i,e[1]=o*n+u*i,e[2]=s*n+c*i,e[3]=l*n+d*i,e[4]=h*n-a*i,e[5]=u*n-o*i,e[6]=c*n-s*i,e[7]=d*n-l*i,e},gt.fromRotationTranslation=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=i+i,l=n+n,h=a+a,u=i*s,c=i*l,i=i*h,d=n*l,n=n*h,a=a*h,s=o*s,l=o*l,o=o*h;return e[0]=1-(d+a),e[1]=c+o,e[2]=i-l,e[3]=0,e[4]=c-o,e[5]=1-(u+a),e[6]=n+s,e[7]=0,e[8]=i+l,e[9]=n-s,e[10]=1-(u+d),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},gt.fromQuat=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=r+r,s=i+i,l=n+n,r=r*o,h=i*o,i=i*s,u=n*o,c=n*s,n=n*l,o=a*o,s=a*s,a=a*l;return e[0]=1-i-n,e[1]=h+a,e[2]=u-s,e[3]=0,e[4]=h-a,e[5]=1-r-n,e[6]=c+o,e[7]=0,e[8]=u+s,e[9]=c-o,e[10]=1-r-i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},gt.frustum=function(e,t,r,i,n,a,o){var s=1/(r-t),l=1/(n-i),h=1/(a-o);return e[0]=2*a*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*l,e[6]=0,e[7]=0,e[8]=(r+t)*s,e[9]=(n+i)*l,e[10]=(o+a)*h,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*a*2*h,e[15]=0,e},gt.perspective=function(e,t,r,i,n){var a=1/Math.tan(t/2),o=1/(i-n);return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(n+i)*o,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*n*i*o,e[15]=0,e},gt.ortho=function(e,t,r,i,n,a,o){var s=1/(t-r),l=1/(i-n),h=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*h,e[11]=0,e[12]=(t+r)*s,e[13]=(n+i)*l,e[14]=(o+a)*h,e[15]=1,e},gt.lookAt=function(e,t,r,i){var n,a,o,s,l=t[0],h=t[1],u=t[2],c=i[0],d=i[1],f=i[2],p=r[0],m=r[1],g=r[2];return Math.abs(l-p)<1e-6&&Math.abs(h-m)<1e-6&&Math.abs(u-g)<1e-6?gt.identity(e):(p=l-p,m=h-m,g=u-g,n=d*(g*=s=1/Math.sqrt(p*p+m*m+g*g))-f*(m*=s),f=f*(p*=s)-c*g,c=c*m-d*p,(s=Math.sqrt(n*n+f*f+c*c))?(n*=s=1/s,f*=s,c*=s):c=f=n=0,d=m*c-g*f,a=g*n-p*c,o=p*f-m*n,(s=Math.sqrt(d*d+a*a+o*o))?(d*=s=1/s,a*=s,o*=s):o=a=d=0,e[0]=n,e[1]=d,e[2]=p,e[3]=0,e[4]=f,e[5]=a,e[6]=m,e[7]=0,e[8]=c,e[9]=o,e[10]=g,e[11]=0,e[12]=-(n*l+f*h+c*u),e[13]=-(d*l+a*h+o*u),e[14]=-(p*l+m*h+g*u),e[15]=1,e)},gt.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))};const G=gt;var _t,a={create:function(){var e=new Ge(3);return e[0]=0,e[1]=0,e[2]=0,e},clone:function(e){var t=new Ge(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},fromValues:function(e,t,r){var i=new Ge(3);return i[0]=e,i[1]=t,i[2]=r,i},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},set:function(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},subtract:function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}};a.sub=a.subtract,a.multiply=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e},a.mul=a.multiply,a.divide=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e},a.div=a.divide,a.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e},a.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e},a.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},a.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e},a.distance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return Math.sqrt(r*r+i*i+n*n)},a.dist=a.distance,a.squaredDistance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return r*r+i*i+n*n},a.sqrDist=a.squaredDistance,a.length=function(e){var t=e[0],r=e[1],i=e[2];return Math.sqrt(t*t+r*r+i*i)},a.len=a.length,a.squaredLength=function(e){var t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i},a.sqrLen=a.squaredLength,a.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},a.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},a.normalize=function(e,t){var r=t[0],i=t[1],n=t[2],r=r*r+i*i+n*n;return 0<r&&(r=1/Math.sqrt(r),e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r),e},a.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},a.cross=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=r[0],s=r[1],l=r[2];return e[0]=n*l-a*s,e[1]=a*o-i*l,e[2]=i*s-n*o,e},a.lerp=function(e,t,r,i){var n=t[0],a=t[1],o=t[2];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e[2]=o+i*(r[2]-o),e},a.random=function(e,t){t=t||1;var r=2*Ue()*Math.PI,i=2*Ue()-1,n=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*n,e[1]=Math.sin(r)*n,e[2]=i*t,e},a.transformMat4=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=r[3]*i+r[7]*n+r[11]*a+r[15];return e[0]=(r[0]*i+r[4]*n+r[8]*a+r[12])/(o=o||1),e[1]=(r[1]*i+r[5]*n+r[9]*a+r[13])/o,e[2]=(r[2]*i+r[6]*n+r[10]*a+r[14])/o,e},a.transformMat3=function(e,t,r){var i=t[0],n=t[1],a=t[2];return e[0]=i*r[0]+n*r[3]+a*r[6],e[1]=i*r[1]+n*r[4]+a*r[7],e[2]=i*r[2]+n*r[5]+a*r[8],e},a.transformQuat=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=r[0],s=r[1],l=r[2],h=r[3],u=h*i+s*a-l*n,c=h*n+l*i-o*a,d=h*a+o*n-s*i,i=-o*i-s*n-l*a;return e[0]=u*h+i*-o+c*-l-d*-s,e[1]=c*h+i*-s+d*-o-u*-l,e[2]=d*h+i*-l+u*-s-c*-o,e},a.rotateX=function(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[0],a[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),a[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},a.rotateY=function(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),a[1]=n[1],a[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},a.rotateZ=function(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),a[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),a[2]=n[2],e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},a.forEach=(_t=a.create(),function(e,t,r,i,n,a){var o,s;for(t=t||3,r=r||0,s=i?Math.min(i*t+r,e.length):e.length,o=r;o<s;o+=t)_t[0]=e[o],_t[1]=e[o+1],_t[2]=e[o+2],n(_t,_t,a),e[o]=_t[0],e[o+1]=_t[1],e[o+2]=_t[2];return e}),a.angle=function(e,t){var r=a.fromValues(e[0],e[1],e[2]),i=a.fromValues(t[0],t[1],t[2]),r=(a.normalize(r,r),a.normalize(i,i),a.dot(r,i));return 1<r?0:Math.acos(r)};const R=a;S[\\\"import\\\"](mt);var m=G.create,vt={};function yt(e){return e.material}function xt(e,t,r){return t.uniforms[r].value}function bt(e,t,r,i){return r!==i}function wt(e){return!0}function Tt(){}var St={\\\"float\\\":re,\\\"byte\\\":5120,ubyte:te,\\\"short\\\":5122,ushort:5123};function Mt(e,t,r){this.availableAttributes=e,this.availableAttributeSymbols=t,this.indicesBuffer=r,this.vao=null}function At(e){var i,n;this.bind=function(e){i||((i=_e.createCanvas()).width=i.height=1,i.getContext(\\\"2d\\\"));var t=e.gl,r=!n;r&&(n=t.createTexture()),t.bindTexture(t.TEXTURE_2D,n),r&&t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i)},this.unbind=function(e){e.gl.bindTexture(e.gl.TEXTURE_2D,null)},this.isRenderable=function(){return!0}}var e=N.extend(function(){return{canvas:null,_width:100,_height:100,devicePixelRatio:\\\"undefined\\\"!=typeof window&&window.devicePixelRatio||1,clearColor:[0,0,0,0],clearBit:17664,alpha:!0,depth:!0,stencil:!1,antialias:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!1,throwError:!0,gl:null,viewport:{},maxJointNumber:20,__currentFrameBuffer:null,_viewportStack:[],_clearStack:[],_sceneRendering:null}},function(){this.canvas||(this.canvas=_e.createCanvas());var e=this.canvas;try{var t={alpha:this.alpha,depth:this.depth,stencil:this.stencil,antialias:this.antialias,premultipliedAlpha:this.premultipliedAlpha,preserveDrawingBuffer:this.preserveDrawingBuffer};if(this.gl=e.getContext(\\\"webgl\\\",t)||e.getContext(\\\"experimental-webgl\\\",t),!this.gl)throw new Error;this._glinfo=new K(this.gl),this.gl.targetRenderer&&console.error(\\\"Already created a renderer\\\"),(this.gl.targetRenderer=this).resize()}catch(e){throw\\\"Error creating WebGL Context \\\"+e}this._programMgr=new Ke(this),this._placeholderTexture=new At},{resize:function(e,t){var r=this.canvas,i=this.devicePixelRatio;null!=e?(r.style&&(r.style.width=e+\\\"px\\\",r.style.height=t+\\\"px\\\"),r.width=e*i,r.height=t*i,this._width=e,this._height=t):(this._width=r.width/i,this._height=r.height/i),this.setViewport(0,0,this._width,this._height)},getWidth:function(){return this._width},getHeight:function(){return this._height},getViewportAspect:function(){var e=this.viewport;return e.width/e.height},setDevicePixelRatio:function(e){this.devicePixelRatio=e,this.resize(this._width,this._height)},getDevicePixelRatio:function(){return this.devicePixelRatio},getGLExtension:function(e){return this._glinfo.getExtension(e)},getGLParameter:function(e){return this._glinfo.getParameter(e)},setViewport:function(e,t,r,i,n){var a;\\\"object\\\"==typeof e&&(e=(a=e).x,t=a.y,r=a.width,i=a.height,n=a.devicePixelRatio),n=n||this.devicePixelRatio,this.gl.viewport(e*n,t*n,r*n,i*n),this.viewport={x:e,y:t,width:r,height:i,devicePixelRatio:n}},saveViewport:function(){this._viewportStack.push(this.viewport)},restoreViewport:function(){0<this._viewportStack.length&&this.setViewport(this._viewportStack.pop())},saveClear:function(){this._clearStack.push({clearBit:this.clearBit,clearColor:this.clearColor})},restoreClear:function(){var e;0<this._clearStack.length&&(e=this._clearStack.pop(),this.clearColor=e.clearColor,this.clearBit=e.clearBit)},bindSceneRendering:function(e){this._sceneRendering=e},render:function(e,t,r,i){var n,a=this.gl,o=this.clearColor;if(this.clearBit&&(a.colorMask(!0,!0,!0,!0),a.depthMask(!0),n=!1,l=(s=this.viewport).devicePixelRatio,(s.width!==this._width||s.height!==this._height||l&&l!==this.devicePixelRatio||s.x||s.y)&&(n=!0,a.enable(a.SCISSOR_TEST),a.scissor(s.x*l,s.y*l,s.width*l,s.height*l)),a.clearColor(o[0],o[1],o[2],o[3]),a.clear(this.clearBit),n)&&a.disable(a.SCISSOR_TEST),r||e.update(!1),e.updateLights(),t=t||e.getMainCamera()){t.update();var s=e.updateRenderList(t,!0),l=(this._sceneRendering=e,s.opaque),h=s.transparent,u=e.material;e.trigger(\\\"beforerender\\\",this,e,t,s),i?(this.renderPreZ(l,e,t),a.depthFunc(a.LEQUAL)):a.depthFunc(a.LESS);for(var c=m(),d=R.create(),f=0;f<h.length;f++){var p=h[f];G.multiplyAffine(c,t.viewMatrix.array,p.worldTransform.array),R.transformMat4(d,p.position.array,c),p.__depth=d[2]}this.renderPass(l,t,{getMaterial:function(e){return u||e.material},sortCompare:this.opaqueSortCompare}),this.renderPass(h,t,{getMaterial:function(e){return u||e.material},sortCompare:this.transparentSortCompare}),e.trigger(\\\"afterrender\\\",this,e,t,s),this._sceneRendering=null}else console.error(\\\"Can't find camera in the scene.\\\")},getProgram:function(e,t,r){return t=t||e.material,this._programMgr.getProgram(e,t,r)},validateProgram:function(e){if(e.__error){var t=e.__error;if(!vt[e.__uid__]){if(vt[e.__uid__]=!0,this.throwError)throw new Error(t);this.trigger(\\\"error\\\",t)}}},updatePrograms:function(e,t,r){var i=r&&r.getMaterial||yt;t=t||null;for(var n=0;n<e.length;n++){var a=e[n],o=i.call(this,a);if(0<n){var s=e[n-1],l=s.joints?s.joints.length:0;if((a.joints?a.joints.length:0)===l&&a.material===s.material&&a.lightGroup===s.lightGroup){a.__program=s.__program;continue}}l=this._programMgr.getProgram(a,o,t);this.validateProgram(l),a.__program=l}},renderPass:function(e,t,r){this.trigger(\\\"beforerenderpass\\\",this,e,t,r),(r=r||{}).getMaterial=r.getMaterial||yt,r.getUniform=r.getUniform||xt,r.isMaterialChanged=r.isMaterialChanged||bt,r.beforeRender=r.beforeRender||Tt,r.afterRender=r.afterRender||Tt;var i=r.ifRender||wt,n=(this.updatePrograms(e,this._sceneRendering,r),r.sortCompare&&e.sort(r.sortCompare),this.viewport),a=n.devicePixelRatio,o=[n.x*a,n.y*a,n.width*a,n.height*a],n=this.devicePixelRatio,s=this.__currentFrameBuffer?[this.__currentFrameBuffer.getTextureWidth(),this.__currentFrameBuffer.getTextureHeight()]:[this._width*n,this._height*n],l=[o[2],o[3]],B=Date.now();t?(G.copy(U.VIEW,t.viewMatrix.array),G.copy(U.PROJECTION,t.projectionMatrix.array),G.copy(U.VIEWINVERSE,t.worldTransform.array)):(G.identity(U.VIEW),G.identity(U.PROJECTION),G.identity(U.VIEWINVERSE)),G.multiply(U.VIEWPROJECTION,U.PROJECTION,U.VIEW),G.invert(U.PROJECTIONINVERSE,U.PROJECTION),G.invert(U.VIEWPROJECTIONINVERSE,U.VIEWPROJECTION);for(var h,u,c,d,f,p,m,g,_,v,y,x=this.gl,b=this._sceneRendering,w=0;w<e.length;w++){var T,S=e[w],M=null!=S.worldTransform;if(i(S)){M&&(T=S.isSkinnedMesh&&S.isSkinnedMesh()?S.offsetMatrix?S.offsetMatrix.array:U.IDENTITY:S.worldTransform.array);var A=S.geometry,E=r.getMaterial.call(this,S),C=S.__program,D=E.shader,L=A.__uid__+\\\"-\\\"+C.__uid__,F=L!==z,z=L,L=(M&&(G.copy(U.WORLD,T),G.multiply(U.WORLDVIEWPROJECTION,U.VIEWPROJECTION,T),G.multiplyAffine(U.WORLDVIEW,U.VIEW,T),(D.matrixSemantics.WORLDINVERSE||D.matrixSemantics.WORLDINVERSETRANSPOSE)&&G.invert(U.WORLDINVERSE,T),(D.matrixSemantics.WORLDVIEWINVERSE||D.matrixSemantics.WORLDVIEWINVERSETRANSPOSE)&&G.invert(U.WORLDVIEWINVERSE,U.WORLDVIEW),D.matrixSemantics.WORLDVIEWPROJECTIONINVERSE||D.matrixSemantics.WORLDVIEWPROJECTIONINVERSETRANSPOSE)&&G.invert(U.WORLDVIEWPROJECTIONINVERSE,U.WORLDVIEWPROJECTION),S.beforeRender&&S.beforeRender(this),r.beforeRender.call(this,S,E,h),C!==u),P=(L?(C.bind(this),C.setUniformOfSemantic(x,\\\"VIEWPORT\\\",o),C.setUniformOfSemantic(x,\\\"WINDOW_SIZE\\\",s),t&&(C.setUniformOfSemantic(x,\\\"NEAR\\\",t.near),C.setUniformOfSemantic(x,\\\"FAR\\\",t.far)),C.setUniformOfSemantic(x,\\\"DEVICEPIXELRATIO\\\",a),C.setUniformOfSemantic(x,\\\"TIME\\\",B),C.setUniformOfSemantic(x,\\\"VIEWPORT_SIZE\\\",l),b&&b.setLightUniforms(C,S.lightGroup,this)):C=u,(L||r.isMaterialChanged(S,c,E,h))&&(E.depthTest!==d&&(E.depthTest?x.enable(x.DEPTH_TEST):x.disable(x.DEPTH_TEST),d=E.depthTest),E.depthMask!==f&&(x.depthMask(E.depthMask),f=E.depthMask),E.transparent!==_&&(E.transparent?x.enable(x.BLEND):x.disable(x.BLEND),_=E.transparent),E.transparent&&(E.blend?E.blend(x):(x.blendEquationSeparate(x.FUNC_ADD,x.FUNC_ADD),x.blendFuncSeparate(x.SRC_ALPHA,x.ONE_MINUS_SRC_ALPHA,x.ONE,x.ONE_MINUS_SRC_ALPHA))),y=this._bindMaterial(S,E,C,c||null,h||null,u||null,r.getUniform),h=E),D.matrixSemanticKeys);if(M)for(var O=0;O<P.length;O++){var N,I=P[O],R=D.matrixSemantics[I],I=U[I];R.isTranspose&&(N=U[R.semanticNoTranspose],G.transpose(I,N)),C.setUniform(x,R.type,R.symbol,I)}S.cullFace!==m&&(m=S.cullFace,x.cullFace(m)),S.frontFace!==g&&(g=S.frontFace,x.frontFace(g)),S.culling!==p&&((p=S.culling)?x.enable(x.CULL_FACE):x.disable(x.CULL_FACE)),this._updateSkeleton(S,C,y),F&&(v=this._bindVAO(null,D,A,C)),this._renderObject(S,v,C),r.afterRender(this,S),S.afterRender&&S.afterRender(this),u=C,c=S}}this.trigger(\\\"afterrenderpass\\\",this,e,t,r)},getMaxJointNumber:function(){return this.maxJointNumber},_updateSkeleton:function(e,t,r){var i,n=this.gl,a=e.skeleton;a&&(a.update(),e.joints.length>this.getMaxJointNumber()?(i=a.getSubSkinMatricesTexture(e.__uid__,e.joints),t.useTextureSlot(this,i,r),t.setUniform(n,\\\"1i\\\",\\\"skinMatricesTexture\\\",r),t.setUniform(n,\\\"1f\\\",\\\"skinMatricesTextureSize\\\",i.width)):(i=a.getSubSkinMatrices(e.__uid__,e.joints),t.setUniformOfSemantic(n,\\\"SKIN_MATRIX\\\",i)))},_renderObject:function(e,t,r){var i,n,a=this.gl,o=e.geometry,s=e.mode,l=(null==s&&(s=4),null),h=e.isInstancedMesh&&e.isInstancedMesh();if(!h||(l=this.getGLExtension(\\\"ANGLE_instanced_arrays\\\"))){if(h&&(i=this._bindInstancedAttributes(e,r,l)),t.indicesBuffer?(n=this.getGLExtension(\\\"OES_element_index_uint\\\")&&o.indices instanceof Uint32Array?a.UNSIGNED_INT:a.UNSIGNED_SHORT,h?l.drawElementsInstancedANGLE(s,t.indicesBuffer.count,n,0,e.getInstanceCount()):a.drawElements(s,t.indicesBuffer.count,n,0)):h?l.drawArraysInstancedANGLE(s,0,o.vertexCount,e.getInstanceCount()):a.drawArrays(s,0,o.vertexCount),h)for(var u=0;u<i.length;u++)a.disableVertexAttribArray(i[u])}else console.warn(\\\"Device not support ANGLE_instanced_arrays extension\\\")},_bindInstancedAttributes:function(e,t,r){for(var i=this.gl,n=e.getInstancedAttributesBuffers(this),a=[],o=0;o<n.length;o++){var s,l=n[o],h=t.getAttribLocation(i,l.symbol);h<0||(s=St[l.type]||i.FLOAT,i.enableVertexAttribArray(h),i.bindBuffer(i.ARRAY_BUFFER,l.buffer),i.vertexAttribPointer(h,l.size,s,!1,0,0),r.vertexAttribDivisorANGLE(h,l.divisor),a.push(h))}return a},_bindMaterial:function(e,t,r,i,n,a,o){for(var s=this.gl,l=a===r,h=r.currentTextureSlot(),u=t.getEnabledUniforms(),c=t.getTextureUniforms(),d=this._placeholderTexture,f=0;f<c.length;f++){var p=o(e,t,v=c[f]);if(\\\"t\\\"===(g=t.uniforms[v].type)&&p)p.__slot=-1;else if(\\\"tv\\\"===g)for(var m=0;m<p.length;m++)p[m]&&(p[m].__slot=-1)}for(d.__slot=-1,f=0;f<u.length;f++){var g,_,v=u[f],y=t.uniforms[v],x=(p=o(e,t,v),\\\"t\\\"===(g=y.type));if(!x||p&&p.isRenderable()||(p=d),n&&l){var b=o(i,n,v);if((b=!x||b&&b.isRenderable()?b:d)===p){if(x)r.takeCurrentTextureSlot(this,null);else if(\\\"tv\\\"===g&&p)for(m=0;m<p.length;m++)r.takeCurrentTextureSlot(this,null);continue}}if(null!=p)if(x)p.__slot<0?(_=r.currentTextureSlot(),r.setUniform(s,\\\"1i\\\",v,_)&&(r.takeCurrentTextureSlot(this,p),p.__slot=_)):r.setUniform(s,\\\"1i\\\",v,p.__slot);else if(Array.isArray(p)){if(0!==p.length)if(\\\"tv\\\"===g){if(r.hasUniform(v)){for(var w=[],m=0;m<p.length;m++){var T=p[m];T.__slot<0?(_=r.currentTextureSlot(),w.push(_),r.takeCurrentTextureSlot(this,T),T.__slot=_):w.push(T.__slot)}r.setUniform(s,\\\"1iv\\\",v,w)}}else r.setUniform(s,y.type,v,p)}else r.setUniform(s,y.type,v,p)}var S=r.currentTextureSlot();return r.resetTextureSlot(h),S},_bindVAO:function(e,t,r,i){var n=!r.dynamic,a=this.gl,o=this.__uid__+\\\"-\\\"+i.__uid__,s=r.__vaoCache[o];if(!s){var l=r.getBufferChunks(this);if(!l||!l.length)return;for(var l=l[0],h=l.attributeBuffers,l=l.indicesBuffer,u=[],c=[],d=0;d<h.length;d++){var f=(g=h[d]).name,p=g.semantic;(p=p?(p=t.attributeSemantics[p])&&p.symbol:f)&&i.attributes[p]&&(u.push(g),c.push(p))}s=new Mt(u,c,l),n&&(r.__vaoCache[o]=s)}o=!0;if(e&&n&&(null==s.vao?s.vao=e.createVertexArrayOES():o=!1,e.bindVertexArrayOES(s.vao)),u=s.availableAttributes,l=s.indicesBuffer,o){for(var m=i.enableAttributes(this,s.availableAttributeSymbols,e&&n&&s),d=0;d<u.length;d++){var g,_,v,y,x=m[d];-1!==x&&(_=(g=u[d]).buffer,v=g.size,y=St[g.type]||a.FLOAT,a.bindBuffer(a.ARRAY_BUFFER,_),a.vertexAttribPointer(x,v,y,!1,0,0))}r.isUseIndices()&&a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,l.buffer)}return s},renderPreZ:function(e,t,r){var i=this.gl,n=this._prezMaterial||new Fe({shader:new S(S.source(\\\"clay.prez.vertex\\\"),S.source(\\\"clay.prez.fragment\\\"))});this._prezMaterial=n,i.colorMask(!1,!1,!1,!1),i.depthMask(!0),this.renderPass(e,r,{ifRender:function(e){return!e.ignorePreZ},isMaterialChanged:function(e,t){var r=e.material,i=t.material;return r.get(\\\"diffuseMap\\\")!==i.get(\\\"diffuseMap\\\")||(r.get(\\\"alphaCutoff\\\")||0)!==(i.get(\\\"alphaCutoff\\\")||0)},getUniform:function(e,t,r){return\\\"alphaMap\\\"===r?e.material.get(\\\"diffuseMap\\\"):\\\"alphaCutoff\\\"===r?e.material.isDefined(\\\"fragment\\\",\\\"ALPHA_TEST\\\")&&e.material.get(\\\"diffuseMap\\\")&&e.material.get(\\\"alphaCutoff\\\")||0:\\\"uvRepeat\\\"===r?e.material.get(\\\"uvRepeat\\\"):\\\"uvOffset\\\"===r?e.material.get(\\\"uvOffset\\\"):t.get(r)},getMaterial:function(){return n},sort:this.opaqueSortCompare}),i.colorMask(!0,!0,!0,!0),i.depthMask(!0)},disposeScene:function(e){this.disposeNode(e,!0,!0),e.dispose()},disposeNode:function(e,s,l){e.getParent()&&e.getParent().remove(e);var h={};e.traverse(function(e){var t=e.material;if(e.geometry&&s&&e.geometry.dispose(this),l&&t&&!h[t.__uid__]){for(var r=t.getTextureUniforms(),i=0;i<r.length;i++){var n=r[i],a=t.uniforms[n].value,n=t.uniforms[n].type;if(a)if(\\\"t\\\"===n)a.dispose&&a.dispose(this);else if(\\\"tv\\\"===n)for(var o=0;o<a.length;o++)a[o]&&a[o].dispose&&a[o].dispose(this)}h[t.__uid__]=!0}e.dispose&&e.dispose(this)},this)},disposeGeometry:function(e){e.dispose(this)},disposeTexture:function(e){e.dispose(this)},disposeFrameBuffer:function(e){e.dispose(this)},dispose:function(){},screenToNDC:function(e,t,r){r=r||new ke,t=this._height-t;var i=this.viewport,n=r.array;return n[0]=(e-i.x)/i.width,n[0]=2*n[0]-1,n[1]=(t-i.y)/i.height,n[1]=2*n[1]-1,r}}),U=(e.opaqueSortCompare=e.prototype.opaqueSortCompare=function(e,t){return e.renderOrder===t.renderOrder?e.__program===t.__program?e.material===t.material?e.geometry.__uid__-t.geometry.__uid__:e.material.__uid__-t.material.__uid__:e.__program&&t.__program?e.__program.__uid__-t.__program.__uid__:0:e.renderOrder-t.renderOrder},e.transparentSortCompare=e.prototype.transparentSortCompare=function(e,t){return e.renderOrder===t.renderOrder?e.__depth===t.__depth?e.__program===t.__program?e.material===t.material?e.geometry.__uid__-t.geometry.__uid__:e.material.__uid__-t.material.__uid__:e.__program&&t.__program?e.__program.__uid__-t.__program.__uid__:0:e.__depth-t.__depth:e.renderOrder-t.renderOrder},{IDENTITY:m(),WORLD:m(),VIEW:m(),PROJECTION:m(),WORLDVIEW:m(),VIEWPROJECTION:m(),WORLDVIEWPROJECTION:m(),WORLDINVERSE:m(),VIEWINVERSE:m(),PROJECTIONINVERSE:m(),WORLDVIEWINVERSE:m(),VIEWPROJECTIONINVERSE:m(),WORLDVIEWPROJECTIONINVERSE:m(),WORLDTRANSPOSE:m(),VIEWTRANSPOSE:m(),PROJECTIONTRANSPOSE:m(),WORLDVIEWTRANSPOSE:m(),VIEWPROJECTIONTRANSPOSE:m(),WORLDVIEWPROJECTIONTRANSPOSE:m(),WORLDINVERSETRANSPOSE:m(),VIEWINVERSETRANSPOSE:m(),PROJECTIONINVERSETRANSPOSE:m(),WORLDVIEWINVERSETRANSPOSE:m(),VIEWPROJECTIONINVERSETRANSPOSE:m(),WORLDVIEWPROJECTIONINVERSETRANSPOSE:m()});e.COLOR_BUFFER_BIT=16384,e.DEPTH_BUFFER_BIT=256,e.STENCIL_BUFFER_BIT=1024;const Et=e;var r=function(e,t,r){e=e||0,t=t||0,r=r||0,this.array=R.fromValues(e,t,r),this._dirty=!0},e=(r.prototype={constructor:r,add:function(e){return R.add(this.array,this.array,e.array),this._dirty=!0,this},set:function(e,t,r){return this.array[0]=e,this.array[1]=t,this.array[2]=r,this._dirty=!0,this},setArray:function(e){return this.array[0]=e[0],this.array[1]=e[1],this.array[2]=e[2],this._dirty=!0,this},clone:function(){return new r(this.x,this.y,this.z)},copy:function(e){return R.copy(this.array,e.array),this._dirty=!0,this},cross:function(e,t){return R.cross(this.array,e.array,t.array),this._dirty=!0,this},dist:function(e){return R.dist(this.array,e.array)},distance:function(e){return R.distance(this.array,e.array)},div:function(e){return R.div(this.array,this.array,e.array),this._dirty=!0,this},divide:function(e){return R.divide(this.array,this.array,e.array),this._dirty=!0,this},dot:function(e){return R.dot(this.array,e.array)},len:function(){return R.len(this.array)},length:function(){return R.length(this.array)},lerp:function(e,t,r){return R.lerp(this.array,e.array,t.array,r),this._dirty=!0,this},min:function(e){return R.min(this.array,this.array,e.array),this._dirty=!0,this},max:function(e){return R.max(this.array,this.array,e.array),this._dirty=!0,this},mul:function(e){return R.mul(this.array,this.array,e.array),this._dirty=!0,this},multiply:function(e){return R.multiply(this.array,this.array,e.array),this._dirty=!0,this},negate:function(){return R.negate(this.array,this.array),this._dirty=!0,this},normalize:function(){return R.normalize(this.array,this.array),this._dirty=!0,this},random:function(e){return R.random(this.array,e),this._dirty=!0,this},scale:function(e){return R.scale(this.array,this.array,e),this._dirty=!0,this},scaleAndAdd:function(e,t){return R.scaleAndAdd(this.array,this.array,e.array,t),this._dirty=!0,this},sqrDist:function(e){return R.sqrDist(this.array,e.array)},squaredDistance:function(e){return R.squaredDistance(this.array,e.array)},sqrLen:function(){return R.sqrLen(this.array)},squaredLength:function(){return R.squaredLength(this.array)},sub:function(e){return R.sub(this.array,this.array,e.array),this._dirty=!0,this},subtract:function(e){return R.subtract(this.array,this.array,e.array),this._dirty=!0,this},transformMat3:function(e){return R.transformMat3(this.array,this.array,e.array),this._dirty=!0,this},transformMat4:function(e){return R.transformMat4(this.array,this.array,e.array),this._dirty=!0,this},transformQuat:function(e){return R.transformQuat(this.array,this.array,e.array),this._dirty=!0,this},applyProjection:function(e){var t,r=this.array;return 0===(e=e.array)[15]?(t=-1/r[2],r[0]=e[0]*r[0]*t,r[1]=e[5]*r[1]*t,r[2]=(e[10]*r[2]+e[14])*t):(r[0]=e[0]*r[0]+e[12],r[1]=e[5]*r[1]+e[13],r[2]=e[10]*r[2]+e[14]),this._dirty=!0,this},eulerFromQuat:function(e,t){r.eulerFromQuat(this,e,t)},eulerFromMat3:function(e,t){r.eulerFromMat3(this,e,t)},toString:function(){return\\\"[\\\"+Array.prototype.join.call(this.array,\\\",\\\")+\\\"]\\\"},toArray:function(){return Array.prototype.slice.call(this.array)}},Object.defineProperty);function Ct(e,t,r){return e<t?t:r<e?r:e}e&&(e(s=r.prototype,\\\"x\\\",{get:function(){return this.array[0]},set:function(e){this.array[0]=e,this._dirty=!0}}),e(s,\\\"y\\\",{get:function(){return this.array[1]},set:function(e){this.array[1]=e,this._dirty=!0}}),e(s,\\\"z\\\",{get:function(){return this.array[2]},set:function(e){this.array[2]=e,this._dirty=!0}})),r.add=function(e,t,r){return R.add(e.array,t.array,r.array),e._dirty=!0,e},r.set=function(e,t,r,i){R.set(e.array,t,r,i),e._dirty=!0},r.copy=function(e,t){return R.copy(e.array,t.array),e._dirty=!0,e},r.cross=function(e,t,r){return R.cross(e.array,t.array,r.array),e._dirty=!0,e},r.distance=r.dist=function(e,t){return R.distance(e.array,t.array)},r.divide=r.div=function(e,t,r){return R.divide(e.array,t.array,r.array),e._dirty=!0,e},r.dot=function(e,t){return R.dot(e.array,t.array)},r.len=function(e){return R.length(e.array)},r.lerp=function(e,t,r,i){return R.lerp(e.array,t.array,r.array,i),e._dirty=!0,e},r.min=function(e,t,r){return R.min(e.array,t.array,r.array),e._dirty=!0,e},r.max=function(e,t,r){return R.max(e.array,t.array,r.array),e._dirty=!0,e},r.multiply=r.mul=function(e,t,r){return R.multiply(e.array,t.array,r.array),e._dirty=!0,e},r.negate=function(e,t){return R.negate(e.array,t.array),e._dirty=!0,e},r.normalize=function(e,t){return R.normalize(e.array,t.array),e._dirty=!0,e},r.random=function(e,t){return R.random(e.array,t),e._dirty=!0,e},r.scale=function(e,t,r){return R.scale(e.array,t.array,r),e._dirty=!0,e},r.scaleAndAdd=function(e,t,r,i){return R.scaleAndAdd(e.array,t.array,r.array,i),e._dirty=!0,e},r.squaredDistance=r.sqrDist=function(e,t){return R.sqrDist(e.array,t.array)},r.squaredLength=r.sqrLen=function(e){return R.sqrLen(e.array)},r.subtract=r.sub=function(e,t,r){return R.subtract(e.array,t.array,r.array),e._dirty=!0,e},r.transformMat3=function(e,t,r){return R.transformMat3(e.array,t.array,r.array),e._dirty=!0,e},r.transformMat4=function(e,t,r){return R.transformMat4(e.array,t.array,r.array),e._dirty=!0,e},r.transformQuat=function(e,t,r){return R.transformQuat(e.array,t.array,r.array),e._dirty=!0,e};var p=Math.atan2,Dt=Math.asin,Lt=Math.abs;r.eulerFromQuat=function(e,t,r){e._dirty=!0,t=t.array;var i=e.array,n=t[0],a=t[1],o=t[2],s=t[3],l=n*n,h=a*a,u=o*o,c=s*s;switch(r=(r||\\\"XYZ\\\").toUpperCase()){case\\\"XYZ\\\":i[0]=p(2*(n*s-a*o),c-l-h+u),i[1]=Dt(Ct(2*(n*o+a*s),-1,1)),i[2]=p(2*(o*s-n*a),c+l-h-u);break;case\\\"YXZ\\\":i[0]=Dt(Ct(2*(n*s-a*o),-1,1)),i[1]=p(2*(n*o+a*s),c-l-h+u),i[2]=p(2*(n*a+o*s),c-l+h-u);break;case\\\"ZXY\\\":i[0]=Dt(Ct(2*(n*s+a*o),-1,1)),i[1]=p(2*(a*s-o*n),c-l-h+u),i[2]=p(2*(o*s-n*a),c-l+h-u);break;case\\\"ZYX\\\":i[0]=p(2*(n*s+o*a),c-l-h+u),i[1]=Dt(Ct(2*(a*s-n*o),-1,1)),i[2]=p(2*(n*a+o*s),c+l-h-u);break;case\\\"YZX\\\":i[0]=p(2*(n*s-o*a),c-l+h-u),i[1]=p(2*(a*s-n*o),c+l-h-u),i[2]=Dt(Ct(2*(n*a+o*s),-1,1));break;case\\\"XZY\\\":i[0]=p(2*(n*s+a*o),c-l+h-u),i[1]=p(2*(n*o+a*s),c+l-h-u),i[2]=Dt(Ct(2*(o*s-n*a),-1,1));break;default:console.warn(\\\"Unkown order: \\\"+r)}return e},r.eulerFromMat3=function(e,t,r){var i=t.array,n=i[0],a=i[3],o=i[6],s=i[1],l=i[4],h=i[7],u=i[2],c=i[5],d=i[8],f=e.array;switch(r=(r||\\\"XYZ\\\").toUpperCase()){case\\\"XYZ\\\":f[1]=Dt(Ct(o,-1,1)),Lt(o)<.99999?(f[0]=p(-h,d),f[2]=p(-a,n)):(f[0]=p(c,l),f[2]=0);break;case\\\"YXZ\\\":f[0]=Dt(-Ct(h,-1,1)),Lt(h)<.99999?(f[1]=p(o,d),f[2]=p(s,l)):(f[1]=p(-u,n),f[2]=0);break;case\\\"ZXY\\\":f[0]=Dt(Ct(c,-1,1)),Lt(c)<.99999?(f[1]=p(-u,d),f[2]=p(-a,l)):(f[1]=0,f[2]=p(s,n));break;case\\\"ZYX\\\":f[1]=Dt(-Ct(u,-1,1)),Lt(u)<.99999?(f[0]=p(c,d),f[2]=p(s,n)):(f[0]=0,f[2]=p(-a,l));break;case\\\"YZX\\\":f[2]=Dt(Ct(s,-1,1)),Lt(s)<.99999?(f[0]=p(-h,l),f[1]=p(-u,n)):(f[0]=0,f[1]=p(o,d));break;case\\\"XZY\\\":f[2]=Dt(-Ct(a,-1,1)),Lt(a)<.99999?(f[0]=p(c,l),f[1]=p(o,n)):(f[0]=p(-h,d),f[1]=0);break;default:console.warn(\\\"Unkown order: \\\"+r)}return e._dirty=!0,e},Object.defineProperties(r,{POSITIVE_X:{get:function(){return new r(1,0,0)}},NEGATIVE_X:{get:function(){return new r(-1,0,0)}},POSITIVE_Y:{get:function(){return new r(0,1,0)}},NEGATIVE_Y:{get:function(){return new r(0,-1,0)}},POSITIVE_Z:{get:function(){return new r(0,0,1)}},NEGATIVE_Z:{get:function(){return new r(0,0,-1)}},UP:{get:function(){return new r(0,1,0)}},ZERO:{get:function(){return new r}}});const z=r;var Pt,Ot,Nt,It,Rt,Bt,Ft=function(e,t){this.origin=e||new z,this.direction=t||new z};Ft.prototype={constructor:Ft,intersectPlane:function(e,t){var r=e.normal.array,i=e.distance,n=this.origin.array,a=this.direction.array,o=R.dot(r,a);if(0===o)return null;t=t||new z;r=(R.dot(r,n)-i)/o;return R.scaleAndAdd(t.array,n,a,-r),t._dirty=!0,t},mirrorAgainstPlane:function(e){var t=R.dot(e.normal.array,this.direction.array);R.scaleAndAdd(this.direction.array,this.direction.array,e.normal.array,2*-t),this.direction._dirty=!0},distanceToPoint:(Rt=R.create(),function(e){R.sub(Rt,e,this.origin.array);var t,r=R.dot(Rt,this.direction.array);return r<0?R.distance(this.origin.array,e):(t=R.lenSquared(Rt),Math.sqrt(t-r*r))}),intersectSphere:(Bt=R.create(),function(e,t,r){var i=this.origin.array,n=this.direction.array,a=(e=e.array,R.sub(Bt,e,i),R.dot(Bt,n)),o=R.squaredLength(Bt)-a*a,s=t*t;if(!(s<o))return o=a-(s=Math.sqrt(s-o)),a=a+s,r=r||new z,o<0?a<0?null:(R.scaleAndAdd(r.array,i,n,a),r):(R.scaleAndAdd(r.array,i,n,o),r)}),intersectBoundingBox:function(e,t){var r,i,n,a,o,s,l=this.direction.array,h=this.origin.array,u=e.min.array,c=e.max.array,d=1/l[0],f=1/l[1],p=1/l[2];return 0<=d?(r=(u[0]-h[0])*d,i=(c[0]-h[0])*d):(i=(u[0]-h[0])*d,r=(c[0]-h[0])*d),0<=f?(n=(u[1]-h[1])*f,a=(c[1]-h[1])*f):(a=(u[1]-h[1])*f,n=(c[1]-h[1])*f),a<r||i<n||((r<n||r!=r)&&(r=n),(a<i||i!=i)&&(i=a),0<=p?(o=(u[2]-h[2])*p,s=(c[2]-h[2])*p):(s=(u[2]-h[2])*p,o=(c[2]-h[2])*p),s<r)||i<o||((r<o||r!=r)&&(r=o),(i=s<i||i!=i?s:i)<0)?null:(d=0<=r?r:i,t=t||new z,R.scaleAndAdd(t.array,h,l,d),t)},intersectTriangle:(Pt=R.create(),Ot=R.create(),Nt=R.create(),It=R.create(),function(e,t,r,i,n,a){var o=this.direction.array,s=this.origin.array,l=(e=e.array,t=t.array,r=r.array,R.sub(Pt,t,e),R.sub(Ot,r,e),R.cross(It,Ot,o),R.dot(Pt,It));if(i){if(-1e-5<l)return null}else if(-1e-5<l&&l<1e-5)return null;R.sub(Nt,s,e);var h=R.dot(It,Nt)/l;if(h<0||1<h)return null;R.cross(It,Pt,Nt);var u=R.dot(o,It)/l;if(u<0||1<u||1<h+u)return null;R.cross(It,Pt,Ot);l=-R.dot(Nt,It)/l;return l<0?null:(n=n||new z,a&&z.set(a,1-h-u,h,u),R.scaleAndAdd(n.array,s,o,l),n)}),applyTransform:function(e){z.add(this.direction,this.direction,this.origin),z.transformMat4(this.origin,this.origin,e),z.transformMat4(this.direction,this.direction,e),z.sub(this.direction,this.direction,this.origin),z.normalize(this.direction,this.direction)},copy:function(e){z.copy(this.origin,e.origin),z.copy(this.direction,e.direction)},clone:function(){var e=new Ft;return e.copy(this),e}};const zt=Ft;var Gt,i={create:function(){var e=new Ge(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},clone:function(e){var t=new Ge(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},fromValues:function(e,t,r,i){var n=new Ge(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},set:function(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},subtract:function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}};i.sub=i.subtract,i.multiply=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e},i.mul=i.multiply,i.divide=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e},i.div=i.divide,i.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},i.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},i.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},i.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e},i.distance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return Math.sqrt(r*r+i*i+n*n+a*a)},i.dist=i.distance,i.squaredDistance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return r*r+i*i+n*n+a*a},i.sqrDist=i.squaredDistance,i.length=function(e){var t=e[0],r=e[1],i=e[2],n=e[3];return Math.sqrt(t*t+r*r+i*i+n*n)},i.len=i.length,i.squaredLength=function(e){var t=e[0],r=e[1],i=e[2],n=e[3];return t*t+r*r+i*i+n*n},i.sqrLen=i.squaredLength,i.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},i.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},i.normalize=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],r=r*r+i*i+n*n+a*a;return 0<r&&(r=1/Math.sqrt(r),e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r),e},i.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},i.lerp=function(e,t,r,i){var n=t[0],a=t[1],o=t[2],s=t[3];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e[2]=o+i*(r[2]-o),e[3]=s+i*(r[3]-s),e},i.random=function(e,t){return t=t||1,e[0]=Ue(),e[1]=Ue(),e[2]=Ue(),e[3]=Ue(),i.normalize(e,e),i.scale(e,e,t),e},i.transformMat4=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*a+r[12]*o,e[1]=r[1]*i+r[5]*n+r[9]*a+r[13]*o,e[2]=r[2]*i+r[6]*n+r[10]*a+r[14]*o,e[3]=r[3]*i+r[7]*n+r[11]*a+r[15]*o,e},i.transformQuat=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=r[0],s=r[1],l=r[2],h=r[3],u=h*i+s*a-l*n,c=h*n+l*i-o*a,d=h*a+o*n-s*i,i=-o*i-s*n-l*a;return e[0]=u*h+i*-o+c*-l-d*-s,e[1]=c*h+i*-s+d*-o-u*-l,e[2]=d*h+i*-l+u*-s-c*-o,e},i.forEach=(Gt=i.create(),function(e,t,r,i,n,a){var o,s;for(t=t||4,r=r||0,s=i?Math.min(i*t+r,e.length):e.length,o=r;o<s;o+=t)Gt[0]=e[o],Gt[1]=e[o+1],Gt[2]=e[o+2],Gt[3]=e[o+3],n(Gt,Gt,a),e[o]=Gt[0],e[o+1]=Gt[1],e[o+2]=Gt[2],e[o+3]=Gt[3];return e});const o=i;var s={create:function(){var e=new Ge(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromMat4:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},clone:function(e){var t=new Ge(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},transpose:function(e,t){var r,i,n;return e===t?(r=t[1],i=t[2],n=t[5],e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=n):(e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8]),e},invert:function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=t[6],h=t[7],u=t[8],c=u*o-s*h,d=-u*a+s*l,f=h*a-o*l,p=r*c+i*d+n*f;return p?(e[0]=c*(p=1/p),e[1]=(-u*i+n*h)*p,e[2]=(s*i-n*o)*p,e[3]=d*p,e[4]=(u*r-n*l)*p,e[5]=(-s*r+n*a)*p,e[6]=f*p,e[7]=(-h*r+i*l)*p,e[8]=(o*r-i*a)*p,e):null},adjoint:function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=t[6],h=t[7],u=t[8];return e[0]=o*u-s*h,e[1]=n*h-i*u,e[2]=i*s-n*o,e[3]=s*l-a*u,e[4]=r*u-n*l,e[5]=n*a-r*s,e[6]=a*h-o*l,e[7]=i*l-r*h,e[8]=r*o-i*a,e},determinant:function(e){var t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],o=e[5],s=e[6],l=e[7],h=e[8];return t*(h*a-o*l)+r*(-h*n+o*s)+i*(l*n-a*s)},multiply:function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],h=t[6],u=t[7],c=t[8],d=r[0],f=r[1],p=r[2],m=r[3],g=r[4],_=r[5],v=r[6],y=r[7],x=r[8];return e[0]=d*i+f*o+p*h,e[1]=d*n+f*s+p*u,e[2]=d*a+f*l+p*c,e[3]=m*i+g*o+_*h,e[4]=m*n+g*s+_*u,e[5]=m*a+g*l+_*c,e[6]=v*i+y*o+x*h,e[7]=v*n+y*s+x*u,e[8]=v*a+y*l+x*c,e}};s.mul=s.multiply,s.translate=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],h=t[6],u=t[7],c=t[8],d=r[0],f=r[1];return e[0]=i,e[1]=n,e[2]=a,e[3]=o,e[4]=s,e[5]=l,e[6]=d*i+f*o+h,e[7]=d*n+f*s+u,e[8]=d*a+f*l+c,e},s.rotate=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],h=t[6],u=t[7],c=t[8],d=Math.sin(r),f=Math.cos(r);return e[0]=f*i+d*o,e[1]=f*n+d*s,e[2]=f*a+d*l,e[3]=f*o-d*i,e[4]=f*s-d*n,e[5]=f*l-d*a,e[6]=h,e[7]=u,e[8]=c,e},s.scale=function(e,t,r){var i=r[0],n=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},s.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},s.fromQuat=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=r+r,s=i+i,l=n+n,r=r*o,h=i*o,i=i*s,u=n*o,c=n*s,n=n*l,o=a*o,s=a*s,a=a*l;return e[0]=1-i-n,e[3]=h-a,e[6]=u+s,e[1]=h+a,e[4]=1-r-n,e[7]=c-o,e[2]=u-s,e[5]=c+o,e[8]=1-r-i,e},s.normalFromMat4=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=t[6],h=t[7],u=t[8],c=t[9],d=t[10],f=t[11],p=t[12],m=t[13],g=t[14],_=t[15],v=r*s-i*o,y=r*l-n*o,x=r*h-a*o,b=i*l-n*s,w=i*h-a*s,T=n*h-a*l,S=u*m-c*p,M=u*g-d*p,u=u*_-f*p,A=c*g-d*m,c=c*_-f*m,d=d*_-f*g,f=v*d-y*c+x*A+b*u-w*M+T*S;return f?(e[0]=(s*d-l*c+h*A)*(f=1/f),e[1]=(l*u-o*d-h*M)*f,e[2]=(o*c-s*u+h*S)*f,e[3]=(n*c-i*d-a*A)*f,e[4]=(r*d-n*u+a*M)*f,e[5]=(i*u-r*c-a*S)*f,e[6]=(m*T-g*w+_*b)*f,e[7]=(g*x-p*T-_*y)*f,e[8]=(p*w-m*x+_*v)*f,e):null},s.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))};const l=s;var Ut,kt,Vt,Ht,u={create:function(){var e=new Ge(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}};u.rotationTo=(Ut=R.create(),kt=R.fromValues(1,0,0),Vt=R.fromValues(0,1,0),function(e,t,r){var i=R.dot(t,r);return i<-.999999?(R.cross(Ut,kt,t),R.length(Ut)<1e-6&&R.cross(Ut,Vt,t),R.normalize(Ut,Ut),u.setAxisAngle(e,Ut,Math.PI),e):.999999<i?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(R.cross(Ut,t,r),e[0]=Ut[0],e[1]=Ut[1],e[2]=Ut[2],e[3]=1+i,u.normalize(e,e))}),u.setAxes=(Ht=l.create(),function(e,t,r,i){return Ht[0]=r[0],Ht[3]=r[1],Ht[6]=r[2],Ht[1]=i[0],Ht[4]=i[1],Ht[7]=i[2],Ht[2]=-t[0],Ht[5]=-t[1],Ht[8]=-t[2],u.normalize(e,u.fromMat3(e,Ht))}),u.clone=o.clone,u.fromValues=o.fromValues,u.copy=o.copy,u.set=o.set,u.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},u.setAxisAngle=function(e,t,r){r*=.5;var i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e},u.add=o.add,u.multiply=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=r[0],l=r[1],h=r[2],u=r[3];return e[0]=i*u+o*s+n*h-a*l,e[1]=n*u+o*l+a*s-i*h,e[2]=a*u+o*h+i*l-n*s,e[3]=o*u-i*s-n*l-a*h,e},u.mul=u.multiply,u.scale=o.scale,u.rotateX=function(e,t,r){r*=.5;var i=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=i*l+o*s,e[1]=n*l+a*s,e[2]=a*l-n*s,e[3]=o*l-i*s,e},u.rotateY=function(e,t,r){r*=.5;var i=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=i*l-a*s,e[1]=n*l+o*s,e[2]=a*l+i*s,e[3]=o*l-n*s,e},u.rotateZ=function(e,t,r){r*=.5;var i=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=i*l+n*s,e[1]=n*l-i*s,e[2]=a*l+o*s,e[3]=o*l-a*s,e},u.calculateW=function(e,t){var r=t[0],i=t[1],n=t[2];return e[0]=r,e[1]=i,e[2]=n,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),e},u.dot=o.dot,u.lerp=o.lerp,u.slerp=function(e,t,r,i){var n,a,o,s=t[0],l=t[1],h=t[2],u=t[3],c=r[0],d=r[1],f=r[2],p=r[3];return(o=s*c+l*d+h*f+u*p)<0&&(o=-o,c=-c,d=-d,f=-f,p=-p),o=1e-6<1-o?(o=Math.acos(o),n=Math.sin(o),a=Math.sin((1-i)*o)/n,Math.sin(i*o)/n):(a=1-i,i),e[0]=a*s+o*c,e[1]=a*l+o*d,e[2]=a*h+o*f,e[3]=a*u+o*p,e},u.invert=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=r*r+i*i+n*n+a*a,o=o?1/o:0;return e[0]=-r*o,e[1]=-i*o,e[2]=-n*o,e[3]=a*o,e},u.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},u.length=o.length,u.len=u.length,u.squaredLength=o.squaredLength,u.sqrLen=u.squaredLength,u.normalize=o.normalize,u.fromMat3=function(e,t){var r,i,n,a=t[0]+t[4]+t[8];return 0<a?(n=Math.sqrt(a+1),e[3]=.5*n,e[0]=(t[5]-t[7])*(n=.5/n),e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n):(t[4]>t[a=0]&&(a=1),r=((a=t[8]>t[3*a+a]?2:a)+1)%3,i=(a+2)%3,n=Math.sqrt(t[3*a+a]-t[3*r+r]-t[3*i+i]+1),e[a]=.5*n,e[3]=(t[3*r+i]-t[3*i+r])*(n=.5/n),e[r]=(t[3*r+a]+t[3*a+r])*n,e[i]=(t[3*i+a]+t[3*a+i])*n),e};const c=u;var Wt,jt,Xt,qt,d=function(){this._axisX=new z,this._axisY=new z,this._axisZ=new z,this.array=G.create(),this._dirty=!0},e=(d.prototype={constructor:d,setArray:function(e){for(var t=0;t<this.array.length;t++)this.array[t]=e[t];return this._dirty=!0,this},adjoint:function(){return G.adjoint(this.array,this.array),this._dirty=!0,this},clone:function(){return(new d).copy(this)},copy:function(e){return G.copy(this.array,e.array),this._dirty=!0,this},determinant:function(){return G.determinant(this.array)},fromQuat:function(e){return G.fromQuat(this.array,e.array),this._dirty=!0,this},fromRotationTranslation:function(e,t){return G.fromRotationTranslation(this.array,e.array,t.array),this._dirty=!0,this},fromMat2d:function(e){return d.fromMat2d(this,e),this},frustum:function(e,t,r,i,n,a){return G.frustum(this.array,e,t,r,i,n,a),this._dirty=!0,this},identity:function(){return G.identity(this.array),this._dirty=!0,this},invert:function(){return G.invert(this.array,this.array),this._dirty=!0,this},lookAt:function(e,t,r){return G.lookAt(this.array,e.array,t.array,r.array),this._dirty=!0,this},mul:function(e){return G.mul(this.array,this.array,e.array),this._dirty=!0,this},mulLeft:function(e){return G.mul(this.array,e.array,this.array),this._dirty=!0,this},multiply:function(e){return G.multiply(this.array,this.array,e.array),this._dirty=!0,this},multiplyLeft:function(e){return G.multiply(this.array,e.array,this.array),this._dirty=!0,this},ortho:function(e,t,r,i,n,a){return G.ortho(this.array,e,t,r,i,n,a),this._dirty=!0,this},perspective:function(e,t,r,i){return G.perspective(this.array,e,t,r,i),this._dirty=!0,this},rotate:function(e,t){return G.rotate(this.array,this.array,e,t.array),this._dirty=!0,this},rotateX:function(e){return G.rotateX(this.array,this.array,e),this._dirty=!0,this},rotateY:function(e){return G.rotateY(this.array,this.array,e),this._dirty=!0,this},rotateZ:function(e){return G.rotateZ(this.array,this.array,e),this._dirty=!0,this},scale:function(e){return G.scale(this.array,this.array,e.array),this._dirty=!0,this},translate:function(e){return G.translate(this.array,this.array,e.array),this._dirty=!0,this},transpose:function(){return G.transpose(this.array,this.array),this._dirty=!0,this},decomposeMatrix:(Wt=R.create(),jt=R.create(),Xt=R.create(),qt=l.create(),function(e,t,r){var i=this.array,n=(R.set(Wt,i[0],i[1],i[2]),R.set(jt,i[4],i[5],i[6]),R.set(Xt,i[8],i[9],i[10]),R.length(Wt)),a=R.length(jt),o=R.length(Xt);this.determinant()<0&&(n=-n),e&&e.set(n,a,o),r.set(i[12],i[13],i[14]),l.fromMat4(qt,i),qt[0]/=n,qt[1]/=n,qt[2]/=n,qt[3]/=a,qt[4]/=a,qt[5]/=a,qt[6]/=o,qt[7]/=o,qt[8]/=o,c.fromMat3(t.array,qt),c.normalize(t.array,t.array),t._dirty=!0,r._dirty=!0}),toString:function(){return\\\"[\\\"+Array.prototype.join.call(this.array,\\\",\\\")+\\\"]\\\"},toArray:function(){return Array.prototype.slice.call(this.array)}},Object.defineProperty);e&&(e(s=d.prototype,\\\"z\\\",{get:function(){var e=this.array;return this._axisZ.set(e[8],e[9],e[10]),this._axisZ},set:function(e){var t=this.array;e=e.array,t[8]=e[0],t[9]=e[1],t[10]=e[2],this._dirty=!0}}),e(s,\\\"y\\\",{get:function(){var e=this.array;return this._axisY.set(e[4],e[5],e[6]),this._axisY},set:function(e){var t=this.array;e=e.array,t[4]=e[0],t[5]=e[1],t[6]=e[2],this._dirty=!0}}),e(s,\\\"x\\\",{get:function(){var e=this.array;return this._axisX.set(e[0],e[1],e[2]),this._axisX},set:function(e){var t=this.array;e=e.array,t[0]=e[0],t[1]=e[1],t[2]=e[2],this._dirty=!0}})),d.adjoint=function(e,t){return G.adjoint(e.array,t.array),e._dirty=!0,e},d.copy=function(e,t){return G.copy(e.array,t.array),e._dirty=!0,e},d.determinant=function(e){return G.determinant(e.array)},d.identity=function(e){return G.identity(e.array),e._dirty=!0,e},d.ortho=function(e,t,r,i,n,a,o){return G.ortho(e.array,t,r,i,n,a,o),e._dirty=!0,e},d.perspective=function(e,t,r,i,n){return G.perspective(e.array,t,r,i,n),e._dirty=!0,e},d.lookAt=function(e,t,r,i){return G.lookAt(e.array,t.array,r.array,i.array),e._dirty=!0,e},d.invert=function(e,t){return G.invert(e.array,t.array),e._dirty=!0,e},d.multiply=d.mul=function(e,t,r){return G.mul(e.array,t.array,r.array),e._dirty=!0,e},d.fromQuat=function(e,t){return G.fromQuat(e.array,t.array),e._dirty=!0,e},d.fromRotationTranslation=function(e,t,r){return G.fromRotationTranslation(e.array,t.array,r.array),e._dirty=!0,e},d.fromMat2d=function(e,t){return e._dirty=!0,t=t.array,(e=e.array)[0]=t[0],e[4]=t[2],e[12]=t[4],e[1]=t[1],e[5]=t[3],e[13]=t[5],e},d.rotate=function(e,t,r,i){return G.rotate(e.array,t.array,r,i.array),e._dirty=!0,e},d.rotateX=function(e,t,r){return G.rotateX(e.array,t.array,r),e._dirty=!0,e},d.rotateY=function(e,t,r){return G.rotateY(e.array,t.array,r),e._dirty=!0,e},d.rotateZ=function(e,t,r){return G.rotateZ(e.array,t.array,r),e._dirty=!0,e},d.scale=function(e,t,r){return G.scale(e.array,t.array,r.array),e._dirty=!0,e},d.transpose=function(e,t){return G.transpose(e.array,t.array),e._dirty=!0,e},d.translate=function(e,t,r){return G.translate(e.array,t.array,r.array),e._dirty=!0,e};const M=d;var Zt,f=function(e,t,r,i){e=e||0,t=t||0,r=r||0,i=void 0===i?1:i,this.array=c.fromValues(e,t,r,i),this._dirty=!0},s=(f.prototype={constructor:f,add:function(e){return c.add(this.array,this.array,e.array),this._dirty=!0,this},calculateW:function(){return c.calculateW(this.array,this.array),this._dirty=!0,this},set:function(e,t,r,i){return this.array[0]=e,this.array[1]=t,this.array[2]=r,this.array[3]=i,this._dirty=!0,this},setArray:function(e){return this.array[0]=e[0],this.array[1]=e[1],this.array[2]=e[2],this.array[3]=e[3],this._dirty=!0,this},clone:function(){return new f(this.x,this.y,this.z,this.w)},conjugate:function(){return c.conjugate(this.array,this.array),this._dirty=!0,this},copy:function(e){return c.copy(this.array,e.array),this._dirty=!0,this},dot:function(e){return c.dot(this.array,e.array)},fromMat3:function(e){return c.fromMat3(this.array,e.array),this._dirty=!0,this},fromMat4:(Zt=l.create(),function(e){return l.fromMat4(Zt,e.array),l.transpose(Zt,Zt),c.fromMat3(this.array,Zt),this._dirty=!0,this}),identity:function(){return c.identity(this.array),this._dirty=!0,this},invert:function(){return c.invert(this.array,this.array),this._dirty=!0,this},len:function(){return c.len(this.array)},length:function(){return c.length(this.array)},lerp:function(e,t,r){return c.lerp(this.array,e.array,t.array,r),this._dirty=!0,this},mul:function(e){return c.mul(this.array,this.array,e.array),this._dirty=!0,this},mulLeft:function(e){return c.multiply(this.array,e.array,this.array),this._dirty=!0,this},multiply:function(e){return c.multiply(this.array,this.array,e.array),this._dirty=!0,this},multiplyLeft:function(e){return c.multiply(this.array,e.array,this.array),this._dirty=!0,this},normalize:function(){return c.normalize(this.array,this.array),this._dirty=!0,this},rotateX:function(e){return c.rotateX(this.array,this.array,e),this._dirty=!0,this},rotateY:function(e){return c.rotateY(this.array,this.array,e),this._dirty=!0,this},rotateZ:function(e){return c.rotateZ(this.array,this.array,e),this._dirty=!0,this},rotationTo:function(e,t){return c.rotationTo(this.array,e.array,t.array),this._dirty=!0,this},setAxes:function(e,t,r){return c.setAxes(this.array,e.array,t.array,r.array),this._dirty=!0,this},setAxisAngle:function(e,t){return c.setAxisAngle(this.array,e.array,t),this._dirty=!0,this},slerp:function(e,t,r){return c.slerp(this.array,e.array,t.array,r),this._dirty=!0,this},sqrLen:function(){return c.sqrLen(this.array)},squaredLength:function(){return c.squaredLength(this.array)},fromEuler:function(e,t){return f.fromEuler(this,e,t)},toString:function(){return\\\"[\\\"+Array.prototype.join.call(this.array,\\\",\\\")+\\\"]\\\"},toArray:function(){return Array.prototype.slice.call(this.array)}},Object.defineProperty);s&&(s(e=f.prototype,\\\"x\\\",{get:function(){return this.array[0]},set:function(e){this.array[0]=e,this._dirty=!0}}),s(e,\\\"y\\\",{get:function(){return this.array[1]},set:function(e){this.array[1]=e,this._dirty=!0}}),s(e,\\\"z\\\",{get:function(){return this.array[2]},set:function(e){this.array[2]=e,this._dirty=!0}}),s(e,\\\"w\\\",{get:function(){return this.array[3]},set:function(e){this.array[3]=e,this._dirty=!0}})),f.add=function(e,t,r){return c.add(e.array,t.array,r.array),e._dirty=!0,e},f.set=function(e,t,r,i,n){c.set(e.array,t,r,i,n),e._dirty=!0},f.copy=function(e,t){return c.copy(e.array,t.array),e._dirty=!0,e},f.calculateW=function(e,t){return c.calculateW(e.array,t.array),e._dirty=!0,e},f.conjugate=function(e,t){return c.conjugate(e.array,t.array),e._dirty=!0,e},f.identity=function(e){return c.identity(e.array),e._dirty=!0,e},f.invert=function(e,t){return c.invert(e.array,t.array),e._dirty=!0,e},f.dot=function(e,t){return c.dot(e.array,t.array)},f.len=function(e){return c.length(e.array)},f.lerp=function(e,t,r,i){return c.lerp(e.array,t.array,r.array,i),e._dirty=!0,e},f.slerp=function(e,t,r,i){return c.slerp(e.array,t.array,r.array,i),e._dirty=!0,e},f.multiply=f.mul=function(e,t,r){return c.multiply(e.array,t.array,r.array),e._dirty=!0,e},f.rotateX=function(e,t,r){return c.rotateX(e.array,t.array,r),e._dirty=!0,e},f.rotateY=function(e,t,r){return c.rotateY(e.array,t.array,r),e._dirty=!0,e},f.rotateZ=function(e,t,r){return c.rotateZ(e.array,t.array,r),e._dirty=!0,e},f.setAxisAngle=function(e,t,r){return c.setAxisAngle(e.array,t.array,r),e._dirty=!0,e},f.normalize=function(e,t){return c.normalize(e.array,t.array),e._dirty=!0,e},f.squaredLength=f.sqrLen=function(e){return c.sqrLen(e.array)},f.fromMat3=function(e,t){return c.fromMat3(e.array,t.array),e._dirty=!0,e},f.setAxes=function(e,t,r,i){return c.setAxes(e.array,t.array,r.array,i.array),e._dirty=!0,e},f.rotationTo=function(e,t,r){return c.rotationTo(e.array,t.array,r.array),e._dirty=!0,e},f.fromEuler=function(e,t,r){e._dirty=!0,t=t.array;var i=e.array,n=Math.cos(t[0]/2),a=Math.cos(t[1]/2),o=Math.cos(t[2]/2),s=Math.sin(t[0]/2),l=Math.sin(t[1]/2),h=Math.sin(t[2]/2);switch(r=(r||\\\"XYZ\\\").toUpperCase()){case\\\"XYZ\\\":i[0]=s*a*o+n*l*h,i[1]=n*l*o-s*a*h,i[2]=n*a*h+s*l*o,i[3]=n*a*o-s*l*h;break;case\\\"YXZ\\\":i[0]=s*a*o+n*l*h,i[1]=n*l*o-s*a*h,i[2]=n*a*h-s*l*o,i[3]=n*a*o+s*l*h;break;case\\\"ZXY\\\":i[0]=s*a*o-n*l*h,i[1]=n*l*o+s*a*h,i[2]=n*a*h+s*l*o,i[3]=n*a*o-s*l*h;break;case\\\"ZYX\\\":i[0]=s*a*o-n*l*h,i[1]=n*l*o+s*a*h,i[2]=n*a*h-s*l*o,i[3]=n*a*o+s*l*h;break;case\\\"YZX\\\":i[0]=s*a*o+n*l*h,i[1]=n*l*o+s*a*h,i[2]=n*a*h-s*l*o,i[3]=n*a*o-s*l*h;break;case\\\"XZY\\\":i[0]=s*a*o-n*l*h,i[1]=n*l*o-s*a*h,i[2]=n*a*h+s*l*o,i[3]=n*a*o+s*l*h}};const Yt=f;var Kt,Qt,Jt,$t,er,tr,rr=R.set,ir=R.copy,nr=function(e,t){this.min=e||new z(1/0,1/0,1/0),this.max=t||new z(-1/0,-1/0,-1/0),this.vertices=null};nr.prototype={constructor:nr,updateFromVertices:function(e){if(0<e.length){var t=this.min,r=this.max,i=t.array,n=r.array;ir(i,e[0]),ir(n,e[0]);for(var a=1;a<e.length;a++){var o=e[a];o[0]<i[0]&&(i[0]=o[0]),o[1]<i[1]&&(i[1]=o[1]),o[2]<i[2]&&(i[2]=o[2]),o[0]>n[0]&&(n[0]=o[0]),o[1]>n[1]&&(n[1]=o[1]),o[2]>n[2]&&(n[2]=o[2])}t._dirty=!0,r._dirty=!0}},union:function(e){var t=this.min,r=this.max;return R.min(t.array,t.array,e.min.array),R.max(r.array,r.array,e.max.array),t._dirty=!0,r._dirty=!0,this},intersection:function(e){var t=this.min,r=this.max;return R.max(t.array,t.array,e.min.array),R.min(r.array,r.array,e.max.array),t._dirty=!0,r._dirty=!0,this},intersectBoundingBox:function(e){var t=this.min.array,r=this.max.array,i=e.min.array,n=e.max.array;return!(t[0]>n[0]||t[1]>n[1]||t[2]>n[2]||r[0]<i[0]||r[1]<i[1]||r[2]<i[2])},containBoundingBox:function(e){var t=this.min.array,r=this.max.array,i=e.min.array,n=e.max.array;return t[0]<=i[0]&&t[1]<=i[1]&&t[2]<=i[2]&&r[0]>=n[0]&&r[1]>=n[1]&&r[2]>=n[2]},containPoint:function(e){var t=this.min.array,r=this.max.array,i=e.array;return t[0]<=i[0]&&t[1]<=i[1]&&t[2]<=i[2]&&r[0]>=i[0]&&r[1]>=i[1]&&r[2]>=i[2]},isFinite:function(){var e=this.min.array,t=this.max.array;return isFinite(e[0])&&isFinite(e[1])&&isFinite(e[2])&&isFinite(t[0])&&isFinite(t[1])&&isFinite(t[2])},applyTransform:function(e){this.transformFrom(this,e)},transformFrom:(Kt=R.create(),Qt=R.create(),Jt=R.create(),$t=R.create(),er=R.create(),tr=R.create(),function(e,t){var r=e.min.array,i=e.max.array,n=t.array;return Kt[0]=n[0]*r[0],Kt[1]=n[1]*r[0],Kt[2]=n[2]*r[0],Qt[0]=n[0]*i[0],Qt[1]=n[1]*i[0],Qt[2]=n[2]*i[0],Jt[0]=n[4]*r[1],Jt[1]=n[5]*r[1],Jt[2]=n[6]*r[1],$t[0]=n[4]*i[1],$t[1]=n[5]*i[1],$t[2]=n[6]*i[1],er[0]=n[8]*r[2],er[1]=n[9]*r[2],er[2]=n[10]*r[2],tr[0]=n[8]*i[2],tr[1]=n[9]*i[2],tr[2]=n[10]*i[2],r=this.min.array,i=this.max.array,r[0]=Math.min(Kt[0],Qt[0])+Math.min(Jt[0],$t[0])+Math.min(er[0],tr[0])+n[12],r[1]=Math.min(Kt[1],Qt[1])+Math.min(Jt[1],$t[1])+Math.min(er[1],tr[1])+n[13],r[2]=Math.min(Kt[2],Qt[2])+Math.min(Jt[2],$t[2])+Math.min(er[2],tr[2])+n[14],i[0]=Math.max(Kt[0],Qt[0])+Math.max(Jt[0],$t[0])+Math.max(er[0],tr[0])+n[12],i[1]=Math.max(Kt[1],Qt[1])+Math.max(Jt[1],$t[1])+Math.max(er[1],tr[1])+n[13],i[2]=Math.max(Kt[2],Qt[2])+Math.max(Jt[2],$t[2])+Math.max(er[2],tr[2])+n[14],this.min._dirty=!0,this.max._dirty=!0,this}),applyProjection:function(e){var t=this.min.array,r=this.max.array,i=e.array,n=t[0],a=t[1],o=t[2],s=r[0],l=r[1],h=t[2],u=r[0],c=r[1],d=r[2];return 1===i[15]?(t[0]=i[0]*n+i[12],t[1]=i[5]*a+i[13],r[2]=i[10]*o+i[14],r[0]=i[0]*u+i[12],r[1]=i[5]*c+i[13],t[2]=i[10]*d+i[14]):(t[0]=i[0]*n*(u=-1/o),t[1]=i[5]*a*u,r[2]=(i[10]*o+i[14])*u,r[0]=i[0]*s*(u=-1/h),r[1]=i[5]*l*u,t[2]=(i[10]*d+i[14])*(u=-1/d)),this.min._dirty=!0,this.max._dirty=!0,this},updateVertices:function(){if(!(e=this.vertices)){for(var e=[],t=0;t<8;t++)e[t]=R.fromValues(0,0,0);this.vertices=e}var r=this.min.array,i=this.max.array;return rr(e[0],r[0],r[1],r[2]),rr(e[1],r[0],i[1],r[2]),rr(e[2],i[0],r[1],r[2]),rr(e[3],i[0],i[1],r[2]),rr(e[4],r[0],r[1],i[2]),rr(e[5],r[0],i[1],i[2]),rr(e[6],i[0],r[1],i[2]),rr(e[7],i[0],i[1],i[2]),this},copy:function(e){var t=this.min,r=this.max;return ir(t.array,e.min.array),ir(r.array,e.max.array),t._dirty=!0,r._dirty=!0,this},clone:function(){var e=new nr;return e.copy(this),e}};const ar=nr;var or,sr,lr,hr,ur,cr,dr,fr=0;const pr=N.extend({name:\\\"\\\",position:null,rotation:null,scale:null,worldTransform:null,localTransform:null,autoUpdateLocalTransform:!0,_parent:null,_scene:null,_needsUpdateWorldTransform:!0,_inIterating:!1,__depth:0},function(){this.name||(this.name=(this.type||\\\"NODE\\\")+\\\"_\\\"+fr++),this.position||(this.position=new z),this.rotation||(this.rotation=new Yt),this.scale||(this.scale=new z(1,1,1)),this.worldTransform=new M,this.localTransform=new M,this._children=[]},{target:null,invisible:!1,isSkinnedMesh:function(){return!1},isRenderable:function(){return!1},setName:function(e){var t=this._scene;t&&(delete(t=t._nodeRepository)[this.name],t[e]=this),this.name=e},add:function(e){var t=e._parent;t!==this&&(t&&t.remove(e),(e._parent=this)._children.push(e),(t=this._scene)&&t!==e.scene&&e.traverse(this._addSelfToScene,this),e._needsUpdateWorldTransform=!0)},remove:function(e){var t=this._children,r=t.indexOf(e);r<0||(t.splice(r,1),e._parent=null,this._scene&&e.traverse(this._removeSelfFromScene,this))},removeAll:function(){for(var e=this._children,t=0;t<e.length;t++)e[t]._parent=null,this._scene&&e[t].traverse(this._removeSelfFromScene,this);this._children=[]},getScene:function(){return this._scene},getParent:function(){return this._parent},_removeSelfFromScene:function(e){e._scene.removeFromScene(e),e._scene=null},_addSelfToScene:function(e){this._scene.addToScene(e),e._scene=this._scene},isAncestor:function(e){for(var t=e._parent;t;){if(t===this)return!0;t=t._parent}return!1},children:function(){return this._children.slice()},childAt:function(e){return this._children[e]},getChildByName:function(e){for(var t=this._children,r=0;r<t.length;r++)if(t[r].name===e)return t[r]},getDescendantByName:function(e){for(var t=this._children,r=0;r<t.length;r++){var i=t[r];if(i.name===e)return i;i=i.getDescendantByName(e);if(i)return i}},queryNode:function(e){if(e){for(var t=e.split(\\\"/\\\"),r=this,i=0;i<t.length;i++){var n=t[i];if(n){for(var a=!1,o=r._children,s=0;s<o.length;s++){var l=o[s];if(l.name===n){r=l,a=!0;break}}if(!a)return}}return r}},getPath:function(e){if(!this._parent)return\\\"/\\\";for(var t=this._parent,r=this.name;t._parent&&(r=t.name+\\\"/\\\"+r,t._parent!=e);)t=t._parent;return!t._parent&&e?null:r},traverse:function(e,t){e.call(t,this);for(var r=this._children,i=0,n=r.length;i<n;i++)r[i].traverse(e,t)},eachChild:function(e,t){for(var r=this._children,i=0,n=r.length;i<n;i++){var a=r[i];e.call(t,a,i)}},setLocalTransform:function(e){G.copy(this.localTransform.array,e.array),this.decomposeLocalTransform()},decomposeLocalTransform:function(e){var t=e?null:this.scale;this.localTransform.decomposeMatrix(t,this.rotation,this.position)},setWorldTransform:function(e){G.copy(this.worldTransform.array,e.array),this.decomposeWorldTransform()},decomposeWorldTransform:(sr=G.create(),function(e){var t=this.localTransform,r=this.worldTransform,r=(this._parent?(G.invert(sr,this._parent.worldTransform.array),G.multiply(t.array,sr,r.array)):G.copy(t.array,r.array),e?null:this.scale);t.decomposeMatrix(r,this.rotation,this.position)}),transformNeedsUpdate:function(){return this.position._dirty||this.rotation._dirty||this.scale._dirty},updateLocalTransform:function(){var e,t=this.position,r=this.rotation,i=this.scale;this.transformNeedsUpdate()&&(e=this.localTransform.array,G.fromRotationTranslation(e,r.array,t.array),G.scale(e,e,i.array),r._dirty=!1,i._dirty=!1,t._dirty=!1,this._needsUpdateWorldTransform=!0)},_updateWorldTransformTopDown:function(){var e=this.localTransform.array,t=this.worldTransform.array;this._parent?G.multiplyAffine(t,this._parent.worldTransform.array,e):G.copy(t,e)},updateWorldTransform:function(){for(var e=this;e&&e.getParent()&&e.getParent().transformNeedsUpdate();)e=e.getParent();e.update()},update:function(e){this.autoUpdateLocalTransform?this.updateLocalTransform():e=!0,(e||this._needsUpdateWorldTransform)&&(this._updateWorldTransformTopDown(),this._needsUpdateWorldTransform=!(e=!0));for(var t=this._children,r=0,i=t.length;r<i;r++)t[r].update(e)},getBoundingBox:(ur=new ar,cr=new M,dr=new M,function(e,t){return t=t||new ar,this._parent?M.invert(dr,this._parent.worldTransform):M.identity(dr),this.traverse(function(e){e.geometry&&e.geometry.boundingBox&&(ur.copy(e.geometry.boundingBox),M.multiply(cr,dr,e.worldTransform),ur.applyTransform(cr),t.union(ur))},this,mr),t}),getWorldPosition:function(e){this.transformNeedsUpdate()&&this.updateWorldTransform();var t,r=this.worldTransform.array;return e?((t=e.array)[0]=r[12],t[1]=r[13],t[2]=r[14],e):new z(r[12],r[13],r[14])},clone:function(){var e=new this.constructor,t=this._children;e.setName(this.name),e.position.copy(this.position),e.rotation.copy(this.rotation),e.scale.copy(this.scale);for(var r=0;r<t.length;r++)e.add(t[r].clone());return e},rotateAround:(lr=new z,hr=new M,function(e,t,r){lr.copy(this.position).subtract(e);var i=this.localTransform;i.identity(),i.translate(e),i.rotate(r,t),hr.fromRotationTranslation(this.rotation,lr),i.multiply(hr),i.scale(this.scale),this.decomposeLocalTransform(),this._needsUpdateWorldTransform=!0}),lookAt:(or=new M,function(e,t){or.lookAt(this.position,e,t||this.localTransform.y).invert(),this.setLocalTransform(or),this.target=e})});function mr(e){return!e.invisible&&e.geometry}var gr,e=pr.extend({material:null,geometry:null,mode:4,_renderInfo:null},{__program:null,lightGroup:0,renderOrder:0,culling:!0,cullFace:J,frontFace:ee,frustumCulling:!0,receiveShadow:!0,castShadow:!0,ignorePicking:!1,ignorePreZ:!1,ignoreGBuffer:!1,isRenderable:function(){return this.geometry&&this.material&&this.material.shader&&!this.invisible&&0<this.geometry.vertexCount},beforeRender:function(e){},afterRender:function(e,t){},getBoundingBox:function(e,t){return t=pr.prototype.getBoundingBox.call(this,e,t),this.geometry&&this.geometry.boundingBox&&t.union(this.geometry.boundingBox),t},clone:(gr=[\\\"castShadow\\\",\\\"receiveShadow\\\",\\\"mode\\\",\\\"culling\\\",\\\"cullFace\\\",\\\"frontFace\\\",\\\"frustumCulling\\\",\\\"renderOrder\\\",\\\"lineWidth\\\",\\\"ignorePicking\\\",\\\"ignorePreZ\\\",\\\"ignoreGBuffer\\\"],function(){var e=pr.prototype.clone.call(this);e.geometry=this.geometry,e.material=this.material;for(var t=0;t<gr.length;t++){var r=gr[t];e[r]!==this[r]&&(e[r]=this[r])}return e})});e.POINTS=0,e.LINES=1,e.LINE_LOOP=2,e.LINE_STRIP=3,e.TRIANGLES=4,e.TRIANGLE_STRIP=5,e.TRIANGLE_FAN=6,e.BACK=J,e.FRONT=Q,e.FRONT_AND_BACK=1032,e.CW=$,e.CCW=ee;const _r=e;var vr,yr,xr,br,wr,Tr=N.extend({scene:null,camera:null,renderer:null},function(){this._ray=new zt,this._ndc=new ke},{pick:function(e,t,r){return this.pickAll(e,t,[],r)[0]||null},pickAll:function(e,t,r,i){return this.renderer.screenToNDC(e,t,this._ndc),this.camera.castRay(this._ndc,this._ray),this._intersectNode(this.scene,r=r||[],i||!1),r.sort(this._intersectionCompareFunc),r},_intersectNode:function(e,t,r){e instanceof _r&&e.isRenderable()&&(e.ignorePicking&&!r||!(4===e.mode&&e.geometry.isUseIndices()||e.geometry.pickByRay||e.geometry.pick)||this._intersectRenderable(e,t));for(var i=0;i<e._children.length;i++)this._intersectNode(e._children[i],t,r)},_intersectRenderable:(vr=new z,yr=new z,xr=new z,br=new zt,wr=new M,function(e,t){var r=e.isSkinnedMesh(),i=(br.copy(this._ray),M.invert(wr,e.worldTransform),r||br.applyTransform(wr),e.geometry),n=(r?e.skeleton:i).boundingBox;if(!n||br.intersectBoundingBox(n))if(i.pick)i.pick(this._ndc.x,this._ndc.y,this.renderer,this.camera,e,t);else if(i.pickByRay)i.pickByRay(br,e,t);else{var a=e.cullFace===J&&e.frontFace===ee||e.cullFace===Q&&e.frontFace===$,o=i.indices,s=i.attributes.position,l=i.attributes.weight,h=i.attributes.joint,u=[];if(s&&s.value&&o){if(r){for(var c=e.skeleton.getSubSkinMatrices(e.__uid__,e.joints),d=0;d<e.joints.length;d++){u[d]=u[d]||[];for(var f=0;f<16;f++)u[d][f]=c[16*d+f]}var p=[],m=[],g=[],_=[],v=[],y=i.attributes.skinnedPosition;for(y&&y.value||(i.createAttribute(\\\"skinnedPosition\\\",\\\"f\\\",3),(y=i.attributes.skinnedPosition).init(i.vertexCount)),d=0;d<i.vertexCount;d++){for(s.get(d,p),l.get(d,m),h.get(d,g),m[3]=1-m[0]-m[1]-m[2],R.set(_,0,0,0),f=0;f<4;f++)0<=g[f]&&1e-4<m[f]&&(R.transformMat4(v,p,u[g[f]]),R.scaleAndAdd(_,_,v,m[f]));y.set(d,_)}}for(d=0;d<o.length;d+=3){var x,b=o[d],w=o[d+1],T=o[d+2],S=r?i.attributes.skinnedPosition:s;S.get(b,vr.array),S.get(w,yr.array),S.get(T,xr.array),(S=a?br.intersectTriangle(vr,yr,xr,e.culling):br.intersectTriangle(vr,xr,yr,e.culling))&&(x=new z,r?z.copy(x,S):z.transformMat4(x,S,e.worldTransform),t.push(new Tr.Intersection(S,x,e,[b,w,T],d/3,z.dist(x,this._ray.origin))))}}}}),_intersectionCompareFunc:function(e,t){return e.distance-t.distance}});Tr.Intersection=function(e,t,r,i,n,a){this.point=e,this.pointWorld=t,this.target=r,this.triangle=i,this.triangleIndex=n,this.distance=a};const Sr=Tr;var Mr=\\\"__dt__\\\",s=function(){this._contextId=0,this._caches=[],this._context={}};const Ar=(s.prototype={use:function(e,t){var r=this._caches;r[e]||(r[e]={},t&&(r[e]=t())),this._contextId=e,this._context=r[e]},put:function(e,t){this._context[e]=t},get:function(e){return this._context[e]},dirty:function(e){var t=Mr+(e=e||\\\"\\\");this.put(t,!0)},dirtyAll:function(e){for(var t=Mr+(e=e||\\\"\\\"),r=this._caches,i=0;i<r.length;i++)r[i]&&(r[i][t]=!0)},fresh:function(e){var t=Mr+(e=e||\\\"\\\");this.put(t,!1)},freshAll:function(e){for(var t=Mr+(e=e||\\\"\\\"),r=this._caches,i=0;i<r.length;i++)r[i]&&(r[i][t]=!1)},isDirty:function(e){var t=Mr+(e=e||\\\"\\\"),r=this._context;return!r.hasOwnProperty(t)||!0===r[t]},deleteContext:function(e){delete this._caches[e],this._context={}},\\\"delete\\\":function(e){delete this._context[e]},clearAll:function(){this._caches={}},getContext:function(){return this._context},eachContext:function(t,r){Object.keys(this._caches).forEach(function(e){t&&t.call(r,e)})},miss:function(e){return!this._context.hasOwnProperty(e)}}).constructor=s;var g=N.extend({width:512,height:512,type:te,format:ne,wrapS:ce,wrapT:ce,minFilter:ue,magFilter:oe,useMipmap:!0,anisotropic:1,flipY:!0,sRGB:!0,unpackAlignment:4,premultiplyAlpha:!1,dynamic:!1,NPOT:!1,__used:0},function(){this._cache=new Ar},{getWebGLTexture:function(e){var t=e.gl,r=this._cache;return r.use(e.__uid__),r.miss(\\\"webgl_texture\\\")&&r.put(\\\"webgl_texture\\\",t.createTexture()),this.dynamic?this.update(e):r.isDirty()&&(this.update(e),r.fresh()),r.get(\\\"webgl_texture\\\")},bind:function(){},unbind:function(){},dirty:function(){this._cache&&this._cache.dirtyAll()},update:function(e){},updateCommon:function(e){var t=e.gl,t=(t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,this.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,this.unpackAlignment),this.format===ie&&(this.useMipmap=!1),e.getGLExtension(\\\"EXT_sRGB\\\"));this.format!==g.SRGB||t||(this.format=g.RGB),this.format!==g.SRGB_ALPHA||t||(this.format=g.RGBA),this.NPOT=!this.isPowerOfTwo()},getAvailableWrapS:function(){return this.NPOT?de:this.wrapS},getAvailableWrapT:function(){return this.NPOT?de:this.wrapT},getAvailableMinFilter:function(){var e=this.minFilter;return this.NPOT||!this.useMipmap?e===se||e===he?ae:e===ue||e===le?oe:e:e},getAvailableMagFilter:function(){return this.magFilter},nextHighestPowerOfTwo:function(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1},dispose:function(e){var t=this._cache,r=(t.use(e.__uid__),t.get(\\\"webgl_texture\\\"));r&&e.gl.deleteTexture(r),t.deleteContext(e.__uid__)},isRenderable:function(){},isPowerOfTwo:function(){}});Object.defineProperty(g.prototype,\\\"width\\\",{get:function(){return this._width},set:function(e){this._width=e}}),Object.defineProperty(g.prototype,\\\"height\\\",{get:function(){return this._height},set:function(e){this._height=e}}),g.BYTE=5120,g.UNSIGNED_BYTE=te,g.SHORT=5122,g.UNSIGNED_SHORT=5123,g.INT=5124,g.UNSIGNED_INT=5125,g.FLOAT=re,g.HALF_FLOAT=36193,g.UNSIGNED_INT_24_8_WEBGL=34042,g.DEPTH_COMPONENT=ie,g.DEPTH_STENCIL=34041,g.ALPHA=6406,g.RGB=6407,g.RGBA=ne,g.LUMINANCE=6409,g.LUMINANCE_ALPHA=6410,g.SRGB=35904,g.SRGB_ALPHA=35906,g.COMPRESSED_RGB_S3TC_DXT1_EXT=33776,g.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777,g.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778,g.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779,g.NEAREST=ae,g.LINEAR=oe,g.NEAREST_MIPMAP_NEAREST=se,g.LINEAR_MIPMAP_NEAREST=le,g.NEAREST_MIPMAP_LINEAR=he,g.LINEAR_MIPMAP_LINEAR=ue,g.REPEAT=ce,g.CLAMP_TO_EDGE=de,g.MIRRORED_REPEAT=33648;const B=g;e=_r.extend({skeleton:null,joints:null},function(){this.joints||(this.joints=[])},{offsetMatrix:null,isInstancedMesh:function(){return!1},isSkinnedMesh:function(){return!!(this.skeleton&&this.joints&&0<this.joints.length)},clone:function(){var e=_r.prototype.clone.call(this);return e.skeleton=this.skeleton,this.joints&&(e.joints=this.joints.slice()),e}});e.POINTS=0,e.LINES=1,e.LINE_LOOP=2,e.LINE_STRIP=3,e.TRIANGLES=4,e.TRIANGLE_STRIP=5,e.TRIANGLE_FAN=6,e.BACK=J,e.FRONT=Q,e.FRONT_AND_BACK=1032,e.CW=$,e.CCW=ee;const Er=e,Cr=function(e){return 0==(e&e-1)};var Dr=Cr;function Lr(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))}s=B.extend(function(){return{image:null,pixels:null,mipmaps:[],convertToPOT:!1}},{textureType:\\\"texture2D\\\",update:function(e){var t=e.gl,r=(t.bindTexture(t.TEXTURE_2D,this._cache.get(\\\"webgl_texture\\\")),this.updateCommon(e),this.format),i=this.type,n=!(!this.convertToPOT||this.mipmaps.length||!this.image||this.wrapS!==B.REPEAT&&this.wrapT!==B.REPEAT||!this.NPOT),a=(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,n?this.wrapS:this.getAvailableWrapS()),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,n?this.wrapT:this.getAvailableWrapT()),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,n?this.magFilter:this.getAvailableMagFilter()),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,n?this.minFilter:this.getAvailableMinFilter()),e.getGLExtension(\\\"EXT_texture_filter_anisotropic\\\"));if(a&&1<this.anisotropic&&t.texParameterf(t.TEXTURE_2D,a.TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropic),36193!==i||e.getGLExtension(\\\"OES_texture_half_float\\\")||(i=re),this.mipmaps.length)for(var o=this.width,s=this.height,l=0;l<this.mipmaps.length;l++){var h=this.mipmaps[l];this._updateTextureData(t,h,l,o,s,r,i,!1),o/=2,s/=2}else this._updateTextureData(t,this,0,this.width,this.height,r,i,n),!this.useMipmap||this.NPOT&&!n||t.generateMipmap(t.TEXTURE_2D);t.bindTexture(t.TEXTURE_2D,null)},_updateTextureData:function(e,t,r,i,n,a,o,s){var l,h,u,c;t.image?(l=t.image,s&&(this._potCanvas=(h=(s=this)._potCanvas,u=Lr(s.width),c=Lr(s.height),(h=h||document.createElement(\\\"canvas\\\")).width=u,h.height=c,h.getContext(\\\"2d\\\").drawImage(s.image,0,0,u,c),h),l=this._potCanvas),e.texImage2D(e.TEXTURE_2D,r,a,a,o,l)):a<=B.COMPRESSED_RGBA_S3TC_DXT5_EXT&&a>=B.COMPRESSED_RGB_S3TC_DXT1_EXT?e.compressedTexImage2D(e.TEXTURE_2D,r,a,i,n,0,t.pixels):e.texImage2D(e.TEXTURE_2D,r,a,i,n,0,a,o,t.pixels)},generateMipmap:function(e){var t=e.gl;this.useMipmap&&!this.NPOT&&(t.bindTexture(t.TEXTURE_2D,this._cache.get(\\\"webgl_texture\\\")),t.generateMipmap(t.TEXTURE_2D))},isPowerOfTwo:function(){return Dr(this.width)&&Dr(this.height)},isRenderable:function(){return this.image?0<this.image.width&&0<this.image.height:!(!this.width||!this.height)},bind:function(e){e.gl.bindTexture(e.gl.TEXTURE_2D,this.getWebGLTexture(e))},unbind:function(e){e.gl.bindTexture(e.gl.TEXTURE_2D,null)},load:function(e,t){var r=_e.createImage(),i=(t&&(r.crossOrigin=t),this);return r.onload=function(){i.dirty(),i.trigger(\\\"success\\\",i)},r.onerror=function(){i.trigger(\\\"error\\\",i)},r.src=e,this.image=r,this}});Object.defineProperty(s.prototype,\\\"width\\\",{get:function(){return this.image?this.image.width:this._width},set:function(e){this.image?console.warn(\\\"Texture from image can't set width\\\"):(this._width!==e&&this.dirty(),this._width=e)}}),Object.defineProperty(s.prototype,\\\"height\\\",{get:function(){return this.image?this.image.height:this._height},set:function(e){this.image?console.warn(\\\"Texture from image can't set height\\\"):(this._height!==e&&this.dirty(),this._height=e)}});const k=s;function Pr(e){return{\\\"byte\\\":_e.Int8Array,ubyte:_e.Uint8Array,\\\"short\\\":_e.Int16Array,ushort:_e.Uint16Array}[e]||_e.Float32Array}function Or(e){return\\\"attr_\\\"+e}function Nr(e,t,r,i){switch(this.name=e,this.type=t,this.size=r,this.semantic=i||\\\"\\\",this.value=null,r){case 1:this.get=function(e){return this.value[e]},this.set=function(e,t){this.value[e]=t},this.copy=function(e,t){this.value[e]=this.value[e]};break;case 2:this.get=function(e,t){var r=this.value;return t[0]=r[2*e],t[1]=r[2*e+1],t},this.set=function(e,t){var r=this.value;r[2*e]=t[0],r[2*e+1]=t[1]},this.copy=function(e,t){var r=this.value;r[e*=2]=r[t*=2],r[e+1]=r[t+1]};break;case 3:this.get=function(e,t){var r=3*e,i=this.value;return t[0]=i[r],t[1]=i[1+r],t[2]=i[2+r],t},this.set=function(e,t){var r=3*e,i=this.value;i[r]=t[0],i[1+r]=t[1],i[2+r]=t[2]},this.copy=function(e,t){var r=this.value;r[e*=3]=r[t*=3],r[e+1]=r[t+1],r[e+2]=r[t+2]};break;case 4:this.get=function(e,t){var r=this.value,i=4*e;return t[0]=r[i],t[1]=r[1+i],t[2]=r[2+i],t[3]=r[3+i],t},this.set=function(e,t){var r=this.value,i=4*e;r[i]=t[0],r[1+i]=t[1],r[2+i]=t[2],r[3+i]=t[3]},this.copy=function(e,t){var r=this.value;r[e*=4]=r[t*=4],r[e+1]=r[t+1],r[e+2]=r[t+2],r[e+3]=r[t+3]}}}function Ir(e,t,r,i,n){this.name=e,this.type=t,this.buffer=r,this.size=i,this.semantic=n,this.symbol=\\\"\\\",this.needsRemove=!1}function Rr(e){this.buffer=e,this.count=0}Nr.prototype.init=function(e){var t;this.value&&this.value.length===e*this.size||(t=Pr(this.type),this.value=new t(e*this.size))},Nr.prototype.fromArray=function(e){var t=Pr(this.type);if(e[0]&&e[0].length)for(var r=0,i=this.size,n=new t(e.length*i),a=0;a<e.length;a++)for(var o=0;o<i;o++)n[r++]=e[a][o];else n=new t(e);this.value=n},Nr.prototype.clone=function(e){var t=new Nr(this.name,this.type,this.size,this.semantic);return e&&console.warn(\\\"todo\\\"),t};var e=N.extend(function(){return{attributes:{},indices:null,dynamic:!0,_enabledAttributes:null,__used:0}},function(){this._cache=new Ar,this._attributeList=Object.keys(this.attributes),this.__vaoCache={}},{mainAttribute:\\\"\\\",pick:null,pickByRay:null,dirty:function(){for(var e=this.getEnabledAttributes(),t=0;t<e.length;t++)this.dirtyAttribute(e[t]);this.dirtyIndices(),this._enabledAttributes=null,this._cache.dirty(\\\"any\\\")},dirtyIndices:function(){this._cache.dirtyAll(\\\"indices\\\")},dirtyAttribute:function(e){this._cache.dirtyAll(Or(e)),this._cache.dirtyAll(\\\"attributes\\\")},getTriangleIndices:function(e,t){var r;if(e<this.triangleCount&&0<=e)return r=this.indices,(t=t||[])[0]=r[3*e],t[1]=r[3*e+1],t[2]=r[3*e+2],t},setTriangleIndices:function(e,t){var r=this.indices;r[3*e]=t[0],r[3*e+1]=t[1],r[3*e+2]=t[2]},isUseIndices:function(){return!!this.indices},initIndicesFromArray:function(e){var t=65535<this.vertexCount?_e.Uint32Array:_e.Uint16Array;if(e[0]&&e[0].length)for(var r=0,i=new t(3*e.length),n=0;n<e.length;n++)for(var a=0;a<3;a++)i[r++]=e[n][a];else i=new t(e);this.indices=i},createAttribute:function(e,t,r,i){var n=new Nr(e,t,r,i);return this.attributes[e]&&this.removeAttribute(e),this.attributes[e]=n,this._attributeList.push(e),n},removeAttribute:function(e){var t=this._attributeList,r=t.indexOf(e);return 0<=r&&(t.splice(r,1),delete this.attributes[e],!0)},getAttribute:function(e){return this.attributes[e]},getEnabledAttributes:function(){var e=this._enabledAttributes,t=this._attributeList;if(e)return e;for(var r=[],i=this.vertexCount,n=0;n<t.length;n++){var a=t[n],o=this.attributes[a];o.value&&o.value.length===i*o.size&&r.push(a)}return this._enabledAttributes=r},getBufferChunks:function(e){var t=this._cache,r=(t.use(e.__uid__),t.isDirty(\\\"attributes\\\")),i=t.isDirty(\\\"indices\\\");if(r||i){this._updateBuffer(e.gl,r,i);for(var n=this.getEnabledAttributes(),a=0;a<n.length;a++)t.fresh(Or(n[a]));t.fresh(\\\"attributes\\\"),t.fresh(\\\"indices\\\")}return t.fresh(\\\"any\\\"),t.get(\\\"chunks\\\")},_updateBuffer:function(e,t,r){var i=this._cache,n=i.get(\\\"chunks\\\"),a=!1,n=(n||((n=[])[0]={attributeBuffers:[],indicesBuffer:null},i.put(\\\"chunks\\\",n),a=!0),n[0]),o=n.attributeBuffers,s=n.indicesBuffer;if(t||a){var l=this.getEnabledAttributes(),h={};if(!a)for(var u=0;u<o.length;u++)h[o[u].name]=o[u];for(var c=0;c<l.length;c++){var d,f=l[c],p=this.attributes[f],m=(d=a?d:h[f])?d.buffer:e.createBuffer();i.isDirty(Or(f))&&(e.bindBuffer(e.ARRAY_BUFFER,m),e.bufferData(e.ARRAY_BUFFER,p.value,this.dynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW)),o[c]=new Ir(f,p.type,m,p.size,p.semantic)}for(u=c;u<o.length;u++)e.deleteBuffer(o[u].buffer);o.length=c}this.isUseIndices()&&(r||a)&&(s||(s=new Rr(e.createBuffer()),n.indicesBuffer=s),s.count=this.indices.length,e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s.buffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,this.dynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW))},dispose:function(e){var t=this._cache,r=(t.use(e.__uid__),t.get(\\\"chunks\\\"));if(r)for(var i=0;i<r.length;i++){for(var n=r[i],a=0;a<n.attributeBuffers.length;a++){var o=n.attributeBuffers[a];e.gl.deleteBuffer(o.buffer)}n.indicesBuffer&&e.gl.deleteBuffer(n.indicesBuffer.buffer)}if(this.__vaoCache){var s,l=e.getGLExtension(\\\"OES_vertex_array_object\\\");for(s in this.__vaoCache){var h=this.__vaoCache[s].vao;h&&l.deleteVertexArrayOES(h)}}this.__vaoCache={},t.deleteContext(e.__uid__)}}),s=(Object.defineProperty&&(Object.defineProperty(e.prototype,\\\"vertexCount\\\",{enumerable:!1,get:function(){var e=this.attributes[this.mainAttribute];return(e=e||this.attributes[this._attributeList[0]])&&e.value?e.value.length/e.size:0}}),Object.defineProperty(e.prototype,\\\"triangleCount\\\",{enumerable:!1,get:function(){var e=this.indices;return e?e.length/3:0}})),e.STATIC_DRAW=35044,e.DYNAMIC_DRAW=35048,e.STREAM_DRAW=35040,e.AttributeBuffer=Ir,e.IndicesBuffer=Rr,e.Attribute=Nr,e),Br=R.create,Fr=R.add,zr=R.set,Gr=s.Attribute,e=s.extend(function(){return{attributes:{position:new Gr(\\\"position\\\",\\\"float\\\",3,\\\"POSITION\\\"),texcoord0:new Gr(\\\"texcoord0\\\",\\\"float\\\",2,\\\"TEXCOORD_0\\\"),texcoord1:new Gr(\\\"texcoord1\\\",\\\"float\\\",2,\\\"TEXCOORD_1\\\"),normal:new Gr(\\\"normal\\\",\\\"float\\\",3,\\\"NORMAL\\\"),tangent:new Gr(\\\"tangent\\\",\\\"float\\\",4,\\\"TANGENT\\\"),color:new Gr(\\\"color\\\",\\\"float\\\",4,\\\"COLOR\\\"),weight:new Gr(\\\"weight\\\",\\\"float\\\",3,\\\"WEIGHT\\\"),joint:new Gr(\\\"joint\\\",\\\"float\\\",4,\\\"JOINT\\\"),barycentric:new Gr(\\\"barycentric\\\",\\\"float\\\",3,null)},boundingBox:null}},{mainAttribute:\\\"position\\\",updateBoundingBox:function(){var e=(e=this.boundingBox)||(this.boundingBox=new ar),t=this.attributes.position.value;if(t&&t.length){var r=e.min,e=e.max,i=r.array,n=e.array;R.set(i,t[0],t[1],t[2]),R.set(n,t[0],t[1],t[2]);for(var a=3;a<t.length;){var o=t[a++],s=t[a++],l=t[a++];o<i[0]&&(i[0]=o),s<i[1]&&(i[1]=s),l<i[2]&&(i[2]=l),o>n[0]&&(n[0]=o),s>n[1]&&(n[1]=s),l>n[2]&&(n[2]=l)}r._dirty=!0,e._dirty=!0}},generateVertexNormals:function(){if(this.vertexCount){var e=this.indices,t=this.attributes,r=t.position.value,i=t.normal.value;if(i&&i.length===r.length)for(var n=0;n<i.length;n++)i[n]=0;else i=t.normal.value=new _e.Float32Array(r.length);for(var a,o,s,l=Br(),h=Br(),u=Br(),c=Br(),d=Br(),f=Br(),p=e?e.length:this.vertexCount,m=0;m<p;)for(s=e?(a=e[m++],o=e[m++],e[m++]):(a=m++,o=m++,m++),zr(l,r[3*a],r[3*a+1],r[3*a+2]),zr(h,r[3*o],r[3*o+1],r[3*o+2]),zr(u,r[3*s],r[3*s+1],r[3*s+2]),R.sub(c,l,h),R.sub(d,h,u),R.cross(f,c,d),n=0;n<3;n++)i[3*a+n]=i[3*a+n]+f[n],i[3*o+n]=i[3*o+n]+f[n],i[3*s+n]=i[3*s+n]+f[n];for(n=0;n<i.length;)zr(f,i[n],i[n+1],i[n+2]),R.normalize(f,f),i[n++]=f[0],i[n++]=f[1],i[n++]=f[2];this.dirty()}},generateFaceNormals:function(){if(this.vertexCount){this.isUniqueVertex()||this.generateUniqueVertex();for(var e,t,r,i=this.indices,n=this.attributes,a=n.position.value,o=n.normal.value,s=Br(),l=Br(),h=Br(),u=Br(),c=Br(),d=Br(),o=o||(n.normal.value=new Float32Array(a.length)),f=i?i.length:this.vertexCount,p=0;p<f;){r=i?(e=i[p++],t=i[p++],i[p++]):(e=p++,t=p++,p++),zr(s,a[3*e],a[3*e+1],a[3*e+2]),zr(l,a[3*t],a[3*t+1],a[3*t+2]),zr(h,a[3*r],a[3*r+1],a[3*r+2]),R.sub(u,s,l),R.sub(c,l,h),R.cross(d,u,c),R.normalize(d,d);for(var m=0;m<3;m++)o[3*e+m]=d[m],o[3*t+m]=d[m],o[3*r+m]=d[m]}this.dirty()}},generateTangents:function(){if(this.vertexCount){var e=this.vertexCount,t=this.attributes,r=(t.tangent.value||(t.tangent.value=new Float32Array(4*e)),t.texcoord0.value),i=t.position.value,n=t.tangent.value,a=t.normal.value;if(r){for(var o=[],s=[],l=0;l<e;l++)o[l]=[0,0,0],s[l]=[0,0,0];for(var h,u,c=[0,0,0],d=[0,0,0],f=this.indices,p=f?f.length:this.vertexCount,l=0;l<p;){var m=f?(h=f[l++],u=f[l++],f[l++]):(h=l++,u=l++,l++),g=r[2*h],_=r[2*u],v=r[2*m],y=r[2*h+1],x=r[2*u+1],b=r[2*m+1],w=i[3*h],T=i[3*u],S=i[3*m],M=i[3*h+1],A=i[3*u+1],E=i[3*m+1],C=i[3*h+2],T=T-w,S=S-w,w=A-M,A=E-M,E=i[3*u+2]-C,M=i[3*m+2]-C,C=_-g,_=v-g,v=x-y,g=b-y,x=1/(C*g-v*_);c[0]=(g*T-v*S)*x,c[1]=(g*w-v*A)*x,c[2]=(g*E-v*M)*x,d[0]=(C*S-_*T)*x,d[1]=(C*A-_*w)*x,d[2]=(C*M-_*E)*x,Fr(o[h],o[h],c),Fr(o[u],o[u],c),Fr(o[m],o[m],c),Fr(s[h],s[h],d),Fr(s[u],s[u],d),Fr(s[m],s[m],d)}var D=Br(),L=Br(),P=Br();for(l=0;l<e;l++){P[0]=a[3*l],P[1]=a[3*l+1],P[2]=a[3*l+2];var O=o[l];R.scale(D,P,R.dot(P,O)),R.sub(D,O,D),R.normalize(D,D),R.cross(L,P,O),n[4*l]=D[0],n[4*l+1]=D[1],n[4*l+2]=D[2],n[4*l+3]=R.dot(L,s[l])<0?-1:1}this.dirty()}else console.warn(\\\"Geometry without texcoords can't generate tangents.\\\")}},isUniqueVertex:function(){return!this.isUseIndices()||this.vertexCount===this.indices.length},generateUniqueVertex:function(){if(this.vertexCount&&this.indices){65535<this.indices.length&&(this.indices=new _e.Uint32Array(this.indices));for(var e=this.attributes,t=this.indices,r=this.getEnabledAttributes(),i={},n=0;n<r.length;n++)i[l=r[n]]=e[l].value,e[l].init(this.indices.length);for(var a=0,o=0;o<t.length;o++){for(var s=t[o],n=0;n<r.length;n++)for(var l,h=e[l=r[n]].value,u=e[l].size,c=0;c<u;c++)h[a*u+c]=i[l][s*u+c];t[o]=a,a++}this.dirty()}},generateBarycentric:function(){if(this.vertexCount){this.isUniqueVertex()||this.generateUniqueVertex();var e=this.attributes,t=e.barycentric.value,r=this.indices;if(!t||t.length!==3*r.length){for(var t=e.barycentric.value=new Float32Array(3*r.length),i=0;i<(r?r.length:this.vertexCount/3);)for(var n=0;n<3;n++)t[3*(r?r[i++]:3*i+n)+n]=1;this.dirty()}}},applyTransform:function(e){var t=this.attributes,r=t.position.value,i=t.normal.value,t=t.tangent.value,n=(e=e.array,G.create()),a=(G.invert(n,e),G.transpose(n,n),R.transformMat4),o=R.forEach;o(r,3,0,null,a,e),i&&o(i,3,0,null,a,n),t&&o(t,4,0,null,a,n),this.boundingBox&&this.updateBoundingBox()},dispose:function(e){var t=this._cache,r=(t.use(e.__uid__),t.get(\\\"chunks\\\"));if(r)for(var i=0;i<r.length;i++){for(var n=r[i],a=0;a<n.attributeBuffers.length;a++){var o=n.attributeBuffers[a];e.gl.deleteBuffer(o.buffer)}n.indicesBuffer&&e.gl.deleteBuffer(n.indicesBuffer.buffer)}if(this.__vaoCache){var s,l=e.getGLExtension(\\\"OES_vertex_array_object\\\");for(s in this.__vaoCache){var h=this.__vaoCache[s].vao;h&&l.deleteVertexArrayOES(h)}}this.__vaoCache={},t.deleteContext(e.__uid__)}});e.STATIC_DRAW=s.STATIC_DRAW,e.DYNAMIC_DRAW=s.DYNAMIC_DRAW,e.STREAM_DRAW=s.STREAM_DRAW,e.AttributeBuffer=s.AttributeBuffer,e.IndicesBuffer=s.IndicesBuffer,e.Attribute=Gr;const _=e;var s=\\\"@export clay.header.\\\",e=\\\"@end\\\",v=\\\":unconfigurable;\\\",s=[s+\\\"directional_light\\\",\\\"uniform vec3 directionalLightDirection[DIRECTIONAL_LIGHT_COUNT]\\\"+v,\\\"uniform vec3 directionalLightColor[DIRECTIONAL_LIGHT_COUNT]\\\"+v,e,s+\\\"ambient_light\\\",\\\"uniform vec3 ambientLightColor[AMBIENT_LIGHT_COUNT]\\\"+v,e,s+\\\"ambient_sh_light\\\",\\\"uniform vec3 ambientSHLightColor[AMBIENT_SH_LIGHT_COUNT]\\\"+v,\\\"uniform vec3 ambientSHLightCoefficients[AMBIENT_SH_LIGHT_COUNT * 9]\\\"+v,\\\"vec3 calcAmbientSHLight(int idx, vec3 N) {\\\\n int offset = 9 * idx;\\\\n return ambientSHLightCoefficients[0]\\\\n + ambientSHLightCoefficients[1] * N.x\\\\n + ambientSHLightCoefficients[2] * N.y\\\\n + ambientSHLightCoefficients[3] * N.z\\\\n + ambientSHLightCoefficients[4] * N.x * N.z\\\\n + ambientSHLightCoefficients[5] * N.z * N.y\\\\n + ambientSHLightCoefficients[6] * N.y * N.x\\\\n + ambientSHLightCoefficients[7] * (3.0 * N.z * N.z - 1.0)\\\\n + ambientSHLightCoefficients[8] * (N.x * N.x - N.y * N.y);\\\\n}\\\",e,s+\\\"ambient_cubemap_light\\\",\\\"uniform vec3 ambientCubemapLightColor[AMBIENT_CUBEMAP_LIGHT_COUNT]\\\"+v,\\\"uniform samplerCube ambientCubemapLightCubemap[AMBIENT_CUBEMAP_LIGHT_COUNT]\\\"+v,\\\"uniform sampler2D ambientCubemapLightBRDFLookup[AMBIENT_CUBEMAP_LIGHT_COUNT]\\\"+v,e,s+\\\"point_light\\\",\\\"uniform vec3 pointLightPosition[POINT_LIGHT_COUNT]\\\"+v,\\\"uniform float pointLightRange[POINT_LIGHT_COUNT]\\\"+v,\\\"uniform vec3 pointLightColor[POINT_LIGHT_COUNT]\\\"+v,e,s+\\\"spot_light\\\",\\\"uniform vec3 spotLightPosition[SPOT_LIGHT_COUNT]\\\"+v,\\\"uniform vec3 spotLightDirection[SPOT_LIGHT_COUNT]\\\"+v,\\\"uniform float spotLightRange[SPOT_LIGHT_COUNT]\\\"+v,\\\"uniform float spotLightUmbraAngleCosine[SPOT_LIGHT_COUNT]\\\"+v,\\\"uniform float spotLightPenumbraAngleCosine[SPOT_LIGHT_COUNT]\\\"+v,\\\"uniform float spotLightFalloffFactor[SPOT_LIGHT_COUNT]\\\"+v,\\\"uniform vec3 spotLightColor[SPOT_LIGHT_COUNT]\\\"+v,e].join(\\\"\\\\n\\\");S[\\\"import\\\"](s);const Ur=pr.extend(function(){return{color:[1,1,1],intensity:1,castShadow:!0,shadowResolution:512,group:0}},{type:\\\"\\\",clone:function(){var e=pr.prototype.clone.call(this);return e.color=Array.prototype.slice.call(this.color),e.intensity=this.intensity,e.castShadow=this.castShadow,e.shadowResolution=this.shadowResolution,e}});var kr,Vr,Hr,Wr,jr=function(e,t){this.normal=e||new z(0,1,0),this.distance=t||0};jr.prototype={constructor:jr,distanceToPoint:function(e){return R.dot(e.array,this.normal.array)-this.distance},projectPoint:function(e,t){t=t||new z;var r=this.distanceToPoint(e);return R.scaleAndAdd(t.array,e.array,this.normal.array,-r),t._dirty=!0,t},normalize:function(){var e=1/R.len(this.normal.array);R.scale(this.normal.array,e),this.distance*=e},intersectFrustum:function(e){for(var t=e.vertices,r=this.normal.array,i=R.dot(t[0].array,r)>this.distance,n=1;n<8;n++)if(R.dot(t[n].array,r)>this.distance!=i)return!0},intersectLine:(Wr=R.create(),function(e,t,r){var i=this.distanceToPoint(e),n=this.distanceToPoint(t);if(0<i&&0<n||i<0&&n<0)return null;var i=this.normal.array,n=this.distance,a=e.array,o=(R.sub(Wr,t.array,e.array),R.normalize(Wr,Wr),R.dot(i,Wr));if(0===o)return null;r=r||new z;i=(R.dot(i,a)-n)/o;return R.scaleAndAdd(r.array,a,Wr,-i),r._dirty=!0,r}),applyTransform:(kr=G.create(),Vr=o.create(),(Hr=o.create())[3]=1,function(e){e=e.array,R.scale(Hr,this.normal.array,this.distance),o.transformMat4(Hr,Hr,e),this.distance=R.dot(Hr,this.normal.array),G.invert(kr,e),G.transpose(kr,kr),Vr[3]=0,R.copy(Vr,this.normal.array),o.transformMat4(Vr,Vr,kr),R.copy(this.normal.array,Vr)}),copy:function(e){R.copy(this.normal.array,e.normal.array),this.normal._dirty=!0,this.distance=e.distance},clone:function(){var e=new jr;return e.copy(this),e}};const Xr=jr;var qr,Zr,Yr=R.set,Kr=R.copy,Qr=R.transformMat4,Jr=Math.min,$r=Math.max,v=function(){this.planes=[];for(var e=0;e<6;e++)this.planes.push(new Xr);for(this.boundingBox=new ar,this.vertices=[],e=0;e<8;e++)this.vertices[e]=R.fromValues(0,0,0)};v.prototype={setFromProjection:function(e){var t=this.planes,r=e.array,i=r[0],n=r[1],a=r[2],o=r[3],s=r[4],l=r[5],h=r[6],u=r[7],c=r[8],d=r[9],f=r[10],p=r[11],m=r[12],g=r[13],_=r[14],r=r[15],s=(Yr(t[0].normal.array,o-i,u-s,p-c),t[0].distance=-(r-m),t[0].normalize(),Yr(t[1].normal.array,o+i,u+s,p+c),t[1].distance=-(r+m),t[1].normalize(),Yr(t[2].normal.array,o+n,u+l,p+d),t[2].distance=-(r+g),t[2].normalize(),Yr(t[3].normal.array,o-n,u-l,p-d),t[3].distance=-(r-g),t[3].normalize(),Yr(t[4].normal.array,o-a,u-h,p-f),t[4].distance=-(r-_),t[4].normalize(),Yr(t[5].normal.array,o+a,u+h,p+f),t[5].distance=-(r+_),t[5].normalize(),this.boundingBox),c=this.vertices;0===r?(d=-(n=-_/(f-1))/l,s.min.set(-(a=-(o=-_/(f+1))/l)*(u=l/i),-a,o),s.max.set(a*u,a,n),Yr(c[0],-a*u,-a,o),Yr(c[1],-a*u,a,o),Yr(c[2],a*u,-a,o),Yr(c[3],a*u,a,o),Yr(c[4],-d*u,-d,n),Yr(c[5],-d*u,d,n),Yr(c[6],d*u,-d,n),Yr(c[7],d*u,d,n)):(h=(-1-m)/i,p=(1-m)/i,t=(1-g)/l,r=(-1-g)/l,a=(-1-_)/f,o=(1-_)/f,s.min.set(Math.min(h,p),Math.min(r,t),Math.min(o,a)),s.max.set(Math.max(p,h),Math.max(t,r),Math.max(a,o)),u=s.min.array,d=s.max.array,Yr(c[0],u[0],u[1],u[2]),Yr(c[1],u[0],d[1],u[2]),Yr(c[2],d[0],u[1],u[2]),Yr(c[3],d[0],d[1],u[2]),Yr(c[4],u[0],u[1],d[2]),Yr(c[5],u[0],d[1],d[2]),Yr(c[6],d[0],u[1],d[2]),Yr(c[7],d[0],d[1],d[2]))},getTransformedBoundingBox:(qr=R.create(),function(e,t){var r=this.vertices,i=t.array,n=e.min,a=e.max,o=n.array,s=a.array,l=r[0];Qr(qr,l,i),Kr(o,qr),Kr(s,qr);for(var h=1;h<8;h++)l=r[h],Qr(qr,l,i),o[0]=Jr(qr[0],o[0]),o[1]=Jr(qr[1],o[1]),o[2]=Jr(qr[2],o[2]),s[0]=$r(qr[0],s[0]),s[1]=$r(qr[1],s[1]),s[2]=$r(qr[2],s[2]);return n._dirty=!0,a._dirty=!0,e})};const ei=v,ti=pr.extend(function(){return{projectionMatrix:new M,invProjectionMatrix:new M,viewMatrix:new M,frustum:new ei}},function(){this.update(!0)},{update:function(e){pr.prototype.update.call(this,e),M.invert(this.viewMatrix,this.worldTransform),this.updateProjectionMatrix(),M.invert(this.invProjectionMatrix,this.projectionMatrix),this.frustum.setFromProjection(this.projectionMatrix)},setViewMatrix:function(e){M.copy(this.viewMatrix,e),M.invert(this.worldTransform,e),this.decomposeWorldTransform()},decomposeProjectionMatrix:function(){},setProjectionMatrix:function(e){M.copy(this.projectionMatrix,e),M.invert(this.invProjectionMatrix,e),this.decomposeProjectionMatrix()},updateProjectionMatrix:function(){},castRay:(Zr=o.create(),function(e,t){var r=void 0!==t?t:new zt,i=e.array[0],n=e.array[1];return o.set(Zr,i,n,-1,1),o.transformMat4(Zr,Zr,this.invProjectionMatrix.array),o.transformMat4(Zr,Zr,this.worldTransform.array),R.scale(r.origin.array,Zr,1/Zr[3]),o.set(Zr,i,n,1,1),o.transformMat4(Zr,Zr,this.invProjectionMatrix.array),o.transformMat4(Zr,Zr,this.worldTransform.array),R.scale(Zr,Zr,1/Zr[3]),R.sub(r.direction.array,Zr,r.origin.array),R.normalize(r.direction.array,r.direction.array),r.direction._dirty=!0,r.origin._dirty=!0,r})});var ri,ii,ni=G.create(),ai=G.create(),oi={};function si(){this.opaque=[],this.transparent=[],this._opaqueCount=0,this._transparentCount=0}function li(e,t){if(t.castShadow&&!e.castShadow)return!0}si.prototype.startCount=function(){this._opaqueCount=0,this._transparentCount=0},si.prototype.add=function(e,t){t?this.transparent[this._transparentCount++]=e:this.opaque[this._opaqueCount++]=e},si.prototype.endCount=function(){this.transparent.length=this._transparentCount,this.opaque.length=this._opaqueCount};const hi=pr.extend(function(){return{material:null,lights:[],viewBoundingBoxLastFrame:new ar,shadowUniforms:{},_cameraList:[],_lightUniforms:{},_previousLightNumber:{},_lightNumber:{},_lightProgramKeys:{},_nodeRepository:{},_renderLists:new xe(20)}},function(){this._scene=this},{addToScene:function(e){e instanceof ti?(0<this._cameraList.length&&console.warn(\\\"Found multiple camera in one scene. Use the fist one.\\\"),this._cameraList.push(e)):e instanceof Ur&&this.lights.push(e),e.name&&(this._nodeRepository[e.name]=e)},removeFromScene:function(e){var t;e instanceof ti?0<=(t=this._cameraList.indexOf(e))&&this._cameraList.splice(t,1):e instanceof Ur&&0<=(t=this.lights.indexOf(e))&&this.lights.splice(t,1),e.name&&delete this._nodeRepository[e.name]},getNode:function(e){return this._nodeRepository[e]},setMainCamera:function(e){var t=this._cameraList.indexOf(e);0<=t&&this._cameraList.splice(t,1),this._cameraList.unshift(e)},getMainCamera:function(){return this._cameraList[0]},getLights:function(){return this.lights},updateLights:function(){var e=this.lights;this._previousLightNumber=this._lightNumber;for(var t,r={},i=0;i<e.length;i++){var n,a=e[i];a.invisible||(r[n=a.group]||(r[n]={}),r[n][a.type]=r[n][a.type]||0,r[n][a.type]++)}for(t in this._lightNumber=r)this._lightProgramKeys[t]=function(e){var t=[],r=Object.keys(e);r.sort();for(var i=0;i<r.length;i++){var n=r[i];t.push(n+\\\" \\\"+e[n])}var a,o=t.join(\\\"\\\\n\\\");return oi[o]||(a=X.genGUID(),oi[o]=a)}(r[t]);this._updateLightUniforms()},cloneNode:function(i){var e=i.clone(),n={};return function i(e,t){n[e.__uid__]=t;for(var r=0;r<e._children.length;r++)i(e._children[r],t._children[r])}(i,e),e.traverse(function(e){e.skeleton&&(e.skeleton=e.skeleton.clone(n)),e.material&&(e.material=e.material.clone())}),e},updateRenderList:function(e,t){var r=e.__uid__,i=this._renderLists.get(r),r=(i||(i=new si,this._renderLists.put(r,i)),i.startCount(),t&&(this.viewBoundingBoxLastFrame.min.set(1/0,1/0,1/0),this.viewBoundingBoxLastFrame.max.set(-1/0,-1/0,-1/0)),this.material&&this.material.transparent||!1);return this._doUpdateRenderList(this,e,r,i,t),i.endCount(),i},getRenderList:function(e){return this._renderLists.get(e.__uid__)},_doUpdateRenderList:function(e,t,r,i,n){if(!e.invisible)for(var a=0;a<e._children.length;a++){var o,s,l=e._children[a];l.isRenderable()&&(o=l.isSkinnedMesh()?ni:l.worldTransform.array,s=l.geometry,G.multiplyAffine(ai,t.viewMatrix.array,o),(!n||s.boundingBox)&&this.isFrustumCulled(l,t,ai)||i.add(l,l.material.transparent||r)),0<l._children.length&&this._doUpdateRenderList(l,t,r,i,n)}},isFrustumCulled:(ri=new ar,ii=new M,function(e,t,r){var i=e.boundingBox;if((i=i||(e.skeleton&&e.skeleton.boundingBox?e.skeleton:e.geometry).boundingBox)&&(ii.array=r,ri.transformFrom(i,ii),e.castShadow&&this.viewBoundingBoxLastFrame.union(ri),e.frustumCulling)){if(!ri.intersectBoundingBox(t.frustum.boundingBox))return!0;ii.array=t.projectionMatrix.array,0<ri.max.array[2]&&ri.min.array[2]<0&&(ri.max.array[2]=-1e-20),ri.applyProjection(ii);var i=ri.min.array,n=ri.max.array;if(n[0]<-1||1<i[0]||n[1]<-1||1<i[1]||n[2]<-1||1<i[2])return!0}return!1}),_updateLightUniforms:function(){var e,t=this.lights,r=(t.sort(li),this._lightUniforms);for(e in r)for(var i in r[e])r[e][i].value.length=0;for(var n=0;n<t.length;n++){var a=t[n];if(!a.invisible)for(var i in e=a.group,a.uniformTemplates){var o=a.uniformTemplates[i],s=o.value(a);if(null!=s){r[e]||(r[e]={}),r[e][i]||(r[e][i]={type:\\\"\\\",value:[]});var l=r[e][i];switch(l.type=o.type+\\\"v\\\",o.type){case\\\"1i\\\":case\\\"1f\\\":case\\\"t\\\":l.value.push(s);break;case\\\"2f\\\":case\\\"3f\\\":case\\\"4f\\\":for(var h=0;h<s.length;h++)l.value.push(s[h]);break;default:console.error(\\\"Unkown light uniform type \\\"+o.type)}}}}},getLightGroups:function(){var e,t=[];for(e in this._lightNumber)t.push(e);return t},getNumberChangedLightGroups:function(){var e,t=[];for(e in this._lightNumber)this.isLightNumberChanged(e)&&t.push(e);return t},isLightNumberChanged:function(e){var t,r=this._previousLightNumber,i=this._lightNumber;for(t in i[e]){if(!r[e])return!0;if(i[e][t]!==r[e][t])return!0}for(t in r[e]){if(!i[e])return!0;if(i[e][t]!==r[e][t])return!0}return!1},getLightsNumbers:function(e){return this._lightNumber[e]},getProgramKey:function(e){return this._lightProgramKeys[e]},setLightUniforms:function(e,t,r){ui(this._lightUniforms[t],e,r),ui(this.shadowUniforms,e,r)},dispose:function(){this.material=null,this._opaqueList=[],this._transparentList=[],this.lights=[],this._lightUniforms={},this._lightNumber={},this._nodeRepository={}}});function ui(e,t,r){for(var i in e){var n=e[i];if(\\\"tv\\\"===n.type){if(t.hasUniform(i)){for(var a=[],o=0;o<n.value.length;o++){var s=n.value[o],s=t.takeCurrentTextureSlot(r,s);a.push(s)}t.setUniform(r.gl,\\\"1iv\\\",i,a)}}else t.setUniform(r.gl,n.type,i,n.value)}}var ci=function(e){this.value=e},di=(fi.prototype.insert=function(e){var t=new ci(e);return this.insertEntry(t),t},fi.prototype.insertEntry=function(e){this.head?((this.tail.next=e).prev=this.tail,e.next=null,this.tail=e):this.head=this.tail=e,this._len++},fi.prototype.remove=function(e){var t=e.prev,r=e.next;t?t.next=r:this.head=r,r?r.prev=t:this.tail=t,e.next=e.prev=null,this._len--},fi.prototype.len=function(){return this._len},fi.prototype.clear=function(){this.head=this.tail=null,this._len=0},fi);function fi(){this._len=0}mi.prototype.put=function(e,t){var r,i,n=this._list,a=this._map,o=null;return null==a[e]&&(i=n.len(),r=this._lastRemovedEntry,i>=this._maxSize&&0<i&&(i=n.head,n.remove(i),delete a[i.key],o=i.value,this._lastRemovedEntry=i),r?r.value=t:r=new ci(t),r.key=e,n.insertEntry(r),a[e]=r),o},mi.prototype.get=function(e){var t=this._map[e],r=this._list;if(null!=t)return t!==r.tail&&(r.remove(t),r.insertEntry(t)),t.value},mi.prototype.clear=function(){this._list.clear(),this._map={}},mi.prototype.len=function(){return this._list.len()};const pi=mi;function mi(e){this._list=new di,this._maxSize=10,this._map={},this._maxSize=e}var gi=Cr,_i=[\\\"px\\\",\\\"nx\\\",\\\"py\\\",\\\"ny\\\",\\\"pz\\\",\\\"nz\\\"],e=B.extend(function(){return{image:{px:null,nx:null,py:null,ny:null,pz:null,nz:null},pixels:{px:null,nx:null,py:null,ny:null,pz:null,nz:null},mipmaps:[]}},{textureType:\\\"textureCube\\\",update:function(e){var t=e.gl,r=(t.bindTexture(t.TEXTURE_CUBE_MAP,this._cache.get(\\\"webgl_texture\\\")),this.updateCommon(e),this.format),i=this.type,n=(t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,this.getAvailableWrapS()),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,this.getAvailableWrapT()),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,this.getAvailableMagFilter()),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,this.getAvailableMinFilter()),e.getGLExtension(\\\"EXT_texture_filter_anisotropic\\\"));if(n&&1<this.anisotropic&&t.texParameterf(t.TEXTURE_CUBE_MAP,n.TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropic),36193!==i||e.getGLExtension(\\\"OES_texture_half_float\\\")||(i=re),this.mipmaps.length)for(var a=this.width,o=this.height,s=0;s<this.mipmaps.length;s++){var l=this.mipmaps[s];this._updateTextureData(t,l,s,a,o,r,i),a/=2,o/=2}else this._updateTextureData(t,this,0,this.width,this.height,r,i),!this.NPOT&&this.useMipmap&&t.generateMipmap(t.TEXTURE_CUBE_MAP);t.bindTexture(t.TEXTURE_CUBE_MAP,null)},_updateTextureData:function(e,t,r,i,n,a,o){for(var s=0;s<6;s++){var l=_i[s],h=t.image&&t.image[l];h?e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+s,r,a,a,o,h):e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+s,r,a,i,n,0,a,o,t.pixels&&t.pixels[l])}},generateMipmap:function(e){var t=e.gl;this.useMipmap&&!this.NPOT&&(t.bindTexture(t.TEXTURE_CUBE_MAP,this._cache.get(\\\"webgl_texture\\\")),t.generateMipmap(t.TEXTURE_CUBE_MAP))},bind:function(e){e.gl.bindTexture(e.gl.TEXTURE_CUBE_MAP,this.getWebGLTexture(e))},unbind:function(e){e.gl.bindTexture(e.gl.TEXTURE_CUBE_MAP,null)},isPowerOfTwo:function(){return this.image.px?gi(this.image.px.width)&&gi(this.image.px.height):gi(this.width)&&gi(this.height)},isRenderable:function(){return this.image.px?vi(this.image.px)&&vi(this.image.nx)&&vi(this.image.py)&&vi(this.image.ny)&&vi(this.image.pz)&&vi(this.image.nz):!(!this.width||!this.height)},load:function(e,i){var n=0,a=this;return X.each(e,function(e,t){var r=_e.createImage();i&&(r.crossOrigin=i),r.onload=function(){0==--n&&(a.dirty(),a.trigger(\\\"success\\\",a))},r.onerror=function(){n--},n++,r.src=e,a.image[t]=r}),this}});function vi(e){return 0<e.width&&0<e.height}Object.defineProperty(e.prototype,\\\"width\\\",{get:function(){return this.image&&this.image.px?this.image.px.width:this._width},set:function(e){this.image&&this.image.px?console.warn(\\\"Texture from image can't set width\\\"):(this._width!==e&&this.dirty(),this._width=e)}}),Object.defineProperty(e.prototype,\\\"height\\\",{get:function(){return this.image&&this.image.px?this.image.px.height:this._height},set:function(e){this.image&&this.image.px?console.warn(\\\"Texture from image can't set height\\\"):(this._height!==e&&this.dirty(),this._height=e)}});const yi=e,xi=ti.extend({fov:50,aspect:1,near:.1,far:2e3},{updateProjectionMatrix:function(){var e=this.fov/180*Math.PI;this.projectionMatrix.perspective(e,this.aspect,this.near,this.far)},decomposeProjectionMatrix:function(){var e=this.projectionMatrix.array,t=2*Math.atan(1/e[5]);this.fov=t/Math.PI*180,this.aspect=e[5]/e[0],this.near=e[14]/(e[10]-1),this.far=e[14]/(e[10]+1)},clone:function(){var e=ti.prototype.clone.call(this);return e.fov=this.fov,e.aspect=this.aspect,e.near=this.near,e.far=this.far,e}});var bi=\\\"framebuffer\\\",wi=\\\"renderbuffer\\\",Ti=\\\"renderbuffer_width\\\",Si=\\\"renderbuffer_height\\\",Mi=\\\"renderbuffer_attached\\\",Ai=\\\"depthtexture_attached\\\",Ei=36160,Ci=36161,Di=36096,s=N.extend({depthBuffer:!0,viewport:null,_width:0,_height:0,_textures:null,_boundRenderer:null},function(){this._cache=new Ar,this._textures={}},{getTextureWidth:function(){return this._width},getTextureHeight:function(){return this._height},bind:function(e){if(e.__currentFrameBuffer){if(e.__currentFrameBuffer===this)return;console.warn(\\\"Renderer already bound with another framebuffer. Unbind it first\\\")}e.__currentFrameBuffer=this;var t=e.gl,r=(t.bindFramebuffer(Ei,this._getFrameBufferGL(e)),this._boundRenderer=e,this._cache);r.put(\\\"viewport\\\",e.viewport);var i,n,a=!1;for(u in this._textures){var a=!0,o=this._textures[u];o&&(i=o.texture.width,n=o.texture.height,this._doAttach(e,o.texture,u,o.target))}this._width=i,this._height=n,!a&&this.depthBuffer&&console.error(\\\"Must attach texture before bind, or renderbuffer may have incorrect width and height.\\\"),this.viewport?e.setViewport(this.viewport):e.setViewport(0,0,i,n,1);var s,l,h=r.get(\\\"attached_textures\\\");if(h)for(var u in h)this._textures[u]||(s=h[u],this._doDetach(t,u,s));!r.get(Ai)&&this.depthBuffer&&(r.miss(wi)&&r.put(wi,t.createRenderbuffer()),l=r.get(wi),i===r.get(Ti)&&n===r.get(Si)||(t.bindRenderbuffer(Ci,l),t.renderbufferStorage(Ci,t.DEPTH_COMPONENT16,i,n),r.put(Ti,i),r.put(Si,n),t.bindRenderbuffer(Ci,null)),r.get(Mi)||(t.framebufferRenderbuffer(Ei,Di,Ci,l),r.put(Mi,!0)))},unbind:function(e){e.__currentFrameBuffer=null,e.gl.bindFramebuffer(Ei,null),this._boundRenderer=null,this._cache.use(e.__uid__);var t=this._cache.get(\\\"viewport\\\");t&&e.setViewport(t),this.updateMipmap(e)},updateMipmap:function(e){var t,r=e.gl;for(t in this._textures){var i,n=this._textures[t];n&&!(n=n.texture).NPOT&&n.useMipmap&&n.minFilter===B.LINEAR_MIPMAP_LINEAR&&(i=\\\"textureCube\\\"===n.textureType?34067:3553,r.bindTexture(i,n.getWebGLTexture(e)),r.generateMipmap(i),r.bindTexture(i,null))}},checkStatus:function(e){return e.checkFramebufferStatus(Ei)},_getFrameBufferGL:function(e){var t=this._cache;return t.use(e.__uid__),t.miss(bi)&&t.put(bi,e.gl.createFramebuffer()),t.get(bi)},attach:function(e,t,r){if(!e.width)throw new Error(\\\"The texture attached to color buffer is not a valid.\\\");t=t||36064,r=r||3553;var i,n=this._boundRenderer,a=(n&&n.gl&&((i=this._cache).use(n.__uid__),i=i.get(\\\"attached_textures\\\")),this._textures[t]);a&&a.target===r&&a.texture===e&&i&&null!=i[t]||(a=!0,n&&(a=this._doAttach(n,e,t,r),this.viewport||n.setViewport(0,0,e.width,e.height,1)),a&&(this._textures[t]=this._textures[t]||{},this._textures[t].texture=e,this._textures[t].target=r))},_doAttach:function(e,t,r,i){var n=e.gl,a=t.getWebGLTexture(e),o=this._cache.get(\\\"attached_textures\\\");if(o&&o[r]){var s=o[r];if(s.texture===t&&s.target===i)return}var l,s=!0;return(r=+r)!=Di&&r!==fe||(e.getGLExtension(\\\"WEBGL_depth_texture\\\")||(console.error(\\\"Depth texture is not supported by the browser\\\"),s=!1),t.format!==ie&&34041!==t.format&&(console.error(\\\"The texture attached to depth buffer is not a valid.\\\"),s=!1),!s)||((l=this._cache.get(wi))&&(n.framebufferRenderbuffer(Ei,Di,Ci,null),n.deleteRenderbuffer(l),this._cache.put(wi,!1)),this._cache.put(Mi,!1),this._cache.put(Ai,!0)),n.framebufferTexture2D(Ei,r,i,a,0),o||this._cache.put(\\\"attached_textures\\\",o={}),o[r]=o[r]||{},o[r].texture=t,o[r].target=i,s},_doDetach:function(e,t,r){e.framebufferTexture2D(Ei,t,r,null,0);var i=this._cache.get(\\\"attached_textures\\\");i&&i[t]&&(i[t]=null),t!==Di&&t!==fe||this._cache.put(Ai,!1)},detach:function(e,t){this._textures[e]=null,this._boundRenderer&&(this._cache.use(this._boundRenderer.__uid__),this._doDetach(this._boundRenderer.gl,e,t))},dispose:function(e){var t=e.gl,r=this._cache,i=(r.use(e.__uid__),r.get(wi)),i=(i&&t.deleteRenderbuffer(i),r.get(bi));i&&t.deleteFramebuffer(i),r.deleteContext(e.__uid__),this._textures={}}});s.DEPTH_ATTACHMENT=Di,s.COLOR_ATTACHMENT0=36064,s.STENCIL_ATTACHMENT=36128,s.DEPTH_STENCIL_ATTACHMENT=fe;const Li=s;var Pi=[\\\"px\\\",\\\"nx\\\",\\\"py\\\",\\\"ny\\\",\\\"pz\\\",\\\"nz\\\"];const Oi=N.extend(function(){var e={position:new z,far:1e3,near:.1,texture:null,shadowMapPass:null},t=e._cameras={px:new xi({fov:90}),nx:new xi({fov:90}),py:new xi({fov:90}),ny:new xi({fov:90}),pz:new xi({fov:90}),nz:new xi({fov:90})};return t.px.lookAt(z.POSITIVE_X,z.NEGATIVE_Y),t.nx.lookAt(z.NEGATIVE_X,z.NEGATIVE_Y),t.py.lookAt(z.POSITIVE_Y,z.POSITIVE_Z),t.ny.lookAt(z.NEGATIVE_Y,z.NEGATIVE_Z),t.pz.lookAt(z.POSITIVE_Z,z.NEGATIVE_Y),t.nz.lookAt(z.NEGATIVE_Z,z.NEGATIVE_Y),e._frameBuffer=new Li,e},{getCamera:function(e){return this._cameras[e]},render:function(e,t,r){var i=e.gl;r||t.update();for(var n=this.texture.width,a=2*Math.atan(n/(n-.5))/Math.PI*180,o=0;o<6;o++){var s,l=this._cameras[Pi[o]];z.copy(l.position,this.position),l.far=this.far,l.near=this.near,l.fov=a,this.shadowMapPass&&(l.update(),(s=t.getBoundingBox()).applyTransform(l.viewMatrix),t.viewBoundingBoxLastFrame.copy(s),this.shadowMapPass.render(e,t,l,!0)),this._frameBuffer.attach(this.texture,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+o),this._frameBuffer.bind(e),e.render(t,l,!0),this._frameBuffer.unbind(e)}},dispose:function(e){this._frameBuffer.dispose(e)}}),Ni=_.extend({dynamic:!1,widthSegments:1,heightSegments:1},function(){this.build()},{build:function(){for(var e=this.heightSegments,t=this.widthSegments,r=this.attributes,i=[],n=[],a=[],o=[],s=0;s<=e;s++)for(var l=s/e,h=0;h<=t;h++){var u=h/t;i.push([2*u-1,2*l-1,0]),n&&n.push([u,l]),a&&a.push([0,0,1]),h<t&&s<e&&(o.push([u=h+s*(t+1),u+1,u+t+1]),o.push([u+t+1,u+1,u+t+2]))}r.position.fromArray(i),r.texcoord0.fromArray(n),r.normal.fromArray(a),this.initIndicesFromArray(o),this.boundingBox=new ar,this.boundingBox.min.set(-1,-1,0),this.boundingBox.max.set(1,1,0)}});var Ii=new M;function Ri(e,t,r){Ii.identity();var i=new Ni({widthSegments:t,heightSegments:r});switch(e){case\\\"px\\\":M.translate(Ii,Ii,z.POSITIVE_X),M.rotateY(Ii,Ii,Math.PI/2);break;case\\\"nx\\\":M.translate(Ii,Ii,z.NEGATIVE_X),M.rotateY(Ii,Ii,-Math.PI/2);break;case\\\"py\\\":M.translate(Ii,Ii,z.POSITIVE_Y),M.rotateX(Ii,Ii,-Math.PI/2);break;case\\\"ny\\\":M.translate(Ii,Ii,z.NEGATIVE_Y),M.rotateX(Ii,Ii,Math.PI/2);break;case\\\"pz\\\":M.translate(Ii,Ii,z.POSITIVE_Z);break;case\\\"nz\\\":M.translate(Ii,Ii,z.NEGATIVE_Z),M.rotateY(Ii,Ii,Math.PI)}return i.applyTransform(Ii),i}const Bi=_.extend({dynamic:!1,widthSegments:1,heightSegments:1,depthSegments:1,inside:!1},function(){this.build()},{build:function(){var e={px:Ri(\\\"px\\\",this.depthSegments,this.heightSegments),nx:Ri(\\\"nx\\\",this.depthSegments,this.heightSegments),py:Ri(\\\"py\\\",this.widthSegments,this.depthSegments),ny:Ri(\\\"ny\\\",this.widthSegments,this.depthSegments),pz:Ri(\\\"pz\\\",this.widthSegments,this.heightSegments),nz:Ri(\\\"nz\\\",this.widthSegments,this.heightSegments)},t=[\\\"position\\\",\\\"texcoord0\\\",\\\"normal\\\"],r=0,i=0;for(a in e)r+=e[a].vertexCount,i+=e[a].indices.length;for(var n=0;n<t.length;n++)this.attributes[t[n]].init(r);this.indices=new _e.Uint16Array(i);var a,o=0,s=0;for(a in e){for(var l=e[a],n=0;n<t.length;n++)for(var h=t[n],u=l.attributes[h].value,c=l.attributes[h].size,d=\\\"normal\\\"===h,f=0;f<u.length;f++){var p=u[f];this.inside&&d&&(p=-p),this.attributes[h].value[f+c*s]=p}for(var m=l.indices.length,f=0;f<l.indices.length;f++)this.indices[f+o]=s+l.indices[this.inside?m-f-1:f];o+=l.indices.length,s+=l.vertexCount}this.boundingBox=new ar,this.boundingBox.max.set(1,1,1),this.boundingBox.min.set(-1,-1,-1)}}),Fi=(S[\\\"import\\\"](\\\"@export clay.skybox.vertex\\\\n#define SHADER_NAME skybox\\\\nuniform mat4 world : WORLD;\\\\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\\\\nattribute vec3 position : POSITION;\\\\nvarying vec3 v_WorldPosition;\\\\nvoid main()\\\\n{\\\\n v_WorldPosition = (world * vec4(position, 1.0)).xyz;\\\\n gl_Position = worldViewProjection * vec4(position, 1.0);\\\\n}\\\\n@end\\\\n@export clay.skybox.fragment\\\\n#define PI 3.1415926\\\\nuniform mat4 viewInverse : VIEWINVERSE;\\\\n#ifdef EQUIRECTANGULAR\\\\nuniform sampler2D environmentMap;\\\\n#else\\\\nuniform samplerCube environmentMap;\\\\n#endif\\\\nuniform float lod: 0.0;\\\\nvarying vec3 v_WorldPosition;\\\\n@import clay.util.rgbm\\\\n@import clay.util.srgb\\\\n@import clay.util.ACES\\\\nvoid main()\\\\n{\\\\n vec3 eyePos = viewInverse[3].xyz;\\\\n vec3 V = normalize(v_WorldPosition - eyePos);\\\\n#ifdef EQUIRECTANGULAR\\\\n float phi = acos(V.y);\\\\n float theta = atan(-V.x, V.z) + PI * 0.5;\\\\n vec2 uv = vec2(theta / 2.0 / PI, phi / PI);\\\\n vec4 texel = decodeHDR(texture2D(environmentMap, fract(uv)));\\\\n#else\\\\n #if defined(LOD) || defined(SUPPORT_TEXTURE_LOD)\\\\n vec4 texel = decodeHDR(textureCubeLodEXT(environmentMap, V, lod));\\\\n #else\\\\n vec4 texel = decodeHDR(textureCube(environmentMap, V));\\\\n #endif\\\\n#endif\\\\n#ifdef SRGB_DECODE\\\\n texel = sRGBToLinear(texel);\\\\n#endif\\\\n#ifdef TONEMAPPING\\\\n texel.rgb = ACESToneMapping(texel.rgb);\\\\n#endif\\\\n#ifdef SRGB_ENCODE\\\\n texel = linearTosRGB(texel);\\\\n#endif\\\\n gl_FragColor = encodeHDR(vec4(texel.rgb, 1.0));\\\\n}\\\\n@end\\\"),Er.extend(function(){var e=new S({vertex:S.source(\\\"clay.skybox.vertex\\\"),fragment:S.source(\\\"clay.skybox.fragment\\\")}),e=new Fe({shader:e,depthMask:!1});return{scene:null,geometry:new Bi,material:e,environmentMap:null,culling:!1,_dummyCamera:new xi}},function(){var e=this.scene;e&&this.attachScene(e),this.environmentMap&&this.setEnvironmentMap(this.environmentMap)},{attachScene:function(e){this.scene&&this.detachScene(),((e.skybox=this).scene=e).on(\\\"beforerender\\\",this._beforeRenderScene,this)},detachScene:function(){this.scene&&(this.scene.off(\\\"beforerender\\\",this._beforeRenderScene),this.scene.skybox=null),this.scene=null},dispose:function(e){this.detachScene(),this.geometry.dispose(e)},setEnvironmentMap:function(e){\\\"texture2D\\\"===e.textureType?(this.material.define(\\\"EQUIRECTANGULAR\\\"),e.minFilter=B.LINEAR):this.material.undefine(\\\"EQUIRECTANGULAR\\\"),this.material.set(\\\"environmentMap\\\",e)},getEnvironmentMap:function(){return this.material.get(\\\"environmentMap\\\")},_beforeRenderScene:function(e,t,r){this.renderSkybox(e,r)},renderSkybox:function(e,t){var r=this._dummyCamera;r.aspect=e.getViewportAspect(),r.fov=t.fov||50,r.updateProjectionMatrix(),M.invert(r.invProjectionMatrix,r.projectionMatrix),r.worldTransform.copy(t.worldTransform),r.viewMatrix.copy(t.viewMatrix),this.position.copy(t.getWorldPosition()),this.update(),e.gl.disable(e.gl.BLEND),0<this.material.get(\\\"lod\\\")?this.material.define(\\\"fragment\\\",\\\"LOD\\\"):this.material.undefine(\\\"fragment\\\",\\\"LOD\\\"),e.renderPass([this],r)}})),zi=Fi;function Gi(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var Ui=Gi(\\\"DXT1\\\"),ki=Gi(\\\"DXT3\\\"),Vi=Gi(\\\"DXT5\\\");var Hi=String.fromCharCode;function Wi(e,t,r,i){for(var n,a,o=0,s=0,l=i;0<l;)if(e[s][0]=t[r++],e[s][1]=t[r++],e[s][2]=t[r++],e[s][3]=t[r++],1===e[s][0]&&1===e[s][1]&&1===e[s][2]){for(var h=e[s][3]<<o>>>0;0<h;h--)n=e[s-1],(a=e[s])[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],s++,l--;o+=8}else s++,l--,o=0;return r}const ji=function(e,t,r){null==r&&(r=0);var i,n,a,o,s,l=new Uint8Array(e),h=l.length;if(\\\"#?\\\"===function(e){for(var t=\\\"\\\",r=0;r<2;r++)t+=Hi(e[r]);return t}(l)){for(var u=2;u<h&&(\\\"\\\\n\\\"!==Hi(l[u])||\\\"\\\\n\\\"!==Hi(l[u+1]));u++);if(!(h<=u)){u+=2;for(var c=\\\"\\\";u<h;u++){var d=Hi(l[u]);if(\\\"\\\\n\\\"===d)break;c+=d}var f=c.split(\\\" \\\"),p=parseInt(f[1]),m=parseInt(f[3]);if(m&&p){for(var g=u+1,_=[],v=0;v<m;v++){_[v]=[];for(var y=0;y<4;y++)_[v][y]=0}for(var x=new Float32Array(m*p*4),b=0,w=0;w<p;w++){if(!(g=function(e,t,r,i){if(i<8|32767<i)return Wi(e,t,r,i);if(2!=(n=t[r++]))return Wi(e,t,r-1,i);if(e[0][1]=t[r++],e[0][2]=t[r++],n=t[r++],(e[0][2]<<8>>>0|n)>>>0!==i)return null;for(var n=0;n<4;n++)for(var a=0;a<i;)if(128<(o=t[r++]))for(var o=(127&o)>>>0,s=t[r++];o--;)e[a++][n]=s;else for(;o--;)e[a++][n]=t[r++];return r}(_,l,g,m)))return null;for(v=0;v<m;v++)n=x,a=b,o=r,s=void 0,0<(i=_[v])[3]?(s=Math.pow(2,i[3]-128-8+o),n[a+0]=i[0]*s,n[a+1]=i[1]*s,n[a+2]=i[2]*s):(n[a+0]=0,n[a+1]=0,n[a+2]=0),n[a+3]=1,b+=4}return(t=t||new k).width=m,t.height=p,t.pixels=x,t.type=B.FLOAT,t}}}};var Xi={loadTexture:function(e,t,r,i){var n;if(t=\\\"function\\\"==typeof t?(i=r=t,{}):t||{},\\\"string\\\"==typeof e){if(e.match(/.hdr$/)||\\\"hdr\\\"===t.fileType)return n=new k({width:0,height:0,sRGB:!1}),Xi._fetchTexture(e,function(e){ji(e,n,t.exposure),n.dirty(),r&&r(n)},i),n;e.match(/.dds$/)||\\\"dds\\\"===t.fileType?(n=new k({width:0,height:0}),Xi._fetchTexture(e,function(e){(function(e,t){var r=new Int32Array(e,0,31);if(542327876!==r[0])return;if(4&!r(20))return;var i,n,a=r(21),o=r[4],s=r[3],l=512&r[28],h=131072&r[2];switch(a){case Ui:i=8,n=B.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case ki:i=16,n=B.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case Vi:i=16,n=B.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return}var u=r[1]+4,c=l?6:1,d=1;h&&(d=Math.max(1,r[7]));for(var f=[],p=0;p<c;p++){var m=o,g=s;f[p]=new k({width:m,height:g,format:n});for(var _=[],v=0;v<d;v++){var y=Math.max(4,m)/4*Math.max(4,g)/4*i,x=new Uint8Array(e,u,y);u+=y,m*=.5,g*=.5,_[v]=x}f[p].pixels=_[0],h&&(f[p].mipmaps=_)}if(!t)return;t.width=f[0].width,t.height=f[0].height,t.format=f[0].format,t.pixels=f[0].pixels,t.mipmaps=f[0].mipmaps})(e,n),n.dirty(),r&&r(n)},i)):((n=new k).load(e),n.success(r),n.error(i))}else\\\"object\\\"==typeof e&&void 0!==e.px&&((n=new yi).load(e),n.success(r),n.error(i));return n},loadPanorama:function(t,e,r,i,n,a){var o=this;i=\\\"function\\\"==typeof i?(a=n=i,{}):i||{},Xi.loadTexture(e,i,function(e){e.flipY=i.flipY||!1,o.panoramaToCubeMap(t,e,r,i),e.dispose(t),n&&n(r)},a)},panoramaToCubeMap:function(e,t,r,i){var n=new Oi,a=new zi({scene:new hi});return a.setEnvironmentMap(t),(i=i||{}).encodeRGBM&&a.material.define(\\\"fragment\\\",\\\"RGBM_ENCODE\\\"),r.sRGB=t.sRGB,n.texture=r,n.render(e,a.scene),n.texture=null,n.dispose(e),r},heightToNormal:function(e,t){var r=document.createElement(\\\"canvas\\\"),i=r.width=e.width,n=r.height=e.height,a=r.getContext(\\\"2d\\\");a.drawImage(e,0,0,i,n),t=t||!1;for(var o=a.getImageData(0,0,i,n),s=a.createImageData(i,n),l=0;l<o.data.length;l+=4){if(t){var h=o.data[l],u=o.data[l+1],c=o.data[l+2];if(20<Math.abs(h-u)+Math.abs(u-c))return console.warn(\\\"Given image is not a height map\\\"),e}var d,f,h=l%(4*i)==0?(d=o.data[l],o.data[l+4]):l%(4*i)==4*(i-1)?(d=o.data[l-4],o.data[l]):(d=o.data[l-4],o.data[l+4]),u=l<4*i?(f=o.data[l],o.data[l+4*i]):i*(n-1)*4<l?(f=o.data[l-4*i],o.data[l]):(f=o.data[l-4*i],o.data[l+4*i]);s.data[l]=d-h+127,s.data[l+1]=f-u+127,s.data[l+2]=255,s.data[l+3]=255}return a.putImageData(s,0,0),r},isHeightImage:function(e,t,r){if(!e||!e.width||!e.height)return!1;var i=document.createElement(\\\"canvas\\\"),n=i.getContext(\\\"2d\\\"),a=t||32;r=r||20,i.width=i.height=a,n.drawImage(e,0,0,a,a);for(var o=n.getImageData(0,0,a,a),s=0;s<o.data.length;s+=4){var l=o.data[s],h=o.data[s+1],u=o.data[s+2];if(Math.abs(l-h)+Math.abs(h-u)>r)return!1}return!0},_fetchTexture:function(e,t,r){_e.request.get({url:e,responseType:\\\"arraybuffer\\\",onload:t,onerror:r})},createChessboard:function(e,t,r,i){e=e||512,t=t||64,r=r||\\\"black\\\",i=i||\\\"white\\\";var n=Math.ceil(e/t),a=document.createElement(\\\"canvas\\\"),o=(a.width=e,a.height=e,a.getContext(\\\"2d\\\"));o.fillStyle=i,o.fillRect(0,0,e,e),o.fillStyle=r;for(var s=0;s<n;s++)for(var l=0;l<n;l++)(l%2?s%2:s%2-1)&&o.fillRect(s*t,l*t,t,t);return new k({image:a,anisotropic:8})},createBlank:function(e){var t=document.createElement(\\\"canvas\\\"),r=(t.width=1,t.height=1,t.getContext(\\\"2d\\\"));return r.fillStyle=e,r.fillRect(0,0,1,1),new k({image:t})}};const qi=Xi;var Zi=[\\\"mousedown\\\",\\\"mouseup\\\",\\\"mousemove\\\",\\\"mouseover\\\",\\\"mouseout\\\",\\\"click\\\",\\\"dblclick\\\",\\\"contextmenu\\\"];function Yi(e){return\\\"_on\\\"+e}var Ki,Qi,Ji,$i,en,tn,rn,nn,v=function(e){var t=this;this._texture=new k({anisotropic:32,flipY:!1,surface:this,dispose:function(e){t.dispose(),k.prototype.dispose.call(this,e)}}),Zi.forEach(function(r){this[Yi(r)]=function(t){t.triangle&&this._meshes.forEach(function(e){this.dispatchEvent(r,e,t.triangle,t.point)},this)}},this),this._meshes=[],e&&this.setECharts(e),this.onupdate=null};v.prototype={constructor:v,getTexture:function(){return this._texture},setECharts:function(e){var t,r,i,n=(this._chart=e).getDom();n instanceof HTMLCanvasElement?(t=this,r=e.getZr(),i=r.__oldRefreshImmediately||r.refreshImmediately,r.refreshImmediately=function(){i.call(this),t._texture.dirty(),t.onupdate&&t.onupdate()},r.__oldRefreshImmediately=i):(console.error(\\\"ECharts must init on canvas if it is used as texture.\\\"),n=document.createElement(\\\"canvas\\\")),this._texture.image=n,this._texture.dirty(),this.onupdate&&this.onupdate()},dispatchEvent:(Ki=new z,Qi=new z,Ji=new z,$i=new ke,en=new ke,tn=new ke,rn=new ke,nn=new z,function(e,t,r,i){var n=t.geometry,a=n.attributes.position,n=n.attributes.texcoord0,o=z.dot,s=z.cross,a=(a.get(r[0],Ki.array),a.get(r[1],Qi.array),a.get(r[2],Ji.array),n.get(r[0],$i.array),n.get(r[1],en.array),n.get(r[2],tn.array),s(nn,Qi,Ji),o(Ki,nn)),n=o(i,nn)/a,l=(s(nn,Ji,Ki),o(i,nn)/a),s=(s(nn,Ki,Qi),o(i,nn)/a),o=(ke.scale(rn,$i,n),ke.scaleAndAdd(rn,rn,en,l),ke.scaleAndAdd(rn,rn,tn,s),rn.x*this._chart.getWidth()),a=rn.y*this._chart.getHeight();this._chart.getZr().handler.dispatch(e,{zrX:o,zrY:a})}),attachToMesh:function(t){0<=this._meshes.indexOf(t)||(Zi.forEach(function(e){t.on(e,this[Yi(e)],this)},this),this._meshes.push(t))},detachFromMesh:function(t){var e=this._meshes.indexOf(t);0<=e&&this._meshes.splice(e,1),Zi.forEach(function(e){t.off(e,this[Yi(e)])},this)},dispose:function(){this._meshes.forEach(function(e){this.detachFromMesh(e)},this)}};const an=v,on=ti.extend({left:-1,right:1,near:-1,far:1,top:1,bottom:-1},{updateProjectionMatrix:function(){this.projectionMatrix.ortho(this.left,this.right,this.bottom,this.top,this.near,this.far)},decomposeProjectionMatrix:function(){var e=this.projectionMatrix.array;this.left=(-1-e[12])/e[0],this.right=(1-e[12])/e[0],this.top=(1-e[13])/e[5],this.bottom=(-1-e[13])/e[5],this.near=-(-1-e[14])/e[10],this.far=-(1-e[14])/e[10]},clone:function(){var e=ti.prototype.clone.call(this);return e.left=this.left,e.right=this.right,e.near=this.near,e.far=this.far,e.top=this.top,e.bottom=this.bottom,e}});S[\\\"import\\\"](\\\"\\\\n@export clay.compositor.vertex\\\\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\\\\nattribute vec3 position : POSITION;\\\\nattribute vec2 texcoord : TEXCOORD_0;\\\\nvarying vec2 v_Texcoord;\\\\nvoid main()\\\\n{\\\\n v_Texcoord = texcoord;\\\\n gl_Position = worldViewProjection * vec4(position, 1.0);\\\\n}\\\\n@end\\\");var e=new Ni,sn=new Er({geometry:e,frustumCulling:!1}),ln=new on;const hn=N.extend(function(){return{fragment:\\\"\\\",outputs:null,material:null,blendWithPrevious:!1,clearColor:!1,clearDepth:!0}},function(){var e=new S(S.source(\\\"clay.compositor.vertex\\\"),this.fragment),e=new Fe({shader:e});e.enableTexturesAll(),this.material=e},{setUniform:function(e,t){this.material.setUniform(e,t)},getUniform:function(e){var t=this.material.uniforms[e];if(t)return t.value},attachOutput:function(e,t){this.outputs||(this.outputs={}),this.outputs[t=t||36064]=e},detachOutput:function(e){for(var t in this.outputs)this.outputs[t]===e&&(this.outputs[t]=null)},bind:function(e,t){if(this.outputs)for(var r in this.outputs){var i=this.outputs[r];i&&t.attach(i,r)}t&&t.bind(e)},unbind:function(e,t){t.unbind(e)},render:function(e,t){var r=e.gl;if(t){this.bind(e,t);var i=e.getGLExtension(\\\"EXT_draw_buffers\\\");if(i&&this.outputs){var n,a=[];for(n in this.outputs)(n=+n)>=r.COLOR_ATTACHMENT0&&n<=r.COLOR_ATTACHMENT0+8&&a.push(n);i.drawBuffersEXT(a)}}this.trigger(\\\"beforerender\\\",this,e);var o,i=this.clearDepth?r.DEPTH_BUFFER_BIT:0;r.depthMask(!0),this.clearColor&&(i|=r.COLOR_BUFFER_BIT,r.colorMask(!0,!0,!0,!0),o=this.clearColor,Array.isArray(o))&&r.clearColor(o[0],o[1],o[2],o[3]),r.clear(i),this.blendWithPrevious?(r.enable(r.BLEND),this.material.transparent=!0):(r.disable(r.BLEND),this.material.transparent=!1),this.renderQuad(e),this.trigger(\\\"afterrender\\\",this,e),t&&this.unbind(e,t)},renderQuad:function(e){sn.material=this.material,e.renderPass([sn],ln)},dispose:function(e){}});var un={},cn=[\\\"px\\\",\\\"nx\\\",\\\"py\\\",\\\"ny\\\",\\\"pz\\\",\\\"nz\\\"];un.prefilterEnvironmentMap=function(e,t,r,i,n){n&&i||(i=un.generateNormalDistribution(),n=un.integrateBRDF(e,i));var a=(r=r||{}).width||64,o=r.height||64,s=r.type||t.type,l=new yi({width:a,height:o,type:s,flipY:!1,mipmaps:[]}),h=(l.isPowerOfTwo()||console.warn(\\\"Width and height must be power of two to enable mipmap.\\\"),Math.min(a,o)),u=Math.log(h)/Math.log(2)+1,h=new Fe({shader:new S({vertex:S.source(\\\"clay.skybox.vertex\\\"),fragment:\\\"#define SHADER_NAME prefilter\\\\n#define SAMPLE_NUMBER 1024\\\\n#define PI 3.14159265358979\\\\nuniform mat4 viewInverse : VIEWINVERSE;\\\\nuniform samplerCube environmentMap;\\\\nuniform sampler2D normalDistribution;\\\\nuniform float roughness : 0.5;\\\\nvarying vec2 v_Texcoord;\\\\nvarying vec3 v_WorldPosition;\\\\n@import clay.util.rgbm\\\\nvec3 importanceSampleNormal(float i, float roughness, vec3 N) {\\\\n vec3 H = texture2D(normalDistribution, vec2(roughness, i)).rgb;\\\\n vec3 upVector = abs(N.y) > 0.999 ? vec3(1.0, 0.0, 0.0) : vec3(0.0, 1.0, 0.0);\\\\n vec3 tangentX = normalize(cross(N, upVector));\\\\n vec3 tangentZ = cross(N, tangentX);\\\\n return normalize(tangentX * H.x + N * H.y + tangentZ * H.z);\\\\n}\\\\nvoid main() {\\\\n vec3 eyePos = viewInverse[3].xyz;\\\\n vec3 V = normalize(v_WorldPosition - eyePos);\\\\n vec3 N = V;\\\\n vec3 prefilteredColor = vec3(0.0);\\\\n float totalWeight = 0.0;\\\\n float fMaxSampleNumber = float(SAMPLE_NUMBER);\\\\n for (int i = 0; i < SAMPLE_NUMBER; i++) {\\\\n vec3 H = importanceSampleNormal(float(i) / fMaxSampleNumber, roughness, N);\\\\n vec3 L = reflect(-V, H);\\\\n float NoL = clamp(dot(N, L), 0.0, 1.0);\\\\n if (NoL > 0.0) {\\\\n prefilteredColor += decodeHDR(textureCube(environmentMap, L)).rgb * NoL;\\\\n totalWeight += NoL;\\\\n }\\\\n }\\\\n gl_FragColor = encodeHDR(vec4(prefilteredColor / totalWeight, 1.0));\\\\n}\\\\n\\\"})});h.set(\\\"normalDistribution\\\",i),r.encodeRGBM&&h.define(\\\"fragment\\\",\\\"RGBM_ENCODE\\\"),r.decodeRGBM&&h.define(\\\"fragment\\\",\\\"RGBM_DECODE\\\");var c,d,f=new hi,p=(\\\"texture2D\\\"===t.textureType&&(d=new yi({width:a,height:o,type:s===B.FLOAT?B.HALF_FLOAT:s}),qi.panoramaToCubeMap(e,t,d,{encodeRGBM:r.decodeRGBM}),t=d),(c=new Fi({scene:f,material:h})).material.set(\\\"environmentMap\\\",t),new Oi({texture:l}));r.encodeRGBM&&(s=l.type=B.UNSIGNED_BYTE);for(var m=new k({width:a,height:o,type:s}),g=new Li({depthBuffer:!1}),_=_e[s===B.UNSIGNED_BYTE?\\\"Uint8Array\\\":\\\"Float32Array\\\"],v=0;v<u;v++){l.mipmaps[v]={pixels:{}},c.material.set(\\\"roughness\\\",v/(u-1));for(var y=m.width,x=2*Math.atan(y/(y-.5))/Math.PI*180,b=0;b<cn.length;b++){var w=new _(m.width*m.height*4),T=(g.attach(m),g.bind(e),p.getCamera(cn[b]));T.fov=x,e.render(f,T),e.gl.readPixels(0,0,m.width,m.height,B.RGBA,s,w),g.unbind(e),l.mipmaps[v].pixels[cn[b]]=w}m.width/=2,m.height/=2,m.dirty()}return g.dispose(e),m.dispose(e),c.dispose(e),i.dispose(e),{environmentMap:l,brdfLookup:n,normalDistribution:i,maxMipmapLevel:u}},un.integrateBRDF=function(e,t){t=t||un.generateNormalDistribution();var r=new Li({depthBuffer:!1}),i=new hn({fragment:\\\"#define SAMPLE_NUMBER 1024\\\\n#define PI 3.14159265358979\\\\nuniform sampler2D normalDistribution;\\\\nuniform vec2 viewportSize : [512, 256];\\\\nconst vec3 N = vec3(0.0, 0.0, 1.0);\\\\nconst float fSampleNumber = float(SAMPLE_NUMBER);\\\\nvec3 importanceSampleNormal(float i, float roughness, vec3 N) {\\\\n vec3 H = texture2D(normalDistribution, vec2(roughness, i)).rgb;\\\\n vec3 upVector = abs(N.y) > 0.999 ? vec3(1.0, 0.0, 0.0) : vec3(0.0, 1.0, 0.0);\\\\n vec3 tangentX = normalize(cross(N, upVector));\\\\n vec3 tangentZ = cross(N, tangentX);\\\\n return normalize(tangentX * H.x + N * H.y + tangentZ * H.z);\\\\n}\\\\nfloat G_Smith(float roughness, float NoV, float NoL) {\\\\n float k = roughness * roughness / 2.0;\\\\n float G1V = NoV / (NoV * (1.0 - k) + k);\\\\n float G1L = NoL / (NoL * (1.0 - k) + k);\\\\n return G1L * G1V;\\\\n}\\\\nvoid main() {\\\\n vec2 uv = gl_FragCoord.xy / viewportSize;\\\\n float NoV = uv.x;\\\\n float roughness = uv.y;\\\\n vec3 V;\\\\n V.x = sqrt(1.0 - NoV * NoV);\\\\n V.y = 0.0;\\\\n V.z = NoV;\\\\n float A = 0.0;\\\\n float B = 0.0;\\\\n for (int i = 0; i < SAMPLE_NUMBER; i++) {\\\\n vec3 H = importanceSampleNormal(float(i) / fSampleNumber, roughness, N);\\\\n vec3 L = reflect(-V, H);\\\\n float NoL = clamp(L.z, 0.0, 1.0);\\\\n float NoH = clamp(H.z, 0.0, 1.0);\\\\n float VoH = clamp(dot(V, H), 0.0, 1.0);\\\\n if (NoL > 0.0) {\\\\n float G = G_Smith(roughness, NoV, NoL);\\\\n float G_Vis = G * VoH / (NoH * NoV);\\\\n float Fc = pow(1.0 - VoH, 5.0);\\\\n A += (1.0 - Fc) * G_Vis;\\\\n B += Fc * G_Vis;\\\\n }\\\\n }\\\\n gl_FragColor = vec4(vec2(A, B) / fSampleNumber, 0.0, 1.0);\\\\n}\\\\n\\\"}),n=new k({width:512,height:256,type:B.HALF_FLOAT,wrapS:B.CLAMP_TO_EDGE,wrapT:B.CLAMP_TO_EDGE,minFilter:B.NEAREST,magFilter:B.NEAREST,useMipmap:!1});return i.setUniform(\\\"normalDistribution\\\",t),i.setUniform(\\\"viewportSize\\\",[512,256]),i.attachOutput(n),i.render(e,r),r.dispose(e),n},un.generateNormalDistribution=function(e,t){for(var r=new k({width:e=e||256,height:t=t||1024,type:B.FLOAT,minFilter:B.NEAREST,magFilter:B.NEAREST,wrapS:B.CLAMP_TO_EDGE,wrapT:B.CLAMP_TO_EDGE,useMipmap:!1}),i=new Float32Array(t*e*4),n=[],a=0;a<e;a++){for(var o=a/e,s=o*o,l=0;l<t;l++){var h=(((16711935&(h=((252645135&(h=((858993459&(h=((1431655765&(h=(l<<16|l>>>16)>>>0))<<1|(2863311530&h)>>>1)>>>0))<<2|(3435973836&h)>>>2)>>>0))<<4|(4042322160&h)>>>4)>>>0))<<8|(4278255360&h)>>>8)>>>0)/4294967296,u=Math.sqrt((1-h)/(1+(s*s-1)*h));n[l]=u}for(l=0;l<t;l++){var c=4*(l*e+a),d=(u=n[l],Math.sqrt(1-u*u)),f=2*Math.PI*(l/t);i[c]=d*Math.cos(f),i[1+c]=u,i[2+c]=d*Math.sin(f),i[3+c]=1}}return r.pixels=i,r};const dn=un,fn=Ur.extend({cubemap:null,castShadow:!1,_normalDistribution:null,_brdfLookup:null},{type:\\\"AMBIENT_CUBEMAP_LIGHT\\\",prefilter:function(e,t){var r,i;e.getGLExtension(\\\"EXT_shader_texture_lod\\\")?(this._brdfLookup||(this._normalDistribution=dn.generateNormalDistribution(),this._brdfLookup=dn.integrateBRDF(e,this._normalDistribution)),(r=this.cubemap).__prefiltered||(i=dn.prefilterEnvironmentMap(e,r,{encodeRGBM:!0,width:t,height:t},this._normalDistribution,this._brdfLookup),this.cubemap=i.environmentMap,this.cubemap.__prefiltered=!0,r.dispose(e))):console.warn(\\\"Device not support textureCubeLodEXT\\\")},getBRDFLookup:function(){return this._brdfLookup},uniformTemplates:{ambientCubemapLightColor:{type:\\\"3f\\\",value:function(e){var t=e.color,r=e.intensity;return[t[0]*r,t[1]*r,t[2]*r]}},ambientCubemapLightCubemap:{type:\\\"t\\\",value:function(e){return e.cubemap}},ambientCubemapLightBRDFLookup:{type:\\\"t\\\",value:function(e){return e._brdfLookup}}}}),pn=Ur.extend({castShadow:!1,coefficients:[]},function(){this._coefficientsTmpArr=new _e.Float32Array(27)},{type:\\\"AMBIENT_SH_LIGHT\\\",uniformTemplates:{ambientSHLightColor:{type:\\\"3f\\\",value:function(e){var t=e.color,r=e.intensity;return[t[0]*r,t[1]*r,t[2]*r]}},ambientSHLightCoefficients:{type:\\\"3f\\\",value:function(e){for(var t=e._coefficientsTmpArr,r=0;r<e.coefficients.length;r++)t[r]=e.coefficients[r];return t}}}});var s={},mn=[\\\"px\\\",\\\"nx\\\",\\\"py\\\",\\\"ny\\\",\\\"pz\\\",\\\"nz\\\"];var gn={px:[2,1,0,-1,-1,1],nx:[2,1,0,1,-1,-1],py:[0,2,1,1,-1,-1],ny:[0,2,1,1,1,1],pz:[0,1,2,-1,-1,-1],nz:[0,1,2,1,-1,1]};s.projectEnvironmentMap=function(e,t,r){(r=r||{}).lod=r.lod||0;var i=new hi,n=64,a=new(\\\"texture2D\\\"===t.textureType?zi:(n=(t.image&&t.image.px?t.image.px:t).width,Fi))({scene:i,environmentMap:t}),o=Math.ceil(n/Math.pow(2,r.lod)),s=Math.ceil(n/Math.pow(2,r.lod)),l=new k({width:o,height:s}),h=new Li;a.material.define(\\\"fragment\\\",\\\"RGBM_ENCODE\\\"),r.decodeRGBM&&a.material.define(\\\"fragment\\\",\\\"RGBM_DECODE\\\"),a.material.set(\\\"lod\\\",r.lod);for(var u=new Oi({texture:l}),c={},d=0;d<mn.length;d++){c[mn[d]]=new Uint8Array(o*s*4);var f=u.getCamera(mn[d]);f.fov=90,h.attach(l),h.bind(e),e.render(i,f),e.gl.readPixels(0,0,o,s,B.RGBA,B.UNSIGNED_BYTE,c[mn[d]]),h.unbind(e)}a.dispose(e),h.dispose(e),l.dispose(e);for(var p,m,g,_=c,v=o,y=s,x=new _e.Float32Array(27),b=R.create(),w=R.create(),T=R.create(),S=0;S<9;S++){for(var M=R.create(),A=0;A<mn.length;A++){for(var E=_[mn[A]],C=R.create(),D=0,L=0,P=gn[mn[A]],O=0;O<y;O++)for(var N=0;N<v;N++){b[0]=N/(v-1)*2-1,b[1]=O/(y-1)*2-1,b[2]=-1,R.normalize(b,b),T[0]=b[P[0]]*P[3],T[1]=b[P[1]]*P[4],T[2]=b[P[2]]*P[5],w[0]=E[L++]/255,w[1]=E[L++]/255,w[2]=E[L++]/255;var I=E[L++]/255*8.12;w[0]*=I,w[1]*=I,w[2]*=I,R.scaleAndAdd(C,C,w,(p=S,g=m=I=void 0,I=T[0],m=T[1],g=T[2],(0===p?1:1===p?I:2===p?m:3===p?g:4===p?I*g:5===p?m*g:6===p?I*m:7===p?3*g*g-1:I*I-m*m)*-b[2])),D+=-b[2]}R.scaleAndAdd(M,M,C,1/D)}x[3*S]=M[0]/6,x[3*S+1]=M[1]/6,x[3*S+2]=M[2]/6}return x};const _n=s,E=function(){for(var e=0,t=arguments.length;e<t;e++)if(null!=arguments[e])return arguments[e]},vn=function(t,e){return null!=e.dataIndexInside?e.dataIndexInside:null!=e.dataIndex?F.util.isArray(e.dataIndex)?F.util.map(e.dataIndex,function(e){return t.indexOfRawIndex(e)}):t.indexOfRawIndex(e.dataIndex):null!=e.name?F.util.isArray(e.name)?F.util.map(e.name,function(e){return t.indexOfName(e)}):t.indexOfName(e.name):void 0},yn=_.extend({dynamic:!1,widthSegments:40,heightSegments:20,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI,radius:1},function(){this.build()},{build:function(){var e=this.heightSegments,t=this.widthSegments,r=this.attributes.position,i=this.attributes.texcoord0,n=this.attributes.normal,a=(t+1)*(e+1);r.init(a),i.init(a),n.init(a);for(var o,s,l,h,u,c,d,f,p,m,a=65535<a?Uint32Array:Uint16Array,g=this.indices=new a(t*e*6),_=(this.radius,this.phiStart),v=this.phiLength,y=this.thetaStart,x=this.thetaLength,b=[],w=[],T=0,S=1/(m=this.radius),M=0;M<=e;M++)for(c=0;c<=t;c++)h=c/t,u=M/e,o=-m*Math.cos(_+h*v)*Math.sin(y+u*x),s=m*Math.cos(y+u*x),l=m*Math.sin(_+h*v)*Math.sin(y+u*x),b[0]=o,b[1]=s,b[2]=l,w[0]=h,w[1]=u,r.set(T,b),i.set(T,w),b[0]*=S,b[1]*=S,b[2]*=S,n.set(T,b),T++;var A=t+1,E=0;for(M=0;M<e;M++)for(c=0;c<t;c++)p=(M+1)*A+c+1,f=(M+1)*A+c,g[E++]=(d=M*A+c)+1,g[E++]=d,g[E++]=p,g[E++]=d,g[E++]=f,g[E++]=p;this.boundingBox=new ar,this.boundingBox.max.set(m,m,m),this.boundingBox.min.set(-m,-m,-m)}}),xn=Ur.extend({castShadow:!1},{type:\\\"AMBIENT_LIGHT\\\",uniformTemplates:{ambientLightColor:{type:\\\"3f\\\",value:function(e){var t=e.color,r=e.intensity;return[t[0]*r,t[1]*r,t[2]*r]}}}}),bn=Ur.extend({shadowBias:.001,shadowSlopeScale:2,shadowCascade:1,cascadeSplitLogFactor:.2},{type:\\\"DIRECTIONAL_LIGHT\\\",uniformTemplates:{directionalLightDirection:{type:\\\"3f\\\",value:function(e){return e.__dir=e.__dir||new z,e.__dir.copy(e.worldTransform.z).normalize().negate().array}},directionalLightColor:{type:\\\"3f\\\",value:function(e){var t=e.color,r=e.intensity;return[t[0]*r,t[1]*r,t[2]*r]}}},clone:function(){var e=Ur.prototype.clone.call(this);return e.shadowBias=this.shadowBias,e.shadowSlopeScale=this.shadowSlopeScale,e}}),wn=Ur.extend({range:100,castShadow:!1},{type:\\\"POINT_LIGHT\\\",uniformTemplates:{pointLightPosition:{type:\\\"3f\\\",value:function(e){return e.getWorldPosition().array}},pointLightRange:{type:\\\"1f\\\",value:function(e){return e.range}},pointLightColor:{type:\\\"3f\\\",value:function(e){var t=e.color,r=e.intensity;return[t[0]*r,t[1]*r,t[2]*r]}}},clone:function(){var e=Ur.prototype.clone.call(this);return e.range=this.range,e}}),Tn=Ur.extend({range:20,umbraAngle:30,penumbraAngle:45,falloffFactor:2,shadowBias:.001,shadowSlopeScale:2},{type:\\\"SPOT_LIGHT\\\",uniformTemplates:{spotLightPosition:{type:\\\"3f\\\",value:function(e){return e.getWorldPosition().array}},spotLightRange:{type:\\\"1f\\\",value:function(e){return e.range}},spotLightUmbraAngleCosine:{type:\\\"1f\\\",value:function(e){return Math.cos(e.umbraAngle*Math.PI/180)}},spotLightPenumbraAngleCosine:{type:\\\"1f\\\",value:function(e){return Math.cos(e.penumbraAngle*Math.PI/180)}},spotLightFalloffFactor:{type:\\\"1f\\\",value:function(e){return e.falloffFactor}},spotLightDirection:{type:\\\"3f\\\",value:function(e){return e.__dir=e.__dir||new z,e.__dir.copy(e.worldTransform.z).negate().array}},spotLightColor:{type:\\\"3f\\\",value:function(e){var t=e.color,r=e.intensity;return[t[0]*r,t[1]*r,t[2]*r]}}},clone:function(){var e=Ur.prototype.clone.call(this);return e.range=this.range,e.umbraAngle=this.umbraAngle,e.penumbraAngle=this.penumbraAngle,e.falloffFactor=this.falloffFactor,e.shadowBias=this.shadowBias,e.shadowSlopeScale=this.shadowSlopeScale,e}});var y=function(e,t,r,i){e=e||0,t=t||0,r=r||0,i=i||0,this.array=o.fromValues(e,t,r,i),this._dirty=!0},v=(y.prototype={constructor:y,add:function(e){return o.add(this.array,this.array,e.array),this._dirty=!0,this},set:function(e,t,r,i){return this.array[0]=e,this.array[1]=t,this.array[2]=r,this.array[3]=i,this._dirty=!0,this},setArray:function(e){return this.array[0]=e[0],this.array[1]=e[1],this.array[2]=e[2],this.array[3]=e[3],this._dirty=!0,this},clone:function(){return new y(this.x,this.y,this.z,this.w)},copy:function(e){return o.copy(this.array,e.array),this._dirty=!0,this},dist:function(e){return o.dist(this.array,e.array)},distance:function(e){return o.distance(this.array,e.array)},div:function(e){return o.div(this.array,this.array,e.array),this._dirty=!0,this},divide:function(e){return o.divide(this.array,this.array,e.array),this._dirty=!0,this},dot:function(e){return o.dot(this.array,e.array)},len:function(){return o.len(this.array)},length:function(){return o.length(this.array)},lerp:function(e,t,r){return o.lerp(this.array,e.array,t.array,r),this._dirty=!0,this},min:function(e){return o.min(this.array,this.array,e.array),this._dirty=!0,this},max:function(e){return o.max(this.array,this.array,e.array),this._dirty=!0,this},mul:function(e){return o.mul(this.array,this.array,e.array),this._dirty=!0,this},multiply:function(e){return o.multiply(this.array,this.array,e.array),this._dirty=!0,this},negate:function(){return o.negate(this.array,this.array),this._dirty=!0,this},normalize:function(){return o.normalize(this.array,this.array),this._dirty=!0,this},random:function(e){return o.random(this.array,e),this._dirty=!0,this},scale:function(e){return o.scale(this.array,this.array,e),this._dirty=!0,this},scaleAndAdd:function(e,t){return o.scaleAndAdd(this.array,this.array,e.array,t),this._dirty=!0,this},sqrDist:function(e){return o.sqrDist(this.array,e.array)},squaredDistance:function(e){return o.squaredDistance(this.array,e.array)},sqrLen:function(){return o.sqrLen(this.array)},squaredLength:function(){return o.squaredLength(this.array)},sub:function(e){return o.sub(this.array,this.array,e.array),this._dirty=!0,this},subtract:function(e){return o.subtract(this.array,this.array,e.array),this._dirty=!0,this},transformMat4:function(e){return o.transformMat4(this.array,this.array,e.array),this._dirty=!0,this},transformQuat:function(e){return o.transformQuat(this.array,this.array,e.array),this._dirty=!0,this},toString:function(){return\\\"[\\\"+Array.prototype.join.call(this.array,\\\",\\\")+\\\"]\\\"},toArray:function(){return Array.prototype.slice.call(this.array)}},Object.defineProperty),s=(v&&(v(e=y.prototype,\\\"x\\\",{get:function(){return this.array[0]},set:function(e){this.array[0]=e,this._dirty=!0}}),v(e,\\\"y\\\",{get:function(){return this.array[1]},set:function(e){this.array[1]=e,this._dirty=!0}}),v(e,\\\"z\\\",{get:function(){return this.array[2]},set:function(e){this.array[2]=e,this._dirty=!0}}),v(e,\\\"w\\\",{get:function(){return this.array[3]},set:function(e){this.array[3]=e,this._dirty=!0}})),y.add=function(e,t,r){return o.add(e.array,t.array,r.array),e._dirty=!0,e},y.set=function(e,t,r,i,n){o.set(e.array,t,r,i,n),e._dirty=!0},y.copy=function(e,t){return o.copy(e.array,t.array),e._dirty=!0,e},y.distance=y.dist=function(e,t){return o.distance(e.array,t.array)},y.divide=y.div=function(e,t,r){return o.divide(e.array,t.array,r.array),e._dirty=!0,e},y.dot=function(e,t){return o.dot(e.array,t.array)},y.len=function(e){return o.length(e.array)},y.lerp=function(e,t,r,i){return o.lerp(e.array,t.array,r.array,i),e._dirty=!0,e},y.min=function(e,t,r){return o.min(e.array,t.array,r.array),e._dirty=!0,e},y.max=function(e,t,r){return o.max(e.array,t.array,r.array),e._dirty=!0,e},y.multiply=y.mul=function(e,t,r){return o.multiply(e.array,t.array,r.array),e._dirty=!0,e},y.negate=function(e,t){return o.negate(e.array,t.array),e._dirty=!0,e},y.normalize=function(e,t){return o.normalize(e.array,t.array),e._dirty=!0,e},y.random=function(e,t){return o.random(e.array,t),e._dirty=!0,e},y.scale=function(e,t,r){return o.scale(e.array,t.array,r),e._dirty=!0,e},y.scaleAndAdd=function(e,t,r,i){return o.scaleAndAdd(e.array,t.array,r.array,i),e._dirty=!0,e},y.squaredDistance=y.sqrDist=function(e,t){return o.sqrDist(e.array,t.array)},y.squaredLength=y.sqrLen=function(e){return o.sqrLen(e.array)},y.subtract=y.sub=function(e,t,r){return o.subtract(e.array,t.array,r.array),e._dirty=!0,e},y.transformMat4=function(e,t,r){return o.transformMat4(e.array,t.array,r.array),e._dirty=!0,e},y.transformQuat=function(e,t,r){return o.transformQuat(e.array,t.array,r.array),e._dirty=!0,e},y),e={create:function(){var e=new Ge(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},clone:function(e){var t=new Ge(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},transpose:function(e,t){var r;return e===t?(r=t[1],e[1]=t[2],e[2]=r):(e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3]),e},invert:function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=r*a-n*i;return o?(e[0]=a*(o=1/o),e[1]=-i*o,e[2]=-n*o,e[3]=r*o,e):null},adjoint:function(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},determinant:function(e){return e[0]*e[3]-e[2]*e[1]},multiply:function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=r[0],l=r[1],h=r[2],u=r[3];return e[0]=i*s+a*l,e[1]=n*s+o*l,e[2]=i*h+a*u,e[3]=n*h+o*u,e}};e.mul=e.multiply,e.rotate=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=i*l+a*s,e[1]=n*l+o*s,e[2]=i*-s+a*l,e[3]=n*-s+o*l,e},e.scale=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=r[0],l=r[1];return e[0]=i*s,e[1]=n*s,e[2]=a*l,e[3]=o*l,e},e.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},e.LDU=function(e,t,r,i){return e[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-e[2]*r[1],[e,t,r]};const Sn=e;var Mn=function(){this.array=Sn.create(),this._dirty=!0},v=(Mn.prototype={constructor:Mn,setArray:function(e){for(var t=0;t<this.array.length;t++)this.array[t]=e[t];return this._dirty=!0,this},clone:function(){return(new Mn).copy(this)},copy:function(e){return Sn.copy(this.array,e.array),this._dirty=!0,this},adjoint:function(){return Sn.adjoint(this.array,this.array),this._dirty=!0,this},determinant:function(){return Sn.determinant(this.array)},identity:function(){return Sn.identity(this.array),this._dirty=!0,this},invert:function(){return Sn.invert(this.array,this.array),this._dirty=!0,this},mul:function(e){return Sn.mul(this.array,this.array,e.array),this._dirty=!0,this},mulLeft:function(e){return Sn.mul(this.array,e.array,this.array),this._dirty=!0,this},multiply:function(e){return Sn.multiply(this.array,this.array,e.array),this._dirty=!0,this},multiplyLeft:function(e){return Sn.multiply(this.array,e.array,this.array),this._dirty=!0,this},rotate:function(e){return Sn.rotate(this.array,this.array,e),this._dirty=!0,this},scale:function(e){return Sn.scale(this.array,this.array,e.array),this._dirty=!0,this},transpose:function(){return Sn.transpose(this.array,this.array),this._dirty=!0,this},toString:function(){return\\\"[\\\"+Array.prototype.join.call(this.array,\\\",\\\")+\\\"]\\\"},toArray:function(){return Array.prototype.slice.call(this.array)}},Mn.adjoint=function(e,t){return Sn.adjoint(e.array,t.array),e._dirty=!0,e},Mn.copy=function(e,t){return Sn.copy(e.array,t.array),e._dirty=!0,e},Mn.determinant=function(e){return Sn.determinant(e.array)},Mn.identity=function(e){return Sn.identity(e.array),e._dirty=!0,e},Mn.invert=function(e,t){return Sn.invert(e.array,t.array),e._dirty=!0,e},Mn.multiply=Mn.mul=function(e,t,r){return Sn.mul(e.array,t.array,r.array),e._dirty=!0,e},Mn.rotate=function(e,t,r){return Sn.rotate(e.array,t.array,r),e._dirty=!0,e},Mn.scale=function(e,t,r){return Sn.scale(e.array,t.array,r.array),e._dirty=!0,e},Mn.transpose=function(e,t){return Sn.transpose(e.array,t.array),e._dirty=!0,e},Mn),e={create:function(){var e=new Ge(6);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},clone:function(e){var t=new Ge(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},invert:function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=r*a-i*n;return l?(e[0]=a*(l=1/l),e[1]=-i*l,e[2]=-n*l,e[3]=r*l,e[4]=(n*s-a*o)*l,e[5]=(i*o-r*s)*l,e):null},determinant:function(e){return e[0]*e[3]-e[1]*e[2]},multiply:function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],h=r[0],u=r[1],c=r[2],d=r[3],f=r[4],p=r[5];return e[0]=i*h+a*u,e[1]=n*h+o*u,e[2]=i*c+a*d,e[3]=n*c+o*d,e[4]=i*f+a*p+s,e[5]=n*f+o*p+l,e}};e.mul=e.multiply,e.rotate=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],h=Math.sin(r),u=Math.cos(r);return e[0]=i*u+a*h,e[1]=n*u+o*h,e[2]=i*-h+a*u,e[3]=n*-h+o*u,e[4]=s,e[5]=l,e},e.scale=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],h=r[0],u=r[1];return e[0]=i*h,e[1]=n*h,e[2]=a*u,e[3]=o*u,e[4]=s,e[5]=l,e},e.translate=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],h=r[0],u=r[1];return e[0]=i,e[1]=n,e[2]=a,e[3]=o,e[4]=i*h+a*u+s,e[5]=n*h+o*u+l,e},e.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+1)};const An=e;var En=function(){this.array=An.create(),this._dirty=!0},e=(En.prototype={constructor:En,setArray:function(e){for(var t=0;t<this.array.length;t++)this.array[t]=e[t];return this._dirty=!0,this},clone:function(){return(new En).copy(this)},copy:function(e){return An.copy(this.array,e.array),this._dirty=!0,this},determinant:function(){return An.determinant(this.array)},identity:function(){return An.identity(this.array),this._dirty=!0,this},invert:function(){return An.invert(this.array,this.array),this._dirty=!0,this},mul:function(e){return An.mul(this.array,this.array,e.array),this._dirty=!0,this},mulLeft:function(e){return An.mul(this.array,e.array,this.array),this._dirty=!0,this},multiply:function(e){return An.multiply(this.array,this.array,e.array),this._dirty=!0,this},multiplyLeft:function(e){return An.multiply(this.array,e.array,this.array),this._dirty=!0,this},rotate:function(e){return An.rotate(this.array,this.array,e),this._dirty=!0,this},scale:function(e){return An.scale(this.array,this.array,e.array),this._dirty=!0,this},translate:function(e){return An.translate(this.array,this.array,e.array),this._dirty=!0,this},toString:function(){return\\\"[\\\"+Array.prototype.join.call(this.array,\\\",\\\")+\\\"]\\\"},toArray:function(){return Array.prototype.slice.call(this.array)}},En.copy=function(e,t){return An.copy(e.array,t.array),e._dirty=!0,e},En.determinant=function(e){return An.determinant(e.array)},En.identity=function(e){return An.identity(e.array),e._dirty=!0,e},En.invert=function(e,t){return An.invert(e.array,t.array),e._dirty=!0,e},En.multiply=En.mul=function(e,t,r){return An.mul(e.array,t.array,r.array),e._dirty=!0,e},En.rotate=function(e,t,r){return An.rotate(e.array,t.array,r),e._dirty=!0,e},En.scale=function(e,t,r){return An.scale(e.array,t.array,r.array),e._dirty=!0,e},En.translate=function(e,t,r){return An.translate(e.array,t.array,r.array),e._dirty=!0,e},En),Cn=function(){this.array=l.create(),this._dirty=!0},Dn=(Cn.prototype={constructor:Cn,setArray:function(e){for(var t=0;t<this.array.length;t++)this.array[t]=e[t];return this._dirty=!0,this},adjoint:function(){return l.adjoint(this.array,this.array),this._dirty=!0,this},clone:function(){return(new Cn).copy(this)},copy:function(e){return l.copy(this.array,e.array),this._dirty=!0,this},determinant:function(){return l.determinant(this.array)},fromMat2d:function(e){return l.fromMat2d(this.array,e.array),this._dirty=!0,this},fromMat4:function(e){return l.fromMat4(this.array,e.array),this._dirty=!0,this},fromQuat:function(e){return l.fromQuat(this.array,e.array),this._dirty=!0,this},identity:function(){return l.identity(this.array),this._dirty=!0,this},invert:function(){return l.invert(this.array,this.array),this._dirty=!0,this},mul:function(e){return l.mul(this.array,this.array,e.array),this._dirty=!0,this},mulLeft:function(e){return l.mul(this.array,e.array,this.array),this._dirty=!0,this},multiply:function(e){return l.multiply(this.array,this.array,e.array),this._dirty=!0,this},multiplyLeft:function(e){return l.multiply(this.array,e.array,this.array),this._dirty=!0,this},rotate:function(e){return l.rotate(this.array,this.array,e),this._dirty=!0,this},scale:function(e){return l.scale(this.array,this.array,e.array),this._dirty=!0,this},translate:function(e){return l.translate(this.array,this.array,e.array),this._dirty=!0,this},normalFromMat4:function(e){return l.normalFromMat4(this.array,e.array),this._dirty=!0,this},transpose:function(){return l.transpose(this.array,this.array),this._dirty=!0,this},toString:function(){return\\\"[\\\"+Array.prototype.join.call(this.array,\\\",\\\")+\\\"]\\\"},toArray:function(){return Array.prototype.slice.call(this.array)}},Cn.adjoint=function(e,t){return l.adjoint(e.array,t.array),e._dirty=!0,e},Cn.copy=function(e,t){return l.copy(e.array,t.array),e._dirty=!0,e},Cn.determinant=function(e){return l.determinant(e.array)},Cn.identity=function(e){return l.identity(e.array),e._dirty=!0,e},Cn.invert=function(e,t){return l.invert(e.array,t.array),e},Cn.multiply=Cn.mul=function(e,t,r){return l.mul(e.array,t.array,r.array),e._dirty=!0,e},Cn.fromMat2d=function(e,t){return l.fromMat2d(e.array,t.array),e._dirty=!0,e},Cn.fromMat4=function(e,t){return l.fromMat4(e.array,t.array),e._dirty=!0,e},Cn.fromQuat=function(e,t){return l.fromQuat(e.array,t.array),e._dirty=!0,e},Cn.normalFromMat4=function(e,t){return l.normalFromMat4(e.array,t.array),e._dirty=!0,e},Cn.rotate=function(e,t,r){return l.rotate(e.array,t.array,r),e._dirty=!0,e},Cn.scale=function(e,t,r){return l.scale(e.array,t.array,r.array),e._dirty=!0,e},Cn.transpose=function(e,t){return l.transpose(e.array,t.array),e._dirty=!0,e},Cn.translate=function(e,t,r){return l.translate(e.array,t.array,r.array),e._dirty=!0,e},Cn),Ln={linear:function(e){return e},quadraticIn:function(e){return e*e},quadraticOut:function(e){return e*(2-e)},quadraticInOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)},cubicIn:function(e){return e*e*e},cubicOut:function(e){return--e*e*e+1},cubicInOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)},quarticIn:function(e){return e*e*e*e},quarticOut:function(e){return 1- --e*e*e*e},quarticInOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)},quinticIn:function(e){return e*e*e*e*e},quinticOut:function(e){return--e*e*e*e*e+1},quinticInOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)},sinusoidalIn:function(e){return 1-Math.cos(e*Math.PI/2)},sinusoidalOut:function(e){return Math.sin(e*Math.PI/2)},sinusoidalInOut:function(e){return.5*(1-Math.cos(Math.PI*e))},exponentialIn:function(e){return 0===e?0:Math.pow(1024,e-1)},exponentialOut:function(e){return 1===e?1:1-Math.pow(2,-10*e)},exponentialInOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))},circularIn:function(e){return 1-Math.sqrt(1-e*e)},circularOut:function(e){return Math.sqrt(1- --e*e)},circularInOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},elasticIn:function(e){var t,r=.1;return 0===e?0:1===e?1:(t=!r||r<1?(r=1,.1):.4*Math.asin(1/r)/(2*Math.PI),-r*Math.pow(2,10*--e)*Math.sin((e-t)*(2*Math.PI)/.4))},elasticOut:function(e){var t,r=.1;return 0===e?0:1===e?1:(t=!r||r<1?(r=1,.1):.4*Math.asin(1/r)/(2*Math.PI),r*Math.pow(2,-10*e)*Math.sin((e-t)*(2*Math.PI)/.4)+1)},elasticInOut:function(e){var t,r=.1;return 0===e?0:1===e?1:(t=!r||r<1?(r=1,.1):.4*Math.asin(1/r)/(2*Math.PI),(e*=2)<1?r*Math.pow(2,10*--e)*Math.sin((e-t)*(2*Math.PI)/.4)*-.5:r*Math.pow(2,-10*--e)*Math.sin((e-t)*(2*Math.PI)/.4)*.5+1)},backIn:function(e){return e*e*(2.70158*e-1.70158)},backOut:function(e){return--e*e*(2.70158*e+1.70158)+1},backInOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((1+t)*e-t)*.5:.5*((e-=2)*e*((1+t)*e+t)+2)},bounceIn:function(e){return 1-Ln.bounceOut(1-e)},bounceOut:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},bounceInOut:function(e){return e<.5?.5*Ln.bounceIn(2*e):.5*Ln.bounceOut(2*e-1)+.5}};const Pn=Ln,On=(Nn.prototype.step=function(e,t){if(this._initialized||(this._startTime=e+this._delay,this._initialized=!0),!this._paused){var r=(e-this._startTime-this._pausedTime)/this._life,i=(r<0&&(r=0),r=Math.min(r,1),this.easing),i=\\\"string\\\"==typeof i?Pn[i]:i,i=\\\"function\\\"==typeof i?i(r):r;if(this.onframe&&this.onframe(i),1===r){if(!this.loop)return!0;this._restart(e),this.onrestart&&this.onrestart()}return!1}this._pausedTime+=t},Nn.prototype._restart=function(e){var t=(e-this._startTime-this._pausedTime)%this._life;this._startTime=e-t+this.gap,this._pausedTime=0},Nn.prototype.pause=function(){this._paused=!0},Nn.prototype.resume=function(){this._paused=!1},Nn);function Nn(e){this._initialized=!1,this._startTime=0,this._pausedTime=0,this._paused=!1,this._life=e.life||1e3,this._delay=e.delay||0,this.loop=null!=e.loop&&e.loop,this.gap=e.gap||0,this.easing=e.easing||\\\"linear\\\",this.onframe=e.onframe,this.ondestroy=e.ondestroy,this.onrestart=e.onrestart}var In={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Rn(e){return(e=Math.round(e))<0?0:255<e?255:e}function Bn(e){return e<0?0:1<e?1:e}function Fn(e){var t=e;return t.length&&\\\"%\\\"===t.charAt(t.length-1)?Rn(parseFloat(t)/100*255):Rn(parseInt(t,10))}function zn(e){var t=e;return t.length&&\\\"%\\\"===t.charAt(t.length-1)?Bn(parseFloat(t)/100):Bn(parseFloat(t))}function Gn(e,t,r){return r<0?r+=1:1<r&&--r,6*r<1?e+(t-e)*r*6:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}function Un(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function kn(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}var Vn=new pi(20),Hn=null;function Wn(e,t){Hn&&kn(Hn,t),Hn=Vn.put(e,Hn||t.slice())}function jn(e,t){if(e){t=t||[];var r=Vn.get(e);if(r)return kn(t,r);r=(e+=\\\"\\\").replace(/ /g,\\\"\\\").toLowerCase();if(r in In)return kn(t,In[r]),Wn(e,t),t;var i=r.length;if(\\\"#\\\"===r.charAt(0))return 4===i||5===i?0<=(n=parseInt(r.slice(1,4),16))&&n<=4095?(Un(t,(3840&n)>>4|(3840&n)>>8,240&n|(240&n)>>4,15&n|(15&n)<<4,5===i?parseInt(r.slice(4),16)/15:1),Wn(e,t),t):void Un(t,0,0,0,1):7===i||9===i?0<=(n=parseInt(r.slice(1,7),16))&&n<=16777215?(Un(t,(16711680&n)>>16,(65280&n)>>8,255&n,9===i?parseInt(r.slice(7),16)/255:1),Wn(e,t),t):void Un(t,0,0,0,1):void 0;var n=r.indexOf(\\\"(\\\"),a=r.indexOf(\\\")\\\");if(-1!==n&&a+1===i){var i=r.substr(0,n),o=r.substr(n+1,a-(n+1)).split(\\\",\\\"),s=1;switch(i){case\\\"rgba\\\":if(4!==o.length)return 3===o.length?Un(t,+o[0],+o[1],+o[2],1):Un(t,0,0,0,1);s=zn(o.pop());case\\\"rgb\\\":return 3!==o.length?void Un(t,0,0,0,1):(Un(t,Fn(o[0]),Fn(o[1]),Fn(o[2]),s),Wn(e,t),t);case\\\"hsla\\\":return 4!==o.length?void Un(t,0,0,0,1):(o[3]=zn(o[3]),Xn(o,t),Wn(e,t),t);case\\\"hsl\\\":return 3!==o.length?void Un(t,0,0,0,1):(Xn(o,t),Wn(e,t),t);default:return}}Un(t,0,0,0,1)}}function Xn(e,t){var r=(parseFloat(e[0])%360+360)%360/360,i=zn(e[1]),n=zn(e[2]),i=n<=.5?n*(i+1):n+i-n*i,n=2*n-i;Un(t=t||[],Rn(255*Gn(n,i,r+1/3)),Rn(255*Gn(n,i,r)),Rn(255*Gn(n,i,r-1/3)),1),4===e.length&&(t[3]=e[3])}var qn=Object.prototype.toString,x=Array.prototype,Zn=x.forEach,Yn=x.filter,Kn=x.slice,Qn=x.map,x=(function(){}).constructor,x=x?x.prototype:null;function Jn(e,t){if(Object.assign)Object.assign(e,t);else for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}function $n(e,t,r){if(e=\\\"prototype\\\"in e?e.prototype:e,t=\\\"prototype\\\"in t?t.prototype:t,Object.getOwnPropertyNames)for(var i=Object.getOwnPropertyNames(t),n=0;n<i.length;n++){var a=i[n];\\\"constructor\\\"!==a&&(r?null!=t[a]:null==e[a])&&(e[a]=t[a])}else for(var o=e,s=t,l=r,h=ia(s),u=0;u<h.length;u++){var c=h[u];(l?null!=s[c]:null==o[c])&&(o[c]=s[c])}}function ea(e){return e&&\\\"string\\\"!=typeof e&&\\\"number\\\"==typeof e.length}function ta(e,t,r){if(e&&t)if(e.forEach&&e.forEach===Zn)e.forEach(t,r);else if(e.length===+e.length)for(var i=0,n=e.length;i<n;i++)t.call(r,e[i],i,e);else for(var a in e)e.hasOwnProperty(a)&&t.call(r,e[a],a,e)}function ra(e,t,r){if(!e)return[];if(!t)return oa(e);if(e.map&&e.map===Qn)return e.map(t,r);for(var i=[],n=0,a=e.length;n<a;n++)i.push(t.call(r,e[n],n,e));return i}function ia(e){if(!e)return[];if(Object.keys)return Object.keys(e);var t,r=[];for(t in e)e.hasOwnProperty(t)&&r.push(t);return r}function na(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return function(){return e.apply(this,t.concat(Kn.call(arguments)))}}function aa(e,t){return null!=e?e:t}function oa(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return Kn.apply(e,t)}x&&\\\"function\\\"==typeof x.bind&&x.call.bind(x.bind);la.prototype.get=function(e){return this.data.hasOwnProperty(e)?this.data[e]:null},la.prototype.set=function(e,t){return this.data[e]=t},la.prototype.each=function(e,t){for(var r in this.data)this.data.hasOwnProperty(r)&&e.call(t,this.data[r],r)},la.prototype.keys=function(){return ia(this.data)},la.prototype.removeKey=function(e){delete this.data[e]};var sa=la;function la(e){this.data={};t=e;var t,r=Array.isArray?Array.isArray(t):\\\"[object Array]\\\"===qn.call(t),i=(this.data={},this);function n(e,t){r?i.set(e,t):i.set(t,e)}e instanceof la?e.each(n):e&&ta(e,n)}function ha(e,t){for(var r=new e.constructor(e.length+t.length),i=0;i<e.length;i++)r[i]=e[i];for(var n=e.length,i=0;i<t.length;i++)r[i+n]=t[i];return r}var ua=Array.prototype.slice;function ca(e,t,r){return(t-e)*r+e}function da(e,t,r,i){for(var n=t.length,a=0;a<n;a++)e[a]=ca(t[a],r[a],i)}function fa(e,t,r,i){for(var n=t.length,a=0;a<n;a++)e[a]=t[a]+r[a]*i;return e}function pa(e,t,r,i){for(var n=t.length,a=n&&t[0].length,o=0;o<n;o++){e[o]||(e[o]=[]);for(var s=0;s<a;s++)e[o][s]=t[o][s]+r[o][s]*i}return e}function ma(e,t){var r=e.length;if(r===t.length){for(var i=0;i<r;i++)if(e[i]!==t[i])return;return 1}}function ga(e,t,r,i,n,a,o){var s=.5*(r-e),l=.5*(i-t);return(2*(t-r)+s+l)*o+(-3*(t-r)-2*s-l)*a+s*n+t}function _a(e,t,r,i,n,a,o,s){for(var l=t.length,h=0;h<l;h++)e[h]=ga(t[h],r[h],i[h],n[h],a,o,s)}function va(e){if(ea(e)){var t=e.length;if(ea(e[0])){for(var r=[],i=0;i<t;i++)r.push(ua.call(e[i]));return r}return ua.call(e)}return e}function ya(e){return e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.floor(e[2]),\\\"rgba(\\\"+e.join(\\\",\\\")+\\\")\\\"}var xa=[0,0,0,0],ba=(wa.prototype.isFinished=function(){return this._finished},wa.prototype.setFinished=function(){this._finished=!0,this._additiveTrack&&this._additiveTrack.setFinished()},wa.prototype.needsAnimate=function(){return!this._isAllValueEqual&&2<=this.keyframes.length&&this.interpolable},wa.prototype.getAdditiveTrack=function(){return this._additiveTrack},wa.prototype.addKeyframe=function(e,t){e>=this.maxTime?this.maxTime=e:this._needsSort=!0;var r=this.keyframes,i=r.length;if(this.interpolable)if(ea(t)){var n,a=ea(t&&t[0])?2:1;if(0<i&&this.arrDim!==a)return void(this.interpolable=!1);if(1==a&&\\\"number\\\"!=typeof t[0]||2==a&&\\\"number\\\"!=typeof t[0][0])return void(this.interpolable=!1);0<i&&(n=r[i-1],!this._isAllValueEqual||1==a&&ma(t,n.value)||(this._isAllValueEqual=!1)),this.arrDim=a}else{if(0<this.arrDim)return void(this.interpolable=!1);if(\\\"string\\\"==typeof t){a=jn(t);a?(t=a,this.isValueColor=!0):this.interpolable=!1}else if(\\\"number\\\"!=typeof t||isNaN(t))return void(this.interpolable=!1);this._isAllValueEqual&&0<i&&(n=r[i-1],this.isValueColor&&!ma(n.value,t)||n.value!==t)&&(this._isAllValueEqual=!1)}a={time:e,value:t,percent:0};return this.keyframes.push(a),a},wa.prototype.prepare=function(e){var t=this.keyframes;this._needsSort&&t.sort(function(e,t){return e.time-t.time});for(var r=this.arrDim,i=t.length,n=t[i-1],a=0;a<i;a++){t[a].percent=t[a].time/this.maxTime;if(0<r&&a!==i-1){o=void 0;s=void 0;l=void 0;h=void 0;u=void 0;c=void 0;d=void 0;f=void 0;p=void 0;m=void 0;var o=t[a].value;var s=n.value;var l=r;var h=o,u=s;if(h.push&&u.push){var c=h.length,d=u.length;if(c!==d)if(d<c)h.length=d;else for(var f=c;f<d;f++)h.push(1===l?u[f]:ua.call(u[f]));for(var p=h[0]&&h[0].length,f=0;f<h.length;f++)if(1===l)isNaN(h[f])&&(h[f]=u[f]);else for(var m=0;m<p;m++)isNaN(h[f][m])&&(h[f][m]=u[f][m])}}}if(e&&this.needsAnimate()&&e.needsAnimate()&&r===e.arrDim&&this.isValueColor===e.isValueColor&&!e._finished){this._additiveTrack=e;for(var g=t[0].value,a=0;a<i;a++)0===r?this.isValueColor?t[a].additiveValue=fa([],t[a].value,g,-1):t[a].additiveValue=t[a].value-g:1===r?t[a].additiveValue=fa([],t[a].value,g,-1):2===r&&(t[a].additiveValue=pa([],t[a].value,g,-1))}},wa.prototype.step=function(e,t){if(!this._finished){this._additiveTrack&&this._additiveTrack._finished&&(this._additiveTrack=null);var r,i=null!=this._additiveTrack,n=i?\\\"additiveValue\\\":\\\"value\\\",a=this.keyframes,o=this.keyframes.length,s=this.propName,l=this.arrDim,h=this.isValueColor;if(t<0)r=0;else if(t<this._lastFramePercent){for(r=Math.min(this._lastFrame+1,o-1);0<=r&&!(a[r].percent<=t);r--);r=Math.min(r,o-2)}else{for(r=this._lastFrame;r<o&&!(a[r].percent>t);r++);r=Math.min(r-1,o-2)}var u,c,d,f,p,m,g,_=a[r+1],v=a[r];v&&_&&(this._lastFrame=r,this._lastFramePercent=t,0!=(u=_.percent-v.percent))&&(u=(t-v.percent)/u,c=i?this._additiveValue:h?xa:e[s],(0<l||h)&&!c&&(c=this._additiveValue=[]),this.useSpline?(d=a[r][n],f=a[0===r?r:r-1][n],p=a[o-2<r?o-1:r+1][n],m=a[o-3<r?o-1:r+2][n],0<l?(1===l?_a:function(e,t,r,i,n,a,o,s){for(var l=t.length,h=t[0].length,u=0;u<l;u++){e[u]||(e[1]=[]);for(var c=0;c<h;c++)e[u][c]=ga(t[u][c],r[u][c],i[u][c],n[u][c],a,o,s)}})(c,f,d,p,m,u,u*u,u*u*u):h?(_a(c,f,d,p,m,u,u*u,u*u*u),i||(e[s]=ya(c))):(g=void 0,g=this.interpolable?ga(f,d,p,m,u,u*u,u*u*u):p,i?this._additiveValue=g:e[s]=g)):0<l?(1===l?da:function(e,t,r,i){for(var n=t.length,a=n&&t[0].length,o=0;o<n;o++){e[o]||(e[o]=[]);for(var s=0;s<a;s++)e[o][s]=ca(t[o][s],r[o][s],i)}})(c,v[n],_[n],u):h?(da(c,v[n],_[n],u),i||(e[s]=ya(c))):(g=void 0,g=this.interpolable?ca(v[n],_[n],u):(y=v[n],x=_[n],.5<u?x:y),i?this._additiveValue=g:e[s]=g),i)&&this._addToTarget(e)}var y,x},wa.prototype._addToTarget=function(e){var t=this.arrDim,r=this.propName,i=this._additiveValue;0===t?this.isValueColor?(jn(e[r],xa),fa(xa,xa,i,1),e[r]=ya(xa)):e[r]=e[r]+i:1===t?fa(e[r],e[r],i,1):2===t&&pa(e[r],e[r],i,1)},wa);function wa(e){this.keyframes=[],this.maxTime=0,this.arrDim=0,this.interpolable=!0,this._needsSort=!1,this._isAllValueEqual=!0,this._lastFrame=0,this._lastFramePercent=0,this.propName=e}Aa.prototype.getTarget=function(){return this._target},Aa.prototype.changeTarget=function(e){this._target=e},Aa.prototype.when=function(e,t){return this.whenWithKeys(e,t,ia(t))},Aa.prototype.whenWithKeys=function(e,t,r){for(var i=this._tracks,n=0;n<r.length;n++){var a=r[n];if(!(s=i[a])){var o,s=i[a]=new ba(a),l=void 0,h=this._getAdditiveTrack(a);if(h?(l=(o=h.keyframes[h.keyframes.length-1])&&o.value,h.isValueColor&&(l=l&&ya(l))):l=this._target[a],null==l)continue;0!==e&&s.addKeyframe(0,va(l)),this._trackKeys.push(a)}s.addKeyframe(e,va(t[a]))}return this._maxTime=Math.max(this._maxTime,e),this},Aa.prototype.pause=function(){this._clip.pause(),this._paused=!0},Aa.prototype.resume=function(){this._clip.resume(),this._paused=!1},Aa.prototype.isPaused=function(){return!!this._paused},Aa.prototype._doneCallback=function(){this._setTracksFinished(),this._clip=null;var e=this._doneList;if(e)for(var t=e.length,r=0;r<t;r++)e[r].call(this)},Aa.prototype._abortedCallback=function(){this._setTracksFinished();var e=this.animation,t=this._abortedList;if(e&&e.removeClip(this._clip),this._clip=null,t)for(var r=0;r<t.length;r++)t[r].call(this)},Aa.prototype._setTracksFinished=function(){for(var e=this._tracks,t=this._trackKeys,r=0;r<t.length;r++)e[t[r]].setFinished()},Aa.prototype._getAdditiveTrack=function(e){var t,r=this._additiveAnimators;if(r)for(var i=0;i<r.length;i++){var n=r[i].getTrack(e);n&&(t=n)}return t},Aa.prototype.start=function(e,t){if(!(0<this._started)){this._started=1;for(var r,a=this,o=[],i=0;i<this._trackKeys.length;i++){var n=this._trackKeys[i],s=this._tracks[n],n=this._getAdditiveTrack(n),l=s.keyframes;s.prepare(n),s.needsAnimate()?o.push(s):s.interpolable||(n=l[l.length-1])&&(a._target[s.propName]=n.value)}return o.length||t?(r=new On({life:this._maxTime,loop:this._loop,delay:this._delay,onframe:function(e){a._started=2;var t=a._additiveAnimators;if(t){for(var r=!1,i=0;i<t.length;i++)if(t[i]._clip){r=!0;break}r||(a._additiveAnimators=null)}for(i=0;i<o.length;i++)o[i].step(a._target,e);var n=a._onframeList;if(n)for(i=0;i<n.length;i++)n[i](a._target,e)},ondestroy:function(){a._doneCallback()}}),this._clip=r,this.animation&&this.animation.addClip(r),e&&\\\"spline\\\"!==e&&(r.easing=e)):this._doneCallback(),this}},Aa.prototype.stop=function(e){var t;this._clip&&(t=this._clip,e&&t.onframe(1),this._abortedCallback())},Aa.prototype.delay=function(e){return this._delay=e,this},Aa.prototype.during=function(e){return e&&(this._onframeList||(this._onframeList=[]),this._onframeList.push(e)),this},Aa.prototype.done=function(e){return e&&(this._doneList||(this._doneList=[]),this._doneList.push(e)),this},Aa.prototype.aborted=function(e){return e&&(this._abortedList||(this._abortedList=[]),this._abortedList.push(e)),this},Aa.prototype.getClip=function(){return this._clip},Aa.prototype.getTrack=function(e){return this._tracks[e]},Aa.prototype.stopTracks=function(e,t){if(!e.length||!this._clip)return!0;for(var r=this._tracks,i=this._trackKeys,n=0;n<e.length;n++){var a=r[e[n]];a&&(t?a.step(this._target,1):1===this._started&&a.step(this._target,0),a.setFinished())}for(var o=!0,n=0;n<i.length;n++)if(!r[i[n]].isFinished()){o=!1;break}return o&&this._abortedCallback(),o},Aa.prototype.saveFinalToTarget=function(e,t){if(e){t=t||this._trackKeys;for(var r=0;r<t.length;r++){var i,n=t[r],a=this._tracks[n];a&&!a.isFinished()&&(i=(i=a.keyframes)[i.length-1])&&(i=va(i.value),a.isValueColor&&(i=ya(i)),e[n]=i)}}},Aa.prototype.__changeFinalValue=function(e,t){t=t||ia(e);for(var r=0;r<t.length;r++){var i,n=t[r],a=this._tracks[n];a&&1<(i=a.keyframes).length&&(i=i.pop(),a.addKeyframe(i.time,e[n]),a.prepare(a.getAdditiveTrack()))}};const Ta=Aa,Sa={_animators:null,getAnimators:function(){return this._animators=this._animators||[],this._animators},animate:function(e,t){var r;if(this._animators=this._animators||[],e){for(var i=e.split(\\\".\\\"),n=this,a=0,o=i.length;a<o;a++)n=n&&n[i[a]];n&&(r=n)}else r=this;if(null==r)throw new Error(\\\"Target \\\"+e+\\\" not exists\\\");var s=this._animators,l=new Ta(r,t),h=this;return l.during(function(){h.__zr&&h.__zr.refresh()}).done(function(){var e=s.indexOf(l);0<=e&&s.splice(e,1)}),s.push(l),this.__zr&&this.__zr.animation.addAnimator(l),l},stopAnimation:function(e){this._animators=this._animators||[];for(var t=this._animators,r=t.length,i=0;i<r;i++)t[i].stop(e);return t.length=0,this},addAnimatorsToZr:function(e){if(this._animators)for(var t=0;t<this._animators.length;t++)e.animation.addAnimator(this._animators[t])},removeAnimatorsFromZr:function(e){if(this._animators)for(var t=0;t<this._animators.length;t++)e.animation.removeAnimator(this._animators[t])}},Ma=\\\"\\\\n@export clay.util.rand\\\\nhighp float rand(vec2 uv) {\\\\n const highp float a = 12.9898, b = 78.233, c = 43758.5453;\\\\n highp float dt = dot(uv.xy, vec2(a,b)), sn = mod(dt, 3.141592653589793);\\\\n return fract(sin(sn) * c);\\\\n}\\\\n@end\\\\n@export clay.util.calculate_attenuation\\\\nuniform float attenuationFactor : 5.0;\\\\nfloat lightAttenuation(float dist, float range)\\\\n{\\\\n float attenuation = 1.0;\\\\n attenuation = dist*dist/(range*range+1.0);\\\\n float att_s = attenuationFactor;\\\\n attenuation = 1.0/(attenuation*att_s+1.0);\\\\n att_s = 1.0/(att_s+1.0);\\\\n attenuation = attenuation - att_s;\\\\n attenuation /= 1.0 - att_s;\\\\n return clamp(attenuation, 0.0, 1.0);\\\\n}\\\\n@end\\\\n@export clay.util.edge_factor\\\\n#ifdef SUPPORT_STANDARD_DERIVATIVES\\\\nfloat edgeFactor(float width)\\\\n{\\\\n vec3 d = fwidth(v_Barycentric);\\\\n vec3 a3 = smoothstep(vec3(0.0), d * width, v_Barycentric);\\\\n return min(min(a3.x, a3.y), a3.z);\\\\n}\\\\n#else\\\\nfloat edgeFactor(float width)\\\\n{\\\\n return 1.0;\\\\n}\\\\n#endif\\\\n@end\\\\n@export clay.util.encode_float\\\\nvec4 encodeFloat(const in float depth)\\\\n{\\\\n const vec4 bitShifts = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\\\\n const vec4 bit_mask = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\\\\n vec4 res = fract(depth * bitShifts);\\\\n res -= res.xxyz * bit_mask;\\\\n return res;\\\\n}\\\\n@end\\\\n@export clay.util.decode_float\\\\nfloat decodeFloat(const in vec4 color)\\\\n{\\\\n const vec4 bitShifts = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\\\\n return dot(color, bitShifts);\\\\n}\\\\n@end\\\\n@export clay.util.float\\\\n@import clay.util.encode_float\\\\n@import clay.util.decode_float\\\\n@end\\\\n@export clay.util.rgbm_decode\\\\nvec3 RGBMDecode(vec4 rgbm, float range) {\\\\n return range * rgbm.rgb * rgbm.a;\\\\n}\\\\n@end\\\\n@export clay.util.rgbm_encode\\\\nvec4 RGBMEncode(vec3 color, float range) {\\\\n if (dot(color, color) == 0.0) {\\\\n return vec4(0.0);\\\\n }\\\\n vec4 rgbm;\\\\n color /= range;\\\\n rgbm.a = clamp(max(max(color.r, color.g), max(color.b, 1e-6)), 0.0, 1.0);\\\\n rgbm.a = ceil(rgbm.a * 255.0) / 255.0;\\\\n rgbm.rgb = color / rgbm.a;\\\\n return rgbm;\\\\n}\\\\n@end\\\\n@export clay.util.rgbm\\\\n@import clay.util.rgbm_decode\\\\n@import clay.util.rgbm_encode\\\\nvec4 decodeHDR(vec4 color)\\\\n{\\\\n#if defined(RGBM_DECODE) || defined(RGBM)\\\\n return vec4(RGBMDecode(color, 8.12), 1.0);\\\\n#else\\\\n return color;\\\\n#endif\\\\n}\\\\nvec4 encodeHDR(vec4 color)\\\\n{\\\\n#if defined(RGBM_ENCODE) || defined(RGBM)\\\\n return RGBMEncode(color.xyz, 8.12);\\\\n#else\\\\n return color;\\\\n#endif\\\\n}\\\\n@end\\\\n@export clay.util.srgb\\\\nvec4 sRGBToLinear(in vec4 value) {\\\\n return vec4(mix(pow(value.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), value.rgb * 0.0773993808, vec3(lessThanEqual(value.rgb, vec3(0.04045)))), value.w);\\\\n}\\\\nvec4 linearTosRGB(in vec4 value) {\\\\n return vec4(mix(pow(value.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), value.rgb * 12.92, vec3(lessThanEqual(value.rgb, vec3(0.0031308)))), value.w);\\\\n}\\\\n@end\\\\n@export clay.chunk.skinning_header\\\\n#ifdef SKINNING\\\\nattribute vec3 weight : WEIGHT;\\\\nattribute vec4 joint : JOINT;\\\\n#ifdef USE_SKIN_MATRICES_TEXTURE\\\\nuniform sampler2D skinMatricesTexture : ignore;\\\\nuniform float skinMatricesTextureSize: ignore;\\\\nmat4 getSkinMatrix(sampler2D tex, float idx) {\\\\n float j = idx * 4.0;\\\\n float x = mod(j, skinMatricesTextureSize);\\\\n float y = floor(j / skinMatricesTextureSize) + 0.5;\\\\n vec2 scale = vec2(skinMatricesTextureSize);\\\\n return mat4(\\\\n texture2D(tex, vec2(x + 0.5, y) / scale),\\\\n texture2D(tex, vec2(x + 1.5, y) / scale),\\\\n texture2D(tex, vec2(x + 2.5, y) / scale),\\\\n texture2D(tex, vec2(x + 3.5, y) / scale)\\\\n );\\\\n}\\\\nmat4 getSkinMatrix(float idx) {\\\\n return getSkinMatrix(skinMatricesTexture, idx);\\\\n}\\\\n#else\\\\nuniform mat4 skinMatrix[JOINT_COUNT] : SKIN_MATRIX;\\\\nmat4 getSkinMatrix(float idx) {\\\\n return skinMatrix[int(idx)];\\\\n}\\\\n#endif\\\\n#endif\\\\n@end\\\\n@export clay.chunk.skin_matrix\\\\nmat4 skinMatrixWS = getSkinMatrix(joint.x) * weight.x;\\\\nif (weight.y > 1e-4)\\\\n{\\\\n skinMatrixWS += getSkinMatrix(joint.y) * weight.y;\\\\n}\\\\nif (weight.z > 1e-4)\\\\n{\\\\n skinMatrixWS += getSkinMatrix(joint.z) * weight.z;\\\\n}\\\\nfloat weightW = 1.0-weight.x-weight.y-weight.z;\\\\nif (weightW > 1e-4)\\\\n{\\\\n skinMatrixWS += getSkinMatrix(joint.w) * weightW;\\\\n}\\\\n@end\\\\n@export clay.chunk.instancing_header\\\\n#ifdef INSTANCING\\\\nattribute vec4 instanceMat1;\\\\nattribute vec4 instanceMat2;\\\\nattribute vec4 instanceMat3;\\\\n#endif\\\\n@end\\\\n@export clay.chunk.instancing_matrix\\\\nmat4 instanceMat = mat4(\\\\n vec4(instanceMat1.xyz, 0.0),\\\\n vec4(instanceMat2.xyz, 0.0),\\\\n vec4(instanceMat3.xyz, 0.0),\\\\n vec4(instanceMat1.w, instanceMat2.w, instanceMat3.w, 1.0)\\\\n);\\\\n@end\\\\n@export clay.util.parallax_correct\\\\nvec3 parallaxCorrect(in vec3 dir, in vec3 pos, in vec3 boxMin, in vec3 boxMax) {\\\\n vec3 first = (boxMax - pos) / dir;\\\\n vec3 second = (boxMin - pos) / dir;\\\\n vec3 further = max(first, second);\\\\n float dist = min(further.x, min(further.y, further.z));\\\\n vec3 fixedPos = pos + dir * dist;\\\\n vec3 boxCenter = (boxMax + boxMin) * 0.5;\\\\n return normalize(fixedPos - boxCenter);\\\\n}\\\\n@end\\\\n@export clay.util.clamp_sample\\\\nvec4 clampSample(const in sampler2D texture, const in vec2 coord)\\\\n{\\\\n#ifdef STEREO\\\\n float eye = step(0.5, coord.x) * 0.5;\\\\n vec2 coordClamped = clamp(coord, vec2(eye, 0.0), vec2(0.5 + eye, 1.0));\\\\n#else\\\\n vec2 coordClamped = clamp(coord, vec2(0.0), vec2(1.0));\\\\n#endif\\\\n return texture2D(texture, coordClamped);\\\\n}\\\\n@end\\\\n@export clay.util.ACES\\\\nvec3 ACESToneMapping(vec3 color)\\\\n{\\\\n const float A = 2.51;\\\\n const float B = 0.03;\\\\n const float C = 2.43;\\\\n const float D = 0.59;\\\\n const float E = 0.14;\\\\n return (color * (A * color + B)) / (color * (C * color + D) + E);\\\\n}\\\\n@end\\\";function Aa(e,t,r){this._tracks={},this._trackKeys=[],this._delay=0,this._maxTime=0,this._paused=!1,this._started=0,this._clip=null,this._target=e,(this._loop=t)&&r?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];\\\"undefined\\\"!=typeof console&&console.error.apply(console,e)}(\\\"Can' use additive animation on looped animation.\\\"):this._additiveAnimators=r}function Ea(e){return e instanceof HTMLCanvasElement||e instanceof HTMLImageElement||e instanceof Image}Object.assign(pr.prototype,Sa),S[\\\"import\\\"](Ma),S[\\\"import\\\"](mt),S[\\\"import\\\"](\\\"\\\\n@export ecgl.common.transformUniforms\\\\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\\\\nuniform mat4 worldInverseTranspose : WORLDINVERSETRANSPOSE;\\\\nuniform mat4 world : WORLD;\\\\n@end\\\\n\\\\n@export ecgl.common.attributes\\\\nattribute vec3 position : POSITION;\\\\nattribute vec2 texcoord : TEXCOORD_0;\\\\nattribute vec3 normal : NORMAL;\\\\n@end\\\\n\\\\n@export ecgl.common.uv.header\\\\nuniform vec2 uvRepeat : [1.0, 1.0];\\\\nuniform vec2 uvOffset : [0.0, 0.0];\\\\nuniform vec2 detailUvRepeat : [1.0, 1.0];\\\\nuniform vec2 detailUvOffset : [0.0, 0.0];\\\\n\\\\nvarying vec2 v_Texcoord;\\\\nvarying vec2 v_DetailTexcoord;\\\\n@end\\\\n\\\\n@export ecgl.common.uv.main\\\\nv_Texcoord = texcoord * uvRepeat + uvOffset;\\\\nv_DetailTexcoord = texcoord * detailUvRepeat + detailUvOffset;\\\\n@end\\\\n\\\\n@export ecgl.common.uv.fragmentHeader\\\\nvarying vec2 v_Texcoord;\\\\nvarying vec2 v_DetailTexcoord;\\\\n@end\\\\n\\\\n\\\\n@export ecgl.common.albedo.main\\\\n\\\\n vec4 albedoTexel = vec4(1.0);\\\\n#ifdef DIFFUSEMAP_ENABLED\\\\n albedoTexel = texture2D(diffuseMap, v_Texcoord);\\\\n #ifdef SRGB_DECODE\\\\n albedoTexel = sRGBToLinear(albedoTexel);\\\\n #endif\\\\n#endif\\\\n\\\\n#ifdef DETAILMAP_ENABLED\\\\n vec4 detailTexel = texture2D(detailMap, v_DetailTexcoord);\\\\n #ifdef SRGB_DECODE\\\\n detailTexel = sRGBToLinear(detailTexel);\\\\n #endif\\\\n albedoTexel.rgb = mix(albedoTexel.rgb, detailTexel.rgb, detailTexel.a);\\\\n albedoTexel.a = detailTexel.a + (1.0 - detailTexel.a) * albedoTexel.a;\\\\n#endif\\\\n\\\\n@end\\\\n\\\\n@export ecgl.common.wireframe.vertexHeader\\\\n\\\\n#ifdef WIREFRAME_QUAD\\\\nattribute vec4 barycentric;\\\\nvarying vec4 v_Barycentric;\\\\n#elif defined(WIREFRAME_TRIANGLE)\\\\nattribute vec3 barycentric;\\\\nvarying vec3 v_Barycentric;\\\\n#endif\\\\n\\\\n@end\\\\n\\\\n@export ecgl.common.wireframe.vertexMain\\\\n\\\\n#if defined(WIREFRAME_QUAD) || defined(WIREFRAME_TRIANGLE)\\\\n v_Barycentric = barycentric;\\\\n#endif\\\\n\\\\n@end\\\\n\\\\n\\\\n@export ecgl.common.wireframe.fragmentHeader\\\\n\\\\nuniform float wireframeLineWidth : 1;\\\\nuniform vec4 wireframeLineColor: [0, 0, 0, 0.5];\\\\n\\\\n#ifdef WIREFRAME_QUAD\\\\nvarying vec4 v_Barycentric;\\\\nfloat edgeFactor () {\\\\n vec4 d = fwidth(v_Barycentric);\\\\n vec4 a4 = smoothstep(vec4(0.0), d * wireframeLineWidth, v_Barycentric);\\\\n return min(min(min(a4.x, a4.y), a4.z), a4.w);\\\\n}\\\\n#elif defined(WIREFRAME_TRIANGLE)\\\\nvarying vec3 v_Barycentric;\\\\nfloat edgeFactor () {\\\\n vec3 d = fwidth(v_Barycentric);\\\\n vec3 a3 = smoothstep(vec3(0.0), d * wireframeLineWidth, v_Barycentric);\\\\n return min(min(a3.x, a3.y), a3.z);\\\\n}\\\\n#endif\\\\n\\\\n@end\\\\n\\\\n\\\\n@export ecgl.common.wireframe.fragmentMain\\\\n\\\\n#if defined(WIREFRAME_QUAD) || defined(WIREFRAME_TRIANGLE)\\\\n if (wireframeLineWidth > 0.) {\\\\n vec4 lineColor = wireframeLineColor;\\\\n#ifdef SRGB_DECODE\\\\n lineColor = sRGBToLinear(lineColor);\\\\n#endif\\\\n\\\\n gl_FragColor.rgb = mix(gl_FragColor.rgb, lineColor.rgb, (1.0 - edgeFactor()) * lineColor.a);\\\\n }\\\\n#endif\\\\n@end\\\\n\\\\n\\\\n\\\\n\\\\n@export ecgl.common.bumpMap.header\\\\n\\\\n#ifdef BUMPMAP_ENABLED\\\\nuniform sampler2D bumpMap;\\\\nuniform float bumpScale : 1.0;\\\\n\\\\n\\\\nvec3 bumpNormal(vec3 surfPos, vec3 surfNormal, vec3 baseNormal)\\\\n{\\\\n vec2 dSTdx = dFdx(v_Texcoord);\\\\n vec2 dSTdy = dFdy(v_Texcoord);\\\\n\\\\n float Hll = bumpScale * texture2D(bumpMap, v_Texcoord).x;\\\\n float dHx = bumpScale * texture2D(bumpMap, v_Texcoord + dSTdx).x - Hll;\\\\n float dHy = bumpScale * texture2D(bumpMap, v_Texcoord + dSTdy).x - Hll;\\\\n\\\\n vec3 vSigmaX = dFdx(surfPos);\\\\n vec3 vSigmaY = dFdy(surfPos);\\\\n vec3 vN = surfNormal;\\\\n\\\\n vec3 R1 = cross(vSigmaY, vN);\\\\n vec3 R2 = cross(vN, vSigmaX);\\\\n\\\\n float fDet = dot(vSigmaX, R1);\\\\n\\\\n vec3 vGrad = sign(fDet) * (dHx * R1 + dHy * R2);\\\\n return normalize(abs(fDet) * baseNormal - vGrad);\\\\n\\\\n}\\\\n#endif\\\\n\\\\n@end\\\\n\\\\n@export ecgl.common.normalMap.vertexHeader\\\\n\\\\n#ifdef NORMALMAP_ENABLED\\\\nattribute vec4 tangent : TANGENT;\\\\nvarying vec3 v_Tangent;\\\\nvarying vec3 v_Bitangent;\\\\n#endif\\\\n\\\\n@end\\\\n\\\\n@export ecgl.common.normalMap.vertexMain\\\\n\\\\n#ifdef NORMALMAP_ENABLED\\\\n if (dot(tangent, tangent) > 0.0) {\\\\n v_Tangent = normalize((worldInverseTranspose * vec4(tangent.xyz, 0.0)).xyz);\\\\n v_Bitangent = normalize(cross(v_Normal, v_Tangent) * tangent.w);\\\\n }\\\\n#endif\\\\n\\\\n@end\\\\n\\\\n\\\\n@export ecgl.common.normalMap.fragmentHeader\\\\n\\\\n#ifdef NORMALMAP_ENABLED\\\\nuniform sampler2D normalMap;\\\\nvarying vec3 v_Tangent;\\\\nvarying vec3 v_Bitangent;\\\\n#endif\\\\n\\\\n@end\\\\n\\\\n@export ecgl.common.normalMap.fragmentMain\\\\n#ifdef NORMALMAP_ENABLED\\\\n if (dot(v_Tangent, v_Tangent) > 0.0) {\\\\n vec3 normalTexel = texture2D(normalMap, v_DetailTexcoord).xyz;\\\\n if (dot(normalTexel, normalTexel) > 0.0) { N = normalTexel * 2.0 - 1.0;\\\\n mat3 tbn = mat3(v_Tangent, v_Bitangent, v_Normal);\\\\n N = normalize(tbn * N);\\\\n }\\\\n }\\\\n#endif\\\\n@end\\\\n\\\\n\\\\n\\\\n@export ecgl.common.vertexAnimation.header\\\\n\\\\n#ifdef VERTEX_ANIMATION\\\\nattribute vec3 prevPosition;\\\\nattribute vec3 prevNormal;\\\\nuniform float percent;\\\\n#endif\\\\n\\\\n@end\\\\n\\\\n@export ecgl.common.vertexAnimation.main\\\\n\\\\n#ifdef VERTEX_ANIMATION\\\\n vec3 pos = mix(prevPosition, position, percent);\\\\n vec3 norm = mix(prevNormal, normal, percent);\\\\n#else\\\\n vec3 pos = position;\\\\n vec3 norm = normal;\\\\n#endif\\\\n\\\\n@end\\\\n\\\\n\\\\n@export ecgl.common.ssaoMap.header\\\\n#ifdef SSAOMAP_ENABLED\\\\nuniform sampler2D ssaoMap;\\\\nuniform vec4 viewport : VIEWPORT;\\\\n#endif\\\\n@end\\\\n\\\\n@export ecgl.common.ssaoMap.main\\\\n float ao = 1.0;\\\\n#ifdef SSAOMAP_ENABLED\\\\n ao = texture2D(ssaoMap, (gl_FragCoord.xy - viewport.xy) / viewport.zw).r;\\\\n#endif\\\\n@end\\\\n\\\\n\\\\n\\\\n\\\\n@export ecgl.common.diffuseLayer.header\\\\n\\\\n#if (LAYER_DIFFUSEMAP_COUNT > 0)\\\\nuniform float layerDiffuseIntensity[LAYER_DIFFUSEMAP_COUNT];\\\\nuniform sampler2D layerDiffuseMap[LAYER_DIFFUSEMAP_COUNT];\\\\n#endif\\\\n\\\\n@end\\\\n\\\\n@export ecgl.common.emissiveLayer.header\\\\n\\\\n#if (LAYER_EMISSIVEMAP_COUNT > 0)\\\\nuniform float layerEmissionIntensity[LAYER_EMISSIVEMAP_COUNT];\\\\nuniform sampler2D layerEmissiveMap[LAYER_EMISSIVEMAP_COUNT];\\\\n#endif\\\\n\\\\n@end\\\\n\\\\n@export ecgl.common.layers.header\\\\n@import ecgl.common.diffuseLayer.header\\\\n@import ecgl.common.emissiveLayer.header\\\\n@end\\\\n\\\\n@export ecgl.common.diffuseLayer.main\\\\n\\\\n#if (LAYER_DIFFUSEMAP_COUNT > 0)\\\\n for (int _idx_ = 0; _idx_ < LAYER_DIFFUSEMAP_COUNT; _idx_++) {{\\\\n float intensity = layerDiffuseIntensity[_idx_];\\\\n vec4 texel2 = texture2D(layerDiffuseMap[_idx_], v_Texcoord);\\\\n #ifdef SRGB_DECODE\\\\n texel2 = sRGBToLinear(texel2);\\\\n #endif\\\\n albedoTexel.rgb = mix(albedoTexel.rgb, texel2.rgb * intensity, texel2.a);\\\\n albedoTexel.a = texel2.a + (1.0 - texel2.a) * albedoTexel.a;\\\\n }}\\\\n#endif\\\\n\\\\n@end\\\\n\\\\n@export ecgl.common.emissiveLayer.main\\\\n\\\\n#if (LAYER_EMISSIVEMAP_COUNT > 0)\\\\n for (int _idx_ = 0; _idx_ < LAYER_EMISSIVEMAP_COUNT; _idx_++)\\\\n {{\\\\n vec4 texel2 = texture2D(layerEmissiveMap[_idx_], v_Texcoord) * layerEmissionIntensity[_idx_];\\\\n #ifdef SRGB_DECODE\\\\n texel2 = sRGBToLinear(texel2);\\\\n #endif\\\\n float intensity = layerEmissionIntensity[_idx_];\\\\n gl_FragColor.rgb += texel2.rgb * texel2.a * intensity;\\\\n }}\\\\n#endif\\\\n\\\\n@end\\\\n\\\"),S[\\\"import\\\"](\\\"@export ecgl.color.vertex\\\\n\\\\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\\\\n\\\\n@import ecgl.common.uv.header\\\\n\\\\nattribute vec2 texcoord : TEXCOORD_0;\\\\nattribute vec3 position: POSITION;\\\\n\\\\n@import ecgl.common.wireframe.vertexHeader\\\\n\\\\n#ifdef VERTEX_COLOR\\\\nattribute vec4 a_Color : COLOR;\\\\nvarying vec4 v_Color;\\\\n#endif\\\\n\\\\n#ifdef VERTEX_ANIMATION\\\\nattribute vec3 prevPosition;\\\\nuniform float percent : 1.0;\\\\n#endif\\\\n\\\\n#ifdef ATMOSPHERE_ENABLED\\\\nattribute vec3 normal: NORMAL;\\\\nuniform mat4 worldInverseTranspose : WORLDINVERSETRANSPOSE;\\\\nvarying vec3 v_Normal;\\\\n#endif\\\\n\\\\nvoid main()\\\\n{\\\\n#ifdef VERTEX_ANIMATION\\\\n vec3 pos = mix(prevPosition, position, percent);\\\\n#else\\\\n vec3 pos = position;\\\\n#endif\\\\n\\\\n gl_Position = worldViewProjection * vec4(pos, 1.0);\\\\n\\\\n @import ecgl.common.uv.main\\\\n\\\\n#ifdef VERTEX_COLOR\\\\n v_Color = a_Color;\\\\n#endif\\\\n\\\\n#ifdef ATMOSPHERE_ENABLED\\\\n v_Normal = normalize((worldInverseTranspose * vec4(normal, 0.0)).xyz);\\\\n#endif\\\\n\\\\n @import ecgl.common.wireframe.vertexMain\\\\n\\\\n}\\\\n\\\\n@end\\\\n\\\\n@export ecgl.color.fragment\\\\n\\\\n#define LAYER_DIFFUSEMAP_COUNT 0\\\\n#define LAYER_EMISSIVEMAP_COUNT 0\\\\n\\\\nuniform sampler2D diffuseMap;\\\\nuniform sampler2D detailMap;\\\\n\\\\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\\\\n\\\\n#ifdef ATMOSPHERE_ENABLED\\\\nuniform mat4 viewTranspose: VIEWTRANSPOSE;\\\\nuniform vec3 glowColor;\\\\nuniform float glowPower;\\\\nvarying vec3 v_Normal;\\\\n#endif\\\\n\\\\n#ifdef VERTEX_COLOR\\\\nvarying vec4 v_Color;\\\\n#endif\\\\n\\\\n@import ecgl.common.layers.header\\\\n\\\\n@import ecgl.common.uv.fragmentHeader\\\\n\\\\n@import ecgl.common.wireframe.fragmentHeader\\\\n\\\\n@import clay.util.srgb\\\\n\\\\nvoid main()\\\\n{\\\\n#ifdef SRGB_DECODE\\\\n gl_FragColor = sRGBToLinear(color);\\\\n#else\\\\n gl_FragColor = color;\\\\n#endif\\\\n\\\\n#ifdef VERTEX_COLOR\\\\n gl_FragColor *= v_Color;\\\\n#endif\\\\n\\\\n @import ecgl.common.albedo.main\\\\n\\\\n @import ecgl.common.diffuseLayer.main\\\\n\\\\n gl_FragColor *= albedoTexel;\\\\n\\\\n#ifdef ATMOSPHERE_ENABLED\\\\n float atmoIntensity = pow(1.0 - dot(v_Normal, (viewTranspose * vec4(0.0, 0.0, 1.0, 0.0)).xyz), glowPower);\\\\n gl_FragColor.rgb += glowColor * atmoIntensity;\\\\n#endif\\\\n\\\\n @import ecgl.common.emissiveLayer.main\\\\n\\\\n @import ecgl.common.wireframe.fragmentMain\\\\n\\\\n}\\\\n@end\\\"),S[\\\"import\\\"](\\\"/**\\\\n * http: */\\\\n\\\\n@export ecgl.lambert.vertex\\\\n\\\\n@import ecgl.common.transformUniforms\\\\n\\\\n@import ecgl.common.uv.header\\\\n\\\\n\\\\n@import ecgl.common.attributes\\\\n\\\\n@import ecgl.common.wireframe.vertexHeader\\\\n\\\\n#ifdef VERTEX_COLOR\\\\nattribute vec4 a_Color : COLOR;\\\\nvarying vec4 v_Color;\\\\n#endif\\\\n\\\\n\\\\n@import ecgl.common.vertexAnimation.header\\\\n\\\\n\\\\nvarying vec3 v_Normal;\\\\nvarying vec3 v_WorldPosition;\\\\n\\\\nvoid main()\\\\n{\\\\n @import ecgl.common.uv.main\\\\n\\\\n @import ecgl.common.vertexAnimation.main\\\\n\\\\n\\\\n gl_Position = worldViewProjection * vec4(pos, 1.0);\\\\n\\\\n v_Normal = normalize((worldInverseTranspose * vec4(norm, 0.0)).xyz);\\\\n v_WorldPosition = (world * vec4(pos, 1.0)).xyz;\\\\n\\\\n#ifdef VERTEX_COLOR\\\\n v_Color = a_Color;\\\\n#endif\\\\n\\\\n @import ecgl.common.wireframe.vertexMain\\\\n}\\\\n\\\\n@end\\\\n\\\\n\\\\n@export ecgl.lambert.fragment\\\\n\\\\n#define LAYER_DIFFUSEMAP_COUNT 0\\\\n#define LAYER_EMISSIVEMAP_COUNT 0\\\\n\\\\n#define NORMAL_UP_AXIS 1\\\\n#define NORMAL_FRONT_AXIS 2\\\\n\\\\n@import ecgl.common.uv.fragmentHeader\\\\n\\\\nvarying vec3 v_Normal;\\\\nvarying vec3 v_WorldPosition;\\\\n\\\\nuniform sampler2D diffuseMap;\\\\nuniform sampler2D detailMap;\\\\n\\\\n@import ecgl.common.layers.header\\\\n\\\\nuniform float emissionIntensity: 1.0;\\\\n\\\\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\\\\n\\\\nuniform mat4 viewInverse : VIEWINVERSE;\\\\n\\\\n#ifdef ATMOSPHERE_ENABLED\\\\nuniform mat4 viewTranspose: VIEWTRANSPOSE;\\\\nuniform vec3 glowColor;\\\\nuniform float glowPower;\\\\n#endif\\\\n\\\\n#ifdef AMBIENT_LIGHT_COUNT\\\\n@import clay.header.ambient_light\\\\n#endif\\\\n#ifdef AMBIENT_SH_LIGHT_COUNT\\\\n@import clay.header.ambient_sh_light\\\\n#endif\\\\n\\\\n#ifdef DIRECTIONAL_LIGHT_COUNT\\\\n@import clay.header.directional_light\\\\n#endif\\\\n\\\\n#ifdef VERTEX_COLOR\\\\nvarying vec4 v_Color;\\\\n#endif\\\\n\\\\n\\\\n@import ecgl.common.ssaoMap.header\\\\n\\\\n@import ecgl.common.bumpMap.header\\\\n\\\\n@import clay.util.srgb\\\\n\\\\n@import ecgl.common.wireframe.fragmentHeader\\\\n\\\\n@import clay.plugin.compute_shadow_map\\\\n\\\\nvoid main()\\\\n{\\\\n#ifdef SRGB_DECODE\\\\n gl_FragColor = sRGBToLinear(color);\\\\n#else\\\\n gl_FragColor = color;\\\\n#endif\\\\n\\\\n#ifdef VERTEX_COLOR\\\\n #ifdef SRGB_DECODE\\\\n gl_FragColor *= sRGBToLinear(v_Color);\\\\n #else\\\\n gl_FragColor *= v_Color;\\\\n #endif\\\\n#endif\\\\n\\\\n @import ecgl.common.albedo.main\\\\n\\\\n @import ecgl.common.diffuseLayer.main\\\\n\\\\n gl_FragColor *= albedoTexel;\\\\n\\\\n vec3 N = v_Normal;\\\\n#ifdef DOUBLE_SIDED\\\\n vec3 eyePos = viewInverse[3].xyz;\\\\n vec3 V = normalize(eyePos - v_WorldPosition);\\\\n\\\\n if (dot(N, V) < 0.0) {\\\\n N = -N;\\\\n }\\\\n#endif\\\\n\\\\n float ambientFactor = 1.0;\\\\n\\\\n#ifdef BUMPMAP_ENABLED\\\\n N = bumpNormal(v_WorldPosition, v_Normal, N);\\\\n ambientFactor = dot(v_Normal, N);\\\\n#endif\\\\n\\\\n vec3 N2 = vec3(N.x, N[NORMAL_UP_AXIS], N[NORMAL_FRONT_AXIS]);\\\\n\\\\n vec3 diffuseColor = vec3(0.0, 0.0, 0.0);\\\\n\\\\n @import ecgl.common.ssaoMap.main\\\\n\\\\n#ifdef AMBIENT_LIGHT_COUNT\\\\n for(int i = 0; i < AMBIENT_LIGHT_COUNT; i++)\\\\n {\\\\n diffuseColor += ambientLightColor[i] * ambientFactor * ao;\\\\n }\\\\n#endif\\\\n#ifdef AMBIENT_SH_LIGHT_COUNT\\\\n for(int _idx_ = 0; _idx_ < AMBIENT_SH_LIGHT_COUNT; _idx_++)\\\\n {{\\\\n diffuseColor += calcAmbientSHLight(_idx_, N2) * ambientSHLightColor[_idx_] * ao;\\\\n }}\\\\n#endif\\\\n#ifdef DIRECTIONAL_LIGHT_COUNT\\\\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\\\\n float shadowContribsDir[DIRECTIONAL_LIGHT_COUNT];\\\\n if(shadowEnabled)\\\\n {\\\\n computeShadowOfDirectionalLights(v_WorldPosition, shadowContribsDir);\\\\n }\\\\n#endif\\\\n for(int i = 0; i < DIRECTIONAL_LIGHT_COUNT; i++)\\\\n {\\\\n vec3 lightDirection = -directionalLightDirection[i];\\\\n vec3 lightColor = directionalLightColor[i];\\\\n\\\\n float shadowContrib = 1.0;\\\\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\\\\n if (shadowEnabled)\\\\n {\\\\n shadowContrib = shadowContribsDir[i];\\\\n }\\\\n#endif\\\\n\\\\n float ndl = dot(N, normalize(lightDirection)) * shadowContrib;\\\\n\\\\n diffuseColor += lightColor * clamp(ndl, 0.0, 1.0);\\\\n }\\\\n#endif\\\\n\\\\n gl_FragColor.rgb *= diffuseColor;\\\\n\\\\n#ifdef ATMOSPHERE_ENABLED\\\\n float atmoIntensity = pow(1.0 - dot(v_Normal, (viewTranspose * vec4(0.0, 0.0, 1.0, 0.0)).xyz), glowPower);\\\\n gl_FragColor.rgb += glowColor * atmoIntensity;\\\\n#endif\\\\n\\\\n @import ecgl.common.emissiveLayer.main\\\\n\\\\n @import ecgl.common.wireframe.fragmentMain\\\\n}\\\\n\\\\n@end\\\"),S[\\\"import\\\"](\\\"@export ecgl.realistic.vertex\\\\n\\\\n@import ecgl.common.transformUniforms\\\\n\\\\n@import ecgl.common.uv.header\\\\n\\\\n@import ecgl.common.attributes\\\\n\\\\n\\\\n@import ecgl.common.wireframe.vertexHeader\\\\n\\\\n#ifdef VERTEX_COLOR\\\\nattribute vec4 a_Color : COLOR;\\\\nvarying vec4 v_Color;\\\\n#endif\\\\n\\\\n#ifdef NORMALMAP_ENABLED\\\\nattribute vec4 tangent : TANGENT;\\\\nvarying vec3 v_Tangent;\\\\nvarying vec3 v_Bitangent;\\\\n#endif\\\\n\\\\n@import ecgl.common.vertexAnimation.header\\\\n\\\\nvarying vec3 v_Normal;\\\\nvarying vec3 v_WorldPosition;\\\\n\\\\nvoid main()\\\\n{\\\\n\\\\n @import ecgl.common.uv.main\\\\n\\\\n @import ecgl.common.vertexAnimation.main\\\\n\\\\n gl_Position = worldViewProjection * vec4(pos, 1.0);\\\\n\\\\n v_Normal = normalize((worldInverseTranspose * vec4(norm, 0.0)).xyz);\\\\n v_WorldPosition = (world * vec4(pos, 1.0)).xyz;\\\\n\\\\n#ifdef VERTEX_COLOR\\\\n v_Color = a_Color;\\\\n#endif\\\\n\\\\n#ifdef NORMALMAP_ENABLED\\\\n v_Tangent = normalize((worldInverseTranspose * vec4(tangent.xyz, 0.0)).xyz);\\\\n v_Bitangent = normalize(cross(v_Normal, v_Tangent) * tangent.w);\\\\n#endif\\\\n\\\\n @import ecgl.common.wireframe.vertexMain\\\\n\\\\n}\\\\n\\\\n@end\\\\n\\\\n\\\\n\\\\n@export ecgl.realistic.fragment\\\\n\\\\n#define LAYER_DIFFUSEMAP_COUNT 0\\\\n#define LAYER_EMISSIVEMAP_COUNT 0\\\\n#define PI 3.14159265358979\\\\n#define ROUGHNESS_CHANEL 0\\\\n#define METALNESS_CHANEL 1\\\\n\\\\n#define NORMAL_UP_AXIS 1\\\\n#define NORMAL_FRONT_AXIS 2\\\\n\\\\n#ifdef VERTEX_COLOR\\\\nvarying vec4 v_Color;\\\\n#endif\\\\n\\\\n@import ecgl.common.uv.fragmentHeader\\\\n\\\\nvarying vec3 v_Normal;\\\\nvarying vec3 v_WorldPosition;\\\\n\\\\nuniform sampler2D diffuseMap;\\\\n\\\\nuniform sampler2D detailMap;\\\\nuniform sampler2D metalnessMap;\\\\nuniform sampler2D roughnessMap;\\\\n\\\\n@import ecgl.common.layers.header\\\\n\\\\nuniform float emissionIntensity: 1.0;\\\\n\\\\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\\\\n\\\\nuniform float metalness : 0.0;\\\\nuniform float roughness : 0.5;\\\\n\\\\nuniform mat4 viewInverse : VIEWINVERSE;\\\\n\\\\n#ifdef ATMOSPHERE_ENABLED\\\\nuniform mat4 viewTranspose: VIEWTRANSPOSE;\\\\nuniform vec3 glowColor;\\\\nuniform float glowPower;\\\\n#endif\\\\n\\\\n#ifdef AMBIENT_LIGHT_COUNT\\\\n@import clay.header.ambient_light\\\\n#endif\\\\n\\\\n#ifdef AMBIENT_SH_LIGHT_COUNT\\\\n@import clay.header.ambient_sh_light\\\\n#endif\\\\n\\\\n#ifdef AMBIENT_CUBEMAP_LIGHT_COUNT\\\\n@import clay.header.ambient_cubemap_light\\\\n#endif\\\\n\\\\n#ifdef DIRECTIONAL_LIGHT_COUNT\\\\n@import clay.header.directional_light\\\\n#endif\\\\n\\\\n@import ecgl.common.normalMap.fragmentHeader\\\\n\\\\n@import ecgl.common.ssaoMap.header\\\\n\\\\n@import ecgl.common.bumpMap.header\\\\n\\\\n@import clay.util.srgb\\\\n\\\\n@import clay.util.rgbm\\\\n\\\\n@import ecgl.common.wireframe.fragmentHeader\\\\n\\\\n@import clay.plugin.compute_shadow_map\\\\n\\\\nvec3 F_Schlick(float ndv, vec3 spec) {\\\\n return spec + (1.0 - spec) * pow(1.0 - ndv, 5.0);\\\\n}\\\\n\\\\nfloat D_Phong(float g, float ndh) {\\\\n float a = pow(8192.0, g);\\\\n return (a + 2.0) / 8.0 * pow(ndh, a);\\\\n}\\\\n\\\\nvoid main()\\\\n{\\\\n vec4 albedoColor = color;\\\\n\\\\n vec3 eyePos = viewInverse[3].xyz;\\\\n vec3 V = normalize(eyePos - v_WorldPosition);\\\\n#ifdef VERTEX_COLOR\\\\n #ifdef SRGB_DECODE\\\\n albedoColor *= sRGBToLinear(v_Color);\\\\n #else\\\\n albedoColor *= v_Color;\\\\n #endif\\\\n#endif\\\\n\\\\n @import ecgl.common.albedo.main\\\\n\\\\n @import ecgl.common.diffuseLayer.main\\\\n\\\\n albedoColor *= albedoTexel;\\\\n\\\\n float m = metalness;\\\\n\\\\n#ifdef METALNESSMAP_ENABLED\\\\n float m2 = texture2D(metalnessMap, v_DetailTexcoord)[METALNESS_CHANEL];\\\\n m = clamp(m2 + (m - 0.5) * 2.0, 0.0, 1.0);\\\\n#endif\\\\n\\\\n vec3 baseColor = albedoColor.rgb;\\\\n albedoColor.rgb = baseColor * (1.0 - m);\\\\n vec3 specFactor = mix(vec3(0.04), baseColor, m);\\\\n\\\\n float g = 1.0 - roughness;\\\\n\\\\n#ifdef ROUGHNESSMAP_ENABLED\\\\n float g2 = 1.0 - texture2D(roughnessMap, v_DetailTexcoord)[ROUGHNESS_CHANEL];\\\\n g = clamp(g2 + (g - 0.5) * 2.0, 0.0, 1.0);\\\\n#endif\\\\n\\\\n vec3 N = v_Normal;\\\\n\\\\n#ifdef DOUBLE_SIDED\\\\n if (dot(N, V) < 0.0) {\\\\n N = -N;\\\\n }\\\\n#endif\\\\n\\\\n float ambientFactor = 1.0;\\\\n\\\\n#ifdef BUMPMAP_ENABLED\\\\n N = bumpNormal(v_WorldPosition, v_Normal, N);\\\\n ambientFactor = dot(v_Normal, N);\\\\n#endif\\\\n\\\\n@import ecgl.common.normalMap.fragmentMain\\\\n\\\\n vec3 N2 = vec3(N.x, N[NORMAL_UP_AXIS], N[NORMAL_FRONT_AXIS]);\\\\n\\\\n vec3 diffuseTerm = vec3(0.0);\\\\n vec3 specularTerm = vec3(0.0);\\\\n\\\\n float ndv = clamp(dot(N, V), 0.0, 1.0);\\\\n vec3 fresnelTerm = F_Schlick(ndv, specFactor);\\\\n\\\\n @import ecgl.common.ssaoMap.main\\\\n\\\\n#ifdef AMBIENT_LIGHT_COUNT\\\\n for(int _idx_ = 0; _idx_ < AMBIENT_LIGHT_COUNT; _idx_++)\\\\n {{\\\\n diffuseTerm += ambientLightColor[_idx_] * ambientFactor * ao;\\\\n }}\\\\n#endif\\\\n\\\\n#ifdef AMBIENT_SH_LIGHT_COUNT\\\\n for(int _idx_ = 0; _idx_ < AMBIENT_SH_LIGHT_COUNT; _idx_++)\\\\n {{\\\\n diffuseTerm += calcAmbientSHLight(_idx_, N2) * ambientSHLightColor[_idx_] * ao;\\\\n }}\\\\n#endif\\\\n\\\\n#ifdef DIRECTIONAL_LIGHT_COUNT\\\\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\\\\n float shadowContribsDir[DIRECTIONAL_LIGHT_COUNT];\\\\n if(shadowEnabled)\\\\n {\\\\n computeShadowOfDirectionalLights(v_WorldPosition, shadowContribsDir);\\\\n }\\\\n#endif\\\\n for(int _idx_ = 0; _idx_ < DIRECTIONAL_LIGHT_COUNT; _idx_++)\\\\n {{\\\\n vec3 L = -directionalLightDirection[_idx_];\\\\n vec3 lc = directionalLightColor[_idx_];\\\\n\\\\n vec3 H = normalize(L + V);\\\\n float ndl = clamp(dot(N, normalize(L)), 0.0, 1.0);\\\\n float ndh = clamp(dot(N, H), 0.0, 1.0);\\\\n\\\\n float shadowContrib = 1.0;\\\\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\\\\n if (shadowEnabled)\\\\n {\\\\n shadowContrib = shadowContribsDir[_idx_];\\\\n }\\\\n#endif\\\\n\\\\n vec3 li = lc * ndl * shadowContrib;\\\\n\\\\n diffuseTerm += li;\\\\n specularTerm += li * fresnelTerm * D_Phong(g, ndh);\\\\n }}\\\\n#endif\\\\n\\\\n\\\\n#ifdef AMBIENT_CUBEMAP_LIGHT_COUNT\\\\n vec3 L = reflect(-V, N);\\\\n L = vec3(L.x, L[NORMAL_UP_AXIS], L[NORMAL_FRONT_AXIS]);\\\\n float rough2 = clamp(1.0 - g, 0.0, 1.0);\\\\n float bias2 = rough2 * 5.0;\\\\n vec2 brdfParam2 = texture2D(ambientCubemapLightBRDFLookup[0], vec2(rough2, ndv)).xy;\\\\n vec3 envWeight2 = specFactor * brdfParam2.x + brdfParam2.y;\\\\n vec3 envTexel2;\\\\n for(int _idx_ = 0; _idx_ < AMBIENT_CUBEMAP_LIGHT_COUNT; _idx_++)\\\\n {{\\\\n envTexel2 = RGBMDecode(textureCubeLodEXT(ambientCubemapLightCubemap[_idx_], L, bias2), 8.12);\\\\n specularTerm += ambientCubemapLightColor[_idx_] * envTexel2 * envWeight2 * ao;\\\\n }}\\\\n#endif\\\\n\\\\n gl_FragColor.rgb = albedoColor.rgb * diffuseTerm + specularTerm;\\\\n gl_FragColor.a = albedoColor.a;\\\\n\\\\n#ifdef ATMOSPHERE_ENABLED\\\\n float atmoIntensity = pow(1.0 - dot(v_Normal, (viewTranspose * vec4(0.0, 0.0, 1.0, 0.0)).xyz), glowPower);\\\\n gl_FragColor.rgb += glowColor * atmoIntensity;\\\\n#endif\\\\n\\\\n#ifdef SRGB_ENCODE\\\\n gl_FragColor = linearTosRGB(gl_FragColor);\\\\n#endif\\\\n\\\\n @import ecgl.common.emissiveLayer.main\\\\n\\\\n @import ecgl.common.wireframe.fragmentMain\\\\n}\\\\n\\\\n@end\\\"),S[\\\"import\\\"](\\\"@export ecgl.hatching.vertex\\\\n\\\\n@import ecgl.realistic.vertex\\\\n\\\\n@end\\\\n\\\\n\\\\n@export ecgl.hatching.fragment\\\\n\\\\n#define NORMAL_UP_AXIS 1\\\\n#define NORMAL_FRONT_AXIS 2\\\\n\\\\n@import ecgl.common.uv.fragmentHeader\\\\n\\\\nvarying vec3 v_Normal;\\\\nvarying vec3 v_WorldPosition;\\\\n\\\\nuniform vec4 color : [0.0, 0.0, 0.0, 1.0];\\\\nuniform vec4 paperColor : [1.0, 1.0, 1.0, 1.0];\\\\n\\\\nuniform mat4 viewInverse : VIEWINVERSE;\\\\n\\\\n#ifdef AMBIENT_LIGHT_COUNT\\\\n@import clay.header.ambient_light\\\\n#endif\\\\n#ifdef AMBIENT_SH_LIGHT_COUNT\\\\n@import clay.header.ambient_sh_light\\\\n#endif\\\\n\\\\n#ifdef DIRECTIONAL_LIGHT_COUNT\\\\n@import clay.header.directional_light\\\\n#endif\\\\n\\\\n#ifdef VERTEX_COLOR\\\\nvarying vec4 v_Color;\\\\n#endif\\\\n\\\\n\\\\n@import ecgl.common.ssaoMap.header\\\\n\\\\n@import ecgl.common.bumpMap.header\\\\n\\\\n@import clay.util.srgb\\\\n\\\\n@import ecgl.common.wireframe.fragmentHeader\\\\n\\\\n@import clay.plugin.compute_shadow_map\\\\n\\\\nuniform sampler2D hatch1;\\\\nuniform sampler2D hatch2;\\\\nuniform sampler2D hatch3;\\\\nuniform sampler2D hatch4;\\\\nuniform sampler2D hatch5;\\\\nuniform sampler2D hatch6;\\\\n\\\\nfloat shade(in float tone) {\\\\n vec4 c = vec4(1. ,1., 1., 1.);\\\\n float step = 1. / 6.;\\\\n vec2 uv = v_DetailTexcoord;\\\\n if (tone <= step / 2.0) {\\\\n c = mix(vec4(0.), texture2D(hatch6, uv), 12. * tone);\\\\n }\\\\n else if (tone <= step) {\\\\n c = mix(texture2D(hatch6, uv), texture2D(hatch5, uv), 6. * tone);\\\\n }\\\\n if(tone > step && tone <= 2. * step){\\\\n c = mix(texture2D(hatch5, uv), texture2D(hatch4, uv) , 6. * (tone - step));\\\\n }\\\\n if(tone > 2. * step && tone <= 3. * step){\\\\n c = mix(texture2D(hatch4, uv), texture2D(hatch3, uv), 6. * (tone - 2. * step));\\\\n }\\\\n if(tone > 3. * step && tone <= 4. * step){\\\\n c = mix(texture2D(hatch3, uv), texture2D(hatch2, uv), 6. * (tone - 3. * step));\\\\n }\\\\n if(tone > 4. * step && tone <= 5. * step){\\\\n c = mix(texture2D(hatch2, uv), texture2D(hatch1, uv), 6. * (tone - 4. * step));\\\\n }\\\\n if(tone > 5. * step){\\\\n c = mix(texture2D(hatch1, uv), vec4(1.), 6. * (tone - 5. * step));\\\\n }\\\\n\\\\n return c.r;\\\\n}\\\\n\\\\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\\\\n\\\\nvoid main()\\\\n{\\\\n#ifdef SRGB_DECODE\\\\n vec4 inkColor = sRGBToLinear(color);\\\\n#else\\\\n vec4 inkColor = color;\\\\n#endif\\\\n\\\\n#ifdef VERTEX_COLOR\\\\n #ifdef SRGB_DECODE\\\\n inkColor *= sRGBToLinear(v_Color);\\\\n #else\\\\n inkColor *= v_Color;\\\\n #endif\\\\n#endif\\\\n\\\\n vec3 N = v_Normal;\\\\n#ifdef DOUBLE_SIDED\\\\n vec3 eyePos = viewInverse[3].xyz;\\\\n vec3 V = normalize(eyePos - v_WorldPosition);\\\\n\\\\n if (dot(N, V) < 0.0) {\\\\n N = -N;\\\\n }\\\\n#endif\\\\n\\\\n float tone = 0.0;\\\\n\\\\n float ambientFactor = 1.0;\\\\n\\\\n#ifdef BUMPMAP_ENABLED\\\\n N = bumpNormal(v_WorldPosition, v_Normal, N);\\\\n ambientFactor = dot(v_Normal, N);\\\\n#endif\\\\n\\\\n vec3 N2 = vec3(N.x, N[NORMAL_UP_AXIS], N[NORMAL_FRONT_AXIS]);\\\\n\\\\n @import ecgl.common.ssaoMap.main\\\\n\\\\n#ifdef AMBIENT_LIGHT_COUNT\\\\n for(int i = 0; i < AMBIENT_LIGHT_COUNT; i++)\\\\n {\\\\n tone += dot(ambientLightColor[i], w) * ambientFactor * ao;\\\\n }\\\\n#endif\\\\n#ifdef AMBIENT_SH_LIGHT_COUNT\\\\n for(int _idx_ = 0; _idx_ < AMBIENT_SH_LIGHT_COUNT; _idx_++)\\\\n {{\\\\n tone += dot(calcAmbientSHLight(_idx_, N2) * ambientSHLightColor[_idx_], w) * ao;\\\\n }}\\\\n#endif\\\\n#ifdef DIRECTIONAL_LIGHT_COUNT\\\\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\\\\n float shadowContribsDir[DIRECTIONAL_LIGHT_COUNT];\\\\n if(shadowEnabled)\\\\n {\\\\n computeShadowOfDirectionalLights(v_WorldPosition, shadowContribsDir);\\\\n }\\\\n#endif\\\\n for(int i = 0; i < DIRECTIONAL_LIGHT_COUNT; i++)\\\\n {\\\\n vec3 lightDirection = -directionalLightDirection[i];\\\\n float lightTone = dot(directionalLightColor[i], w);\\\\n\\\\n float shadowContrib = 1.0;\\\\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\\\\n if (shadowEnabled)\\\\n {\\\\n shadowContrib = shadowContribsDir[i];\\\\n }\\\\n#endif\\\\n\\\\n float ndl = dot(N, normalize(lightDirection)) * shadowContrib;\\\\n\\\\n tone += lightTone * clamp(ndl, 0.0, 1.0);\\\\n }\\\\n#endif\\\\n\\\\n gl_FragColor = mix(inkColor, paperColor, shade(clamp(tone, 0.0, 1.0)));\\\\n }\\\\n@end\\\\n\\\"),S[\\\"import\\\"](\\\"@export ecgl.sm.depth.vertex\\\\n\\\\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\\\\n\\\\nattribute vec3 position : POSITION;\\\\nattribute vec2 texcoord : TEXCOORD_0;\\\\n\\\\n#ifdef VERTEX_ANIMATION\\\\nattribute vec3 prevPosition;\\\\nuniform float percent : 1.0;\\\\n#endif\\\\n\\\\nvarying vec4 v_ViewPosition;\\\\nvarying vec2 v_Texcoord;\\\\n\\\\nvoid main(){\\\\n\\\\n#ifdef VERTEX_ANIMATION\\\\n vec3 pos = mix(prevPosition, position, percent);\\\\n#else\\\\n vec3 pos = position;\\\\n#endif\\\\n\\\\n v_ViewPosition = worldViewProjection * vec4(pos, 1.0);\\\\n gl_Position = v_ViewPosition;\\\\n\\\\n v_Texcoord = texcoord;\\\\n\\\\n}\\\\n@end\\\\n\\\\n\\\\n\\\\n@export ecgl.sm.depth.fragment\\\\n\\\\n@import clay.sm.depth.fragment\\\\n\\\\n@end\\\");var Ca=hi.prototype.addToScene,Da=hi.prototype.removeFromScene,b=(hi.prototype.addToScene=function(e){var t;Ca.call(this,e),this.__zr&&(t=this.__zr,e.traverse(function(e){e.__zr=t,e.addAnimatorsToZr&&e.addAnimatorsToZr(t)}))},hi.prototype.removeFromScene=function(e){Da.call(this,e),e.traverse(function(e){var t=e.__zr;e.__zr=null,t&&e.removeAnimatorsFromZr&&e.removeAnimatorsFromZr(t)})},Fe.prototype.setTextureImage=function(t,e,r,i){var n,a,o;if(this.shader)return a=r.getZr(),(o=this).autoUpdateTextureStatus=!1,o.disableTexture(t),e&&\\\"none\\\"!==e&&(n=b.loadTexture(e,r,i,function(e){o.enableTexture(t),a&&a.refresh()}),o.set(t,n)),n},{}),La=(b.Renderer=Et,b.Node=pr,b.Mesh=Er,b.Shader=S,b.Material=Fe,b.Texture=B,b.Texture2D=k,b.Geometry=_,b.SphereGeometry=yn,b.PlaneGeometry=Ni,b.CubeGeometry=Bi,b.AmbientLight=xn,b.DirectionalLight=bn,b.PointLight=wn,b.SpotLight=Tn,b.PerspectiveCamera=xi,b.OrthographicCamera=on,b.Vector2=ke,b.Vector3=z,b.Vector4=s,b.Quaternion=Yt,b.Matrix2=v,b.Matrix2d=e,b.Matrix3=Dn,b.Matrix4=M,b.Plane=Xr,b.Ray=zt,b.BoundingBox=ar,b.Frustum=ei,null);function Pa(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))}function Oa(e){var t,r,i;e.wrapS!==B.REPEAT&&e.wrapT!==B.REPEAT||!e.image||(t=Pa(e.width),r=Pa(e.height),t===e.width&&r===e.height)||((i=document.createElement(\\\"canvas\\\")).width=t,i.height=r,i.getContext(\\\"2d\\\").drawImage(e.image,0,0,t,r),e.image=i)}b.loadTexture=function(e,t,r,i){\\\"function\\\"==typeof r&&(i=r,r={}),r=r||{};for(var n=Object.keys(r).sort(),a=\\\"\\\",o=0;o<n.length;o++)a+=n[o]+\\\"_\\\"+r[n[o]]+\\\"_\\\";var s=t.__textureCache=t.__textureCache||new pi(20);if(e.getZr&&e.setOption){var l=e.__textureid__;if(u=s.get(a+l))u.texture.surface.setECharts(e);else{var h=new an(e);for(h.onupdate=function(){t.getZr().refresh()},u={texture:h.getTexture()},o=0;o<n.length;o++)u.texture[n[o]]=r[n[o]];l=e.__textureid__||\\\"__ecgl_ec__\\\"+u.texture.__uid__,e.__textureid__=l,s.put(a+l,u)}i&&i(u.texture)}else if(Ea(e)){l=e.__textureid__;if(!(u=s.get(a+l))){for(u={texture:new b.Texture2D({image:e})},o=0;o<n.length;o++)u.texture[n[o]]=r[n[o]];l=e.__textureid__||\\\"__ecgl_image__\\\"+u.texture.__uid__,e.__textureid__=l,s.put(a+l,u),Oa(u.texture),i&&i(u.texture)}}else if(u=s.get(a+e))u.callbacks?u.callbacks.push(i):i&&i(u.texture);else{if(e.match(/.hdr$|^data:application\\\\/octet-stream/)){var u={callbacks:[i]},c=qi.loadTexture(e,{exposure:r.exposure,fileType:\\\"hdr\\\"},function(){c.dirty(),u.callbacks.forEach(function(e){e&&e(c)}),u.callbacks=null});u.texture=c}else{for(c=new b.Texture2D({image:new Image}),o=0;o<n.length;o++)c[n[o]]=r[n[o]];u={texture:c,callbacks:[i]};var d=c.image;d.onload=function(){c.image=d,Oa(c),c.dirty(),u.callbacks.forEach(function(e){e&&e(c)}),u.callbacks=null},d.crossOrigin=\\\"Anonymous\\\",d.src=e,c.image=null!==La?La:La=qi.createBlank(\\\"rgba(255,255,255,0)\\\").image}s.put(a+e,u)}return u.texture},b.createAmbientCubemap=function(e,t,r,i){var n=(e=e||{}).texture,a=E(e.exposure,1),o=new fn({intensity:E(e.specularIntensity,1)}),s=new pn({intensity:E(e.diffuseIntensity,1),coefficients:[.844,.712,.691,-.037,.083,.167,.343,.288,.299,-.041,-.021,-.009,-.003,-.041,-.064,-.011,-.007,-.004,-.031,.034,.081,-.06,-.049,-.06,.046,.056,.05]});return o.cubemap=b.loadTexture(n,r,{exposure:a},function(){o.cubemap.flipY=!1,o.prefilter(t,32),s.coefficients=_n.projectEnvironmentMap(t,o.cubemap,{lod:1}),i&&i()}),{specular:o,diffuse:s}},b.createBlankTexture=qi.createBlank,b.isImage=Ea,b.additiveBlend=function(e){e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE)},b.parseColor=function(e,t){return e instanceof Array?((t=t||[])[0]=e[0],t[1]=e[1],t[2]=e[2],3<e.length?t[3]=e[3]:t[3]=1):((t=F.color.parse(e||\\\"#000\\\",t)||[0,0,0,0])[0]/=255,t[1]/=255,t[2]/=255),t},b.directionFromAlphaBeta=function(e,t){var r=e/180*Math.PI+Math.PI/2,i=-t/180*Math.PI+Math.PI/2,n=[],a=Math.sin(r);return n[0]=a*Math.cos(i),n[1]=-Math.cos(r),n[2]=a*Math.sin(i),n},b.getShadowResolution=function(e){var t=1024;switch(e){case\\\"low\\\":t=512;break;case\\\"medium\\\":break;case\\\"high\\\":t=2048;break;case\\\"ultra\\\":t=4096}return t},b.COMMON_SHADERS=[\\\"lambert\\\",\\\"color\\\",\\\"realistic\\\",\\\"hatching\\\",\\\"shadow\\\"],b.createShader=function(e){\\\"ecgl.shadow\\\"===e&&(e=\\\"ecgl.displayShadow\\\");var t=S.source(e+\\\".vertex\\\"),r=S.source(e+\\\".fragment\\\"),t=(t||console.error(\\\"Vertex shader of '%s' not exits\\\",e),r||console.error(\\\"Fragment shader of '%s' not exits\\\",e),new S(t,r));return t.name=e,t},b.createMaterial=function(e,t){t instanceof Array||(t=[t]);var r=b.createShader(e),i=new Fe({shader:r});return t.forEach(function(e){\\\"string\\\"==typeof e&&i.define(e)}),i},b.setMaterialFromModel=function(e,t,r,i){t.autoUpdateTextureStatus=!1;var n=r.getModel(e+\\\"Material\\\"),a=n.get(\\\"detailTexture\\\"),o=E(n.get(\\\"textureTiling\\\"),1),s=E(n.get(\\\"textureOffset\\\"),0),l=(\\\"number\\\"==typeof s&&(s=[s,s]),1<(o=\\\"number\\\"==typeof o?[o,o]:o)[0]||1<o[1]?b.Texture.REPEAT:b.Texture.CLAMP_TO_EDGE),l={anisotropic:8,wrapS:l,wrapT:l};if(\\\"realistic\\\"===e){var h=n.get(\\\"roughness\\\"),u=n.get(\\\"metalness\\\"),c=(null!=u?isNaN(u)&&(t.setTextureImage(\\\"metalnessMap\\\",u,i,l),u=E(n.get(\\\"metalnessAdjust\\\"),.5)):u=0,null!=h?isNaN(h)&&(t.setTextureImage(\\\"roughnessMap\\\",h,i,l),h=E(n.get(\\\"roughnessAdjust\\\"),.5)):h=.5,n.get(\\\"normalTexture\\\"));t.setTextureImage(\\\"detailMap\\\",a,i,l),t.setTextureImage(\\\"normalMap\\\",c,i,l),t.set({roughness:h,metalness:u,detailUvRepeat:o,detailUvOffset:s})}else if(\\\"lambert\\\"===e)t.setTextureImage(\\\"detailMap\\\",a,i,l),t.set({detailUvRepeat:o,detailUvOffset:s});else if(\\\"color\\\"===e)t.setTextureImage(\\\"detailMap\\\",a,i,l),t.set({detailUvRepeat:o,detailUvOffset:s});else if(\\\"hatching\\\"===e){var d=n.get(\\\"hatchingTextures\\\")||[];d.length;for(var f=0;f<6;f++)t.setTextureImage(\\\"hatch\\\"+(f+1),d[f],i,{anisotropic:8,wrapS:b.Texture.REPEAT,wrapT:b.Texture.REPEAT});t.set({detailUvRepeat:o,detailUvOffset:s})}},b.updateVertexAnimation=function(e,t,r,i){var n=i.get(\\\"animation\\\"),a=i.get(\\\"animationDurationUpdate\\\"),o=i.get(\\\"animationEasingUpdate\\\"),s=r.shadowDepthMaterial;if(n&&t&&0<a&&t.geometry.vertexCount===r.geometry.vertexCount){r.material.define(\\\"vertex\\\",\\\"VERTEX_ANIMATION\\\"),r.ignorePreZ=!0,s&&s.define(\\\"vertex\\\",\\\"VERTEX_ANIMATION\\\");for(var l=0;l<e.length;l++)r.geometry.attributes[e[l][0]].value=t.geometry.attributes[e[l][1]].value;r.geometry.dirty(),r.__percent=0,r.material.set(\\\"percent\\\",0),r.stopAnimation(),r.animate().when(a,{__percent:1}).during(function(){r.material.set(\\\"percent\\\",r.__percent),s&&s.set(\\\"percent\\\",r.__percent)}).done(function(){r.ignorePreZ=!1,r.material.undefine(\\\"vertex\\\",\\\"VERTEX_ANIMATION\\\"),s&&s.undefine(\\\"vertex\\\",\\\"VERTEX_ANIMATION\\\")}).start(o)}else r.material.undefine(\\\"vertex\\\",\\\"VERTEX_ANIMATION\\\"),s&&s.undefine(\\\"vertex\\\",\\\"VERTEX_ANIMATION\\\")};const Z=b,Na=\\\"undefined\\\"!=typeof window&&(window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.msRequestAnimationFrame&&window.msRequestAnimationFrame.bind(window)||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(e){return setTimeout(e,16)};x=function(e,t){this.id=e,this.zr=t;try{this.renderer=new Et({clearBit:0,devicePixelRatio:t.painter.dpr,preserveDrawingBuffer:!0,premultipliedAlpha:!0}),this.renderer.resize(t.painter.getWidth(),t.painter.getHeight())}catch(e){return this.renderer=null,this.dom=document.createElement(\\\"div\\\"),this.dom.style.cssText=\\\"position:absolute; left: 0; top: 0; right: 0; bottom: 0;\\\",this.dom.className=\\\"ecgl-nowebgl\\\",this.dom.innerHTML=\\\"Sorry, your browser does not support WebGL\\\",void console.error(e)}this.onglobalout=this.onglobalout.bind(this),t.on(\\\"globalout\\\",this.onglobalout),this.dom=this.renderer.canvas;var r=this.dom.style;r.position=\\\"absolute\\\",r.left=\\\"0\\\",r.top=\\\"0\\\",this.views=[],this._picking=new Sr({renderer:this.renderer}),this._viewsToDispose=[],this._accumulatingId=0,this._zrEventProxy=new F.graphic.Rect({shape:{x:-1,y:-1,width:2,height:2},__isGLToZRProxy:!0}),this._backgroundColor=null,this._disposed=!1};function Ia(e){var t=e.__zr;e.__zr=null,t&&e.removeAnimatorsFromZr&&e.removeAnimatorsFromZr(t)}x.prototype.setUnpainted=function(){},x.prototype.addView=function(e){var t,r;e.layer!==this&&(0<=(t=this._viewsToDispose.indexOf(e))&&this._viewsToDispose.splice(t,1),this.views.push(e),r=(e.layer=this).zr,e.scene.traverse(function(e){e.__zr=r,e.addAnimatorsToZr&&e.addAnimatorsToZr(r)}))},x.prototype.removeView=function(e){var t;e.layer===this&&0<=(t=this.views.indexOf(e))&&(this.views.splice(t,1),e.scene.traverse(Ia,this),e.layer=null,this._viewsToDispose.push(e))},x.prototype.removeViewsAll=function(){this.views.forEach(function(e){e.scene.traverse(Ia,this),e.layer=null,this._viewsToDispose.push(e)},this),this.views.length=0},x.prototype.resize=function(e,t){this.renderer.resize(e,t)},x.prototype.clear=function(){var e=this.renderer.gl,t=this._backgroundColor||[0,0,0,0];e.clearColor(t[0],t[1],t[2],t[3]),e.depthMask(!0),e.colorMask(!0,!0,!0,!0),e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT)},x.prototype.clearDepth=function(){var e=this.renderer.gl;e.clear(e.DEPTH_BUFFER_BIT)},x.prototype.clearColor=function(){var e=this.renderer.gl;e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)},x.prototype.needsRefresh=function(){this.zr.refresh()},x.prototype.refresh=function(e){this._backgroundColor=e?Z.parseColor(e):[0,0,0,0],this.renderer.clearColor=this._backgroundColor;for(var t=0;t<this.views.length;t++)this.views[t].prepareRender(this.renderer);for(this._doRender(!1),this._trackAndClean(),t=0;t<this._viewsToDispose.length;t++)this._viewsToDispose[t].dispose(this.renderer);this._viewsToDispose.length=0,this._startAccumulating()},x.prototype.renderToCanvas=function(e){this._startAccumulating(!0),e.drawImage(this.dom,0,0,e.canvas.width,e.canvas.height)},x.prototype._doRender=function(e){this.clear(),this.renderer.saveViewport();for(var t=0;t<this.views.length;t++)this.views[t].render(this.renderer,e);this.renderer.restoreViewport()},x.prototype._stopAccumulating=function(){this._accumulatingId=0,clearTimeout(this._accumulatingTimeout)};var Ra=1;function Ba(e){for(var t=0;t<e.length;t++)e[t].__used__=0}function Fa(e,t){for(var r=0;r<t.length;r++)t[r].__used__||t[r].dispose(e)}function za(e,t){e.__used__=e.__used__||0,e.__used__++,1===e.__used__&&t.push(e)}x.prototype._startAccumulating=function(i){var n=this;this._stopAccumulating();for(var a=!1,e=0;e<this.views.length;e++)a=this.views[e].needsAccumulate()||a;function o(e){if(n._accumulatingId&&e===n._accumulatingId){for(var t=!0,r=0;r<n.views.length;r++)t=n.views[r].isAccumulateFinished()&&a;t||(n._doRender(!0),i?o(e):Na(function(){o(e)}))}}a&&(this._accumulatingId=Ra++,i?o(n._accumulatingId):this._accumulatingTimeout=setTimeout(function(){o(n._accumulatingId)},50))},x.prototype._trackAndClean=function(){var e=[],t=[];this._textureList&&(Ba(this._textureList),Ba(this._geometriesList));for(var r=0;r<this.views.length;r++)!function(e,l,h){var u,c;e.traverse(function(e){if(e.isRenderable()){var t=e.geometry,r=e.material;if(r!==u)for(var i=r.getTextureUniforms(),n=0;n<i.length;n++){var a=i[n],o=r.uniforms[a].value;if(o)if(o instanceof B)za(o,l);else if(o instanceof Array)for(var s=0;s<o.length;s++)o[s]instanceof B&&za(o[s],l)}t!==c&&za(t,h),u=r,c=t}});for(var t=0;t<e.lights.length;t++)e.lights[t].cubemap&&za(e.lights[t].cubemap,l)}(this.views[r].scene,e,t);this._textureList&&(Fa(this.renderer,this._textureList),Fa(this.renderer,this._geometriesList)),this._textureList=e,this._geometriesList=t},x.prototype.dispose=function(){this._disposed||(this._stopAccumulating(),this._textureList&&(Ba(this._textureList),Ba(this._geometriesList),Fa(this.renderer,this._textureList),Fa(this.renderer,this._geometriesList)),this.zr.off(\\\"globalout\\\",this.onglobalout),this._disposed=!0)},x.prototype.onmousedown=function(e){var t;e.target&&e.target.__isGLToZRProxy||(e=e.event,(t=this.pickObject(e.offsetX,e.offsetY))&&(this._dispatchEvent(\\\"mousedown\\\",e,t),this._dispatchDataEvent(\\\"mousedown\\\",e,t)),this._downX=e.offsetX,this._downY=e.offsetY)},x.prototype.onmousemove=function(e){var t,r,i;e.target&&e.target.__isGLToZRProxy||(e=e.event,r=(t=this.pickObject(e.offsetX,e.offsetY))&&t.target,i=this._hovered,this._hovered=t,i&&r!==i.target&&(i.relatedTarget=r,this._dispatchEvent(\\\"mouseout\\\",e,i),this.zr.setCursorStyle(\\\"default\\\")),this._dispatchEvent(\\\"mousemove\\\",e,t),t&&(this.zr.setCursorStyle(\\\"pointer\\\"),i&&r===i.target||this._dispatchEvent(\\\"mouseover\\\",e,t)),this._dispatchDataEvent(\\\"mousemove\\\",e,t))},x.prototype.onmouseup=function(e){var t;e.target&&e.target.__isGLToZRProxy||(e=e.event,(t=this.pickObject(e.offsetX,e.offsetY))&&(this._dispatchEvent(\\\"mouseup\\\",e,t),this._dispatchDataEvent(\\\"mouseup\\\",e,t)),this._upX=e.offsetX,this._upY=e.offsetY)},x.prototype.onclick=x.prototype.dblclick=function(e){var t,r;e.target&&e.target.__isGLToZRProxy||(t=this._upX-this._downX,r=this._upY-this._downY,20<Math.sqrt(t*t+r*r))||(e=e.event,(t=this.pickObject(e.offsetX,e.offsetY))&&(this._dispatchEvent(e.type,e,t),this._dispatchDataEvent(e.type,e,t)),(r=this._clickToSetFocusPoint(e))&&r.view.setDOFFocusOnPoint(r.distance)&&this.zr.refresh())},x.prototype._clickToSetFocusPoint=function(e){for(var t=this.renderer,r=t.viewport,i=this.views.length-1;0<=i;i--){var n=this.views[i];if(n.hasDOF()&&n.containPoint(e.offsetX,e.offsetY)){this._picking.scene=n.scene,this._picking.camera=n.camera,t.viewport=n.viewport;var a=this._picking.pick(e.offsetX,e.offsetY,!0);if(a)return a.view=n,a}}t.viewport=r},x.prototype.onglobalout=function(e){var t=this._hovered;t&&this._dispatchEvent(\\\"mouseout\\\",e,{target:t.target})},x.prototype.pickObject=function(e,t){for(var r=[],i=this.renderer,n=i.viewport,a=0;a<this.views.length;a++){var o=this.views[a];o.containPoint(e,t)&&(this._picking.scene=o.scene,this._picking.camera=o.camera,i.viewport=o.viewport,this._picking.pickAll(e,t,r))}return i.viewport=n,r.sort(function(e,t){return e.distance-t.distance}),r[0]},x.prototype._dispatchEvent=function(e,t,r){var i=(r=r||{}).target;for(r.cancelBubble=!1,r.event=t,r.type=e,r.offsetX=t.offsetX,r.offsetY=t.offsetY;i&&(i.trigger(e,r),i=i.getParent(),!r.cancelBubble););this._dispatchToView(e,r)},x.prototype._dispatchDataEvent=function(e,t,r){var i=r&&r.target,n=i&&i.dataIndex,a=i&&i.seriesIndex,i=i&&i.eventData,o=!1,s=this._zrEventProxy,l=(s.x=t.offsetX,s.y=t.offsetY,s.update(),{target:s}),s=F.helper.getECData(s);\\\"mousemove\\\"===e&&(null!=n?n!==this._lastDataIndex&&(0<=parseInt(this._lastDataIndex,10)&&(s.dataIndex=this._lastDataIndex,s.seriesIndex=this._lastSeriesIndex,this.zr.handler.dispatchToElement(l,\\\"mouseout\\\",t)),o=!0):null!=i&&i!==this._lastEventData&&(null!=this._lastEventData&&(s.eventData=this._lastEventData,this.zr.handler.dispatchToElement(l,\\\"mouseout\\\",t)),o=!0),this._lastEventData=i,this._lastDataIndex=n,this._lastSeriesIndex=a),s.eventData=i,s.dataIndex=n,s.seriesIndex=a,(null!=i||0<=parseInt(n,10)&&0<=parseInt(a,10))&&(this.zr.handler.dispatchToElement(l,e,t),o)&&this.zr.handler.dispatchToElement(l,\\\"mouseover\\\",t)},x.prototype._dispatchToView=function(e,t){for(var r=0;r<this.views.length;r++)this.views[r].containPoint(t.offsetX,t.offsetY)&&this.views[r].trigger(e,t)},Object.assign(x.prototype,V);const Ga=x;var Ua=[\\\"bar3D\\\",\\\"line3D\\\",\\\"map3D\\\",\\\"scatter3D\\\",\\\"surface\\\",\\\"lines3D\\\",\\\"scatterGL\\\",\\\"scatter3D\\\"];function ka(e,t){var r,i;e&&e[t]&&(e[t].normal||e[t].emphasis)&&(r=e[t].normal,i=e[t].emphasis,r&&(e[t]=r),i)&&(e.emphasis=e.emphasis||{},e.emphasis[t]=i)}function Va(e){e&&(e instanceof Array||(e=[e]),F.util.each(e,function(e){var t;e.axisLabel&&(t=e.axisLabel,Object.assign(t,t.textStyle),t.textStyle=null)}))}function Ha(e){this._layers={},this._zr=e}Ha.prototype.update=function(a,o){var n=this,s=o.getZr();if(s.getWidth()&&s.getHeight()){for(var e in this._layers)this._layers[e].removeViewsAll();a.eachComponent(function(e,t){if(\\\"series\\\"!==e){var r=o.getViewOfComponentModel(t),i=t.coordinateSystem;if(r.__ecgl__){if(i){if(!i.viewGL)return void console.error(\\\"Can't find viewGL in coordinateSystem of component \\\"+t.id)}else if(!t.viewGL)return void console.error(\\\"Can't find viewGL of component \\\"+t.id);var n=i.viewGL,n=i.viewGL,i=l(t);i.addView(n),r.afterRender&&r.afterRender(t,a,o,i),h(r.groupGL,t.get(\\\"silent\\\"))}}}),a.eachSeries(function(e){var t,r=o.getViewOfSeriesModel(e),i=e.coordinateSystem;r.__ecgl__&&(!i||i.viewGL||r.viewGL?(i=i&&i.viewGL||r.viewGL,(t=l(e)).addView(i),r.afterRender&&r.afterRender(e,a,o,t),h(r.groupGL,e.get(\\\"silent\\\"))):console.error(\\\"Can't find viewGL of series \\\"+r.id))})}else console.warn(\\\"Dom has no width or height\\\");function l(e){s.setSleepAfterStill(0),e.coordinateSystem&&e.coordinateSystem.model,t=e.get(\\\"zlevel\\\");var t,r=n._layers,i=r[t];return i||(i=r[t]=new Ga(\\\"gl-\\\"+t,s),s.painter.isSingleCanvas()&&(i.virtual=!0,r=new F.graphic.Image({z:1e4,style:{image:i.renderer.canvas},silent:!0}),i.__hostImage=r,s.add(r)),s.painter.insertLayer(t,i)),i.__hostImage&&i.__hostImage.setStyle({width:i.renderer.getWidth(),height:i.renderer.getHeight()}),i}function h(e,t){e&&e.traverse(function(e){e.isRenderable&&e.isRenderable()&&(e.ignorePicking=null!=e.$ignorePicking?e.$ignorePicking:t)})}},F.registerPostInit(function(e){var t=e.getZr(),r=t.painter.dispose;t.painter.dispose=function(){this.eachOtherLayer(function(e){e instanceof Ga&&e.dispose()}),r.call(this)},t.painter.getRenderedCanvas=function(e){if(e=e||{},this._singleCanvas)return this._layers[0].dom;var t=document.createElement(\\\"canvas\\\"),r=e.pixelRatio||this.dpr,s=(t.width=this.getWidth()*r,t.height=this.getHeight()*r,t.getContext(\\\"2d\\\"));s.dpr=r,s.clearRect(0,0,t.width,t.height),e.backgroundColor&&(s.fillStyle=e.backgroundColor,s.fillRect(0,0,t.width,t.height));var i,n=this.storage.getDisplayList(!0),a={},l=this;function o(e,t){var r,i=l._zlevelList;null==e&&(e=-1/0);for(var n=0;n<i.length;n++){var a=i[n],o=l._layers[a];if(!o.__builtin__&&e<a&&a<t){r=o;break}}r&&r.renderToCanvas&&(s.save(),r.renderToCanvas(s),s.restore())}for(var h={ctx:s},u=0;u<n.length;u++){var c=n[u];c.zlevel!==i&&(o(i,c.zlevel),i=c.zlevel),this._doPaintEl(c,h,!0,null,a)}return o(i,1/0),t}}),F.registerPostUpdate(function(e,t){var r=t.getZr();(r.__egl=r.__egl||new Ha(r)).update(e,t)}),F.registerPreprocessor(function(r){F.util.each(r.series,function(e){var t;0<=F.util.indexOf(Ua,e.type)&&(ka(t=e,\\\"itemStyle\\\"),ka(t,\\\"lineStyle\\\"),ka(t,\\\"areaStyle\\\"),ka(t,\\\"label\\\"),\\\"mapbox\\\"===e.coordinateSystem)&&(e.coordinateSystem=\\\"mapbox3D\\\",r.mapbox3D=r.mapbox)}),Va(r.xAxis3D),Va(r.yAxis3D),Va(r.zAxis3D),Va(r.grid3D),ka(r.geo3D)});s={defaultOption:{viewControl:{projection:\\\"perspective\\\",autoRotate:!1,autoRotateDirection:\\\"cw\\\",autoRotateSpeed:10,autoRotateAfterStill:3,damping:.8,rotateSensitivity:1,zoomSensitivity:1,panSensitivity:1,panMouseButton:\\\"middle\\\",rotateMouseButton:\\\"left\\\",distance:150,minDistance:40,maxDistance:400,orthographicSize:150,maxOrthographicSize:400,minOrthographicSize:20,center:[0,0,0],alpha:0,beta:0,minAlpha:-90,maxAlpha:90}},setView:function(e){e=e||{},this.option.viewControl=this.option.viewControl||{},null!=e.alpha&&(this.option.viewControl.alpha=e.alpha),null!=e.beta&&(this.option.viewControl.beta=e.beta),null!=e.distance&&(this.option.viewControl.distance=e.distance),null!=e.center&&(this.option.viewControl.center=e.center)}},v={defaultOption:{postEffect:{enable:!1,bloom:{enable:!0,intensity:.1},depthOfField:{enable:!1,focalRange:20,focalDistance:50,blurRadius:10,fstop:2.8,quality:\\\"medium\\\"},screenSpaceAmbientOcclusion:{enable:!1,radius:2,quality:\\\"medium\\\",intensity:1},screenSpaceReflection:{enable:!1,quality:\\\"medium\\\",maxRoughness:.8},colorCorrection:{enable:!0,exposure:0,brightness:0,contrast:1,saturation:1,lookupTexture:\\\"\\\"},edge:{enable:!1},FXAA:{enable:!1}},temporalSuperSampling:{enable:\\\"auto\\\"}}},e={defaultOption:{light:{main:{shadow:!1,shadowQuality:\\\"high\\\",color:\\\"#fff\\\",intensity:1,alpha:0,beta:0},ambient:{color:\\\"#fff\\\",intensity:.2},ambientCubemap:{texture:null,exposure:1,diffuseIntensity:.5,specularIntensity:.5}}}},Dn=F.ComponentModel.extend({type:\\\"grid3D\\\",dependencies:[\\\"xAxis3D\\\",\\\"yAxis3D\\\",\\\"zAxis3D\\\"],defaultOption:{show:!0,zlevel:-10,left:0,top:0,width:\\\"100%\\\",height:\\\"100%\\\",environment:\\\"auto\\\",boxWidth:100,boxHeight:100,boxDepth:100,axisPointer:{show:!0,lineStyle:{color:\\\"rgba(0, 0, 0, 0.8)\\\",width:1},label:{show:!0,formatter:null,margin:8,textStyle:{fontSize:14,color:\\\"#fff\\\",backgroundColor:\\\"rgba(0,0,0,0.5)\\\",padding:3,borderRadius:3}}},axisLine:{show:!0,lineStyle:{color:\\\"#333\\\",width:2,type:\\\"solid\\\"}},axisTick:{show:!0,inside:!1,length:3,lineStyle:{width:1}},axisLabel:{show:!0,inside:!1,rotate:0,margin:8,textStyle:{fontSize:12}},splitLine:{show:!0,lineStyle:{color:[\\\"#ccc\\\"],width:1,type:\\\"solid\\\"}},splitArea:{show:!1,areaStyle:{color:[\\\"rgba(250,250,250,0.3)\\\",\\\"rgba(200,200,200,0.3)\\\"]}},light:{main:{alpha:30,beta:40},ambient:{intensity:.4}},viewControl:{alpha:20,beta:40,autoRotate:!1,distance:200,minDistance:40,maxDistance:400}}});F.util.merge(Dn.prototype,s),F.util.merge(Dn.prototype,v),F.util.merge(Dn.prototype,e);const Wa=Dn;function ja(e,t){switch(e){case\\\"center\\\":case\\\"middle\\\":e=\\\"50%\\\";break;case\\\"left\\\":case\\\"top\\\":e=\\\"0%\\\";break;case\\\"right\\\":case\\\"bottom\\\":e=\\\"100%\\\"}return\\\"string\\\"==typeof e?e.replace(/^\\\\s+|\\\\s+$/g,\\\"\\\").match(/%$/)?parseFloat(e)/100*t:parseFloat(e):null==e?NaN:+e}function Xa(){var t=\\\"__ec_inner_\\\"+qa++;return function(e){return e[t]||(e[t]={})}}var qa=Math.round(9*Math.random()),Za={};function Ya(e,t,r,i,n){var a={},o=a,s=e,l=0,h=i,u=n;l=r||Za;var c,d,f=s.ecModel,p=f&&f.option.textStyle,m=function(e){for(;e&&e!==e.ecModel;){var t=(e.option||Za).rich;if(t)for(var r=r||{},i=ia(t),n=0;n<i.length;n++)r[i[n]]=1;e=e.parentModel}return r}(s);if(m)for(var g in c={},m)m.hasOwnProperty(g)&&(d=s.getModel([\\\"rich\\\",g]),$a(c[g]={},d,p,l,h,u,!1,!0));return c&&(o.rich=c),(f=s.get(\\\"overflow\\\"))&&(o.overflow=f),null!=(f=s.get(\\\"minMargin\\\"))&&(o.margin=f),$a(o,s,p,l,h,u,!0,!1),t&&Jn(a,t),a}var Ka=[\\\"fontStyle\\\",\\\"fontWeight\\\",\\\"fontSize\\\",\\\"fontFamily\\\",\\\"textShadowColor\\\",\\\"textShadowBlur\\\",\\\"textShadowOffsetX\\\",\\\"textShadowOffsetY\\\"],Qa=[\\\"align\\\",\\\"lineHeight\\\",\\\"width\\\",\\\"height\\\",\\\"tag\\\",\\\"verticalAlign\\\"],Ja=[\\\"padding\\\",\\\"borderWidth\\\",\\\"borderRadius\\\",\\\"borderDashOffset\\\",\\\"backgroundColor\\\",\\\"borderColor\\\",\\\"shadowColor\\\",\\\"shadowBlur\\\",\\\"shadowOffsetX\\\",\\\"shadowOffsetY\\\"];function $a(e,t,r,i,n,a,o,s){r=!n&&r||Za;var l=i&&i.inheritColor,h=t.getShallow(\\\"color\\\"),u=t.getShallow(\\\"textBorderColor\\\"),c=aa(t.getShallow(\\\"opacity\\\"),r.opacity),h=(\\\"inherit\\\"!==h&&\\\"auto\\\"!==h||(h=l||null),\\\"inherit\\\"!==u&&\\\"auto\\\"!==u||(u=l||null),a||(h=h||r.color,u=u||r.textBorderColor),null!=h&&(e.fill=h),null!=u&&(e.stroke=u),aa(t.getShallow(\\\"textBorderWidth\\\"),r.textBorderWidth)),u=(null!=h&&(e.lineWidth=h),aa(t.getShallow(\\\"textBorderType\\\"),r.textBorderType)),h=(null!=u&&(e.lineDash=u),aa(t.getShallow(\\\"textBorderDashOffset\\\"),r.textBorderDashOffset));null!=h&&(e.lineDashOffset=h),null!=(c=n||null!=c||s?c:i&&i.defaultOpacity)&&(e.opacity=c),n||a||null==e.fill&&i.inheritColor&&(e.fill=i.inheritColor);for(var d=0;d<Ka.length;d++){var f=Ka[d];null!=(p=aa(t.getShallow(f),r[f]))&&(e[f]=p)}for(d=0;d<Qa.length;d++)f=Qa[d],null!=(p=t.getShallow(f))&&(e[f]=p);if(null==e.verticalAlign&&null!=(u=t.getShallow(\\\"baseline\\\"))&&(e.verticalAlign=u),!o||!i.disableBox){for(d=0;d<Ja.length;d++){var p,f=Ja[d];null!=(p=t.getShallow(f))&&(e[f]=p)}h=t.getShallow(\\\"borderType\\\");null!=h&&(e.borderDash=h),\\\"auto\\\"!==e.backgroundColor&&\\\"inherit\\\"!==e.backgroundColor||!l||(e.backgroundColor=l),\\\"auto\\\"!==e.borderColor&&\\\"inherit\\\"!==e.borderColor||!l||(e.borderColor=l)}}Xa();var eo=E,to={left:0,middle:1,right:2};function ro(e){return e=e instanceof Array?e:[e,e]}x=N.extend(function(){return{zr:null,viewGL:null,_center:new z,minDistance:.5,maxDistance:1.5,maxOrthographicSize:300,minOrthographicSize:30,minAlpha:-90,maxAlpha:90,minBeta:-1/0,maxBeta:1/0,autoRotateAfterStill:0,autoRotateDirection:\\\"cw\\\",autoRotateSpeed:60,damping:.8,rotateSensitivity:1,zoomSensitivity:1,panSensitivity:1,panMouseButton:\\\"middle\\\",rotateMouseButton:\\\"left\\\",_mode:\\\"rotate\\\",_camera:null,_needsUpdate:!1,_rotating:!1,_phi:0,_theta:0,_mouseX:0,_mouseY:0,_rotateVelocity:new ke,_panVelocity:new ke,_distance:500,_zoomSpeed:0,_stillTimeout:0,_animators:[]}},function(){[\\\"_mouseDownHandler\\\",\\\"_mouseWheelHandler\\\",\\\"_mouseMoveHandler\\\",\\\"_mouseUpHandler\\\",\\\"_pinchHandler\\\",\\\"_contextMenuHandler\\\",\\\"_update\\\"].forEach(function(e){this[e]=this[e].bind(this)},this)},{init:function(){var e=this.zr;e&&(e.on(\\\"mousedown\\\",this._mouseDownHandler),e.on(\\\"globalout\\\",this._mouseUpHandler),e.on(\\\"mousewheel\\\",this._mouseWheelHandler),e.on(\\\"pinch\\\",this._pinchHandler),e.animation.on(\\\"frame\\\",this._update),e.dom.addEventListener(\\\"contextmenu\\\",this._contextMenuHandler))},dispose:function(){var e=this.zr;e&&(e.off(\\\"mousedown\\\",this._mouseDownHandler),e.off(\\\"mousemove\\\",this._mouseMoveHandler),e.off(\\\"mouseup\\\",this._mouseUpHandler),e.off(\\\"mousewheel\\\",this._mouseWheelHandler),e.off(\\\"pinch\\\",this._pinchHandler),e.off(\\\"globalout\\\",this._mouseUpHandler),e.dom.removeEventListener(\\\"contextmenu\\\",this._contextMenuHandler),e.animation.off(\\\"frame\\\",this._update)),this.stopAllAnimation()},getDistance:function(){return this._distance},setDistance:function(e){this._distance=e,this._needsUpdate=!0},getOrthographicSize:function(){return this._orthoSize},setOrthographicSize:function(e){this._orthoSize=e,this._needsUpdate=!0},getAlpha:function(){return this._theta/Math.PI*180},getBeta:function(){return-this._phi/Math.PI*180},getCenter:function(){return this._center.toArray()},setAlpha:function(e){e=Math.max(Math.min(this.maxAlpha,e),this.minAlpha),this._theta=e/180*Math.PI,this._needsUpdate=!0},setBeta:function(e){e=Math.max(Math.min(this.maxBeta,e),this.minBeta),this._phi=-e/180*Math.PI,this._needsUpdate=!0},setCenter:function(e){this._center.setArray(e)},setViewGL:function(e){this.viewGL=e},getCamera:function(){return this.viewGL.camera},setFromViewControlModel:function(t,e){var r=(e=e||{}).baseDistance||0,i=e.baseOrthoSize||1,n=t.get(\\\"projection\\\"),n=(this._projection=n=\\\"perspective\\\"!==n&&\\\"orthographic\\\"!==n&&\\\"isometric\\\"!==n?\\\"perspective\\\":n,this.viewGL.setProjection(n),t.get(\\\"distance\\\")+r),a=t.get(\\\"orthographicSize\\\")+i,o=([[\\\"damping\\\",.8],[\\\"autoRotate\\\",!1],[\\\"autoRotateAfterStill\\\",3],[\\\"autoRotateDirection\\\",\\\"cw\\\"],[\\\"autoRotateSpeed\\\",10],[\\\"minDistance\\\",30],[\\\"maxDistance\\\",400],[\\\"minOrthographicSize\\\",30],[\\\"maxOrthographicSize\\\",300],[\\\"minAlpha\\\",-90],[\\\"maxAlpha\\\",90],[\\\"minBeta\\\",-1/0],[\\\"maxBeta\\\",1/0],[\\\"rotateSensitivity\\\",1],[\\\"zoomSensitivity\\\",1],[\\\"panSensitivity\\\",1],[\\\"panMouseButton\\\",\\\"left\\\"],[\\\"rotateMouseButton\\\",\\\"middle\\\"]].forEach(function(e){this[e[0]]=eo(t.get(e[0]),e[1])},this),this.minDistance+=r,this.maxDistance+=r,this.minOrthographicSize+=i,this.maxOrthographicSize+=i,t.ecModel),s={},r=([\\\"animation\\\",\\\"animationDurationUpdate\\\",\\\"animationEasingUpdate\\\"].forEach(function(e){s[e]=eo(t.get(e),o&&o.get(e))}),eo(e.alpha,t.get(\\\"alpha\\\"))||0),i=eo(e.beta,t.get(\\\"beta\\\"))||0,l=eo(e.center,t.get(\\\"center\\\"))||[0,0,0];s.animation&&0<s.animationDurationUpdate&&this._notFirst?this.animateTo({alpha:r,beta:i,center:l,distance:n,orthographicSize:a,easing:s.animationEasingUpdate,duration:s.animationDurationUpdate}):(this.setDistance(n),this.setAlpha(r),this.setBeta(i),this.setCenter(l),this.setOrthographicSize(a)),this._notFirst=!0,this._validateProperties()},_validateProperties:function(){},animateTo:function(e){var t=this.zr,r=this,i={},n={};return null!=e.distance&&(i.distance=this.getDistance(),n.distance=e.distance),null!=e.orthographicSize&&(i.orthographicSize=this.getOrthographicSize(),n.orthographicSize=e.orthographicSize),null!=e.alpha&&(i.alpha=this.getAlpha(),n.alpha=e.alpha),null!=e.beta&&(i.beta=this.getBeta(),n.beta=e.beta),null!=e.center&&(i.center=this.getCenter(),n.center=e.center),this._addAnimator(t.animation.animate(i).when(e.duration||1e3,n).during(function(){null!=i.alpha&&r.setAlpha(i.alpha),null!=i.beta&&r.setBeta(i.beta),null!=i.distance&&r.setDistance(i.distance),null!=i.center&&r.setCenter(i.center),null!=i.orthographicSize&&r.setOrthographicSize(i.orthographicSize),r._needsUpdate=!0})).start(e.easing||\\\"linear\\\")},stopAllAnimation:function(){for(var e=0;e<this._animators.length;e++)this._animators[e].stop();this._animators.length=0},update:function(){this._needsUpdate=!0,this._update(20)},_isAnimating:function(){return 0<this._animators.length},_update:function(e){var t;this._rotating?(t=(\\\"cw\\\"===this.autoRotateDirection?1:-1)*this.autoRotateSpeed/180*Math.PI,this._phi-=t*e/1e3,this._needsUpdate=!0):0<this._rotateVelocity.len()&&(this._needsUpdate=!0),(.1<Math.abs(this._zoomSpeed)||0<this._panVelocity.len())&&(this._needsUpdate=!0),this._needsUpdate&&(e=Math.min(e,50),this._updateDistanceOrSize(e),this._updatePan(e),this._updateRotate(e),this._updateTransform(),this.getCamera().update(),this.zr&&this.zr.refresh(),this.trigger(\\\"update\\\"),this._needsUpdate=!1)},_updateRotate:function(e){var t=this._rotateVelocity;this._phi=t.y*e/20+this._phi,this._theta=t.x*e/20+this._theta,this.setAlpha(this.getAlpha()),this.setBeta(this.getBeta()),this._vectorDamping(t,Math.pow(this.damping,e/16))},_updateDistanceOrSize:function(e){\\\"perspective\\\"===this._projection?this._setDistance(this._distance+this._zoomSpeed*e/20):this._setOrthoSize(this._orthoSize+this._zoomSpeed*e/20),this._zoomSpeed*=Math.pow(this.damping,e/16)},_setDistance:function(e){this._distance=Math.max(Math.min(e,this.maxDistance),this.minDistance)},_setOrthoSize:function(e){this._orthoSize=Math.max(Math.min(e,this.maxOrthographicSize),this.minOrthographicSize);var t=this.getCamera(),r=this._orthoSize,i=r/this.viewGL.viewport.height*this.viewGL.viewport.width;t.left=-i/2,t.right=i/2,t.top=r/2,t.bottom=-r/2},_updatePan:function(e){var t=this._panVelocity,r=this._distance,i=this.getCamera(),n=i.worldTransform.y,i=i.worldTransform.x;this._center.scaleAndAdd(i,-t.x*r/200).scaleAndAdd(n,-t.y*r/200),this._vectorDamping(t,0)},_updateTransform:function(){var e=this.getCamera(),t=new z,r=this._theta+Math.PI/2,i=this._phi+Math.PI/2,n=Math.sin(r);t.x=n*Math.cos(i),t.y=-Math.cos(r),t.z=n*Math.sin(i),e.position.copy(this._center).scaleAndAdd(t,this._distance),e.rotation.identity().rotateY(-this._phi).rotateX(-this._theta)},_startCountingStill:function(){clearTimeout(this._stillTimeout);var e=this.autoRotateAfterStill,t=this;!isNaN(e)&&0<e&&(this._stillTimeout=setTimeout(function(){t._rotating=!0},1e3*e))},_vectorDamping:function(e,t){var r=e.len();(r*=t)<1e-4&&(r=0),e.normalize().scale(r)},_decomposeTransform:function(){var e,t;this.getCamera()&&(this.getCamera().updateWorldTransform(),t=this.getCamera().worldTransform.z,e=Math.asin(t.y),t=Math.atan2(t.x,t.z),this._theta=e,this._phi=-t,this.setBeta(this.getBeta()),this.setAlpha(this.getAlpha()),this.getCamera().aspect?this._setDistance(this.getCamera().position.dist(this._center)):this._setOrthoSize(this.getCamera().top-this.getCamera().bottom))},_mouseDownHandler:function(e){var t,r;e.target||this._isAnimating()||(t=e.offsetX,r=e.offsetY,this.viewGL&&!this.viewGL.containPoint(t,r))||(this.zr.on(\\\"mousemove\\\",this._mouseMoveHandler),this.zr.on(\\\"mouseup\\\",this._mouseUpHandler),e.event.targetTouches?1===e.event.targetTouches.length&&(this._mode=\\\"rotate\\\"):e.event.button===to[this.rotateMouseButton]?this._mode=\\\"rotate\\\":e.event.button===to[this.panMouseButton]?this._mode=\\\"pan\\\":this._mode=\\\"\\\",this._rotateVelocity.set(0,0),this._rotating=!1,this.autoRotate&&this._startCountingStill(),this._mouseX=e.offsetX,this._mouseY=e.offsetY)},_mouseMoveHandler:function(e){var t,r;e.target&&e.target.__isGLToZRProxy||this._isAnimating()||(t=ro(this.panSensitivity),r=ro(this.rotateSensitivity),\\\"rotate\\\"===this._mode?(this._rotateVelocity.y=(e.offsetX-this._mouseX)/this.zr.getHeight()*2*r[0],this._rotateVelocity.x=(e.offsetY-this._mouseY)/this.zr.getWidth()*2*r[1]):\\\"pan\\\"===this._mode&&(this._panVelocity.x=(e.offsetX-this._mouseX)/this.zr.getWidth()*t[0]*400,this._panVelocity.y=(-e.offsetY+this._mouseY)/this.zr.getHeight()*t[1]*400),this._mouseX=e.offsetX,this._mouseY=e.offsetY,e.event.preventDefault())},_mouseWheelHandler:function(e){var t;this._isAnimating()||(t=e.event.wheelDelta||-e.event.detail,this._zoomHandler(e,t))},_pinchHandler:function(e){this._isAnimating()||(this._zoomHandler(e,1<e.pinchScale?1:-1),this._mode=\\\"\\\")},_zoomHandler:function(e,t){var r,i;0!==t&&(r=e.offsetX,i=e.offsetY,this.viewGL&&!this.viewGL.containPoint(r,i)||(r=\\\"perspective\\\"===this._projection?Math.max(Math.max(Math.min(this._distance-this.minDistance,this.maxDistance-this._distance))/20,.5):Math.max(Math.max(Math.min(this._orthoSize-this.minOrthographicSize,this.maxOrthographicSize-this._orthoSize))/20,.5),this._zoomSpeed=(0<t?-1:1)*r*this.zoomSensitivity,this._rotating=!1,this.autoRotate&&\\\"rotate\\\"===this._mode&&this._startCountingStill(),e.event.preventDefault()))},_mouseUpHandler:function(){this.zr.off(\\\"mousemove\\\",this._mouseMoveHandler),this.zr.off(\\\"mouseup\\\",this._mouseUpHandler)},_isRightMouseButtonUsed:function(){return\\\"right\\\"===this.rotateMouseButton||\\\"right\\\"===this.panMouseButton},_contextMenuHandler:function(e){this._isRightMouseButtonUsed()&&e.preventDefault()},_addAnimator:function(t){var r=this._animators;return r.push(t),t.done(function(){var e=r.indexOf(t);0<=e&&r.splice(e,1)}),t}});Object.defineProperty(x.prototype,\\\"autoRotate\\\",{get:function(e){return this._autoRotate},set:function(e){this._autoRotate=e,this._rotating=e}});const io=x,no={convertToDynamicArray:function(e){e&&this.resetOffset();var t,r=this.attributes;for(t in r)e||!r[t].value?r[t].value=[]:r[t].value=Array.prototype.slice.call(r[t].value);e||!this.indices?this.indices=[]:this.indices=Array.prototype.slice.call(this.indices)},convertToTypedArray:function(){var e,t=this.attributes;for(e in t)t[e].value&&0<t[e].value.length?t[e].value=new Float32Array(t[e].value):t[e].value=null;this.indices&&0<this.indices.length&&(this.indices=new(65535<this.vertexCount?Uint32Array:Uint16Array)(this.indices)),this.dirty()}},ao={vec2:n,vec3:R,vec4:o,mat2:Sn,mat2d:An,mat3:l,mat4:G,quat:c};var oo=ao.vec3,so=[[0,0],[1,1]],Dn=_.extend(function(){return{segmentScale:1,dynamic:!0,useNativeLine:!0,attributes:{position:new _.Attribute(\\\"position\\\",\\\"float\\\",3,\\\"POSITION\\\"),positionPrev:new _.Attribute(\\\"positionPrev\\\",\\\"float\\\",3),positionNext:new _.Attribute(\\\"positionNext\\\",\\\"float\\\",3),prevPositionPrev:new _.Attribute(\\\"prevPositionPrev\\\",\\\"float\\\",3),prevPosition:new _.Attribute(\\\"prevPosition\\\",\\\"float\\\",3),prevPositionNext:new _.Attribute(\\\"prevPositionNext\\\",\\\"float\\\",3),offset:new _.Attribute(\\\"offset\\\",\\\"float\\\",1),color:new _.Attribute(\\\"color\\\",\\\"float\\\",4,\\\"COLOR\\\")}}},{resetOffset:function(){this._vertexOffset=0,this._triangleOffset=0,this._itemVertexOffsets=[]},setVertexCount:function(e){var t=this.attributes;this.vertexCount!==e&&(t.position.init(e),t.color.init(e),this.useNativeLine||(t.positionPrev.init(e),t.positionNext.init(e),t.offset.init(e)),65535<e?this.indices instanceof Uint16Array&&(this.indices=new Uint32Array(this.indices)):this.indices instanceof Uint32Array&&(this.indices=new Uint16Array(this.indices)))},setTriangleCount:function(e){this.triangleCount!==e&&(this.indices=0===e?null:new(65535<this.vertexCount?Uint32Array:Uint16Array)(3*e))},_getCubicCurveApproxStep:function(e,t,r,i){return 1/(oo.dist(e,t)+oo.dist(r,t)+oo.dist(i,r)+1)*this.segmentScale},getCubicCurveVertexCount:function(e,t,r,i){var n=this._getCubicCurveApproxStep(e,t,r,i),n=Math.ceil(1/n);return this.useNativeLine?2*n:2*n+2},getCubicCurveTriangleCount:function(e,t,r,i){var n=this._getCubicCurveApproxStep(e,t,r,i),n=Math.ceil(1/n);return this.useNativeLine?0:2*n},getLineVertexCount:function(){return this.getPolylineVertexCount(so)},getLineTriangleCount:function(){return this.getPolylineTriangleCount(so)},getPolylineVertexCount:function(e){var t=\\\"number\\\"==typeof e?e:\\\"number\\\"!=typeof e[0]?e.length:e.length/3;return this.useNativeLine?2*(t-1):2*(t-1)+2},getPolylineTriangleCount:function(e){var t=\\\"number\\\"==typeof e?e:\\\"number\\\"!=typeof e[0]?e.length:e.length/3;return this.useNativeLine?0:2*Math.max(t-1,0)},addCubicCurve:function(e,t,r,i,B,n){null==n&&(n=1);for(var a=e[0],o=e[1],s=e[2],l=t[0],h=t[1],u=t[2],c=r[0],d=r[1],f=r[2],p=i[0],m=i[1],g=i[2],_=this._getCubicCurveApproxStep(e,t,r,i),v=_*_,y=v*_,x=3*_,b=3*v,v=6*v,w=6*y,T=a-2*l+c,S=o-2*h+d,M=s-2*u+f,c=3*(l-c)-a+p,d=3*(h-d)-o+m,f=3*(u-f)-s+g,A=a,E=o,C=s,D=(l-a)*x+T*b+c*y,L=(h-o)*x+S*b+d*y,P=(u-s)*x+M*b+f*y,O=T*v+c*w,N=S*v+d*w,F=M*v+f*w,z=c*w,G=d*w,U=f*w,k=0,V=0,H=Math.ceil(1/_),I=new Float32Array(3*(H+1)),R=(I=[],0),V=0;V<H+1;V++)I[R++]=A,I[R++]=E,I[R++]=C,A+=D,E+=L,C+=P,D+=O,L+=N,P+=F,O+=z,N+=G,F+=U,1<(k+=_)&&(A=0<D?Math.min(A,p):Math.max(A,p),E=0<L?Math.min(E,m):Math.max(E,m),C=0<P?Math.min(C,g):Math.max(C,g));return this.addPolyline(I,B,n)},addLine:function(e,t,r,i){return this.addPolyline([e,t],r,i)},addPolyline:function(e,t,r,i,n){if(e.length){var a=\\\"number\\\"!=typeof e[0];if(!((n=null==n?a?e.length:e.length/3:n)<2)){null==i&&(i=0),null==r&&(r=1),this._itemVertexOffsets.push(this._vertexOffset);var o,s,l=(a=\\\"number\\\"!=typeof e[0])?\\\"number\\\"!=typeof t[0]:t.length/4===n,h=this.attributes.position,u=this.attributes.positionPrev,c=this.attributes.positionNext,d=this.attributes.color,f=this.attributes.offset,p=this.indices,m=this._vertexOffset;r=Math.max(r,.01);for(var g,_,v,y=i;y<n;y++)a?(o=e[y],s=l?t[y]:t):((o=o||[])[0]=e[g=3*y],o[1]=e[1+g],o[2]=e[2+g],l?((s=s||[])[0]=t[g=4*y],s[1]=t[1+g],s[2]=t[2+g],s[3]=t[3+g]):s=t),this.useNativeLine?1<y&&(h.copy(m,m-1),d.copy(m,m-1),m++):(y<n-1&&(u.set(m+2,o),u.set(m+3,o)),0<y&&(c.set(m-2,o),c.set(m-1,o)),h.set(m,o),h.set(m+1,o),d.set(m,s),d.set(m+1,s),f.set(m,r/2),f.set(m+1,-r/2),m+=2),this.useNativeLine?(d.set(m,s),h.set(m,o),m++):0<y&&(g=3*this._triangleOffset,(p=this.indices)[g]=m-4,p[1+g]=m-3,p[2+g]=m-2,p[3+g]=m-3,p[4+g]=m-1,p[5+g]=m-2,this._triangleOffset+=2);return this.useNativeLine||(_=this._vertexOffset,v=this._vertexOffset+2*n,u.copy(_,_+2),u.copy(_+1,_+3),c.copy(v-1,v-3),c.copy(v-2,v-4)),this._vertexOffset=m,this._vertexOffset}}},setItemColor:function(e,t){for(var r=this._itemVertexOffsets[e],i=e<this._itemVertexOffsets.length-1?this._itemVertexOffsets[e+1]:this._vertexOffset,n=r;n<i;n++)this.attributes.color.set(n,t);this.dirty(\\\"color\\\")},currentTriangleOffset:function(){return this._triangleOffset},currentVertexOffset:function(){return this._vertexOffset}});F.util.defaults(Dn.prototype,no);const lo=Dn;function ho(e,t,r,i,n,a,o){this._zr=e,this._x=0,this._y=0,this._rowHeight=0,this.width=i,this.height=n,this.offsetX=t,this.offsetY=r,this.dpr=o,this.gap=a}function uo(e){(e=e||{}).width=e.width||512,e.height=e.height||512,e.devicePixelRatio=e.devicePixelRatio||1,e.gap=null==e.gap?2:e.gap;var t=document.createElement(\\\"canvas\\\"),r=(t.width=e.width*e.devicePixelRatio,t.height=e.height*e.devicePixelRatio,this._canvas=t,this._texture=new k({image:t,flipY:!1}),this),i=(this._zr=F.zrender.init(t),this._zr.refreshImmediately);this._zr.refreshImmediately=function(){i.call(this),r._texture.dirty(),r.onupdate&&r.onupdate()},this._dpr=e.devicePixelRatio,this._coords={},this.onupdate=e.onupdate,this._gap=e.gap,this._textureAtlasNodes=[new ho(this._zr,0,0,e.width,e.height,this._gap,this._dpr)],this._nodeWidth=e.width,this._nodeHeight=e.height,this._currentNodeIdx=0}ho.prototype={constructor:ho,clear:function(){this._x=0,this._y=0,this._rowHeight=0},add:function(e,t,r){var i=e.getBoundingRect(),i=(null==t&&(t=i.width),null==r&&(r=i.height),t*=this.dpr,r*=this.dpr,this._fitElement(e,t,r),this._x),n=this._y,a=this.width*this.dpr,o=this.height*this.dpr,s=this.gap;if(a<i+t+s&&(i=this._x=0,n+=this._rowHeight+s,this._y=n,this._rowHeight=0),this._x+=t+s,this._rowHeight=Math.max(this._rowHeight,r),o<n+r+s)return null;e.x+=this.offsetX*this.dpr+i,e.y+=this.offsetY*this.dpr+n,this._zr.add(e);s=[this.offsetX/this.width,this.offsetY/this.height];return[[i/a+s[0],n/o+s[1]],[(i+t)/a+s[0],(n+r)/o+s[1]]]},_fitElement:function(e,t,r){var i=e.getBoundingRect(),n=t/i.width,a=r/i.height;e.x=-i.x*n,e.y=-i.y*a,e.scaleX=n,e.scaleY=a,e.update()}},uo.prototype={clear:function(){for(var e=0;e<this._textureAtlasNodes.length;e++)this._textureAtlasNodes[e].clear();this._currentNodeIdx=0,this._zr.clear(),this._coords={}},getWidth:function(){return this._width},getHeight:function(){return this._height},getTexture:function(){return this._texture},getDevicePixelRatio:function(){return this._dpr},getZr:function(){return this._zr},_getCurrentNode:function(){return this._textureAtlasNodes[this._currentNodeIdx]},_expand:function(){if(this._currentNodeIdx++,this._textureAtlasNodes[this._currentNodeIdx])return this._textureAtlasNodes[this._currentNodeIdx];var e=4096/this._dpr,t=this._textureAtlasNodes.length,r=t*this._nodeWidth%e,t=Math.floor(t*this._nodeWidth/e)*this._nodeHeight;if(!(e<=t)){var i=(r+this._nodeWidth)*this._dpr,n=(t+this._nodeHeight)*this._dpr;try{this._zr.resize({width:i,height:n})}catch(e){this._canvas.width=i,this._canvas.height=n}i=new ho(this._zr,r,t,this._nodeWidth,this._nodeHeight,this._gap,this._dpr);return this._textureAtlasNodes.push(i),i}},add:function(e,t,r){if(this._coords[e.id])return this._coords[e.id];var i=this._getCurrentNode().add(e,t,r);if(!i){var n=this._expand();if(!n)return;i=n.add(e,t,r)}return this._coords[e.id]=i},getCoordsScale:function(){var e=this._dpr;return[this._nodeWidth/this._canvas.width*e,this._nodeHeight/this._canvas.height*e]},getCoords:function(e){return this._coords[e]},dispose:function(){this._zr.dispose()}};const co=uo;function fo(){}fo.prototype={constructor:fo,setScene:function(e){this._scene=e,this._skybox&&this._skybox.attachScene(this._scene)},initLight:function(e){this._lightRoot=e,this.mainLight=new Z.DirectionalLight({shadowBias:.005}),this.ambientLight=new Z.AmbientLight,e.add(this.mainLight),e.add(this.ambientLight)},dispose:function(){this._lightRoot&&(this._lightRoot.remove(this.mainLight),this._lightRoot.remove(this.ambientLight))},updateLight:function(e){var t=this.mainLight,r=this.ambientLight,i=e.getModel(\\\"light\\\"),n=i.getModel(\\\"main\\\"),i=i.getModel(\\\"ambient\\\"),r=(t.intensity=n.get(\\\"intensity\\\"),r.intensity=i.get(\\\"intensity\\\"),t.color=Z.parseColor(n.get(\\\"color\\\")).slice(0,3),r.color=Z.parseColor(i.get(\\\"color\\\")).slice(0,3),n.get(\\\"alpha\\\")||0),i=n.get(\\\"beta\\\")||0;t.position.setArray(Z.directionFromAlphaBeta(r,i)),t.lookAt(Z.Vector3.ZERO),t.castShadow=n.get(\\\"shadow\\\"),t.shadowResolution=Z.getShadowResolution(n.get(\\\"shadowQuality\\\"))},updateAmbientCubemap:function(e,t,r){var i,n,a=t.getModel(\\\"light.ambientCubemap\\\"),o=a.get(\\\"texture\\\");o?(this._cubemapLightsCache=this._cubemapLightsCache||{},(n=this._cubemapLightsCache[o])||(n=(i=this)._cubemapLightsCache[o]=Z.createAmbientCubemap(a.option,e,r,function(){i._isSkyboxFromAmbientCubemap&&i._skybox.setEnvironmentMap(n.specular.cubemap),r.getZr().refresh()})),this._lightRoot.add(n.diffuse),this._lightRoot.add(n.specular),this._currentCubemapLights=n):this._currentCubemapLights&&(this._lightRoot.remove(this._currentCubemapLights.diffuse),this._lightRoot.remove(this._currentCubemapLights.specular),this._currentCubemapLights=null)},updateSkybox:function(e,t,r){var i,n,a=t.get(\\\"environment\\\"),o=(this._skybox=this._skybox||new Fi,this._skybox),s=(a&&\\\"none\\\"!==a?\\\"auto\\\"===a?(this._isSkyboxFromAmbientCubemap=!0,this._currentCubemapLights?(s=this._currentCubemapLights.specular.cubemap,o.setEnvironmentMap(s),this._scene&&o.attachScene(this._scene),o.material.set(\\\"lod\\\",3)):this._skybox&&this._skybox.detachScene()):(\\\"object\\\"==typeof a&&a.colorStops||\\\"string\\\"==typeof a&&F.color.parse(a)?(this._isSkyboxFromAmbientCubemap=!1,i=new Z.Texture2D({anisotropic:8,flipY:!1}),o.setEnvironmentMap(i),(s=i.image=document.createElement(\\\"canvas\\\")).width=s.height=16,s=s.getContext(\\\"2d\\\"),n=new F.graphic.Rect({shape:{x:0,y:0,width:16,height:16},style:{fill:a}}),F.innerDrawElementOnCanvas(s,n)):(this._isSkyboxFromAmbientCubemap=!1,i=Z.loadTexture(a,r,{anisotropic:8,flipY:!1}),o.setEnvironmentMap(i)),o.attachScene(this._scene)):(this._skybox&&this._skybox.detachScene(this._scene),this._skybox=null),t.coordinateSystem);this._skybox&&(!s||!s.viewGL||\\\"auto\\\"===a||a.match&&a.match(/.hdr$/)?this._skybox.material.undefine(\\\"fragment\\\",\\\"SRGB_DECODE\\\"):(n=s.viewGL.isLinearSpace()?\\\"define\\\":\\\"undefine\\\",this._skybox.material[n](\\\"fragment\\\",\\\"SRGB_DECODE\\\")))}};const po=fo;var mo,go,_o,vo,yo=ao.vec3,x=_.extend(function(){return{segmentScale:1,useNativeLine:!0,attributes:{position:new _.Attribute(\\\"position\\\",\\\"float\\\",3,\\\"POSITION\\\"),normal:new _.Attribute(\\\"normal\\\",\\\"float\\\",3,\\\"NORMAL\\\"),color:new _.Attribute(\\\"color\\\",\\\"float\\\",4,\\\"COLOR\\\")}}},{resetOffset:function(){this._vertexOffset=0,this._faceOffset=0},setQuadCount:function(e){var t=this.attributes,r=this.getQuadVertexCount()*e,i=this.getQuadTriangleCount()*e;this.vertexCount!==r&&(t.position.init(r),t.normal.init(r),t.color.init(r)),this.triangleCount!==i&&(this.indices=new(65535<r?Uint32Array:Uint16Array)(3*i))},getQuadVertexCount:function(){return 4},getQuadTriangleCount:function(){return 2},addQuad:(mo=yo.create(),go=yo.create(),_o=yo.create(),vo=[0,3,1,3,2,1],function(e,t){var r=this.attributes.position,i=this.attributes.normal,n=this.attributes.color;yo.sub(mo,e[1],e[0]),yo.sub(go,e[2],e[1]),yo.cross(_o,mo,go),yo.normalize(_o,_o);for(var a=0;a<4;a++)r.set(this._vertexOffset+a,e[a]),n.set(this._vertexOffset+a,t),i.set(this._vertexOffset+a,_o);for(var o=3*this._faceOffset,a=0;a<6;a++)this.indices[o+a]=vo[a]+this._vertexOffset;this._vertexOffset+=4,this._faceOffset+=2})});F.util.defaults(x.prototype,no);const xo=x;var bo=E,wo={x:0,y:2,z:1};function To(e,t,r){this.rootNode=new Z.Node;var i=new Z.Mesh({geometry:new lo({useNativeLine:!1}),material:t,castShadow:!1,ignorePicking:!0,$ignorePicking:!0,renderOrder:1}),n=new Z.Mesh({geometry:new xo,material:r,castShadow:!1,culling:!1,ignorePicking:!0,$ignorePicking:!0,renderOrder:0});this.rootNode.add(n),this.rootNode.add(i),this.faceInfo=e,this.plane=new Z.Plane,this.linesMesh=i,this.quadsMesh=n}To.prototype.update=function(e,t,r){var i,n,a=e.coordinateSystem,o=[a.getAxis(this.faceInfo[0]),a.getAxis(this.faceInfo[1])],s=this.linesMesh.geometry,l=this.quadsMesh.geometry,o=(s.convertToDynamicArray(!0),l.convertToDynamicArray(!0),this._updateSplitLines(s,o,e,r),this._udpateSplitAreas(l,o,e,r),s.convertToTypedArray(),l.convertToTypedArray(),a.getAxis(this.faceInfo[2]));e=this.rootNode,r=this.plane,i=o,n=this.faceInfo[3],s=[0,0,0],l=n<0?i.getExtentMin():i.getExtentMax(),s[wo[i.dim]]=l,e.position.setArray(s),e.rotation.identity(),r.distance=-Math.abs(l),r.normal.set(0,0,0),\\\"x\\\"===i.dim?(e.rotation.rotateY(n*Math.PI/2),r.normal.x=-n):\\\"z\\\"===i.dim?(e.rotation.rotateX(-n*Math.PI/2),r.normal.y=-n):(0<n&&e.rotation.rotateY(Math.PI),r.normal.z=-n)},To.prototype._updateSplitLines=function(m,g,_,e){var v=e.getDevicePixelRatio();g.forEach(function(e,t){var r=e.model,i=g[1-t].getExtent();if(!e.scale.isBlank()){r=r.getModel(\\\"splitLine\\\",_.getModel(\\\"splitLine\\\"));if(r.get(\\\"show\\\"))for(var n=r.getModel(\\\"lineStyle\\\"),a=n.get(\\\"color\\\"),o=bo(n.get(\\\"opacity\\\"),1),s=bo(n.get(\\\"width\\\"),1),a=F.util.isArray(a)?a:[a],l=e.getTicksCoords({tickModel:r}),h=0,u=0;u<l.length;u++){var c=l[u].coord,d=Z.parseColor(a[h%a.length]),f=(d[3]*=o,[0,0,0]),p=[0,0,0];f[t]=p[t]=c,f[1-t]=i[0],p[1-t]=i[1],m.addLine(f,p,d,s*v),h++}}})},To.prototype._udpateSplitAreas=function(m,g,_,e){g.forEach(function(e,t){var r=e.model,i=g[1-t].getExtent();if(!e.scale.isBlank()){r=r.getModel(\\\"splitArea\\\",_.getModel(\\\"splitArea\\\"));if(r.get(\\\"show\\\"))for(var n=r.getModel(\\\"areaStyle\\\"),a=n.get(\\\"color\\\"),o=bo(n.get(\\\"opacity\\\"),1),a=F.util.isArray(a)?a:[a],s=e.getTicksCoords({tickModel:r,clamp:!0}),l=0,h=[0,0,0],u=[0,0,0],c=0;c<s.length;c++){var d=s[c].coord,f=[0,0,0],p=[0,0,0];f[t]=p[t]=d,f[1-t]=i[0],p[1-t]=i[1],0!==c?((d=Z.parseColor(a[l%a.length]))[3]*=o,m.addQuad([h,f,p,u],d),h=f,u=p,l++):(h=f,u=p)}}})};const So=To;var Mo=[0,1,2,0,2,3],Dn=_.extend(function(){return{attributes:{position:new _.Attribute(\\\"position\\\",\\\"float\\\",3,\\\"POSITION\\\"),texcoord:new _.Attribute(\\\"texcoord\\\",\\\"float\\\",2,\\\"TEXCOORD_0\\\"),offset:new _.Attribute(\\\"offset\\\",\\\"float\\\",2),color:new _.Attribute(\\\"color\\\",\\\"float\\\",4,\\\"COLOR\\\")}}},{resetOffset:function(){this._vertexOffset=0,this._faceOffset=0},setSpriteCount:function(e){var t=4*(this._spriteCount=e),r=2*e;this.vertexCount!==t&&(this.attributes.position.init(t),this.attributes.offset.init(t),this.attributes.color.init(t)),this.triangleCount!==r&&(this.indices=new(65535<t?Uint32Array:Uint16Array)(3*r))},setSpriteAlign:function(e,t,r,i,n){var a,o,s,l;switch(null==i&&(i=\\\"top\\\"),n=n||0,r=null==r?\\\"left\\\":r){case\\\"left\\\":a=n,s=t[0]+n;break;case\\\"center\\\":case\\\"middle\\\":a=-t[0]/2,s=t[0]/2;break;case\\\"right\\\":a=-t[0]-n,s=-n}switch(i){case\\\"bottom\\\":o=n,l=t[1]+n;break;case\\\"middle\\\":o=-t[1]/2,l=t[1]/2;break;case\\\"top\\\":o=-t[1]-n,l=-n}var h=4*e,u=this.attributes.offset;u.set(h,[a,l]),u.set(1+h,[s,l]),u.set(2+h,[s,o]),u.set(3+h,[a,o])},addSprite:function(e,t,r,i,n,a){var o=this._vertexOffset;this.setSprite(this._vertexOffset/4,e,t,r,i,n,a);for(var s=0;s<Mo.length;s++)this.indices[3*this._faceOffset+s]=Mo[s]+o;return this._faceOffset+=2,this._vertexOffset+=4,o/4},setSprite:function(e,t,r,i,n,a,o){for(var s=4*e,l=this.attributes,h=0;h<4;h++)l.position.set(s+h,t);var u=l.texcoord;u.set(s,[i[0][0],i[0][1]]),u.set(1+s,[i[1][0],i[0][1]]),u.set(2+s,[i[1][0],i[1][1]]),u.set(3+s,[i[0][0],i[1][1]]),this.setSpriteAlign(e,r,n,a,o)}});F.util.defaults(Dn.prototype,no);const Ao=Dn,Eo=(Z.Shader[\\\"import\\\"](\\\"@export ecgl.labels.vertex\\\\n\\\\nattribute vec3 position: POSITION;\\\\nattribute vec2 texcoord: TEXCOORD_0;\\\\nattribute vec2 offset;\\\\n#ifdef VERTEX_COLOR\\\\nattribute vec4 a_Color : COLOR;\\\\nvarying vec4 v_Color;\\\\n#endif\\\\n\\\\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\\\\nuniform vec4 viewport : VIEWPORT;\\\\n\\\\nvarying vec2 v_Texcoord;\\\\n\\\\nvoid main()\\\\n{\\\\n vec4 proj = worldViewProjection * vec4(position, 1.0);\\\\n\\\\n vec2 screen = (proj.xy / abs(proj.w) + 1.0) * 0.5 * viewport.zw;\\\\n\\\\n screen += offset;\\\\n\\\\n proj.xy = (screen / viewport.zw - 0.5) * 2.0 * abs(proj.w);\\\\n gl_Position = proj;\\\\n#ifdef VERTEX_COLOR\\\\n v_Color = a_Color;\\\\n#endif\\\\n v_Texcoord = texcoord;\\\\n}\\\\n@end\\\\n\\\\n\\\\n@export ecgl.labels.fragment\\\\n\\\\nuniform vec3 color : [1.0, 1.0, 1.0];\\\\nuniform float alpha : 1.0;\\\\nuniform sampler2D textureAtlas;\\\\nuniform vec2 uvScale: [1.0, 1.0];\\\\n\\\\n#ifdef VERTEX_COLOR\\\\nvarying vec4 v_Color;\\\\n#endif\\\\nvarying float v_Miter;\\\\n\\\\nvarying vec2 v_Texcoord;\\\\n\\\\nvoid main()\\\\n{\\\\n gl_FragColor = vec4(color, alpha) * texture2D(textureAtlas, v_Texcoord * uvScale);\\\\n#ifdef VERTEX_COLOR\\\\n gl_FragColor *= v_Color;\\\\n#endif\\\\n}\\\\n\\\\n@end\\\"),Z.Mesh.extend(function(){return{geometry:new Ao({dynamic:!0}),material:new Z.Material({shader:Z.createShader(\\\"ecgl.labels\\\"),transparent:!0,depthMask:!1}),culling:!1,castShadow:!1,ignorePicking:!0}}));var Co=E,Do={x:0,y:2,z:1};function Lo(e,t){var r=new Z.Mesh({geometry:new lo({useNativeLine:!1}),material:t,castShadow:!1,ignorePicking:!0,renderOrder:2}),i=new Eo,n=(i.material.depthMask=!1,new Z.Node);n.add(r),n.add(i),this.rootNode=n,this.dim=e,this.linesMesh=r,this.labelsMesh=i,this.axisLineCoords=null,this.labelElements=[]}var Po={x:\\\"y\\\",y:\\\"x\\\",z:\\\"y\\\"};Lo.prototype.update=function(e,t,r){var i,n,a=e.coordinateSystem.getAxis(this.dim),o=this.linesMesh.geometry,s=this.labelsMesh.geometry,l=(o.convertToDynamicArray(!0),s.convertToDynamicArray(!0),a.model),h=a.getExtent(),u=r.getDevicePixelRatio(),c=l.getModel(\\\"axisLine\\\",e.getModel(\\\"axisLine\\\")),d=l.getModel(\\\"axisTick\\\",e.getModel(\\\"axisTick\\\")),f=l.getModel(\\\"axisLabel\\\",e.getModel(\\\"axisLabel\\\")),p=c.get(\\\"lineStyle.color\\\");if(c.get(\\\"show\\\")&&(c=c.getModel(\\\"lineStyle\\\"),i=[0,0,0],(b=[0,0,0])[w=Do[a.dim]]=h[0],i[w]=h[1],this.axisLineCoords=[b,i],n=Z.parseColor(p),g=Co(c.get(\\\"width\\\"),1),c=Co(c.get(\\\"opacity\\\"),1),n[3]*=c,o.addLine(b,i,n,g*u)),d.get(\\\"show\\\")){var c=d.getModel(\\\"lineStyle\\\"),m=Z.parseColor(Co(c.get(\\\"color\\\"),p)),g=Co(c.get(\\\"width\\\"),1);m[3]*=Co(c.get(\\\"opacity\\\"),1);for(var _=a.getTicksCoords(),v=d.get(\\\"length\\\"),y=0;y<_.length;y++){var x=_[y].coord,b=[0,0,0],w=Do[a.dim],T=Do[Po[a.dim]];b[w]=(i=[0,0,0])[w]=x,i[T]=v,o.addLine(b,i,m,g*u)}}if(this.labelElements=[],u=r.getDevicePixelRatio(),f.get(\\\"show\\\"))for(var _=a.getTicksCoords(),S=l.get(\\\"data\\\"),M=f.get(\\\"margin\\\"),A=a.getViewLabels(),y=0;y<A.length;y++){var E=A[y].tickValue,C=A[y].formattedLabel,D=A[y].rawLabel,L=(x=a.dataToCoord(E),[0,0,0]),w=Do[a.dim],T=Do[Po[a.dim]],P=(L[w]=L[w]=x,L[T]=M,f),O=(S&&S[E]&&S[E].textStyle&&(P=new F.Model(S[E].textStyle,f,l.ecModel)),Co(P.get(\\\"color\\\"),p)),N=new F.graphic.Text({style:Ya(P,{text:C,fill:\\\"function\\\"==typeof O?O(\\\"category\\\"===a.type?D:\\\"value\\\"===a.type?E+\\\"\\\":E,y):O,verticalAlign:\\\"top\\\",align:\\\"left\\\"})}),I=t.add(N),R=N.getBoundingRect();s.addSprite(L,[R.width*u,R.height*u],I),this.labelElements.push(N)}l.get(\\\"name\\\")&&(n=l.getModel(\\\"nameTextStyle\\\"),L=[0,0,0],w=Do[a.dim],T=Do[Po[a.dim]],c=Co(n.get(\\\"color\\\"),p),d=n.get(\\\"borderColor\\\"),g=n.get(\\\"borderWidth\\\"),L[w]=L[w]=(h[0]+h[1])/2,L[T]=l.get(\\\"nameGap\\\"),N=new F.graphic.Text({style:Ya(n,{text:l.get(\\\"name\\\"),fill:c,stroke:d,lineWidth:g})}),I=t.add(N),R=N.getBoundingRect(),s.addSprite(L,[R.width*u,R.height*u],I),N.__idx=this.labelElements.length,this.nameLabelElement=N),this.labelsMesh.material.set(\\\"textureAtlas\\\",t.getTexture()),this.labelsMesh.material.set(\\\"uvScale\\\",t.getCoordsScale()),o.convertToTypedArray(),s.convertToTypedArray()},Lo.prototype.setSpriteAlign=function(e,t,r){for(var i=r.getDevicePixelRatio(),n=this.labelsMesh.geometry,a=0;a<this.labelElements.length;a++){var o=this.labelElements[a].getBoundingRect();n.setSpriteAlign(a,[o.width*i,o.height*i],e,t)}var s=this.nameLabelElement;s&&(o=s.getBoundingRect(),n.setSpriteAlign(s.__idx,[o.width*i,o.height*i],e,t),n.dirty()),this.textAlign=e,this.textVerticalAlign=t};const Oo=Lo,No=\\\"@export ecgl.lines3D.vertex\\\\n\\\\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\\\\n\\\\nattribute vec3 position: POSITION;\\\\nattribute vec4 a_Color : COLOR;\\\\nvarying vec4 v_Color;\\\\n\\\\nvoid main()\\\\n{\\\\n gl_Position = worldViewProjection * vec4(position, 1.0);\\\\n v_Color = a_Color;\\\\n}\\\\n\\\\n@end\\\\n\\\\n@export ecgl.lines3D.fragment\\\\n\\\\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\\\\n\\\\nvarying vec4 v_Color;\\\\n\\\\n@import clay.util.srgb\\\\n\\\\nvoid main()\\\\n{\\\\n#ifdef SRGB_DECODE\\\\n gl_FragColor = sRGBToLinear(color * v_Color);\\\\n#else\\\\n gl_FragColor = color * v_Color;\\\\n#endif\\\\n}\\\\n@end\\\\n\\\\n\\\\n\\\\n@export ecgl.lines3D.clipNear\\\\n\\\\nvec4 clipNear(vec4 p1, vec4 p2) {\\\\n float n = (p1.w - near) / (p1.w - p2.w);\\\\n return vec4(mix(p1.xy, p2.xy, n), -near, near);\\\\n}\\\\n\\\\n@end\\\\n\\\\n@export ecgl.lines3D.expandLine\\\\n#ifdef VERTEX_ANIMATION\\\\n vec4 prevProj = worldViewProjection * vec4(mix(prevPositionPrev, positionPrev, percent), 1.0);\\\\n vec4 currProj = worldViewProjection * vec4(mix(prevPosition, position, percent), 1.0);\\\\n vec4 nextProj = worldViewProjection * vec4(mix(prevPositionNext, positionNext, percent), 1.0);\\\\n#else\\\\n vec4 prevProj = worldViewProjection * vec4(positionPrev, 1.0);\\\\n vec4 currProj = worldViewProjection * vec4(position, 1.0);\\\\n vec4 nextProj = worldViewProjection * vec4(positionNext, 1.0);\\\\n#endif\\\\n\\\\n if (currProj.w < 0.0) {\\\\n if (nextProj.w > 0.0) {\\\\n currProj = clipNear(currProj, nextProj);\\\\n }\\\\n else if (prevProj.w > 0.0) {\\\\n currProj = clipNear(currProj, prevProj);\\\\n }\\\\n }\\\\n\\\\n vec2 prevScreen = (prevProj.xy / abs(prevProj.w) + 1.0) * 0.5 * viewport.zw;\\\\n vec2 currScreen = (currProj.xy / abs(currProj.w) + 1.0) * 0.5 * viewport.zw;\\\\n vec2 nextScreen = (nextProj.xy / abs(nextProj.w) + 1.0) * 0.5 * viewport.zw;\\\\n\\\\n vec2 dir;\\\\n float len = offset;\\\\n if (position == positionPrev) {\\\\n dir = normalize(nextScreen - currScreen);\\\\n }\\\\n else if (position == positionNext) {\\\\n dir = normalize(currScreen - prevScreen);\\\\n }\\\\n else {\\\\n vec2 dirA = normalize(currScreen - prevScreen);\\\\n vec2 dirB = normalize(nextScreen - currScreen);\\\\n\\\\n vec2 tanget = normalize(dirA + dirB);\\\\n\\\\n float miter = 1.0 / max(dot(tanget, dirA), 0.5);\\\\n len *= miter;\\\\n dir = tanget;\\\\n }\\\\n\\\\n dir = vec2(-dir.y, dir.x) * len;\\\\n currScreen += dir;\\\\n\\\\n currProj.xy = (currScreen / viewport.zw - 0.5) * 2.0 * abs(currProj.w);\\\\n@end\\\\n\\\\n\\\\n@export ecgl.meshLines3D.vertex\\\\n\\\\nattribute vec3 position: POSITION;\\\\nattribute vec3 positionPrev;\\\\nattribute vec3 positionNext;\\\\nattribute float offset;\\\\nattribute vec4 a_Color : COLOR;\\\\n\\\\n#ifdef VERTEX_ANIMATION\\\\nattribute vec3 prevPosition;\\\\nattribute vec3 prevPositionPrev;\\\\nattribute vec3 prevPositionNext;\\\\nuniform float percent : 1.0;\\\\n#endif\\\\n\\\\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\\\\nuniform vec4 viewport : VIEWPORT;\\\\nuniform float near : NEAR;\\\\n\\\\nvarying vec4 v_Color;\\\\n\\\\n@import ecgl.common.wireframe.vertexHeader\\\\n\\\\n@import ecgl.lines3D.clipNear\\\\n\\\\nvoid main()\\\\n{\\\\n @import ecgl.lines3D.expandLine\\\\n\\\\n gl_Position = currProj;\\\\n\\\\n v_Color = a_Color;\\\\n\\\\n @import ecgl.common.wireframe.vertexMain\\\\n}\\\\n@end\\\\n\\\\n\\\\n@export ecgl.meshLines3D.fragment\\\\n\\\\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\\\\n\\\\nvarying vec4 v_Color;\\\\n\\\\n@import ecgl.common.wireframe.fragmentHeader\\\\n\\\\n@import clay.util.srgb\\\\n\\\\nvoid main()\\\\n{\\\\n#ifdef SRGB_DECODE\\\\n gl_FragColor = sRGBToLinear(color * v_Color);\\\\n#else\\\\n gl_FragColor = color * v_Color;\\\\n#endif\\\\n\\\\n @import ecgl.common.wireframe.fragmentMain\\\\n}\\\\n\\\\n@end\\\";var Io=E,Ro=(Z.Shader[\\\"import\\\"](No),{x:0,y:2,z:1});const Bo=F.ComponentView.extend({type:\\\"grid3D\\\",__ecgl__:!0,init:function(e,t){var r=new Z.Material({shader:Z.createShader(\\\"ecgl.color\\\"),depthMask:!1,transparent:!0}),i=new Z.Material({shader:Z.createShader(\\\"ecgl.meshLines3D\\\"),depthMask:!1,transparent:!0}),n=(r.define(\\\"fragment\\\",\\\"DOUBLE_SIDED\\\"),r.define(\\\"both\\\",\\\"VERTEX_COLOR\\\"),this.groupGL=new Z.Node,this._control=new io({zr:t.getZr()}),this._control.init(),this._faces=[[\\\"y\\\",\\\"z\\\",\\\"x\\\",-1,\\\"left\\\"],[\\\"y\\\",\\\"z\\\",\\\"x\\\",1,\\\"right\\\"],[\\\"x\\\",\\\"y\\\",\\\"z\\\",-1,\\\"bottom\\\"],[\\\"x\\\",\\\"y\\\",\\\"z\\\",1,\\\"top\\\"],[\\\"x\\\",\\\"z\\\",\\\"y\\\",-1,\\\"far\\\"],[\\\"x\\\",\\\"z\\\",\\\"y\\\",1,\\\"near\\\"]].map(function(e){var t=new So(e,i,r);return this.groupGL.add(t.rootNode),t},this),this._axes=[\\\"x\\\",\\\"y\\\",\\\"z\\\"].map(function(e){var t=new Oo(e,i);return this.groupGL.add(t.rootNode),t},this),t.getDevicePixelRatio());this._axisLabelSurface=new co({width:256,height:256,devicePixelRatio:n}),this._axisLabelSurface.onupdate=function(){t.getZr().refresh()},this._axisPointerLineMesh=new Z.Mesh({geometry:new lo({useNativeLine:!1}),material:i,castShadow:!1,ignorePicking:!0,renderOrder:3}),this.groupGL.add(this._axisPointerLineMesh),this._axisPointerLabelsSurface=new co({width:128,height:128,devicePixelRatio:n}),this._axisPointerLabelsMesh=new Eo({ignorePicking:!0,renderOrder:4,castShadow:!1}),this._axisPointerLabelsMesh.material.set(\\\"textureAtlas\\\",this._axisPointerLabelsSurface.getTexture()),this.groupGL.add(this._axisPointerLabelsMesh),this._lightRoot=new Z.Node,this._sceneHelper=new po,this._sceneHelper.initLight(this._lightRoot)},render:function(t,r,i){this._model=t,this._api=i;var e=t.coordinateSystem,n=(e.viewGL.add(this._lightRoot),t.get(\\\"show\\\")?e.viewGL.add(this.groupGL):e.viewGL.remove(this.groupGL),this._control),a=(n.setViewGL(e.viewGL),t.getModel(\\\"viewControl\\\"));n.setFromViewControlModel(a,0),this._axisLabelSurface.clear(),n.off(\\\"update\\\"),t.get(\\\"show\\\")&&(this._faces.forEach(function(e){e.update(t,r,i)},this),this._axes.forEach(function(e){e.update(t,this._axisLabelSurface,i)},this)),n.on(\\\"update\\\",this._onCameraChange.bind(this,t,i),this),this._sceneHelper.setScene(e.viewGL.scene),this._sceneHelper.updateLight(t),e.viewGL.setPostEffect(t.getModel(\\\"postEffect\\\"),i),e.viewGL.setTemporalSuperSampling(t.getModel(\\\"temporalSuperSampling\\\")),this._initMouseHandler(t)},afterRender:function(e,t,r,i){var n=i.renderer;this._sceneHelper.updateAmbientCubemap(n,e,r),this._sceneHelper.updateSkybox(n,e,r)},showAxisPointer:function(e,t,r,i){this._doShowAxisPointer(),this._updateAxisPointer(i.value)},hideAxisPointer:function(e,t,r,i){this._doHideAxisPointer()},_initMouseHandler:function(e){var t=e.coordinateSystem.viewGL;e.get(\\\"show\\\")&&e.get(\\\"axisPointer.show\\\")?t.on(\\\"mousemove\\\",this._updateAxisPointerOnMousePosition,this):t.off(\\\"mousemove\\\",this._updateAxisPointerOnMousePosition)},_updateAxisPointerOnMousePosition:function(e){if(!e.target){for(var t,r,i=this._model.coordinateSystem,n=i.viewGL,a=n.castRay(e.offsetX,e.offsetY,new Z.Ray),o=0;o<this._faces.length;o++){var s,l,h,u,c=this._faces[o];c.rootNode.invisible||(c.plane.normal.dot(n.camera.worldTransform.z)<0&&c.plane.normal.negate(),(s=a.intersectPlane(c.plane))&&(l=i.getAxis(c.faceInfo[0]),h=i.getAxis(c.faceInfo[1]),u=Ro[c.faceInfo[0]],c=Ro[c.faceInfo[1]],l.contain(s.array[u]))&&h.contain(s.array[c])&&(t=s))}t?(r=i.pointToData(t.array,[],!0),this._updateAxisPointer(r),this._doShowAxisPointer()):this._doHideAxisPointer()}},_onCameraChange:function(e,t){e.get(\\\"show\\\")&&(this._updateFaceVisibility(),this._updateAxisLinePosition());var r=this._control;t.dispatchAction({type:\\\"grid3DChangeCamera\\\",alpha:r.getAlpha(),beta:r.getBeta(),distance:r.getDistance(),center:r.getCenter(),from:this.uid,grid3DId:e.id})},_updateFaceVisibility:function(){var e=this._control.getCamera(),t=new Z.Vector3;e.update();for(var r=0;r<this._faces.length/2;r++){for(var i=[],n=0;n<2;n++)this._faces[2*r+n].rootNode.getWorldPosition(t),t.transformMat4(e.viewMatrix),i[n]=t.z;var a=i[1]<i[0]?0:1,o=this._faces[2*r+a],a=this._faces[2*r+1-a];o.rootNode.invisible=!0,a.rootNode.invisible=!1}},_updateAxisLinePosition:function(){var e=this._model.coordinateSystem,t=e.getAxis(\\\"x\\\"),r=e.getAxis(\\\"y\\\"),e=e.getAxis(\\\"z\\\"),i=e.getExtentMax(),e=e.getExtentMin(),n=t.getExtentMin(),t=t.getExtentMax(),a=r.getExtentMax(),r=r.getExtentMin(),o=this._axes[0].rootNode,s=this._axes[1].rootNode,l=this._axes[2].rootNode,h=this._faces,u=h[4].rootNode.invisible?r:a,c=h[2].rootNode.invisible?i:e,d=h[0].rootNode.invisible?n:t,i=h[2].rootNode.invisible?i:e,e=h[0].rootNode.invisible?t:n,t=h[4].rootNode.invisible?r:a;o.rotation.identity(),s.rotation.identity(),l.rotation.identity(),h[4].rootNode.invisible&&(this._axes[0].flipped=!0,o.rotation.rotateX(Math.PI)),h[0].rootNode.invisible&&(this._axes[1].flipped=!0,s.rotation.rotateZ(Math.PI)),h[4].rootNode.invisible&&(this._axes[2].flipped=!0,l.rotation.rotateY(Math.PI)),o.position.set(0,c,u),s.position.set(d,i,0),l.position.set(e,0,t),o.update(),s.update(),l.update(),this._updateAxisLabelAlign()},_updateAxisLabelAlign:function(){var h=this._control.getCamera(),u=[new Z.Vector4,new Z.Vector4],c=new Z.Vector4;this.groupGL.getWorldPosition(c),c.w=1,c.transformMat4(h.viewMatrix).transformMat4(h.projectionMatrix),c.x/=c.w,c.y/=c.w,this._axes.forEach(function(e){for(var t=e.axisLineCoords,r=(e.labelsMesh.geometry,0);r<u.length;r++)u[r].setArray(t[r]),u[r].w=1,u[r].transformMat4(e.rootNode.worldTransform).transformMat4(h.viewMatrix).transformMat4(h.projectionMatrix),u[r].x/=u[r].w,u[r].y/=u[r].w;var i,n,a=u[1].x-u[0].x,o=u[1].y-u[0].y,s=(u[1].x+u[0].x)/2,l=(u[1].y+u[0].y)/2;Math.abs(o/a)<.5?(i=\\\"center\\\",n=l>c.y?\\\"bottom\\\":\\\"top\\\"):(n=\\\"middle\\\",i=s>c.x?\\\"left\\\":\\\"right\\\"),e.setSpriteAlign(i,n,this._api)},this)},_doShowAxisPointer:function(){this._axisPointerLineMesh.invisible&&(this._axisPointerLineMesh.invisible=!1,this._axisPointerLabelsMesh.invisible=!1,this._api.getZr().refresh())},_doHideAxisPointer:function(){this._axisPointerLineMesh.invisible||(this._axisPointerLineMesh.invisible=!0,this._axisPointerLabelsMesh.invisible=!0,this._api.getZr().refresh())},_updateAxisPointer:function(e){var t=this._model.coordinateSystem,r=t.dataToPoint(e),i=this._axisPointerLineMesh.geometry,n=this._model.getModel(\\\"axisPointer\\\"),a=this._api.getDevicePixelRatio();function o(e){return E(e.model.get(\\\"axisPointer.show\\\"),n.get(\\\"show\\\"))}function s(e){var t=e.model.getModel(\\\"axisPointer\\\",n).getModel(\\\"lineStyle\\\"),r=Z.parseColor(t.get(\\\"color\\\")),i=Io(t.get(\\\"width\\\"),1),t=Io(t.get(\\\"opacity\\\"),1);return r[3]*=t,{color:r,lineWidth:i}}i.convertToDynamicArray(!0);for(var l=0;l<this._faces.length;l++){var h=this._faces[l];if(!h.rootNode.invisible){for(var u,c,d=h.faceInfo,f=d[3]<0?t.getAxis(d[2]).getExtentMin():t.getAxis(d[2]).getExtentMax(),p=Ro[d[2]],m=0;m<2;m++){var g,_=d[m],v=d[1-m],y=t.getAxis(_),x=t.getAxis(v);o(y)&&(v=Ro[v],(c=[0,0,0])[_=Ro[_]]=(u=[0,0,0])[_]=r[_],c[p]=u[p]=f,c[v]=x.getExtentMin(),u[v]=x.getExtentMax(),g=s(y),i.addLine(c,u,g.color,g.lineWidth*a))}o(t.getAxis(d[2]))&&(c=r.slice(),(u=r.slice())[p]=f,g=s(t.getAxis(d[2])),i.addLine(c,u,g.color,g.lineWidth*a))}}i.convertToTypedArray(),this._updateAxisPointerLabelsMesh(e),this._api.getZr().refresh()},_updateAxisPointerLabelsMesh:function(l){var e=this._model,h=this._axisPointerLabelsMesh,u=this._axisPointerLabelsSurface,c=e.coordinateSystem,d=e.getModel(\\\"axisPointer\\\"),f=(h.geometry.convertToDynamicArray(!0),u.clear(),{x:\\\"y\\\",y:\\\"x\\\",z:\\\"y\\\"});this._axes.forEach(function(e,t){var r,i,n=c.getAxis(e.dim),a=n.model.getModel(\\\"axisPointer\\\",d),o=a.getModel(\\\"label\\\"),s=a.get(\\\"lineStyle.color\\\");o.get(\\\"show\\\")&&a.get(\\\"show\\\")&&(a=l[t],i=o.get(\\\"formatter\\\"),r=n.scale.getLabel({value:a}),null!=i?r=i(r,l):\\\"interval\\\"!==n.scale.type&&\\\"log\\\"!==n.scale.type||(i=F.number.getPrecisionSafe(n.scale.getTicks()[0]),r=a.toFixed(i+2)),i=o.get(\\\"color\\\"),a=new F.graphic.Text({style:Ya(o,{text:r,fill:i||s,align:\\\"left\\\",verticalAlign:\\\"top\\\"})}),r=u.add(a),i=a.getBoundingRect(),s=this._api.getDevicePixelRatio(),(a=e.rootNode.position.toArray())[Ro[f[e.dim]]]+=(e.flipped?-1:1)*o.get(\\\"margin\\\"),a[Ro[e.dim]]=n.dataToCoord(l[t]),h.geometry.addSprite(a,[i.width*s,i.height*s],r,e.textAlign,e.textVerticalAlign))},this),u.getZr().refreshImmediately(),h.material.set(\\\"uvScale\\\",u.getCoordsScale()),h.geometry.convertToTypedArray()},dispose:function(){this.groupGL.removeAll(),this._control.dispose(),this._axisLabelSurface.dispose(),this._axisPointerLabelsSurface.dispose()}}),Fo=(zo.prototype.getAxis=function(e){return this._axes[e]},zo.prototype.getAxes=function(){return ra(this._dimList,function(e){return this._axes[e]},this)},zo.prototype.getAxesByScale=function(t){t=t.toLowerCase();var e=this.getAxes(),r=function(e){return e.scale.type===t};if(!e)return[];if(e.filter&&e.filter===Yn)return e.filter(r,void 0);for(var i=[],n=0,a=e.length;n<a;n++)r.call(void 0,e[n],n,e)&&i.push(e[n]);return i},zo.prototype.addAxis=function(e){var t=e.dim;this._axes[t]=e,this._dimList.push(t)},zo);function zo(e){this.type=\\\"cartesian\\\",this._dimList=[],this._axes={},this.name=e||\\\"\\\"}function Go(e){Fo.call(this,e),this.type=\\\"cartesian3D\\\",this.dimensions=[\\\"x\\\",\\\"y\\\",\\\"z\\\"],this.size=[0,0,0]}Go.prototype={constructor:Go,model:null,containPoint:function(e){return this.getAxis(\\\"x\\\").contain(e[0])&&this.getAxis(\\\"y\\\").contain(e[2])&&this.getAxis(\\\"z\\\").contain(e[1])},containData:function(e){return this.getAxis(\\\"x\\\").containData(e[0])&&this.getAxis(\\\"y\\\").containData(e[1])&&this.getAxis(\\\"z\\\").containData(e[2])},dataToPoint:function(e,t,r){return(t=t||[])[0]=this.getAxis(\\\"x\\\").dataToCoord(e[0],r),t[2]=this.getAxis(\\\"y\\\").dataToCoord(e[1],r),t[1]=this.getAxis(\\\"z\\\").dataToCoord(e[2],r),t},pointToData:function(e,t,r){return(t=t||[])[0]=this.getAxis(\\\"x\\\").coordToData(e[0],r),t[1]=this.getAxis(\\\"y\\\").coordToData(e[2],r),t[2]=this.getAxis(\\\"z\\\").coordToData(e[1],r),t}},F.util.inherits(Go,Fo);const Uo=Go;function ko(e,t,r){F.Axis.call(this,e,t,r)}ko.prototype={constructor:ko,getExtentMin:function(){var e=this._extent;return Math.min(e[0],e[1])},getExtentMax:function(){var e=this._extent;return Math.max(e[0],e[1])},calculateCategoryInterval:function(){return Math.floor(this.scale.count()/8)}},F.util.inherits(ko,F.Axis);const Vo=ko;function Ho(e,t,r){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4]+r[0],e[5]=t[5]+r[1]}w.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this},w.prototype.clone=function(){return new w(this.x,this.y)},w.prototype.set=function(e,t){return this.x=e,this.y=t,this},w.prototype.equal=function(e){return e.x===this.x&&e.y===this.y},w.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},w.prototype.scale=function(e){this.x*=e,this.y*=e},w.prototype.scaleAndAdd=function(e,t){this.x+=e.x*t,this.y+=e.y*t},w.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},w.prototype.dot=function(e){return this.x*e.x+this.y*e.y},w.prototype.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},w.prototype.lenSquare=function(){return this.x*this.x+this.y*this.y},w.prototype.normalize=function(){var e=this.len();return this.x/=e,this.y/=e,this},w.prototype.distance=function(e){var t=this.x-e.x,r=this.y-e.y;return Math.sqrt(t*t+r*r)},w.prototype.distanceSquare=function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},w.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},w.prototype.transform=function(e){var t,r;if(e)return t=this.x,r=this.y,this.x=e[0]*t+e[2]*r+e[4],this.y=e[1]*t+e[3]*r+e[5],this},w.prototype.toArray=function(e){return e[0]=this.x,e[1]=this.y,e},w.prototype.fromArray=function(e){this.x=e[0],this.y=e[1]},w.set=function(e,t,r){e.x=t,e.y=r},w.copy=function(e,t){e.x=t.x,e.y=t.y},w.len=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},w.lenSquare=function(e){return e.x*e.x+e.y*e.y},w.dot=function(e,t){return e.x*t.x+e.y*t.y},w.add=function(e,t,r){e.x=t.x+r.x,e.y=t.y+r.y},w.sub=function(e,t,r){e.x=t.x-r.x,e.y=t.y-r.y},w.scale=function(e,t,r){e.x=t.x*r,e.y=t.y*r},w.scaleAndAdd=function(e,t,r,i){e.x=t.x+r.x*i,e.y=t.y+r.y*i},w.lerp=function(e,t,r,i){var n=1-i;e.x=n*t.x+i*r.x,e.y=n*t.y+i*r.y};const Wo=w;function w(e,t){this.x=e||0,this.y=t||0}var jo=Math.min,Xo=Math.max,qo=new Wo,Zo=new Wo,Yo=new Wo,Ko=new Wo,Qo=new Wo,Jo=new Wo;es.prototype.union=function(e){var t=jo(e.x,this.x),r=jo(e.y,this.y);isFinite(this.x)&&isFinite(this.width)?this.width=Xo(e.x+e.width,this.x+this.width)-t:this.width=e.width,isFinite(this.y)&&isFinite(this.height)?this.height=Xo(e.y+e.height,this.y+this.height)-r:this.height=e.height,this.x=t,this.y=r},es.prototype.applyTransform=function(e){es.applyTransform(this,this,e)},es.prototype.calculateTransform=function(e){var t,r,i,n=e.width/this.width,a=e.height/this.height,o=[1,0,0,1,0,0];return Ho(o,o,[-this.x,-this.y]),r=t=o,n=(i=[n,a])[0],a=i[1],t[0]=r[0]*n,t[1]=r[1]*a,t[2]=r[2]*n,t[3]=r[3]*a,t[4]=r[4]*n,t[5]=r[5]*a,Ho(o,o,[e.x,e.y]),o},es.prototype.intersect=function(e,t){if(!e)return!1;e instanceof es||(e=es.create(e));var r,i,n,a,o,s,l,h,u=this.x,c=this.x+this.width,d=this.y,f=this.y+this.height,p=e.x,m=e.x+e.width,g=e.y,_=e.y+e.height,v=!(c<p||m<u||f<g||_<d);return t&&(r=1/0,i=0,n=Math.abs(c-p),a=Math.abs(m-u),o=Math.abs(f-g),s=Math.abs(_-d),l=Math.min(n,a),h=Math.min(o,s),c<p||m<u?i<l&&(i=l,n<a?Wo.set(Jo,-n,0):Wo.set(Jo,a,0)):l<r&&(r=l,n<a?Wo.set(Qo,n,0):Wo.set(Qo,-a,0)),f<g||_<d?i<h&&(i=h,o<s?Wo.set(Jo,0,-o):Wo.set(Jo,0,s)):l<r&&(r=l,o<s?Wo.set(Qo,0,o):Wo.set(Qo,0,-s))),t&&Wo.copy(t,v?Qo:Jo),v},es.prototype.contain=function(e,t){return e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height},es.prototype.clone=function(){return new es(this.x,this.y,this.width,this.height)},es.prototype.copy=function(e){es.copy(this,e)},es.prototype.plain=function(){return{x:this.x,y:this.y,width:this.width,height:this.height}},es.prototype.isFinite=function(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.width)&&isFinite(this.height)},es.prototype.isZero=function(){return 0===this.width||0===this.height},es.create=function(e){return new es(e.x,e.y,e.width,e.height)},es.copy=function(e,t){e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height},es.applyTransform=function(e,t,r){var i,n,a,o;r?r[1]<1e-5&&-1e-5<r[1]&&r[2]<1e-5&&-1e-5<r[2]?(i=r[0],n=r[3],a=r[4],o=r[5],e.x=t.x*i+a,e.y=t.y*n+o,e.width=t.width*i,e.height=t.height*n,e.width<0&&(e.x+=e.width,e.width=-e.width),e.height<0&&(e.y+=e.height,e.height=-e.height)):(qo.x=Yo.x=t.x,qo.y=Ko.y=t.y,Zo.x=Ko.x=t.x+t.width,Zo.y=Yo.y=t.y+t.height,qo.transform(r),Ko.transform(r),Zo.transform(r),Yo.transform(r),e.x=jo(qo.x,Zo.x,Yo.x,Ko.x),e.y=jo(qo.y,Zo.y,Yo.y,Ko.y),a=Xo(qo.x,Zo.x,Yo.x,Ko.x),o=Xo(qo.y,Zo.y,Yo.y,Ko.y),e.width=a-e.x,e.height=o-e.y):e!==t&&es.copy(e,t)};const $o=es;function es(e,t,r,i){r<0&&(e+=r,r=-r),i<0&&(t+=i,i=-i),this.x=e,this.y=t,this.width=r,this.height=i}function ts(s,l,h,u,c){var d=0,f=0,p=(null==u&&(u=1/0),null==c&&(c=1/0),0);l.eachChild(function(e,t){var r,i,n,a=e.getBoundingRect(),o=l.childAt(t+1),o=o&&o.getBoundingRect();p=\\\"horizontal\\\"===s?(n=a.width+(o?-o.x+a.x:0),(r=d+n)>u||e.newline?(d=0,r=n,f+=p+h,a.height):Math.max(p,a.height)):(n=a.height+(o?-o.y+a.y:0),(i=f+n)>c||e.newline?(d+=p+h,f=0,i=n,a.width):Math.max(p,a.width)),e.newline||(e.x=d,e.y=f,e.markRedraw(),\\\"horizontal\\\"===s?d=r+h:f=i+h)})}function rs(e,t,r){r=\\\"number\\\"==typeof(i=r||0)?[i,i,i,i]:2===(l=i.length)?[i[0],i[1],i[0],i[1]]:3===l?[i[0],i[1],i[2],i[1]]:i;var i,n=t.width,a=t.height,o=ja(e.left,n),s=ja(e.top,a),l=ja(e.right,n),h=ja(e.bottom,a),u=ja(e.width,n),c=ja(e.height,a),d=r[2]+r[0],f=r[1]+r[3],p=e.aspect;switch(isNaN(u)&&(u=n-l-f-o),isNaN(c)&&(c=a-h-d-s),null!=p&&(isNaN(u)&&isNaN(c)&&(n/a<p?u=.8*n:c=.8*a),isNaN(u)&&(u=p*c),isNaN(c))&&(c=u/p),isNaN(o)&&(o=n-l-u-f),isNaN(s)&&(s=a-h-c-d),e.left||e.right){case\\\"center\\\":o=n/2-u/2-r[3];break;case\\\"right\\\":o=n-u-f}switch(e.top||e.bottom){case\\\"middle\\\":case\\\"center\\\":s=a/2-c/2-r[0];break;case\\\"bottom\\\":s=a-c-d}o=o||0,s=s||0,isNaN(u)&&(u=n-f-o-(l||0)),isNaN(c)&&(c=a-d-s-(h||0));p=new $o(o+r[3],s+r[0],u,c);return p.margin=r,p}na(ts,\\\"vertical\\\"),na(ts,\\\"horizontal\\\");var x=function(){this._pool={},this._allocatedTextures=[]},is={width:512,height:512,type:te,format:ne,wrapS:de,wrapT:de,minFilter:ue,magFilter:oe,useMipmap:!0,anisotropic:1,flipY:!0,unpackAlignment:4,premultiplyAlpha:!(x.prototype={constructor:x,get:function(e){var t=as(e),t=(this._pool.hasOwnProperty(t)||(this._pool[t]=[]),this._pool[t]);return t.length?t.pop():(t=new k(e),this._allocatedTextures.push(t),t)},put:function(e){var t=as(e);this._pool.hasOwnProperty(t)||(this._pool[t]=[]),this._pool[t].push(e)},clear:function(e){for(var t=0;t<this._allocatedTextures.length;t++)this._allocatedTextures[t].dispose(e);this._pool={},this._allocatedTextures=[]}})},ns=Object.keys(is);function as(e){var t,r,i;X.defaultsWithPropList(e,is,ns),i=(t=e).width,r=t.height,i=0==(i&i-1)&&0==(r&r-1),t.format===ie&&(t.useMipmap=!1),i&&t.useMipmap||(t.minFilter==se||t.minFilter==he?t.minFilter=ae:t.minFilter!=ue&&t.minFilter!=le||(t.minFilter=oe)),i||(t.wrapS=de,t.wrapT=de);for(var n=\\\"\\\",a=0;a<ns.length;a++)n+=e[ns[a]].toString();return n}const os=x;var ss=[\\\"px\\\",\\\"nx\\\",\\\"py\\\",\\\"ny\\\",\\\"pz\\\",\\\"nz\\\"];function ls(e,t,r){return\\\"alphaMap\\\"===r?e.material.get(\\\"diffuseMap\\\"):\\\"alphaCutoff\\\"===r?e.material.isDefined(\\\"fragment\\\",\\\"ALPHA_TEST\\\")&&e.material.get(\\\"diffuseMap\\\")&&e.material.get(\\\"alphaCutoff\\\")||0:\\\"uvRepeat\\\"===r?e.material.get(\\\"uvRepeat\\\"):\\\"uvOffset\\\"===r?e.material.get(\\\"uvOffset\\\"):t.get(r)}function hs(e,t){var r=e.material,i=t.material;return r.get(\\\"diffuseMap\\\")!==i.get(\\\"diffuseMap\\\")||(r.get(\\\"alphaCutoff\\\")||0)!==(i.get(\\\"alphaCutoff\\\")||0)}S[\\\"import\\\"](\\\"@export clay.sm.depth.vertex\\\\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\\\\nattribute vec3 position : POSITION;\\\\nattribute vec2 texcoord : TEXCOORD_0;\\\\nuniform vec2 uvRepeat = vec2(1.0, 1.0);\\\\nuniform vec2 uvOffset = vec2(0.0, 0.0);\\\\n@import clay.chunk.skinning_header\\\\n@import clay.chunk.instancing_header\\\\nvarying vec4 v_ViewPosition;\\\\nvarying vec2 v_Texcoord;\\\\nvoid main(){\\\\n vec4 P = vec4(position, 1.0);\\\\n#ifdef SKINNING\\\\n @import clay.chunk.skin_matrix\\\\n P = skinMatrixWS * P;\\\\n#endif\\\\n#ifdef INSTANCING\\\\n @import clay.chunk.instancing_matrix\\\\n P = instanceMat * P;\\\\n#endif\\\\n v_ViewPosition = worldViewProjection * P;\\\\n gl_Position = v_ViewPosition;\\\\n v_Texcoord = texcoord * uvRepeat + uvOffset;\\\\n}\\\\n@end\\\\n@export clay.sm.depth.fragment\\\\nvarying vec4 v_ViewPosition;\\\\nvarying vec2 v_Texcoord;\\\\nuniform float bias : 0.001;\\\\nuniform float slopeScale : 1.0;\\\\nuniform sampler2D alphaMap;\\\\nuniform float alphaCutoff: 0.0;\\\\n@import clay.util.encode_float\\\\nvoid main(){\\\\n float depth = v_ViewPosition.z / v_ViewPosition.w;\\\\n if (alphaCutoff > 0.0) {\\\\n if (texture2D(alphaMap, v_Texcoord).a <= alphaCutoff) {\\\\n discard;\\\\n }\\\\n }\\\\n#ifdef USE_VSM\\\\n depth = depth * 0.5 + 0.5;\\\\n float moment1 = depth;\\\\n float moment2 = depth * depth;\\\\n #ifdef SUPPORT_STANDARD_DERIVATIVES\\\\n float dx = dFdx(depth);\\\\n float dy = dFdy(depth);\\\\n moment2 += 0.25*(dx*dx+dy*dy);\\\\n #endif\\\\n gl_FragColor = vec4(moment1, moment2, 0.0, 1.0);\\\\n#else\\\\n #ifdef SUPPORT_STANDARD_DERIVATIVES\\\\n float dx = dFdx(depth);\\\\n float dy = dFdy(depth);\\\\n depth += sqrt(dx*dx + dy*dy) * slopeScale + bias;\\\\n #else\\\\n depth += bias;\\\\n #endif\\\\n gl_FragColor = encodeFloat(depth * 0.5 + 0.5);\\\\n#endif\\\\n}\\\\n@end\\\\n@export clay.sm.debug_depth\\\\nuniform sampler2D depthMap;\\\\nvarying vec2 v_Texcoord;\\\\n@import clay.util.decode_float\\\\nvoid main() {\\\\n vec4 tex = texture2D(depthMap, v_Texcoord);\\\\n#ifdef USE_VSM\\\\n gl_FragColor = vec4(tex.rgb, 1.0);\\\\n#else\\\\n float depth = decodeFloat(tex);\\\\n gl_FragColor = vec4(depth, depth, depth, 1.0);\\\\n#endif\\\\n}\\\\n@end\\\\n@export clay.sm.distance.vertex\\\\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\\\\nuniform mat4 world : WORLD;\\\\nattribute vec3 position : POSITION;\\\\n@import clay.chunk.skinning_header\\\\nvarying vec3 v_WorldPosition;\\\\nvoid main (){\\\\n vec4 P = vec4(position, 1.0);\\\\n#ifdef SKINNING\\\\n @import clay.chunk.skin_matrix\\\\n P = skinMatrixWS * P;\\\\n#endif\\\\n#ifdef INSTANCING\\\\n @import clay.chunk.instancing_matrix\\\\n P = instanceMat * P;\\\\n#endif\\\\n gl_Position = worldViewProjection * P;\\\\n v_WorldPosition = (world * P).xyz;\\\\n}\\\\n@end\\\\n@export clay.sm.distance.fragment\\\\nuniform vec3 lightPosition;\\\\nuniform float range : 100;\\\\nvarying vec3 v_WorldPosition;\\\\n@import clay.util.encode_float\\\\nvoid main(){\\\\n float dist = distance(lightPosition, v_WorldPosition);\\\\n#ifdef USE_VSM\\\\n gl_FragColor = vec4(dist, dist * dist, 0.0, 0.0);\\\\n#else\\\\n dist = dist / range;\\\\n gl_FragColor = encodeFloat(dist);\\\\n#endif\\\\n}\\\\n@end\\\\n@export clay.plugin.shadow_map_common\\\\n@import clay.util.decode_float\\\\nfloat tapShadowMap(sampler2D map, vec2 uv, float z){\\\\n vec4 tex = texture2D(map, uv);\\\\n return step(z, decodeFloat(tex) * 2.0 - 1.0);\\\\n}\\\\nfloat pcf(sampler2D map, vec2 uv, float z, float textureSize, vec2 scale) {\\\\n float shadowContrib = tapShadowMap(map, uv, z);\\\\n vec2 offset = vec2(1.0 / textureSize) * scale;\\\\n#ifdef PCF_KERNEL_SIZE\\\\n for (int _idx_ = 0; _idx_ < PCF_KERNEL_SIZE; _idx_++) {{\\\\n shadowContrib += tapShadowMap(map, uv + offset * pcfKernel[_idx_], z);\\\\n }}\\\\n return shadowContrib / float(PCF_KERNEL_SIZE + 1);\\\\n#else\\\\n shadowContrib += tapShadowMap(map, uv+vec2(offset.x, 0.0), z);\\\\n shadowContrib += tapShadowMap(map, uv+vec2(offset.x, offset.y), z);\\\\n shadowContrib += tapShadowMap(map, uv+vec2(-offset.x, offset.y), z);\\\\n shadowContrib += tapShadowMap(map, uv+vec2(0.0, offset.y), z);\\\\n shadowContrib += tapShadowMap(map, uv+vec2(-offset.x, 0.0), z);\\\\n shadowContrib += tapShadowMap(map, uv+vec2(-offset.x, -offset.y), z);\\\\n shadowContrib += tapShadowMap(map, uv+vec2(offset.x, -offset.y), z);\\\\n shadowContrib += tapShadowMap(map, uv+vec2(0.0, -offset.y), z);\\\\n return shadowContrib / 9.0;\\\\n#endif\\\\n}\\\\nfloat pcf(sampler2D map, vec2 uv, float z, float textureSize) {\\\\n return pcf(map, uv, z, textureSize, vec2(1.0));\\\\n}\\\\nfloat chebyshevUpperBound(vec2 moments, float z){\\\\n float p = 0.0;\\\\n z = z * 0.5 + 0.5;\\\\n if (z <= moments.x) {\\\\n p = 1.0;\\\\n }\\\\n float variance = moments.y - moments.x * moments.x;\\\\n variance = max(variance, 0.0000001);\\\\n float mD = moments.x - z;\\\\n float pMax = variance / (variance + mD * mD);\\\\n pMax = clamp((pMax-0.4)/(1.0-0.4), 0.0, 1.0);\\\\n return max(p, pMax);\\\\n}\\\\nfloat computeShadowContrib(\\\\n sampler2D map, mat4 lightVPM, vec3 position, float textureSize, vec2 scale, vec2 offset\\\\n) {\\\\n vec4 posInLightSpace = lightVPM * vec4(position, 1.0);\\\\n posInLightSpace.xyz /= posInLightSpace.w;\\\\n float z = posInLightSpace.z;\\\\n if(all(greaterThan(posInLightSpace.xyz, vec3(-0.99, -0.99, -1.0))) &&\\\\n all(lessThan(posInLightSpace.xyz, vec3(0.99, 0.99, 1.0)))){\\\\n vec2 uv = (posInLightSpace.xy+1.0) / 2.0;\\\\n #ifdef USE_VSM\\\\n vec2 moments = texture2D(map, uv * scale + offset).xy;\\\\n return chebyshevUpperBound(moments, z);\\\\n #else\\\\n return pcf(map, uv * scale + offset, z, textureSize, scale);\\\\n #endif\\\\n }\\\\n return 1.0;\\\\n}\\\\nfloat computeShadowContrib(sampler2D map, mat4 lightVPM, vec3 position, float textureSize) {\\\\n return computeShadowContrib(map, lightVPM, position, textureSize, vec2(1.0), vec2(0.0));\\\\n}\\\\nfloat computeShadowContribOmni(samplerCube map, vec3 direction, float range)\\\\n{\\\\n float dist = length(direction);\\\\n vec4 shadowTex = textureCube(map, direction);\\\\n#ifdef USE_VSM\\\\n vec2 moments = shadowTex.xy;\\\\n float variance = moments.y - moments.x * moments.x;\\\\n float mD = moments.x - dist;\\\\n float p = variance / (variance + mD * mD);\\\\n if(moments.x + 0.001 < dist){\\\\n return clamp(p, 0.0, 1.0);\\\\n }else{\\\\n return 1.0;\\\\n }\\\\n#else\\\\n return step(dist, (decodeFloat(shadowTex) + 0.0002) * range);\\\\n#endif\\\\n}\\\\n@end\\\\n@export clay.plugin.compute_shadow_map\\\\n#if defined(SPOT_LIGHT_SHADOWMAP_COUNT) || defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT) || defined(POINT_LIGHT_SHADOWMAP_COUNT)\\\\n#ifdef SPOT_LIGHT_SHADOWMAP_COUNT\\\\nuniform sampler2D spotLightShadowMaps[SPOT_LIGHT_SHADOWMAP_COUNT]:unconfigurable;\\\\nuniform mat4 spotLightMatrices[SPOT_LIGHT_SHADOWMAP_COUNT]:unconfigurable;\\\\nuniform float spotLightShadowMapSizes[SPOT_LIGHT_SHADOWMAP_COUNT]:unconfigurable;\\\\n#endif\\\\n#ifdef DIRECTIONAL_LIGHT_SHADOWMAP_COUNT\\\\n#if defined(SHADOW_CASCADE)\\\\nuniform sampler2D directionalLightShadowMaps[1]:unconfigurable;\\\\nuniform mat4 directionalLightMatrices[SHADOW_CASCADE]:unconfigurable;\\\\nuniform float directionalLightShadowMapSizes[1]:unconfigurable;\\\\nuniform float shadowCascadeClipsNear[SHADOW_CASCADE]:unconfigurable;\\\\nuniform float shadowCascadeClipsFar[SHADOW_CASCADE]:unconfigurable;\\\\n#else\\\\nuniform sampler2D directionalLightShadowMaps[DIRECTIONAL_LIGHT_SHADOWMAP_COUNT]:unconfigurable;\\\\nuniform mat4 directionalLightMatrices[DIRECTIONAL_LIGHT_SHADOWMAP_COUNT]:unconfigurable;\\\\nuniform float directionalLightShadowMapSizes[DIRECTIONAL_LIGHT_SHADOWMAP_COUNT]:unconfigurable;\\\\n#endif\\\\n#endif\\\\n#ifdef POINT_LIGHT_SHADOWMAP_COUNT\\\\nuniform samplerCube pointLightShadowMaps[POINT_LIGHT_SHADOWMAP_COUNT]:unconfigurable;\\\\n#endif\\\\nuniform bool shadowEnabled : true;\\\\n#ifdef PCF_KERNEL_SIZE\\\\nuniform vec2 pcfKernel[PCF_KERNEL_SIZE];\\\\n#endif\\\\n@import clay.plugin.shadow_map_common\\\\n#if defined(SPOT_LIGHT_SHADOWMAP_COUNT)\\\\nvoid computeShadowOfSpotLights(vec3 position, inout float shadowContribs[SPOT_LIGHT_COUNT] ) {\\\\n float shadowContrib;\\\\n for(int _idx_ = 0; _idx_ < SPOT_LIGHT_SHADOWMAP_COUNT; _idx_++) {{\\\\n shadowContrib = computeShadowContrib(\\\\n spotLightShadowMaps[_idx_], spotLightMatrices[_idx_], position,\\\\n spotLightShadowMapSizes[_idx_]\\\\n );\\\\n shadowContribs[_idx_] = shadowContrib;\\\\n }}\\\\n for(int _idx_ = SPOT_LIGHT_SHADOWMAP_COUNT; _idx_ < SPOT_LIGHT_COUNT; _idx_++){{\\\\n shadowContribs[_idx_] = 1.0;\\\\n }}\\\\n}\\\\n#endif\\\\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\\\\n#ifdef SHADOW_CASCADE\\\\nvoid computeShadowOfDirectionalLights(vec3 position, inout float shadowContribs[DIRECTIONAL_LIGHT_COUNT]){\\\\n float depth = (2.0 * gl_FragCoord.z - gl_DepthRange.near - gl_DepthRange.far)\\\\n / (gl_DepthRange.far - gl_DepthRange.near);\\\\n float shadowContrib;\\\\n shadowContribs[0] = 1.0;\\\\n for (int _idx_ = 0; _idx_ < SHADOW_CASCADE; _idx_++) {{\\\\n if (\\\\n depth >= shadowCascadeClipsNear[_idx_] &&\\\\n depth <= shadowCascadeClipsFar[_idx_]\\\\n ) {\\\\n shadowContrib = computeShadowContrib(\\\\n directionalLightShadowMaps[0], directionalLightMatrices[_idx_], position,\\\\n directionalLightShadowMapSizes[0],\\\\n vec2(1.0 / float(SHADOW_CASCADE), 1.0),\\\\n vec2(float(_idx_) / float(SHADOW_CASCADE), 0.0)\\\\n );\\\\n shadowContribs[0] = shadowContrib;\\\\n }\\\\n }}\\\\n for(int _idx_ = DIRECTIONAL_LIGHT_SHADOWMAP_COUNT; _idx_ < DIRECTIONAL_LIGHT_COUNT; _idx_++) {{\\\\n shadowContribs[_idx_] = 1.0;\\\\n }}\\\\n}\\\\n#else\\\\nvoid computeShadowOfDirectionalLights(vec3 position, inout float shadowContribs[DIRECTIONAL_LIGHT_COUNT]){\\\\n float shadowContrib;\\\\n for(int _idx_ = 0; _idx_ < DIRECTIONAL_LIGHT_SHADOWMAP_COUNT; _idx_++) {{\\\\n shadowContrib = computeShadowContrib(\\\\n directionalLightShadowMaps[_idx_], directionalLightMatrices[_idx_], position,\\\\n directionalLightShadowMapSizes[_idx_]\\\\n );\\\\n shadowContribs[_idx_] = shadowContrib;\\\\n }}\\\\n for(int _idx_ = DIRECTIONAL_LIGHT_SHADOWMAP_COUNT; _idx_ < DIRECTIONAL_LIGHT_COUNT; _idx_++) {{\\\\n shadowContribs[_idx_] = 1.0;\\\\n }}\\\\n}\\\\n#endif\\\\n#endif\\\\n#if defined(POINT_LIGHT_SHADOWMAP_COUNT)\\\\nvoid computeShadowOfPointLights(vec3 position, inout float shadowContribs[POINT_LIGHT_COUNT] ){\\\\n vec3 lightPosition;\\\\n vec3 direction;\\\\n for(int _idx_ = 0; _idx_ < POINT_LIGHT_SHADOWMAP_COUNT; _idx_++) {{\\\\n lightPosition = pointLightPosition[_idx_];\\\\n direction = position - lightPosition;\\\\n shadowContribs[_idx_] = computeShadowContribOmni(pointLightShadowMaps[_idx_], direction, pointLightRange[_idx_]);\\\\n }}\\\\n for(int _idx_ = POINT_LIGHT_SHADOWMAP_COUNT; _idx_ < POINT_LIGHT_COUNT; _idx_++) {{\\\\n shadowContribs[_idx_] = 1.0;\\\\n }}\\\\n}\\\\n#endif\\\\n#endif\\\\n@end\\\");var us,cs,ds,fs,ps,ms,gs,_s,vs,ys,xs=N.extend(function(){return{softShadow:xs.PCF,shadowBlur:1,lightFrustumBias:\\\"auto\\\",kernelPCF:new Float32Array([1,0,1,1,-1,1,0,1,-1,0,-1,-1,1,-1,0,-1]),precision:\\\"highp\\\",_lastRenderNotCastShadow:!1,_frameBuffer:new Li,_textures:{},_shadowMapNumber:{POINT_LIGHT:0,DIRECTIONAL_LIGHT:0,SPOT_LIGHT:0},_depthMaterials:{},_distanceMaterials:{},_receivers:[],_lightsCastShadow:[],_lightCameras:{},_lightMaterials:{},_texturePool:new os}},function(){this._gaussianPassH=new hn({fragment:S.source(\\\"clay.compositor.gaussian_blur\\\")}),this._gaussianPassV=new hn({fragment:S.source(\\\"clay.compositor.gaussian_blur\\\")}),this._gaussianPassH.setUniform(\\\"blurSize\\\",this.shadowBlur),this._gaussianPassH.setUniform(\\\"blurDir\\\",0),this._gaussianPassV.setUniform(\\\"blurSize\\\",this.shadowBlur),this._gaussianPassV.setUniform(\\\"blurDir\\\",1),this._outputDepthPass=new hn({fragment:S.source(\\\"clay.sm.debug_depth\\\")})},{render:function(e,t,r,i){r=r||t.getMainCamera(),this.trigger(\\\"beforerender\\\",this,e,t,r),this._renderShadowPass(e,t,r,i),this.trigger(\\\"afterrender\\\",this,e,t,r)},renderDebug:function(e,t){e.saveClear();var r,i=e.viewport,n=0,a=t||i.width/4,o=a;for(r in this.softShadow===xs.VSM?this._outputDepthPass.material.define(\\\"fragment\\\",\\\"USE_VSM\\\"):this._outputDepthPass.material.undefine(\\\"fragment\\\",\\\"USE_VSM\\\"),this._textures){var s=this._textures[r];e.setViewport(n,0,a*s.width/s.height,o),this._outputDepthPass.setUniform(\\\"depthMap\\\",s),this._outputDepthPass.render(e),n+=a*s.width/s.height}e.setViewport(i),e.restoreClear()},_updateReceivers:function(e,t){var r;t.receiveShadow?(this._receivers.push(t),t.material.set(\\\"shadowEnabled\\\",1),t.material.set(\\\"pcfKernel\\\",this.kernelPCF)):t.material.set(\\\"shadowEnabled\\\",0),this.softShadow===xs.VSM?(t.material.define(\\\"fragment\\\",\\\"USE_VSM\\\"),t.material.undefine(\\\"fragment\\\",\\\"PCF_KERNEL_SIZE\\\")):(t.material.undefine(\\\"fragment\\\",\\\"USE_VSM\\\"),(r=this.kernelPCF)&&r.length?t.material.define(\\\"fragment\\\",\\\"PCF_KERNEL_SIZE\\\",r.length/2):t.material.undefine(\\\"fragment\\\",\\\"PCF_KERNEL_SIZE\\\"))},_update:function(t,e){var r=this;e.traverse(function(e){e.isRenderable()&&r._updateReceivers(t,e)});for(var i=0;i<e.lights.length;i++){var n=e.lights[i];n.castShadow&&!n.invisible&&this._lightsCastShadow.push(n)}},_renderShadowPass:function(e,t,r,i){for(var n in this._shadowMapNumber)this._shadowMapNumber[n]=0;this._lightsCastShadow.length=0,this._receivers.length=0;var a=e.gl;if(i||t.update(),r&&r.update(),t.updateLights(),this._update(e,t),this._lightsCastShadow.length||!this._lastRenderNotCastShadow){this._lastRenderNotCastShadow=0===this._lightsCastShadow,a.enable(a.DEPTH_TEST),a.depthMask(!0),a.disable(a.BLEND),a.clearColor(1,1,1,1);for(var o,s,l=[],h=[],u=[],c=[],d=[],f=[],p=0;p<this._lightsCastShadow.length;p++){var m=this._lightsCastShadow[p];if(\\\"DIRECTIONAL_LIGHT\\\"===m.type){if(o){console.warn(\\\"Only one direectional light supported with shadow cascade\\\");continue}if(4<m.shadowCascade){console.warn(\\\"Support at most 4 cascade\\\");continue}1<m.shadowCascade&&(o=m),this.renderDirectionalLightShadow(e,t,r,m,d,c,u)}else\\\"SPOT_LIGHT\\\"===m.type?this.renderSpotLightShadow(e,t,m,h,l):\\\"POINT_LIGHT\\\"===m.type&&this.renderPointLightShadow(e,t,m,f);this._shadowMapNumber[m.type]++}for(s in this._shadowMapNumber)for(var g=this._shadowMapNumber[s],_=s+\\\"_SHADOWMAP_COUNT\\\",p=0;p<this._receivers.length;p++)(v=this._receivers[p].material).fragmentDefines[_]!==g&&(0<g?v.define(\\\"fragment\\\",_,g):v.isDefined(\\\"fragment\\\",_)&&v.undefine(\\\"fragment\\\",_));for(p=0;p<this._receivers.length;p++){var v=this._receivers[p].material;o?v.define(\\\"fragment\\\",\\\"SHADOW_CASCADE\\\",o.shadowCascade):v.undefine(\\\"fragment\\\",\\\"SHADOW_CASCADE\\\")}var y,x,a=t.shadowUniforms;0<u.length&&(x=u.map(b),a.directionalLightShadowMaps={value:u,type:\\\"tv\\\"},a.directionalLightMatrices={value:c,type:\\\"m4v\\\"},a.directionalLightShadowMapSizes={value:x,type:\\\"1fv\\\"},o)&&(x=d.slice(),y=d.slice(),x.pop(),y.shift(),x.reverse(),y.reverse(),c.reverse(),a.shadowCascadeClipsNear={value:x,type:\\\"1fv\\\"},a.shadowCascadeClipsFar={value:y,type:\\\"1fv\\\"}),0<l.length&&(x=l.map(b),(a=t.shadowUniforms).spotLightShadowMaps={value:l,type:\\\"tv\\\"},a.spotLightMatrices={value:h,type:\\\"m4v\\\"},a.spotLightShadowMapSizes={value:x,type:\\\"1fv\\\"}),0<f.length&&(a.pointLightShadowMaps={value:f,type:\\\"tv\\\"})}function b(e){return e.height}},renderDirectionalLightShadow:(us=new ei,cs=new M,ds=new ar,fs=new M,ps=new M,ms=new M,gs=new M,function(e,t,r,i,n,a,o){var s=this._getDepthMaterial(i),l={getMaterial:function(e){return e.shadowDepthMaterial||s},isMaterialChanged:hs,getUniform:ls,ifRender:function(e){return e.castShadow},sortCompare:Et.opaqueSortCompare},h=(t.viewBoundingBoxLastFrame.isFinite()||(d=t.getBoundingBox(),t.viewBoundingBoxLastFrame.copy(d).applyTransform(r.viewMatrix)),Math.min(-t.viewBoundingBoxLastFrame.min.z,r.far)),u=Math.max(-t.viewBoundingBoxLastFrame.max.z,r.near),c=this._getDirectionalLightCamera(i,t,r),d=ms.array;gs.copy(c.projectionMatrix),G.invert(ps.array,c.worldTransform.array),G.multiply(ps.array,ps.array,r.worldTransform.array),G.multiply(d,gs.array,ps.array);for(var f=[],p=r instanceof xi,m=(r.near+r.far)/(r.near-r.far),g=2*r.near*r.far/(r.near-r.far),_=0;_<=i.shadowCascade;_++){var v=u*Math.pow(h/u,_/i.shadowCascade),y=u+(h-u)*_/i.shadowCascade,v=v*i.cascadeSplitLogFactor+y*(1-i.cascadeSplitLogFactor);f.push(v),n.push(-(-v*m+g)/-v)}var x=this._getTexture(i,i.shadowCascade),d=(o.push(x),e.viewport),b=e.gl;for(this._frameBuffer.attach(x),this._frameBuffer.bind(e),b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT),_=0;_<i.shadowCascade;_++){var w=f[_],T=f[_+1],w=(p?G.perspective(cs.array,r.fov/180*Math.PI,r.aspect,w,T):G.ortho(cs.array,r.left,r.right,r.bottom,r.top,w,T),us.setFromProjection(cs),us.getTransformedBoundingBox(ds,ps),ds.applyProjection(gs),ds.min.array),T=ds.max.array,w=(w[0]=Math.max(w[0],-1),w[1]=Math.max(w[1],-1),T[0]=Math.min(T[0],1),T[1]=Math.min(T[1],1),fs.ortho(w[0],T[0],w[1],T[1],1,-1),c.projectionMatrix.multiplyLeft(fs),i.shadowResolution||512),T=(e.setViewport((i.shadowCascade-_-1)*w,0,w,w,1),t.updateRenderList(c)),w=(e.renderPass(T.opaque,c,l),this.softShadow===xs.VSM&&this._gaussianFilter(e,x,x.width),new M);w.copy(c.viewMatrix).multiplyLeft(c.projectionMatrix),a.push(w.array),c.projectionMatrix.copy(gs)}this._frameBuffer.unbind(e),e.setViewport(d)}),renderSpotLightShadow:function(e,t,r,i,n){var a=this._getTexture(r),o=this._getSpotLightCamera(r),s=e.gl,l=(this._frameBuffer.attach(a),this._frameBuffer.bind(e),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),this._getDepthMaterial(r)),s={getMaterial:function(e){return e.shadowDepthMaterial||l},isMaterialChanged:hs,getUniform:ls,ifRender:function(e){return e.castShadow},sortCompare:Et.opaqueSortCompare},h=t.updateRenderList(o),h=(e.renderPass(h.opaque,o,s),this._frameBuffer.unbind(e),this.softShadow===xs.VSM&&this._gaussianFilter(e,a,a.width),new M);h.copy(o.worldTransform).invert().multiplyLeft(o.projectionMatrix),n.push(a),i.push(h.array)},renderPointLightShadow:function(e,t,r,i){var n=this._getTexture(r),a=e.gl,o=(i.push(n),this._getDepthMaterial(r)),s={getMaterial:function(e){return e.shadowDepthMaterial||o},getUniform:ls,sortCompare:Et.opaqueSortCompare},h={px:[],py:[],pz:[],nx:[],ny:[],nz:[]},u=new ar,c=r.getWorldPosition().array,d=new ar,l=r.range,l=(d.min.setArray(c),d.max.setArray(c),new z(l,l,l)),f=(d.max.add(l),d.min.sub(l),{px:!1,py:!1,pz:!1,nx:!1,ny:!1,nz:!1});t.traverse(function(e){if(e.isRenderable()&&e.castShadow){var t=e.geometry;if(t.boundingBox){if(u.transformFrom(t.boundingBox,e.worldTransform),u.intersectBoundingBox(d)){for(u.updateVertices(),l=0;l<ss.length;l++)f[ss[l]]=!1;for(l=0;l<8;l++){var r=u.vertices[l],i=r[0]-c[0],n=r[1]-c[1],r=r[2]-c[2],a=Math.abs(i),o=Math.abs(n),s=Math.abs(r);o<a?s<a?f[0<i?\\\"px\\\":\\\"nx\\\"]=!0:f[0<r?\\\"pz\\\":\\\"nz\\\"]=!0:s<o?f[0<n?\\\"py\\\":\\\"ny\\\"]=!0:f[0<r?\\\"pz\\\":\\\"nz\\\"]=!0}for(l=0;l<ss.length;l++)f[ss[l]]&&h[ss[l]].push(e)}}else for(var l=0;l<ss.length;l++)h[ss[l]].push(e)}});for(var p=0;p<6;p++){var m=ss[p],g=this._getPointLightCamera(r,m);this._frameBuffer.attach(n,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+p),this._frameBuffer.bind(e),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),e.renderPass(h[m],g,s)}this._frameBuffer.unbind(e)},_getDepthMaterial:function(e){var t,r=this._lightMaterials[e.__uid__],i=\\\"POINT_LIGHT\\\"===e.type;return r||(t=i?\\\"clay.sm.distance.\\\":\\\"clay.sm.depth.\\\",r=new Fe({precision:this.precision,shader:new S(S.source(t+\\\"vertex\\\"),S.source(t+\\\"fragment\\\"))}),this._lightMaterials[e.__uid__]=r),null!=e.shadowSlopeScale&&r.setUniform(\\\"slopeScale\\\",e.shadowSlopeScale),null!=e.shadowBias&&r.setUniform(\\\"bias\\\",e.shadowBias),this.softShadow===xs.VSM?r.define(\\\"fragment\\\",\\\"USE_VSM\\\"):r.undefine(\\\"fragment\\\",\\\"USE_VSM\\\"),i&&(r.set(\\\"lightPosition\\\",e.getWorldPosition().array),r.set(\\\"range\\\",e.range)),r},_gaussianFilter:function(e,t,r){var i={width:r,height:r,type:B.FLOAT},i=this._texturePool.get(i);this._frameBuffer.attach(i),this._frameBuffer.bind(e),this._gaussianPassH.setUniform(\\\"texture\\\",t),this._gaussianPassH.setUniform(\\\"textureWidth\\\",r),this._gaussianPassH.render(e),this._frameBuffer.attach(t),this._gaussianPassV.setUniform(\\\"texture\\\",i),this._gaussianPassV.setUniform(\\\"textureHeight\\\",r),this._gaussianPassV.render(e),this._frameBuffer.unbind(e),this._texturePool.put(i)},_getTexture:function(e,t){var r=e.__uid__,i=this._textures[r],n=e.shadowResolution||512;return t=t||1,i||((i=new(\\\"POINT_LIGHT\\\"===e.type?yi:k)).width=n*t,i.height=n,this.softShadow===xs.VSM?(i.type=B.FLOAT,i.anisotropic=4):(i.minFilter=ae,i.magFilter=ae,i.useMipmap=!1),this._textures[r]=i),i},_getPointLightCamera:function(e,t){this._lightCameras.point||(this._lightCameras.point={px:new xi,nx:new xi,py:new xi,ny:new xi,pz:new xi,nz:new xi});var r=this._lightCameras.point[t];switch(r.far=e.range,r.fov=90,r.position.set(0,0,0),t){case\\\"px\\\":r.lookAt(z.POSITIVE_X,z.NEGATIVE_Y);break;case\\\"nx\\\":r.lookAt(z.NEGATIVE_X,z.NEGATIVE_Y);break;case\\\"py\\\":r.lookAt(z.POSITIVE_Y,z.POSITIVE_Z);break;case\\\"ny\\\":r.lookAt(z.NEGATIVE_Y,z.NEGATIVE_Z);break;case\\\"pz\\\":r.lookAt(z.POSITIVE_Z,z.NEGATIVE_Y);break;case\\\"nz\\\":r.lookAt(z.NEGATIVE_Z,z.NEGATIVE_Y)}return e.getWorldPosition(r.position),r.update(),r},_getDirectionalLightCamera:(_s=new M,vs=new ar,ys=new ar,function(e,t,r){this._lightCameras.directional||(this._lightCameras.directional=new on);var i=this._lightCameras.directional,n=(vs.copy(t.viewBoundingBoxLastFrame),vs.intersection(r.frustum.boundingBox),i.position.copy(vs.min).add(vs.max).scale(.5).transformMat4(r.worldTransform),i.rotation.copy(e.rotation),i.scale.copy(e.scale),i.updateWorldTransform(),M.invert(_s,i.worldTransform),M.multiply(_s,_s,r.worldTransform),ys.copy(vs).applyTransform(_s),ys.min.array),a=ys.max.array;return i.position.set((n[0]+a[0])/2,(n[1]+a[1])/2,a[2]).transformMat4(i.worldTransform),i.near=0,i.far=-n[2]+a[2],isNaN(this.lightFrustumBias)?i.far*=4:i.far+=this.lightFrustumBias,i.left=n[0],i.right=a[0],i.top=a[1],i.bottom=n[1],i.update(!0),i}),_getSpotLightCamera:function(e){this._lightCameras.spot||(this._lightCameras.spot=new xi);var t=this._lightCameras.spot;return t.fov=2*e.penumbraAngle,t.far=e.range,t.worldTransform.copy(e.worldTransform),t.updateProjectionMatrix(),G.invert(t.viewMatrix.array,t.worldTransform.array),t},dispose:function(e){var t,r=e.gl||e;for(t in this._frameBuffer&&this._frameBuffer.dispose(r),this._textures)this._textures[t].dispose(r);this._texturePool.clear(e.gl),this._depthMaterials={},this._distanceMaterials={},this._textures={},this._lightCameras={},this._shadowMapNumber={POINT_LIGHT:0,DIRECTIONAL_LIGHT:0,SPOT_LIGHT:0},this._meshMaterials={};for(var i=0;i<this._receivers.length;i++){var n=this._receivers[i];n.material&&((n=n.material).undefine(\\\"fragment\\\",\\\"POINT_LIGHT_SHADOW_COUNT\\\"),n.undefine(\\\"fragment\\\",\\\"DIRECTIONAL_LIGHT_SHADOW_COUNT\\\"),n.undefine(\\\"fragment\\\",\\\"AMBIENT_LIGHT_SHADOW_COUNT\\\"),n.set(\\\"shadowEnabled\\\",0))}this._receivers=[],this._lightsCastShadow=[]}});xs.VSM=1,xs.PCF=2;const bs=xs,ws=N.extend(function(){return{name:\\\"\\\",inputLinks:{},outputLinks:{},_prevOutputTextures:{},_outputTextures:{},_outputReferences:{},_rendering:!1,_rendered:!1,_compositor:null}},{updateParameter:function(e,t){var r,i=this.outputs[e],n=i.parameters,a=(a=i._parametersCopy)||(i._parametersCopy={});if(n)for(var o in n)\\\"width\\\"!==o&&\\\"height\\\"!==o&&(a[o]=n[o]);return i=n.width instanceof Function?n.width.call(this,t):n.width,r=n.height instanceof Function?n.height.call(this,t):n.height,a.width===i&&a.height===r||this._outputTextures[e]&&this._outputTextures[e].dispose(t.gl),a.width=i,a.height=r,a},setParameter:function(e,t){},getParameter:function(e){},setParameters:function(e){for(var t in e)this.setParameter(t,e[t])},render:function(){},getOutput:function(e,t){var r;return null==t?this._outputTextures[t=e]:(r=this.outputs[t])?(this._rendered?r.outputLastFrame?this._prevOutputTextures:this._outputTextures:this._rendering?(this._prevOutputTextures[t]||(this._prevOutputTextures[t]=this._compositor.allocateTexture(r.parameters||{})),this._prevOutputTextures):(this.render(e),this._outputTextures))[t]:void 0},removeReference:function(e){this._outputReferences[e]--,0===this._outputReferences[e]&&(this.outputs[e].keepLastFrame?(this._prevOutputTextures[e]&&this._compositor.releaseTexture(this._prevOutputTextures[e]),this._prevOutputTextures[e]=this._outputTextures[e]):this._compositor.releaseTexture(this._outputTextures[e]))},link:function(e,t,r){this.inputLinks[e]={node:t,pin:r},t.outputLinks[r]||(t.outputLinks[r]=[]),t.outputLinks[r].push({node:this,pin:e}),this.pass.material.enableTexture(e)},clear:function(){this.inputLinks={},this.outputLinks={}},updateReference:function(e){if(!this._rendering){for(var t in this._rendering=!0,this.inputLinks){t=this.inputLinks[t];t.node.updateReference(t.pin)}this._rendering=!1}e&&this._outputReferences[e]++},beforeFrame:function(){for(var e in this._rendered=!1,this.outputLinks)this._outputReferences[e]=0},afterFrame:function(){for(var e in this.outputLinks)0<this._outputReferences[e]&&(this.outputs[e].keepLastFrame?(this._prevOutputTextures[e]&&this._compositor.releaseTexture(this._prevOutputTextures[e]),this._prevOutputTextures[e]=this._outputTextures[e]):this._compositor.releaseTexture(this._outputTextures[e]))}}),Ts=N.extend(function(){return{nodes:[]}},{dirty:function(){this._dirty=!0},addNode:function(e){0<=this.nodes.indexOf(e)||(this.nodes.push(e),this._dirty=!0)},removeNode:function(e){\\\"string\\\"==typeof e&&(e=this.getNodeByName(e));var t=this.nodes.indexOf(e);0<=t&&(this.nodes.splice(t,1),this._dirty=!0)},getNodeByName:function(e){for(var t=0;t<this.nodes.length;t++)if(this.nodes[t].name===e)return this.nodes[t]},update:function(){for(var e=0;e<this.nodes.length;e++)this.nodes[e].clear();for(e=0;e<this.nodes.length;e++){var t,r,i=this.nodes[e];if(i.inputs)for(var n in i.inputs)i.inputs[n]&&(!i.pass||i.pass.material.isUniformEnabled(n)?(t=i.inputs[n],(r=this.findPin(t))?i.link(n,r.node,r.pin):\\\"string\\\"==typeof t?console.warn(\\\"Node \\\"+t+\\\" not exist\\\"):console.warn(\\\"Pin of \\\"+t.node+\\\".\\\"+t.pin+\\\" not exist\\\")):console.warn(\\\"Pin \\\"+i.name+\\\".\\\"+n+\\\" not used.\\\"))}},findPin:function(e){var t;if(\\\"string\\\"==typeof(e=\\\"string\\\"==typeof e||e instanceof ws?{node:e}:e).node)for(var r=0;r<this.nodes.length;r++){var i=this.nodes[r];i.name===e.node&&(t=i)}else t=e.node;if(t){var n=e.pin;if(n||t.outputs&&(n=Object.keys(t.outputs)[0]),t.outputs[n])return{node:t,pin:n}}}}),Ss=Ts.extend(function(){return{_outputs:[],_texturePool:new os,_frameBuffer:new Li({depthBuffer:!1})}},{addNode:function(e){Ts.prototype.addNode.call(this,e),e._compositor=this},render:function(e,t){if(this._dirty){this.update(),this._dirty=!1;for(var r=this._outputs.length=0;r<this.nodes.length;r++)this.nodes[r].outputs||this._outputs.push(this.nodes[r])}for(r=0;r<this.nodes.length;r++)this.nodes[r].beforeFrame();for(r=0;r<this._outputs.length;r++)this._outputs[r].updateReference();for(r=0;r<this._outputs.length;r++)this._outputs[r].render(e,t);for(r=0;r<this.nodes.length;r++)this.nodes[r].afterFrame()},allocateTexture:function(e){return this._texturePool.get(e)},releaseTexture:function(e){this._texturePool.put(e)},getFrameBuffer:function(){return this._frameBuffer},dispose:function(e){this._texturePool.clear(e)}}),Ms=ws.extend({name:\\\"scene\\\",scene:null,camera:null,autoUpdateScene:!0,preZ:!1},function(){this.frameBuffer=new Li},{render:function(e){this._rendering=!0;var t=e.gl;if(this.trigger(\\\"beforerender\\\"),this.outputs){var r,i=this.frameBuffer;for(r in this.outputs){var n=this.updateParameter(r,e),a=this.outputs[r],n=this._compositor.allocateTexture(n);this._outputTextures[r]=n,\\\"string\\\"==typeof(s=a.attachment||t.COLOR_ATTACHMENT0)&&(s=t[s]),i.attach(n,s)}i.bind(e);var o=e.getGLExtension(\\\"EXT_draw_buffers\\\");if(o){var s,l=[];for(s in this.outputs)(s=parseInt(s))>=t.COLOR_ATTACHMENT0&&s<=t.COLOR_ATTACHMENT0+8&&l.push(s);o.drawBuffersEXT(l)}e.saveClear(),e.clearBit=16640,o=e.render(this.scene,this.camera,!this.autoUpdateScene,this.preZ),e.restoreClear(),i.unbind(e)}else o=e.render(this.scene,this.camera,!this.autoUpdateScene,this.preZ);this.trigger(\\\"afterrender\\\",o),this._rendering=!1,this._rendered=!0}}),As=ws.extend(function(){return{texture:null,outputs:{color:{}}}},function(){},{getOutput:function(e,t){return this.texture},beforeFrame:function(){},afterFrame:function(){}}),Es=ws.extend(function(){return{name:\\\"\\\",inputs:{},outputs:null,shader:\\\"\\\",inputLinks:{},outputLinks:{},pass:null,_prevOutputTextures:{},_outputTextures:{},_outputReferences:{},_rendering:!1,_rendered:!1,_compositor:null}},function(){var e=new hn({fragment:this.shader});this.pass=e},{render:function(e,t){this.trigger(\\\"beforerender\\\",e),this._rendering=!0;var r,i,n=e.gl;for(r in this.inputLinks){var a=(i=this.inputLinks[r]).node.getOutput(e,i.pin);this.pass.setUniform(r,a)}if(this.outputs){this.pass.outputs={};var o,s,l={};for(o in this.outputs){var h=this.updateParameter(o,e),u=(isNaN(h.width)&&this.updateParameter(o,e),this.outputs[o]),h=this._compositor.allocateTexture(h);this._outputTextures[o]=h,l[s=\\\"string\\\"==typeof(s=u.attachment||n.COLOR_ATTACHMENT0)?n[s]:s]=h}for(s in this._compositor.getFrameBuffer().bind(e),l)this._compositor.getFrameBuffer().attach(l[s],s);this.pass.render(e),this._compositor.getFrameBuffer().updateMipmap(e)}else this.pass.outputs=null,this._compositor.getFrameBuffer().unbind(e),this.pass.render(e,t);for(r in this.inputLinks)(i=this.inputLinks[r]).node.removeReference(i.pin);this._rendering=!1,this._rendered=!0,this.trigger(\\\"afterrender\\\",e)},updateParameter:function(e,t){var r,i=this.outputs[e],n=i.parameters,a=(a=i._parametersCopy)||(i._parametersCopy={});if(n)for(var o in n)\\\"width\\\"!==o&&\\\"height\\\"!==o&&(a[o]=n[o]);return i=\\\"function\\\"==typeof n.width?n.width.call(this,t):n.width,r=\\\"function\\\"==typeof n.height?n.height.call(this,t):n.height,i=Math.ceil(i),r=Math.ceil(r),a.width===i&&a.height===r||this._outputTextures[e]&&this._outputTextures[e].dispose(t),a.width=i,a.height=r,a},setParameter:function(e,t){this.pass.setUniform(e,t)},getParameter:function(e){return this.pass.getUniform(e)},setParameters:function(e){for(var t in e)this.setParameter(t,e[t])},define:function(e,t){this.pass.material.define(\\\"fragment\\\",e,t)},undefine:function(e){this.pass.material.undefine(\\\"fragment\\\",e)},removeReference:function(e){this._outputReferences[e]--,0===this._outputReferences[e]&&(this.outputs[e].keepLastFrame?(this._prevOutputTextures[e]&&this._compositor.releaseTexture(this._prevOutputTextures[e]),this._prevOutputTextures[e]=this._outputTextures[e]):this._compositor.releaseTexture(this._outputTextures[e]))},clear:function(){ws.prototype.clear.call(this),this.pass.material.disableTexturesAll()}}),Cs=\\\"@export clay.compositor.kernel.gaussian_9\\\\nfloat gaussianKernel[9];\\\\ngaussianKernel[0] = 0.07;\\\\ngaussianKernel[1] = 0.09;\\\\ngaussianKernel[2] = 0.12;\\\\ngaussianKernel[3] = 0.14;\\\\ngaussianKernel[4] = 0.16;\\\\ngaussianKernel[5] = 0.14;\\\\ngaussianKernel[6] = 0.12;\\\\ngaussianKernel[7] = 0.09;\\\\ngaussianKernel[8] = 0.07;\\\\n@end\\\\n@export clay.compositor.kernel.gaussian_13\\\\nfloat gaussianKernel[13];\\\\ngaussianKernel[0] = 0.02;\\\\ngaussianKernel[1] = 0.03;\\\\ngaussianKernel[2] = 0.06;\\\\ngaussianKernel[3] = 0.08;\\\\ngaussianKernel[4] = 0.11;\\\\ngaussianKernel[5] = 0.13;\\\\ngaussianKernel[6] = 0.14;\\\\ngaussianKernel[7] = 0.13;\\\\ngaussianKernel[8] = 0.11;\\\\ngaussianKernel[9] = 0.08;\\\\ngaussianKernel[10] = 0.06;\\\\ngaussianKernel[11] = 0.03;\\\\ngaussianKernel[12] = 0.02;\\\\n@end\\\\n@export clay.compositor.gaussian_blur\\\\n#define SHADER_NAME gaussian_blur\\\\nuniform sampler2D texture;varying vec2 v_Texcoord;\\\\nuniform float blurSize : 2.0;\\\\nuniform vec2 textureSize : [512.0, 512.0];\\\\nuniform float blurDir : 0.0;\\\\n@import clay.util.rgbm\\\\n@import clay.util.clamp_sample\\\\nvoid main (void)\\\\n{\\\\n @import clay.compositor.kernel.gaussian_9\\\\n vec2 off = blurSize / textureSize;\\\\n off *= vec2(1.0 - blurDir, blurDir);\\\\n vec4 sum = vec4(0.0);\\\\n float weightAll = 0.0;\\\\n for (int i = 0; i < 9; i++) {\\\\n float w = gaussianKernel[i];\\\\n vec4 texel = decodeHDR(clampSample(texture, v_Texcoord + float(i - 4) * off));\\\\n sum += texel * w;\\\\n weightAll += w;\\\\n }\\\\n gl_FragColor = encodeHDR(sum / max(weightAll, 0.01));\\\\n}\\\\n@end\\\\n\\\",Ds=\\\"\\\\n@export clay.compositor.lut\\\\nvarying vec2 v_Texcoord;\\\\nuniform sampler2D texture;\\\\nuniform sampler2D lookup;\\\\nvoid main()\\\\n{\\\\n vec4 tex = texture2D(texture, v_Texcoord);\\\\n float blueColor = tex.b * 63.0;\\\\n vec2 quad1;\\\\n quad1.y = floor(floor(blueColor) / 8.0);\\\\n quad1.x = floor(blueColor) - (quad1.y * 8.0);\\\\n vec2 quad2;\\\\n quad2.y = floor(ceil(blueColor) / 8.0);\\\\n quad2.x = ceil(blueColor) - (quad2.y * 8.0);\\\\n vec2 texPos1;\\\\n texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.r);\\\\n texPos1.y = (quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.g);\\\\n vec2 texPos2;\\\\n texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.r);\\\\n texPos2.y = (quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.g);\\\\n vec4 newColor1 = texture2D(lookup, texPos1);\\\\n vec4 newColor2 = texture2D(lookup, texPos2);\\\\n vec4 newColor = mix(newColor1, newColor2, fract(blueColor));\\\\n gl_FragColor = vec4(newColor.rgb, tex.w);\\\\n}\\\\n@end\\\",Ls=\\\"@export clay.compositor.output\\\\n#define OUTPUT_ALPHA\\\\nvarying vec2 v_Texcoord;\\\\nuniform sampler2D texture;\\\\n@import clay.util.rgbm\\\\nvoid main()\\\\n{\\\\n vec4 tex = decodeHDR(texture2D(texture, v_Texcoord));\\\\n gl_FragColor.rgb = tex.rgb;\\\\n#ifdef OUTPUT_ALPHA\\\\n gl_FragColor.a = tex.a;\\\\n#else\\\\n gl_FragColor.a = 1.0;\\\\n#endif\\\\n gl_FragColor = encodeHDR(gl_FragColor);\\\\n#ifdef PREMULTIPLY_ALPHA\\\\n gl_FragColor.rgb *= gl_FragColor.a;\\\\n#endif\\\\n}\\\\n@end\\\",Ps=\\\"@export clay.compositor.bright\\\\nuniform sampler2D texture;\\\\nuniform float threshold : 1;\\\\nuniform float scale : 1.0;\\\\nuniform vec2 textureSize: [512, 512];\\\\nvarying vec2 v_Texcoord;\\\\nconst vec3 lumWeight = vec3(0.2125, 0.7154, 0.0721);\\\\n@import clay.util.rgbm\\\\nvec4 median(vec4 a, vec4 b, vec4 c)\\\\n{\\\\n return a + b + c - min(min(a, b), c) - max(max(a, b), c);\\\\n}\\\\nvoid main()\\\\n{\\\\n vec4 texel = decodeHDR(texture2D(texture, v_Texcoord));\\\\n#ifdef ANTI_FLICKER\\\\n vec3 d = 1.0 / textureSize.xyx * vec3(1.0, 1.0, 0.0);\\\\n vec4 s1 = decodeHDR(texture2D(texture, v_Texcoord - d.xz));\\\\n vec4 s2 = decodeHDR(texture2D(texture, v_Texcoord + d.xz));\\\\n vec4 s3 = decodeHDR(texture2D(texture, v_Texcoord - d.zy));\\\\n vec4 s4 = decodeHDR(texture2D(texture, v_Texcoord + d.zy));\\\\n texel = median(median(texel, s1, s2), s3, s4);\\\\n#endif\\\\n float lum = dot(texel.rgb , lumWeight);\\\\n vec4 color;\\\\n if (lum > threshold && texel.a > 0.0)\\\\n {\\\\n color = vec4(texel.rgb * scale, texel.a * scale);\\\\n }\\\\n else\\\\n {\\\\n color = vec4(0.0);\\\\n }\\\\n gl_FragColor = encodeHDR(color);\\\\n}\\\\n@end\\\\n\\\",Os=\\\"@export clay.compositor.downsample\\\\nuniform sampler2D texture;\\\\nuniform vec2 textureSize : [512, 512];\\\\nvarying vec2 v_Texcoord;\\\\n@import clay.util.rgbm\\\\nfloat brightness(vec3 c)\\\\n{\\\\n return max(max(c.r, c.g), c.b);\\\\n}\\\\n@import clay.util.clamp_sample\\\\nvoid main()\\\\n{\\\\n vec4 d = vec4(-1.0, -1.0, 1.0, 1.0) / textureSize.xyxy;\\\\n#ifdef ANTI_FLICKER\\\\n vec3 s1 = decodeHDR(clampSample(texture, v_Texcoord + d.xy)).rgb;\\\\n vec3 s2 = decodeHDR(clampSample(texture, v_Texcoord + d.zy)).rgb;\\\\n vec3 s3 = decodeHDR(clampSample(texture, v_Texcoord + d.xw)).rgb;\\\\n vec3 s4 = decodeHDR(clampSample(texture, v_Texcoord + d.zw)).rgb;\\\\n float s1w = 1.0 / (brightness(s1) + 1.0);\\\\n float s2w = 1.0 / (brightness(s2) + 1.0);\\\\n float s3w = 1.0 / (brightness(s3) + 1.0);\\\\n float s4w = 1.0 / (brightness(s4) + 1.0);\\\\n float oneDivideSum = 1.0 / (s1w + s2w + s3w + s4w);\\\\n vec4 color = vec4(\\\\n (s1 * s1w + s2 * s2w + s3 * s3w + s4 * s4w) * oneDivideSum,\\\\n 1.0\\\\n );\\\\n#else\\\\n vec4 color = decodeHDR(clampSample(texture, v_Texcoord + d.xy));\\\\n color += decodeHDR(clampSample(texture, v_Texcoord + d.zy));\\\\n color += decodeHDR(clampSample(texture, v_Texcoord + d.xw));\\\\n color += decodeHDR(clampSample(texture, v_Texcoord + d.zw));\\\\n color *= 0.25;\\\\n#endif\\\\n gl_FragColor = encodeHDR(color);\\\\n}\\\\n@end\\\",Ns=\\\"\\\\n@export clay.compositor.upsample\\\\n#define HIGH_QUALITY\\\\nuniform sampler2D texture;\\\\nuniform vec2 textureSize : [512, 512];\\\\nuniform float sampleScale: 0.5;\\\\nvarying vec2 v_Texcoord;\\\\n@import clay.util.rgbm\\\\n@import clay.util.clamp_sample\\\\nvoid main()\\\\n{\\\\n#ifdef HIGH_QUALITY\\\\n vec4 d = vec4(1.0, 1.0, -1.0, 0.0) / textureSize.xyxy * sampleScale;\\\\n vec4 s;\\\\n s = decodeHDR(clampSample(texture, v_Texcoord - d.xy));\\\\n s += decodeHDR(clampSample(texture, v_Texcoord - d.wy)) * 2.0;\\\\n s += decodeHDR(clampSample(texture, v_Texcoord - d.zy));\\\\n s += decodeHDR(clampSample(texture, v_Texcoord + d.zw)) * 2.0;\\\\n s += decodeHDR(clampSample(texture, v_Texcoord )) * 4.0;\\\\n s += decodeHDR(clampSample(texture, v_Texcoord + d.xw)) * 2.0;\\\\n s += decodeHDR(clampSample(texture, v_Texcoord + d.zy));\\\\n s += decodeHDR(clampSample(texture, v_Texcoord + d.wy)) * 2.0;\\\\n s += decodeHDR(clampSample(texture, v_Texcoord + d.xy));\\\\n gl_FragColor = encodeHDR(s / 16.0);\\\\n#else\\\\n vec4 d = vec4(-1.0, -1.0, +1.0, +1.0) / textureSize.xyxy;\\\\n vec4 s;\\\\n s = decodeHDR(clampSample(texture, v_Texcoord + d.xy));\\\\n s += decodeHDR(clampSample(texture, v_Texcoord + d.zy));\\\\n s += decodeHDR(clampSample(texture, v_Texcoord + d.xw));\\\\n s += decodeHDR(clampSample(texture, v_Texcoord + d.zw));\\\\n gl_FragColor = encodeHDR(s / 4.0);\\\\n#endif\\\\n}\\\\n@end\\\",Is=\\\"@export clay.compositor.hdr.composite\\\\n#define TONEMAPPING\\\\nuniform sampler2D texture;\\\\n#ifdef BLOOM_ENABLED\\\\nuniform sampler2D bloom;\\\\n#endif\\\\n#ifdef LENSFLARE_ENABLED\\\\nuniform sampler2D lensflare;\\\\nuniform sampler2D lensdirt;\\\\n#endif\\\\n#ifdef LUM_ENABLED\\\\nuniform sampler2D lum;\\\\n#endif\\\\n#ifdef LUT_ENABLED\\\\nuniform sampler2D lut;\\\\n#endif\\\\n#ifdef COLOR_CORRECTION\\\\nuniform float brightness : 0.0;\\\\nuniform float contrast : 1.0;\\\\nuniform float saturation : 1.0;\\\\n#endif\\\\n#ifdef VIGNETTE\\\\nuniform float vignetteDarkness: 1.0;\\\\nuniform float vignetteOffset: 1.0;\\\\n#endif\\\\nuniform float exposure : 1.0;\\\\nuniform float bloomIntensity : 0.25;\\\\nuniform float lensflareIntensity : 1;\\\\nvarying vec2 v_Texcoord;\\\\n@import clay.util.srgb\\\\nvec3 ACESToneMapping(vec3 color)\\\\n{\\\\n const float A = 2.51;\\\\n const float B = 0.03;\\\\n const float C = 2.43;\\\\n const float D = 0.59;\\\\n const float E = 0.14;\\\\n return (color * (A * color + B)) / (color * (C * color + D) + E);\\\\n}\\\\nfloat eyeAdaption(float fLum)\\\\n{\\\\n return mix(0.2, fLum, 0.5);\\\\n}\\\\n#ifdef LUT_ENABLED\\\\nvec3 lutTransform(vec3 color) {\\\\n float blueColor = color.b * 63.0;\\\\n vec2 quad1;\\\\n quad1.y = floor(floor(blueColor) / 8.0);\\\\n quad1.x = floor(blueColor) - (quad1.y * 8.0);\\\\n vec2 quad2;\\\\n quad2.y = floor(ceil(blueColor) / 8.0);\\\\n quad2.x = ceil(blueColor) - (quad2.y * 8.0);\\\\n vec2 texPos1;\\\\n texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * color.r);\\\\n texPos1.y = (quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * color.g);\\\\n vec2 texPos2;\\\\n texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * color.r);\\\\n texPos2.y = (quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * color.g);\\\\n vec4 newColor1 = texture2D(lut, texPos1);\\\\n vec4 newColor2 = texture2D(lut, texPos2);\\\\n vec4 newColor = mix(newColor1, newColor2, fract(blueColor));\\\\n return newColor.rgb;\\\\n}\\\\n#endif\\\\n@import clay.util.rgbm\\\\nvoid main()\\\\n{\\\\n vec4 texel = vec4(0.0);\\\\n vec4 originalTexel = vec4(0.0);\\\\n#ifdef TEXTURE_ENABLED\\\\n texel = decodeHDR(texture2D(texture, v_Texcoord));\\\\n originalTexel = texel;\\\\n#endif\\\\n#ifdef BLOOM_ENABLED\\\\n vec4 bloomTexel = decodeHDR(texture2D(bloom, v_Texcoord));\\\\n texel.rgb += bloomTexel.rgb * bloomIntensity;\\\\n texel.a += bloomTexel.a * bloomIntensity;\\\\n#endif\\\\n#ifdef LENSFLARE_ENABLED\\\\n texel += decodeHDR(texture2D(lensflare, v_Texcoord)) * texture2D(lensdirt, v_Texcoord) * lensflareIntensity;\\\\n#endif\\\\n texel.a = min(texel.a, 1.0);\\\\n#ifdef LUM_ENABLED\\\\n float fLum = texture2D(lum, vec2(0.5, 0.5)).r;\\\\n float adaptedLumDest = 3.0 / (max(0.1, 1.0 + 10.0*eyeAdaption(fLum)));\\\\n float exposureBias = adaptedLumDest * exposure;\\\\n#else\\\\n float exposureBias = exposure;\\\\n#endif\\\\n#ifdef TONEMAPPING\\\\n texel.rgb *= exposureBias;\\\\n texel.rgb = ACESToneMapping(texel.rgb);\\\\n#endif\\\\n texel = linearTosRGB(texel);\\\\n#ifdef LUT_ENABLED\\\\n texel.rgb = lutTransform(clamp(texel.rgb,vec3(0.0),vec3(1.0)));\\\\n#endif\\\\n#ifdef COLOR_CORRECTION\\\\n texel.rgb = clamp(texel.rgb + vec3(brightness), 0.0, 1.0);\\\\n texel.rgb = clamp((texel.rgb - vec3(0.5))*contrast+vec3(0.5), 0.0, 1.0);\\\\n float lum = dot(texel.rgb, vec3(0.2125, 0.7154, 0.0721));\\\\n texel.rgb = mix(vec3(lum), texel.rgb, saturation);\\\\n#endif\\\\n#ifdef VIGNETTE\\\\n vec2 uv = (v_Texcoord - vec2(0.5)) * vec2(vignetteOffset);\\\\n texel.rgb = mix(texel.rgb, vec3(1.0 - vignetteDarkness), dot(uv, uv));\\\\n#endif\\\\n gl_FragColor = encodeHDR(texel);\\\\n#ifdef DEBUG\\\\n #if DEBUG == 1\\\\n gl_FragColor = encodeHDR(decodeHDR(texture2D(texture, v_Texcoord)));\\\\n #elif DEBUG == 2\\\\n gl_FragColor = encodeHDR(decodeHDR(texture2D(bloom, v_Texcoord)) * bloomIntensity);\\\\n #elif DEBUG == 3\\\\n gl_FragColor = encodeHDR(decodeHDR(texture2D(lensflare, v_Texcoord) * lensflareIntensity));\\\\n #endif\\\\n#endif\\\\n if (originalTexel.a <= 0.01 && gl_FragColor.a > 1e-5) {\\\\n gl_FragColor.a = dot(gl_FragColor.rgb, vec3(0.2125, 0.7154, 0.0721));\\\\n }\\\\n#ifdef PREMULTIPLY_ALPHA\\\\n gl_FragColor.rgb *= gl_FragColor.a;\\\\n#endif\\\\n}\\\\n@end\\\",Rs=\\\"@export clay.compositor.blend\\\\n#define SHADER_NAME blend\\\\n#ifdef TEXTURE1_ENABLED\\\\nuniform sampler2D texture1;\\\\nuniform float weight1 : 1.0;\\\\n#endif\\\\n#ifdef TEXTURE2_ENABLED\\\\nuniform sampler2D texture2;\\\\nuniform float weight2 : 1.0;\\\\n#endif\\\\n#ifdef TEXTURE3_ENABLED\\\\nuniform sampler2D texture3;\\\\nuniform float weight3 : 1.0;\\\\n#endif\\\\n#ifdef TEXTURE4_ENABLED\\\\nuniform sampler2D texture4;\\\\nuniform float weight4 : 1.0;\\\\n#endif\\\\n#ifdef TEXTURE5_ENABLED\\\\nuniform sampler2D texture5;\\\\nuniform float weight5 : 1.0;\\\\n#endif\\\\n#ifdef TEXTURE6_ENABLED\\\\nuniform sampler2D texture6;\\\\nuniform float weight6 : 1.0;\\\\n#endif\\\\nvarying vec2 v_Texcoord;\\\\n@import clay.util.rgbm\\\\nvoid main()\\\\n{\\\\n vec4 tex = vec4(0.0);\\\\n#ifdef TEXTURE1_ENABLED\\\\n tex += decodeHDR(texture2D(texture1, v_Texcoord)) * weight1;\\\\n#endif\\\\n#ifdef TEXTURE2_ENABLED\\\\n tex += decodeHDR(texture2D(texture2, v_Texcoord)) * weight2;\\\\n#endif\\\\n#ifdef TEXTURE3_ENABLED\\\\n tex += decodeHDR(texture2D(texture3, v_Texcoord)) * weight3;\\\\n#endif\\\\n#ifdef TEXTURE4_ENABLED\\\\n tex += decodeHDR(texture2D(texture4, v_Texcoord)) * weight4;\\\\n#endif\\\\n#ifdef TEXTURE5_ENABLED\\\\n tex += decodeHDR(texture2D(texture5, v_Texcoord)) * weight5;\\\\n#endif\\\\n#ifdef TEXTURE6_ENABLED\\\\n tex += decodeHDR(texture2D(texture6, v_Texcoord)) * weight6;\\\\n#endif\\\\n gl_FragColor = encodeHDR(tex);\\\\n}\\\\n@end\\\",Bs=\\\"@export clay.compositor.fxaa\\\\nuniform sampler2D texture;\\\\nuniform vec4 viewport : VIEWPORT;\\\\nvarying vec2 v_Texcoord;\\\\n#define FXAA_REDUCE_MIN (1.0/128.0)\\\\n#define FXAA_REDUCE_MUL (1.0/8.0)\\\\n#define FXAA_SPAN_MAX 8.0\\\\n@import clay.util.rgbm\\\\nvoid main()\\\\n{\\\\n vec2 resolution = 1.0 / viewport.zw;\\\\n vec3 rgbNW = decodeHDR( texture2D( texture, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * resolution ) ).xyz;\\\\n vec3 rgbNE = decodeHDR( texture2D( texture, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * resolution ) ).xyz;\\\\n vec3 rgbSW = decodeHDR( texture2D( texture, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * resolution ) ).xyz;\\\\n vec3 rgbSE = decodeHDR( texture2D( texture, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * resolution ) ).xyz;\\\\n vec4 rgbaM = decodeHDR( texture2D( texture, gl_FragCoord.xy * resolution ) );\\\\n vec3 rgbM = rgbaM.xyz;\\\\n float opacity = rgbaM.w;\\\\n vec3 luma = vec3( 0.299, 0.587, 0.114 );\\\\n float lumaNW = dot( rgbNW, luma );\\\\n float lumaNE = dot( rgbNE, luma );\\\\n float lumaSW = dot( rgbSW, luma );\\\\n float lumaSE = dot( rgbSE, luma );\\\\n float lumaM = dot( rgbM, luma );\\\\n float lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );\\\\n float lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );\\\\n vec2 dir;\\\\n dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\\\\n dir.y = ((lumaNW + lumaSW) - (lumaNE + lumaSE));\\\\n float dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );\\\\n float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );\\\\n dir = min( vec2( FXAA_SPAN_MAX, FXAA_SPAN_MAX),\\\\n max( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\\\\n dir * rcpDirMin)) * resolution;\\\\n vec3 rgbA = decodeHDR( texture2D( texture, gl_FragCoord.xy * resolution + dir * ( 1.0 / 3.0 - 0.5 ) ) ).xyz;\\\\n rgbA += decodeHDR( texture2D( texture, gl_FragCoord.xy * resolution + dir * ( 2.0 / 3.0 - 0.5 ) ) ).xyz;\\\\n rgbA *= 0.5;\\\\n vec3 rgbB = decodeHDR( texture2D( texture, gl_FragCoord.xy * resolution + dir * -0.5 ) ).xyz;\\\\n rgbB += decodeHDR( texture2D( texture, gl_FragCoord.xy * resolution + dir * 0.5 ) ).xyz;\\\\n rgbB *= 0.25;\\\\n rgbB += rgbA * 0.5;\\\\n float lumaB = dot( rgbB, luma );\\\\n if ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) )\\\\n {\\\\n gl_FragColor = vec4( rgbA, opacity );\\\\n }\\\\n else {\\\\n gl_FragColor = vec4( rgbB, opacity );\\\\n }\\\\n}\\\\n@end\\\";(D=S)[\\\"import\\\"](\\\"@export clay.compositor.coloradjust\\\\nvarying vec2 v_Texcoord;\\\\nuniform sampler2D texture;\\\\nuniform float brightness : 0.0;\\\\nuniform float contrast : 1.0;\\\\nuniform float exposure : 0.0;\\\\nuniform float gamma : 1.0;\\\\nuniform float saturation : 1.0;\\\\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\\\\nvoid main()\\\\n{\\\\n vec4 tex = texture2D( texture, v_Texcoord);\\\\n vec3 color = clamp(tex.rgb + vec3(brightness), 0.0, 1.0);\\\\n color = clamp( (color-vec3(0.5))*contrast+vec3(0.5), 0.0, 1.0);\\\\n color = clamp( color * pow(2.0, exposure), 0.0, 1.0);\\\\n color = clamp( pow(color, vec3(gamma)), 0.0, 1.0);\\\\n float luminance = dot( color, w );\\\\n color = mix(vec3(luminance), color, saturation);\\\\n gl_FragColor = vec4(color, tex.a);\\\\n}\\\\n@end\\\\n@export clay.compositor.brightness\\\\nvarying vec2 v_Texcoord;\\\\nuniform sampler2D texture;\\\\nuniform float brightness : 0.0;\\\\nvoid main()\\\\n{\\\\n vec4 tex = texture2D( texture, v_Texcoord);\\\\n vec3 color = tex.rgb + vec3(brightness);\\\\n gl_FragColor = vec4(color, tex.a);\\\\n}\\\\n@end\\\\n@export clay.compositor.contrast\\\\nvarying vec2 v_Texcoord;\\\\nuniform sampler2D texture;\\\\nuniform float contrast : 1.0;\\\\nvoid main()\\\\n{\\\\n vec4 tex = texture2D( texture, v_Texcoord);\\\\n vec3 color = (tex.rgb-vec3(0.5))*contrast+vec3(0.5);\\\\n gl_FragColor = vec4(color, tex.a);\\\\n}\\\\n@end\\\\n@export clay.compositor.exposure\\\\nvarying vec2 v_Texcoord;\\\\nuniform sampler2D texture;\\\\nuniform float exposure : 0.0;\\\\nvoid main()\\\\n{\\\\n vec4 tex = texture2D(texture, v_Texcoord);\\\\n vec3 color = tex.rgb * pow(2.0, exposure);\\\\n gl_FragColor = vec4(color, tex.a);\\\\n}\\\\n@end\\\\n@export clay.compositor.gamma\\\\nvarying vec2 v_Texcoord;\\\\nuniform sampler2D texture;\\\\nuniform float gamma : 1.0;\\\\nvoid main()\\\\n{\\\\n vec4 tex = texture2D(texture, v_Texcoord);\\\\n vec3 color = pow(tex.rgb, vec3(gamma));\\\\n gl_FragColor = vec4(color, tex.a);\\\\n}\\\\n@end\\\\n@export clay.compositor.saturation\\\\nvarying vec2 v_Texcoord;\\\\nuniform sampler2D texture;\\\\nuniform float saturation : 1.0;\\\\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\\\\nvoid main()\\\\n{\\\\n vec4 tex = texture2D(texture, v_Texcoord);\\\\n vec3 color = tex.rgb;\\\\n float luminance = dot(color, w);\\\\n color = mix(vec3(luminance), color, saturation);\\\\n gl_FragColor = vec4(color, tex.a);\\\\n}\\\\n@end\\\"),D[\\\"import\\\"](Cs),D[\\\"import\\\"](\\\"@export clay.compositor.hdr.log_lum\\\\nvarying vec2 v_Texcoord;\\\\nuniform sampler2D texture;\\\\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\\\\n@import clay.util.rgbm\\\\nvoid main()\\\\n{\\\\n vec4 tex = decodeHDR(texture2D(texture, v_Texcoord));\\\\n float luminance = dot(tex.rgb, w);\\\\n luminance = log(luminance + 0.001);\\\\n gl_FragColor = encodeHDR(vec4(vec3(luminance), 1.0));\\\\n}\\\\n@end\\\\n@export clay.compositor.hdr.lum_adaption\\\\nvarying vec2 v_Texcoord;\\\\nuniform sampler2D adaptedLum;\\\\nuniform sampler2D currentLum;\\\\nuniform float frameTime : 0.02;\\\\n@import clay.util.rgbm\\\\nvoid main()\\\\n{\\\\n float fAdaptedLum = decodeHDR(texture2D(adaptedLum, vec2(0.5, 0.5))).r;\\\\n float fCurrentLum = exp(encodeHDR(texture2D(currentLum, vec2(0.5, 0.5))).r);\\\\n fAdaptedLum += (fCurrentLum - fAdaptedLum) * (1.0 - pow(0.98, 30.0 * frameTime));\\\\n gl_FragColor = encodeHDR(vec4(vec3(fAdaptedLum), 1.0));\\\\n}\\\\n@end\\\\n@export clay.compositor.lum\\\\nvarying vec2 v_Texcoord;\\\\nuniform sampler2D texture;\\\\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\\\\nvoid main()\\\\n{\\\\n vec4 tex = texture2D( texture, v_Texcoord );\\\\n float luminance = dot(tex.rgb, w);\\\\n gl_FragColor = vec4(vec3(luminance), 1.0);\\\\n}\\\\n@end\\\"),D[\\\"import\\\"](Ds),D[\\\"import\\\"](\\\"@export clay.compositor.vignette\\\\n#define OUTPUT_ALPHA\\\\nvarying vec2 v_Texcoord;\\\\nuniform sampler2D texture;\\\\nuniform float darkness: 1;\\\\nuniform float offset: 1;\\\\n@import clay.util.rgbm\\\\nvoid main()\\\\n{\\\\n vec4 texel = decodeHDR(texture2D(texture, v_Texcoord));\\\\n gl_FragColor.rgb = texel.rgb;\\\\n vec2 uv = (v_Texcoord - vec2(0.5)) * vec2(offset);\\\\n gl_FragColor = encodeHDR(vec4(mix(texel.rgb, vec3(1.0 - darkness), dot(uv, uv)), texel.a));\\\\n}\\\\n@end\\\"),D[\\\"import\\\"](Ls),D[\\\"import\\\"](Ps),D[\\\"import\\\"](Os),D[\\\"import\\\"](Ns),D[\\\"import\\\"](Is),D[\\\"import\\\"](\\\"@export clay.compositor.lensflare\\\\n#define SAMPLE_NUMBER 8\\\\nuniform sampler2D texture;\\\\nuniform sampler2D lenscolor;\\\\nuniform vec2 textureSize : [512, 512];\\\\nuniform float dispersal : 0.3;\\\\nuniform float haloWidth : 0.4;\\\\nuniform float distortion : 1.0;\\\\nvarying vec2 v_Texcoord;\\\\n@import clay.util.rgbm\\\\nvec4 textureDistorted(\\\\n in vec2 texcoord,\\\\n in vec2 direction,\\\\n in vec3 distortion\\\\n) {\\\\n return vec4(\\\\n decodeHDR(texture2D(texture, texcoord + direction * distortion.r)).r,\\\\n decodeHDR(texture2D(texture, texcoord + direction * distortion.g)).g,\\\\n decodeHDR(texture2D(texture, texcoord + direction * distortion.b)).b,\\\\n 1.0\\\\n );\\\\n}\\\\nvoid main()\\\\n{\\\\n vec2 texcoord = -v_Texcoord + vec2(1.0); vec2 textureOffset = 1.0 / textureSize;\\\\n vec2 ghostVec = (vec2(0.5) - texcoord) * dispersal;\\\\n vec2 haloVec = normalize(ghostVec) * haloWidth;\\\\n vec3 distortion = vec3(-textureOffset.x * distortion, 0.0, textureOffset.x * distortion);\\\\n vec4 result = vec4(0.0);\\\\n for (int i = 0; i < SAMPLE_NUMBER; i++)\\\\n {\\\\n vec2 offset = fract(texcoord + ghostVec * float(i));\\\\n float weight = length(vec2(0.5) - offset) / length(vec2(0.5));\\\\n weight = pow(1.0 - weight, 10.0);\\\\n result += textureDistorted(offset, normalize(ghostVec), distortion) * weight;\\\\n }\\\\n result *= texture2D(lenscolor, vec2(length(vec2(0.5) - texcoord)) / length(vec2(0.5)));\\\\n float weight = length(vec2(0.5) - fract(texcoord + haloVec)) / length(vec2(0.5));\\\\n weight = pow(1.0 - weight, 10.0);\\\\n vec2 offset = fract(texcoord + haloVec);\\\\n result += textureDistorted(offset, normalize(ghostVec), distortion) * weight;\\\\n gl_FragColor = result;\\\\n}\\\\n@end\\\"),D[\\\"import\\\"](Rs),D[\\\"import\\\"](Bs);var Fs=/^#source\\\\((.*?)\\\\)/;function zs(e,t,r){var i,n,a,o,s=e.type||\\\"filter\\\";if(\\\"filter\\\"===s){var l=e.shader.trim(),h=Fs.exec(l);if(h?i=S.source(h[1].trim()):\\\"#\\\"===l.charAt(0)&&(i=t.shaders[l.substr(1)]),!(i=i||l))return}if(e.inputs)for(var u in n={},e.inputs)\\\"string\\\"==typeof e.inputs[u]?n[u]=e.inputs[u]:n[u]={node:e.inputs[u].node,pin:e.inputs[u].pin};if(e.outputs)for(var u in a={},e.outputs){var c=e.outputs[u];a[u]={},null!=c.attachment&&(a[u].attachment=c.attachment),null!=c.keepLastFrame&&(a[u].keepLastFrame=c.keepLastFrame),null!=c.outputLastFrame&&(a[u].outputLastFrame=c.outputLastFrame),c.parameters&&(a[u].parameters=ks(c.parameters))}if(o=\\\"scene\\\"===s?new Ms({name:e.name,scene:r.scene,camera:r.camera,outputs:a}):\\\"texture\\\"===s?new As({name:e.name,outputs:a}):new Es({name:e.name,shader:i,inputs:n,outputs:a})){if(e.parameters)for(var u in e.parameters)\\\"string\\\"==typeof(d=e.parameters[u])?\\\"#\\\"===(d=d.trim()).charAt(0)?d=t.textures[d.substr(1)]:o.on(\\\"beforerender\\\",function(n,a){return function(e){var t=e.getDevicePixelRatio(),r=e.getWidth(),i=e.getHeight(),r=a(r,i,t);this.setParameter(n,r)}}(u,Vs(d))):\\\"function\\\"==typeof d&&o.on(\\\"beforerender\\\",d),o.setParameter(u,d);if(e.defines&&o.pass)for(var u in e.defines){var d=e.defines[u];o.pass.material.define(\\\"fragment\\\",u,d)}}return o}function Gs(e,t){return e}function Us(e,t){return t}function ks(r){var i,o={};return r&&([\\\"type\\\",\\\"minFilter\\\",\\\"magFilter\\\",\\\"wrapS\\\",\\\"wrapT\\\",\\\"flipY\\\",\\\"useMipmap\\\"].forEach(function(e){var t=r[e];null!=t&&(\\\"string\\\"==typeof t&&(t=B[t]),o[e]=t)}),i=r.scale||1,[\\\"width\\\",\\\"height\\\"].forEach(function(e){var t,n,a;null!=r[e]&&(\\\"string\\\"==typeof(t=r[e])?(t=t.trim(),o[e]=(n=Vs(t),a=i||1,function(e){var t=e.getDevicePixelRatio(),r=e.getWidth()*a,i=e.getHeight()*a;return n(r,i,t)})):o[e]=t)}),o.width||(o.width=Gs),o.height||(o.height=Us),null!=r.useMipmap)&&(o.useMipmap=r.useMipmap),o}function Vs(e){var t=/^expr\\\\((.*)\\\\)$/.exec(e);if(t)try{var r=new Function(\\\"width\\\",\\\"height\\\",\\\"dpr\\\",\\\"return \\\"+t[1]);return r(1,1),r}catch(e){throw new Error(\\\"Invalid expression.\\\")}}const Hs=function(e,t){for(var r=0,i=1/t,n=e;0<n;)r+=i*(n%t),n=Math.floor(n/t),i/=t;return r};function Ws(e){for(var t=new Uint8Array(e*e*4),r=0,i=new z,n=0;n<e;n++)for(var a=0;a<e;a++)i.set(2*Math.random()-1,2*Math.random()-1,0).normalize(),t[r++]=255*(.5*i.x+.5),t[r++]=255*(.5*i.y+.5),t[r++]=0,t[r++]=255;return t}function js(e){return new k({pixels:Ws(e),wrapS:B.REPEAT,wrapT:B.REPEAT,width:e,height:e})}function Xs(e){e=e||{},this._ssaoPass=new hn({fragment:S.source(\\\"ecgl.ssao.estimate\\\")}),this._blurPass=new hn({fragment:S.source(\\\"ecgl.ssao.blur\\\")}),this._framebuffer=new Li({depthBuffer:!1}),this._ssaoTexture=new k,this._blurTexture=new k,this._blurTexture2=new k,this._depthTex=e.depthTexture,this._normalTex=e.normalTexture,this.setNoiseSize(4),this.setKernelSize(e.kernelSize||12),null!=e.radius&&this.setParameter(\\\"radius\\\",e.radius),null!=e.power&&this.setParameter(\\\"power\\\",e.power),this._normalTex||(this._ssaoPass.material.disableTexture(\\\"normalTex\\\"),this._blurPass.material.disableTexture(\\\"normalTex\\\")),this._depthTex||this._blurPass.material.disableTexture(\\\"depthTex\\\"),this._blurPass.material.setUniform(\\\"normalTex\\\",this._normalTex),this._blurPass.material.setUniform(\\\"depthTex\\\",this._depthTex)}S[\\\"import\\\"](\\\"@export ecgl.ssao.estimate\\\\n\\\\nuniform sampler2D depthTex;\\\\n\\\\nuniform sampler2D normalTex;\\\\n\\\\nuniform sampler2D noiseTex;\\\\n\\\\nuniform vec2 depthTexSize;\\\\n\\\\nuniform vec2 noiseTexSize;\\\\n\\\\nuniform mat4 projection;\\\\n\\\\nuniform mat4 projectionInv;\\\\n\\\\nuniform mat4 viewInverseTranspose;\\\\n\\\\nuniform vec3 kernel[KERNEL_SIZE];\\\\n\\\\nuniform float radius : 1;\\\\n\\\\nuniform float power : 1;\\\\n\\\\nuniform float bias: 1e-2;\\\\n\\\\nuniform float intensity: 1.0;\\\\n\\\\nvarying vec2 v_Texcoord;\\\\n\\\\nfloat ssaoEstimator(in vec3 originPos, in mat3 kernelBasis) {\\\\n float occlusion = 0.0;\\\\n\\\\n for (int i = 0; i < KERNEL_SIZE; i++) {\\\\n vec3 samplePos = kernel[i];\\\\n#ifdef NORMALTEX_ENABLED\\\\n samplePos = kernelBasis * samplePos;\\\\n#endif\\\\n samplePos = samplePos * radius + originPos;\\\\n\\\\n vec4 texCoord = projection * vec4(samplePos, 1.0);\\\\n texCoord.xy /= texCoord.w;\\\\n\\\\n vec4 depthTexel = texture2D(depthTex, texCoord.xy * 0.5 + 0.5);\\\\n\\\\n float sampleDepth = depthTexel.r * 2.0 - 1.0;\\\\n if (projection[3][3] == 0.0) {\\\\n sampleDepth = projection[3][2] / (sampleDepth * projection[2][3] - projection[2][2]);\\\\n }\\\\n else {\\\\n sampleDepth = (sampleDepth - projection[3][2]) / projection[2][2];\\\\n }\\\\n \\\\n float rangeCheck = smoothstep(0.0, 1.0, radius / abs(originPos.z - sampleDepth));\\\\n occlusion += rangeCheck * step(samplePos.z, sampleDepth - bias);\\\\n }\\\\n#ifdef NORMALTEX_ENABLED\\\\n occlusion = 1.0 - occlusion / float(KERNEL_SIZE);\\\\n#else\\\\n occlusion = 1.0 - clamp((occlusion / float(KERNEL_SIZE) - 0.6) * 2.5, 0.0, 1.0);\\\\n#endif\\\\n return pow(occlusion, power);\\\\n}\\\\n\\\\nvoid main()\\\\n{\\\\n\\\\n vec4 depthTexel = texture2D(depthTex, v_Texcoord);\\\\n\\\\n#ifdef NORMALTEX_ENABLED\\\\n vec4 tex = texture2D(normalTex, v_Texcoord);\\\\n if (dot(tex.rgb, tex.rgb) == 0.0) {\\\\n gl_FragColor = vec4(1.0);\\\\n return;\\\\n }\\\\n vec3 N = tex.rgb * 2.0 - 1.0;\\\\n N = (viewInverseTranspose * vec4(N, 0.0)).xyz;\\\\n\\\\n vec2 noiseTexCoord = depthTexSize / vec2(noiseTexSize) * v_Texcoord;\\\\n vec3 rvec = texture2D(noiseTex, noiseTexCoord).rgb * 2.0 - 1.0;\\\\n vec3 T = normalize(rvec - N * dot(rvec, N));\\\\n vec3 BT = normalize(cross(N, T));\\\\n mat3 kernelBasis = mat3(T, BT, N);\\\\n#else\\\\n if (depthTexel.r > 0.99999) {\\\\n gl_FragColor = vec4(1.0);\\\\n return;\\\\n }\\\\n mat3 kernelBasis;\\\\n#endif\\\\n\\\\n float z = depthTexel.r * 2.0 - 1.0;\\\\n\\\\n vec4 projectedPos = vec4(v_Texcoord * 2.0 - 1.0, z, 1.0);\\\\n vec4 p4 = projectionInv * projectedPos;\\\\n\\\\n vec3 position = p4.xyz / p4.w;\\\\n\\\\n float ao = ssaoEstimator(position, kernelBasis);\\\\n ao = clamp(1.0 - (1.0 - ao) * intensity, 0.0, 1.0);\\\\n gl_FragColor = vec4(vec3(ao), 1.0);\\\\n}\\\\n\\\\n@end\\\\n\\\\n\\\\n@export ecgl.ssao.blur\\\\n#define SHADER_NAME SSAO_BLUR\\\\n\\\\nuniform sampler2D ssaoTexture;\\\\n\\\\n#ifdef NORMALTEX_ENABLED\\\\nuniform sampler2D normalTex;\\\\n#endif\\\\n\\\\nvarying vec2 v_Texcoord;\\\\n\\\\nuniform vec2 textureSize;\\\\nuniform float blurSize : 1.0;\\\\n\\\\nuniform int direction: 0.0;\\\\n\\\\n#ifdef DEPTHTEX_ENABLED\\\\nuniform sampler2D depthTex;\\\\nuniform mat4 projection;\\\\nuniform float depthRange : 0.5;\\\\n\\\\nfloat getLinearDepth(vec2 coord)\\\\n{\\\\n float depth = texture2D(depthTex, coord).r * 2.0 - 1.0;\\\\n return projection[3][2] / (depth * projection[2][3] - projection[2][2]);\\\\n}\\\\n#endif\\\\n\\\\nvoid main()\\\\n{\\\\n float kernel[5];\\\\n kernel[0] = 0.122581;\\\\n kernel[1] = 0.233062;\\\\n kernel[2] = 0.288713;\\\\n kernel[3] = 0.233062;\\\\n kernel[4] = 0.122581;\\\\n\\\\n vec2 off = vec2(0.0);\\\\n if (direction == 0) {\\\\n off[0] = blurSize / textureSize.x;\\\\n }\\\\n else {\\\\n off[1] = blurSize / textureSize.y;\\\\n }\\\\n\\\\n vec2 coord = v_Texcoord;\\\\n\\\\n float sum = 0.0;\\\\n float weightAll = 0.0;\\\\n\\\\n#ifdef NORMALTEX_ENABLED\\\\n vec3 centerNormal = texture2D(normalTex, v_Texcoord).rgb * 2.0 - 1.0;\\\\n#endif\\\\n#if defined(DEPTHTEX_ENABLED)\\\\n float centerDepth = getLinearDepth(v_Texcoord);\\\\n#endif\\\\n\\\\n for (int i = 0; i < 5; i++) {\\\\n vec2 coord = clamp(v_Texcoord + vec2(float(i) - 2.0) * off, vec2(0.0), vec2(1.0));\\\\n\\\\n float w = kernel[i];\\\\n#ifdef NORMALTEX_ENABLED\\\\n vec3 normal = texture2D(normalTex, coord).rgb * 2.0 - 1.0;\\\\n w *= clamp(dot(normal, centerNormal), 0.0, 1.0);\\\\n#endif\\\\n#ifdef DEPTHTEX_ENABLED\\\\n float d = getLinearDepth(coord);\\\\n w *= (1.0 - smoothstep(abs(centerDepth - d) / depthRange, 0.0, 1.0));\\\\n#endif\\\\n\\\\n weightAll += w;\\\\n sum += texture2D(ssaoTexture, coord).r * w;\\\\n }\\\\n\\\\n gl_FragColor = vec4(vec3(sum / weightAll), 1.0);\\\\n}\\\\n\\\\n@end\\\\n\\\"),Xs.prototype.setDepthTexture=function(e){this._depthTex=e},Xs.prototype.setNormalTexture=function(e){this._normalTex=e,this._ssaoPass.material[e?\\\"enableTexture\\\":\\\"disableTexture\\\"](\\\"normalTex\\\"),this.setKernelSize(this._kernelSize)},Xs.prototype.update=function(e,t,r){var i=e.getWidth(),n=e.getHeight(),a=this._ssaoPass,o=this._blurPass,s=(a.setUniform(\\\"kernel\\\",this._kernels[r%this._kernels.length]),a.setUniform(\\\"depthTex\\\",this._depthTex),null!=this._normalTex&&a.setUniform(\\\"normalTex\\\",this._normalTex),a.setUniform(\\\"depthTexSize\\\",[this._depthTex.width,this._depthTex.height]),new M),s=(M.transpose(s,t.worldTransform),a.setUniform(\\\"projection\\\",t.projectionMatrix.array),a.setUniform(\\\"projectionInv\\\",t.invProjectionMatrix.array),a.setUniform(\\\"viewInverseTranspose\\\",s.array),this._ssaoTexture),l=this._blurTexture,h=this._blurTexture2,a=(s.width=i/2,s.height=n/2,l.width=i,l.height=n,h.width=i,h.height=n,this._framebuffer.attach(s),this._framebuffer.bind(e),e.gl.clearColor(1,1,1,1),e.gl.clear(e.gl.COLOR_BUFFER_BIT),a.render(e),o.setUniform(\\\"textureSize\\\",[i/2,n/2]),o.setUniform(\\\"projection\\\",t.projectionMatrix.array),this._framebuffer.attach(l),o.setUniform(\\\"direction\\\",0),o.setUniform(\\\"ssaoTexture\\\",s),o.render(e),this._framebuffer.attach(h),o.setUniform(\\\"textureSize\\\",[i,n]),o.setUniform(\\\"direction\\\",1),o.setUniform(\\\"ssaoTexture\\\",l),o.render(e),this._framebuffer.unbind(e),e.clearColor);e.gl.clearColor(a[0],a[1],a[2],a[3])},Xs.prototype.getTargetTexture=function(){return this._blurTexture2},Xs.prototype.setParameter=function(e,t){\\\"noiseTexSize\\\"===e?this.setNoiseSize(t):\\\"kernelSize\\\"===e?this.setKernelSize(t):\\\"intensity\\\"===e?this._ssaoPass.material.set(\\\"intensity\\\",t):this._ssaoPass.setUniform(e,t)},Xs.prototype.setKernelSize=function(e){this._kernelSize=e,this._ssaoPass.material.define(\\\"fragment\\\",\\\"KERNEL_SIZE\\\",e),this._kernels=this._kernels||[];for(var t=0;t<30;t++)this._kernels[t]=function(e,t,r){var i=new Float32Array(3*e);t=t||0;for(var n=0;n<e;n++){var a=Hs(n+t,2)*(r?1:2)*Math.PI,o=Hs(n+t,3)*Math.PI,s=Math.random(),l=Math.cos(a)*Math.sin(o)*s,h=Math.cos(o)*s,a=Math.sin(a)*Math.sin(o)*s;i[3*n]=l,i[3*n+1]=h,i[3*n+2]=a}return i}(e,t*e,!!this._normalTex)},Xs.prototype.setNoiseSize=function(e){var t=this._ssaoPass.getUniform(\\\"noiseTex\\\");t?(t.data=Ws(e),t.width=t.height=e,t.dirty()):(t=js(e),this._ssaoPass.setUniform(\\\"noiseTex\\\",js(e))),this._ssaoPass.setUniform(\\\"noiseTexSize\\\",[e,e])},Xs.prototype.dispose=function(e){this._blurTexture.dispose(e),this._ssaoTexture.dispose(e),this._blurTexture2.dispose(e)};const qs=Xs;function Zs(e){e=e||{},this._ssrPass=new hn({fragment:S.source(\\\"ecgl.ssr.main\\\"),clearColor:[0,0,0,0]}),this._blurPass1=new hn({fragment:S.source(\\\"ecgl.ssr.blur\\\"),clearColor:[0,0,0,0]}),this._blurPass2=new hn({fragment:S.source(\\\"ecgl.ssr.blur\\\"),clearColor:[0,0,0,0]}),this._blendPass=new hn({fragment:S.source(\\\"clay.compositor.blend\\\")}),this._blendPass.material.disableTexturesAll(),this._blendPass.material.enableTexture([\\\"texture1\\\",\\\"texture2\\\"]),this._ssrPass.setUniform(\\\"gBufferTexture1\\\",e.normalTexture),this._ssrPass.setUniform(\\\"gBufferTexture2\\\",e.depthTexture),this._blurPass1.setUniform(\\\"gBufferTexture1\\\",e.normalTexture),this._blurPass1.setUniform(\\\"gBufferTexture2\\\",e.depthTexture),this._blurPass2.setUniform(\\\"gBufferTexture1\\\",e.normalTexture),this._blurPass2.setUniform(\\\"gBufferTexture2\\\",e.depthTexture),this._blurPass2.material.define(\\\"fragment\\\",\\\"VERTICAL\\\"),this._blurPass2.material.define(\\\"fragment\\\",\\\"BLEND\\\"),this._ssrTexture=new k({type:B.HALF_FLOAT}),this._texture2=new k({type:B.HALF_FLOAT}),this._texture3=new k({type:B.HALF_FLOAT}),this._prevTexture=new k({type:B.HALF_FLOAT}),this._currentTexture=new k({type:B.HALF_FLOAT}),this._frameBuffer=new Li({depthBuffer:!1}),this._normalDistribution=null,this._totalSamples=256,this._samplePerFrame=4,this._ssrPass.material.define(\\\"fragment\\\",\\\"SAMPLE_PER_FRAME\\\",this._samplePerFrame),this._ssrPass.material.define(\\\"fragment\\\",\\\"TOTAL_SAMPLES\\\",this._totalSamples),this._downScale=1}S[\\\"import\\\"](\\\"@export ecgl.ssr.main\\\\n\\\\n#define SHADER_NAME SSR\\\\n#define MAX_ITERATION 20;\\\\n#define SAMPLE_PER_FRAME 5;\\\\n#define TOTAL_SAMPLES 128;\\\\n\\\\nuniform sampler2D sourceTexture;\\\\nuniform sampler2D gBufferTexture1;\\\\nuniform sampler2D gBufferTexture2;\\\\nuniform sampler2D gBufferTexture3;\\\\nuniform samplerCube specularCubemap;\\\\nuniform float specularIntensity: 1;\\\\n\\\\nuniform mat4 projection;\\\\nuniform mat4 projectionInv;\\\\nuniform mat4 toViewSpace;\\\\nuniform mat4 toWorldSpace;\\\\n\\\\nuniform float maxRayDistance: 200;\\\\n\\\\nuniform float pixelStride: 16;\\\\nuniform float pixelStrideZCutoff: 50; \\\\nuniform float screenEdgeFadeStart: 0.9; \\\\nuniform float eyeFadeStart : 0.2; uniform float eyeFadeEnd: 0.8; \\\\nuniform float minGlossiness: 0.2; uniform float zThicknessThreshold: 1;\\\\n\\\\nuniform float nearZ;\\\\nuniform vec2 viewportSize : VIEWPORT_SIZE;\\\\n\\\\nuniform float jitterOffset: 0;\\\\n\\\\nvarying vec2 v_Texcoord;\\\\n\\\\n#ifdef DEPTH_DECODE\\\\n@import clay.util.decode_float\\\\n#endif\\\\n\\\\n#ifdef PHYSICALLY_CORRECT\\\\nuniform sampler2D normalDistribution;\\\\nuniform float sampleOffset: 0;\\\\nuniform vec2 normalDistributionSize;\\\\n\\\\nvec3 transformNormal(vec3 H, vec3 N) {\\\\n vec3 upVector = N.y > 0.999 ? vec3(1.0, 0.0, 0.0) : vec3(0.0, 1.0, 0.0);\\\\n vec3 tangentX = normalize(cross(N, upVector));\\\\n vec3 tangentZ = cross(N, tangentX);\\\\n return normalize(tangentX * H.x + N * H.y + tangentZ * H.z);\\\\n}\\\\nvec3 importanceSampleNormalGGX(float i, float roughness, vec3 N) {\\\\n float p = fract((i + sampleOffset) / float(TOTAL_SAMPLES));\\\\n vec3 H = texture2D(normalDistribution,vec2(roughness, p)).rgb;\\\\n return transformNormal(H, N);\\\\n}\\\\nfloat G_Smith(float g, float ndv, float ndl) {\\\\n float roughness = 1.0 - g;\\\\n float k = roughness * roughness / 2.0;\\\\n float G1V = ndv / (ndv * (1.0 - k) + k);\\\\n float G1L = ndl / (ndl * (1.0 - k) + k);\\\\n return G1L * G1V;\\\\n}\\\\nvec3 F_Schlick(float ndv, vec3 spec) {\\\\n return spec + (1.0 - spec) * pow(1.0 - ndv, 5.0);\\\\n}\\\\n#endif\\\\n\\\\nfloat fetchDepth(sampler2D depthTexture, vec2 uv)\\\\n{\\\\n vec4 depthTexel = texture2D(depthTexture, uv);\\\\n return depthTexel.r * 2.0 - 1.0;\\\\n}\\\\n\\\\nfloat linearDepth(float depth)\\\\n{\\\\n if (projection[3][3] == 0.0) {\\\\n return projection[3][2] / (depth * projection[2][3] - projection[2][2]);\\\\n }\\\\n else {\\\\n return (depth - projection[3][2]) / projection[2][2];\\\\n }\\\\n}\\\\n\\\\nbool rayIntersectDepth(float rayZNear, float rayZFar, vec2 hitPixel)\\\\n{\\\\n if (rayZFar > rayZNear)\\\\n {\\\\n float t = rayZFar; rayZFar = rayZNear; rayZNear = t;\\\\n }\\\\n float cameraZ = linearDepth(fetchDepth(gBufferTexture2, hitPixel));\\\\n return rayZFar <= cameraZ && rayZNear >= cameraZ - zThicknessThreshold;\\\\n}\\\\n\\\\n\\\\nbool traceScreenSpaceRay(\\\\n vec3 rayOrigin, vec3 rayDir, float jitter,\\\\n out vec2 hitPixel, out vec3 hitPoint, out float iterationCount\\\\n)\\\\n{\\\\n float rayLength = ((rayOrigin.z + rayDir.z * maxRayDistance) > -nearZ)\\\\n ? (-nearZ - rayOrigin.z) / rayDir.z : maxRayDistance;\\\\n\\\\n vec3 rayEnd = rayOrigin + rayDir * rayLength;\\\\n\\\\n vec4 H0 = projection * vec4(rayOrigin, 1.0);\\\\n vec4 H1 = projection * vec4(rayEnd, 1.0);\\\\n\\\\n float k0 = 1.0 / H0.w, k1 = 1.0 / H1.w;\\\\n\\\\n vec3 Q0 = rayOrigin * k0, Q1 = rayEnd * k1;\\\\n\\\\n vec2 P0 = (H0.xy * k0 * 0.5 + 0.5) * viewportSize;\\\\n vec2 P1 = (H1.xy * k1 * 0.5 + 0.5) * viewportSize;\\\\n\\\\n P1 += dot(P1 - P0, P1 - P0) < 0.0001 ? 0.01 : 0.0;\\\\n vec2 delta = P1 - P0;\\\\n\\\\n bool permute = false;\\\\n if (abs(delta.x) < abs(delta.y)) {\\\\n permute = true;\\\\n delta = delta.yx;\\\\n P0 = P0.yx;\\\\n P1 = P1.yx;\\\\n }\\\\n float stepDir = sign(delta.x);\\\\n float invdx = stepDir / delta.x;\\\\n\\\\n vec3 dQ = (Q1 - Q0) * invdx;\\\\n float dk = (k1 - k0) * invdx;\\\\n\\\\n vec2 dP = vec2(stepDir, delta.y * invdx);\\\\n\\\\n float strideScaler = 1.0 - min(1.0, -rayOrigin.z / pixelStrideZCutoff);\\\\n float pixStride = 1.0 + strideScaler * pixelStride;\\\\n\\\\n dP *= pixStride; dQ *= pixStride; dk *= pixStride;\\\\n\\\\n vec4 pqk = vec4(P0, Q0.z, k0);\\\\n vec4 dPQK = vec4(dP, dQ.z, dk);\\\\n\\\\n pqk += dPQK * jitter;\\\\n float rayZFar = (dPQK.z * 0.5 + pqk.z) / (dPQK.w * 0.5 + pqk.w);\\\\n float rayZNear;\\\\n\\\\n bool intersect = false;\\\\n\\\\n vec2 texelSize = 1.0 / viewportSize;\\\\n\\\\n iterationCount = 0.0;\\\\n\\\\n for (int i = 0; i < MAX_ITERATION; i++)\\\\n {\\\\n pqk += dPQK;\\\\n\\\\n rayZNear = rayZFar;\\\\n rayZFar = (dPQK.z * 0.5 + pqk.z) / (dPQK.w * 0.5 + pqk.w);\\\\n\\\\n hitPixel = permute ? pqk.yx : pqk.xy;\\\\n hitPixel *= texelSize;\\\\n\\\\n intersect = rayIntersectDepth(rayZNear, rayZFar, hitPixel);\\\\n\\\\n iterationCount += 1.0;\\\\n\\\\n dPQK *= 1.2;\\\\n\\\\n if (intersect) {\\\\n break;\\\\n }\\\\n }\\\\n\\\\n Q0.xy += dQ.xy * iterationCount;\\\\n Q0.z = pqk.z;\\\\n hitPoint = Q0 / pqk.w;\\\\n\\\\n return intersect;\\\\n}\\\\n\\\\nfloat calculateAlpha(\\\\n float iterationCount, float reflectivity,\\\\n vec2 hitPixel, vec3 hitPoint, float dist, vec3 rayDir\\\\n)\\\\n{\\\\n float alpha = clamp(reflectivity, 0.0, 1.0);\\\\n alpha *= 1.0 - (iterationCount / float(MAX_ITERATION));\\\\n vec2 hitPixelNDC = hitPixel * 2.0 - 1.0;\\\\n float maxDimension = min(1.0, max(abs(hitPixelNDC.x), abs(hitPixelNDC.y)));\\\\n alpha *= 1.0 - max(0.0, maxDimension - screenEdgeFadeStart) / (1.0 - screenEdgeFadeStart);\\\\n\\\\n float _eyeFadeStart = eyeFadeStart;\\\\n float _eyeFadeEnd = eyeFadeEnd;\\\\n if (_eyeFadeStart > _eyeFadeEnd) {\\\\n float tmp = _eyeFadeEnd;\\\\n _eyeFadeEnd = _eyeFadeStart;\\\\n _eyeFadeStart = tmp;\\\\n }\\\\n\\\\n float eyeDir = clamp(rayDir.z, _eyeFadeStart, _eyeFadeEnd);\\\\n alpha *= 1.0 - (eyeDir - _eyeFadeStart) / (_eyeFadeEnd - _eyeFadeStart);\\\\n\\\\n alpha *= 1.0 - clamp(dist / maxRayDistance, 0.0, 1.0);\\\\n\\\\n return alpha;\\\\n}\\\\n\\\\n@import clay.util.rand\\\\n\\\\n@import clay.util.rgbm\\\\n\\\\nvoid main()\\\\n{\\\\n vec4 normalAndGloss = texture2D(gBufferTexture1, v_Texcoord);\\\\n\\\\n if (dot(normalAndGloss.rgb, vec3(1.0)) == 0.0) {\\\\n discard;\\\\n }\\\\n\\\\n float g = normalAndGloss.a;\\\\n#if !defined(PHYSICALLY_CORRECT)\\\\n if (g <= minGlossiness) {\\\\n discard;\\\\n }\\\\n#endif\\\\n\\\\n float reflectivity = (g - minGlossiness) / (1.0 - minGlossiness);\\\\n\\\\n vec3 N = normalize(normalAndGloss.rgb * 2.0 - 1.0);\\\\n N = normalize((toViewSpace * vec4(N, 0.0)).xyz);\\\\n\\\\n vec4 projectedPos = vec4(v_Texcoord * 2.0 - 1.0, fetchDepth(gBufferTexture2, v_Texcoord), 1.0);\\\\n vec4 pos = projectionInv * projectedPos;\\\\n vec3 rayOrigin = pos.xyz / pos.w;\\\\n vec3 V = -normalize(rayOrigin);\\\\n\\\\n float ndv = clamp(dot(N, V), 0.0, 1.0);\\\\n float iterationCount;\\\\n float jitter = rand(fract(v_Texcoord + jitterOffset));\\\\n\\\\n#ifdef PHYSICALLY_CORRECT\\\\n vec4 color = vec4(vec3(0.0), 1.0);\\\\n vec4 albedoMetalness = texture2D(gBufferTexture3, v_Texcoord);\\\\n vec3 albedo = albedoMetalness.rgb;\\\\n float m = albedoMetalness.a;\\\\n vec3 diffuseColor = albedo * (1.0 - m);\\\\n vec3 spec = mix(vec3(0.04), albedo, m);\\\\n\\\\n float jitter2 = rand(fract(v_Texcoord)) * float(TOTAL_SAMPLES);\\\\n\\\\n for (int i = 0; i < SAMPLE_PER_FRAME; i++) {\\\\n vec3 H = importanceSampleNormalGGX(float(i) + jitter2, 1.0 - g, N);\\\\n vec3 rayDir = normalize(reflect(-V, H));\\\\n#else\\\\n vec3 rayDir = normalize(reflect(-V, N));\\\\n#endif\\\\n vec2 hitPixel;\\\\n vec3 hitPoint;\\\\n\\\\n bool intersect = traceScreenSpaceRay(rayOrigin, rayDir, jitter, hitPixel, hitPoint, iterationCount);\\\\n\\\\n float dist = distance(rayOrigin, hitPoint);\\\\n\\\\n vec3 hitNormal = texture2D(gBufferTexture1, hitPixel).rgb * 2.0 - 1.0;\\\\n hitNormal = normalize((toViewSpace * vec4(hitNormal, 0.0)).xyz);\\\\n#ifdef PHYSICALLY_CORRECT\\\\n float ndl = clamp(dot(N, rayDir), 0.0, 1.0);\\\\n float vdh = clamp(dot(V, H), 0.0, 1.0);\\\\n float ndh = clamp(dot(N, H), 0.0, 1.0);\\\\n vec3 litTexel = vec3(0.0);\\\\n if (dot(hitNormal, rayDir) < 0.0 && intersect) {\\\\n litTexel = texture2D(sourceTexture, hitPixel).rgb;\\\\n litTexel *= pow(clamp(1.0 - dist / 200.0, 0.0, 1.0), 3.0);\\\\n\\\\n }\\\\n else {\\\\n #ifdef SPECULARCUBEMAP_ENABLED\\\\n vec3 rayDirW = normalize(toWorldSpace * vec4(rayDir, 0.0)).rgb;\\\\n litTexel = RGBMDecode(textureCubeLodEXT(specularCubemap, rayDirW, 0.0), 8.12).rgb * specularIntensity;\\\\n#endif\\\\n }\\\\n color.rgb += ndl * litTexel * (\\\\n F_Schlick(ndl, spec) * G_Smith(g, ndv, ndl) * vdh / (ndh * ndv + 0.001)\\\\n );\\\\n }\\\\n color.rgb /= float(SAMPLE_PER_FRAME);\\\\n#else\\\\n #if !defined(SPECULARCUBEMAP_ENABLED)\\\\n if (dot(hitNormal, rayDir) >= 0.0) {\\\\n discard;\\\\n }\\\\n if (!intersect) {\\\\n discard;\\\\n }\\\\n#endif\\\\n float alpha = clamp(calculateAlpha(iterationCount, reflectivity, hitPixel, hitPoint, dist, rayDir), 0.0, 1.0);\\\\n vec4 color = texture2D(sourceTexture, hitPixel);\\\\n color.rgb *= alpha;\\\\n\\\\n#ifdef SPECULARCUBEMAP_ENABLED\\\\n vec3 rayDirW = normalize(toWorldSpace * vec4(rayDir, 0.0)).rgb;\\\\n alpha = alpha * (intersect ? 1.0 : 0.0);\\\\n float bias = (1.0 -g) * 5.0;\\\\n color.rgb += (1.0 - alpha)\\\\n * RGBMDecode(textureCubeLodEXT(specularCubemap, rayDirW, bias), 8.12).rgb\\\\n * specularIntensity;\\\\n#endif\\\\n\\\\n#endif\\\\n\\\\n gl_FragColor = encodeHDR(color);\\\\n}\\\\n@end\\\\n\\\\n@export ecgl.ssr.blur\\\\n\\\\nuniform sampler2D texture;\\\\nuniform sampler2D gBufferTexture1;\\\\nuniform sampler2D gBufferTexture2;\\\\nuniform mat4 projection;\\\\nuniform float depthRange : 0.05;\\\\n\\\\nvarying vec2 v_Texcoord;\\\\n\\\\nuniform vec2 textureSize;\\\\nuniform float blurSize : 1.0;\\\\n\\\\n#ifdef BLEND\\\\n #ifdef SSAOTEX_ENABLED\\\\nuniform sampler2D ssaoTex;\\\\n #endif\\\\nuniform sampler2D sourceTexture;\\\\n#endif\\\\n\\\\nfloat getLinearDepth(vec2 coord)\\\\n{\\\\n float depth = texture2D(gBufferTexture2, coord).r * 2.0 - 1.0;\\\\n return projection[3][2] / (depth * projection[2][3] - projection[2][2]);\\\\n}\\\\n\\\\n@import clay.util.rgbm\\\\n\\\\n\\\\nvoid main()\\\\n{\\\\n @import clay.compositor.kernel.gaussian_9\\\\n\\\\n vec4 centerNTexel = texture2D(gBufferTexture1, v_Texcoord);\\\\n float g = centerNTexel.a;\\\\n float maxBlurSize = clamp(1.0 - g, 0.0, 1.0) * blurSize;\\\\n#ifdef VERTICAL\\\\n vec2 off = vec2(0.0, maxBlurSize / textureSize.y);\\\\n#else\\\\n vec2 off = vec2(maxBlurSize / textureSize.x, 0.0);\\\\n#endif\\\\n\\\\n vec2 coord = v_Texcoord;\\\\n\\\\n vec4 sum = vec4(0.0);\\\\n float weightAll = 0.0;\\\\n\\\\n vec3 cN = centerNTexel.rgb * 2.0 - 1.0;\\\\n float cD = getLinearDepth(v_Texcoord);\\\\n for (int i = 0; i < 9; i++) {\\\\n vec2 coord = clamp((float(i) - 4.0) * off + v_Texcoord, vec2(0.0), vec2(1.0));\\\\n float w = gaussianKernel[i]\\\\n * clamp(dot(cN, texture2D(gBufferTexture1, coord).rgb * 2.0 - 1.0), 0.0, 1.0);\\\\n float d = getLinearDepth(coord);\\\\n w *= (1.0 - smoothstep(abs(cD - d) / depthRange, 0.0, 1.0));\\\\n\\\\n weightAll += w;\\\\n sum += decodeHDR(texture2D(texture, coord)) * w;\\\\n }\\\\n\\\\n#ifdef BLEND\\\\n float aoFactor = 1.0;\\\\n #ifdef SSAOTEX_ENABLED\\\\n aoFactor = texture2D(ssaoTex, v_Texcoord).r;\\\\n #endif\\\\n gl_FragColor = encodeHDR(\\\\n sum / weightAll * aoFactor + decodeHDR(texture2D(sourceTexture, v_Texcoord))\\\\n );\\\\n#else\\\\n gl_FragColor = encodeHDR(sum / weightAll);\\\\n#endif\\\\n}\\\\n\\\\n@end\\\"),Zs.prototype.setAmbientCubemap=function(e,t){this._ssrPass.material.set(\\\"specularCubemap\\\",e),this._ssrPass.material.set(\\\"specularIntensity\\\",t),this._ssrPass.material[e&&t?\\\"enableTexture\\\":\\\"disableTexture\\\"](\\\"specularCubemap\\\")},Zs.prototype.update=function(e,t,r,i){var n=e.getWidth(),a=e.getHeight(),o=this._ssrTexture,s=this._texture2,l=this._texture3,h=(o.width=this._prevTexture.width=this._currentTexture.width=n/this._downScale,o.height=this._prevTexture.height=this._currentTexture.height=a/this._downScale,s.width=l.width=n,s.height=l.height=a,this._frameBuffer),u=this._ssrPass,c=this._blurPass1,d=this._blurPass2,f=this._blendPass,p=new M,m=new M,p=(M.transpose(p,t.worldTransform),M.transpose(m,t.viewMatrix),u.setUniform(\\\"sourceTexture\\\",r),u.setUniform(\\\"projection\\\",t.projectionMatrix.array),u.setUniform(\\\"projectionInv\\\",t.invProjectionMatrix.array),u.setUniform(\\\"toViewSpace\\\",p.array),u.setUniform(\\\"toWorldSpace\\\",m.array),u.setUniform(\\\"nearZ\\\",t.near),i/this._totalSamples*this._samplePerFrame);u.setUniform(\\\"jitterOffset\\\",p),u.setUniform(\\\"sampleOffset\\\",i*this._samplePerFrame),c.setUniform(\\\"textureSize\\\",[o.width,o.height]),d.setUniform(\\\"textureSize\\\",[n,a]),d.setUniform(\\\"sourceTexture\\\",r),c.setUniform(\\\"projection\\\",t.projectionMatrix.array),d.setUniform(\\\"projection\\\",t.projectionMatrix.array),h.attach(o),h.bind(e),u.render(e),this._physicallyCorrect&&(h.attach(this._currentTexture),f.setUniform(\\\"texture1\\\",this._prevTexture),f.setUniform(\\\"texture2\\\",o),f.material.set({weight1:1<=i?.95:0,weight2:1<=i?.05:1}),f.render(e)),h.attach(s),c.setUniform(\\\"texture\\\",this._physicallyCorrect?this._currentTexture:o),c.render(e),h.attach(l),d.setUniform(\\\"texture\\\",s),d.render(e),h.unbind(e),this._physicallyCorrect&&(m=this._prevTexture,this._prevTexture=this._currentTexture,this._currentTexture=m)},Zs.prototype.getTargetTexture=function(){return this._texture3},Zs.prototype.setParameter=function(e,t){\\\"maxIteration\\\"===e?this._ssrPass.material.define(\\\"fragment\\\",\\\"MAX_ITERATION\\\",t):this._ssrPass.setUniform(e,t)},Zs.prototype.setPhysicallyCorrect=function(e){e?(this._normalDistribution||(this._normalDistribution=dn.generateNormalDistribution(64,this._totalSamples)),this._ssrPass.material.define(\\\"fragment\\\",\\\"PHYSICALLY_CORRECT\\\"),this._ssrPass.material.set(\\\"normalDistribution\\\",this._normalDistribution),this._ssrPass.material.set(\\\"normalDistributionSize\\\",[64,this._totalSamples])):this._ssrPass.material.undefine(\\\"fragment\\\",\\\"PHYSICALLY_CORRECT\\\"),this._physicallyCorrect=e},Zs.prototype.setSSAOTexture=function(e){var t=this._blurPass2;e?(t.material.enableTexture(\\\"ssaoTex\\\"),t.material.set(\\\"ssaoTex\\\",e)):t.material.disableTexture(\\\"ssaoTex\\\")},Zs.prototype.isFinished=function(e){return!this._physicallyCorrect||e>this._totalSamples/this._samplePerFrame},Zs.prototype.dispose=function(e){this._ssrTexture.dispose(e),this._texture2.dispose(e),this._texture3.dispose(e),this._prevTexture.dispose(e),this._currentTexture.dispose(e),this._frameBuffer.dispose(e)};const Ys=Zs,Ks=[0,0,-.321585265978,-.154972575841,.458126042375,.188473391593,.842080129861,.527766490688,.147304551086,-.659453822776,-.331943915203,-.940619700594,.0479226680259,.54812163202,.701581552186,-.709825561388,-.295436780218,.940589268233,-.901489676764,.237713156085,.973570876096,-.109899459384,-.866792314779,-.451805525005,.330975007087,.800048655954,-.344275183665,.381779221166,-.386139432542,-.437418421534,-.576478634965,-.0148463392551,.385798197415,-.262426961053,-.666302061145,.682427250835,-.628010632582,-.732836215494,.10163141741,-.987658134403,.711995289051,-.320024291314,.0296005138058,.950296523438,.0130612307608,-.351024443122,-.879596633704,-.10478487883,.435712737232,.504254490347,.779203817497,.206477676721,.388264289969,-.896736162545,-.153106280781,-.629203242522,-.245517550697,.657969239148,.126830499058,.26862328493,-.634888119007,-.302301223431,.617074219636,.779817204925];function Qs(e,t,r,i,n){var a=e.gl;t.setUniform(a,\\\"1i\\\",r,n),a.activeTexture(a.TEXTURE0+n),i.isRenderable()?i.bind(e):i.unbind(e)}function Js(e){this._depthTex=new k({format:B.DEPTH_COMPONENT,type:B.UNSIGNED_INT}),this._normalTex=new k({type:B.HALF_FLOAT}),this._framebuffer=new Li,this._framebuffer.attach(this._normalTex),this._framebuffer.attach(this._depthTex,Li.DEPTH_ATTACHMENT),this._normalMaterial=new Fe({shader:new S(S.source(\\\"ecgl.normal.vertex\\\"),S.source(\\\"ecgl.normal.fragment\\\"))}),this._normalMaterial.enableTexture([\\\"normalMap\\\",\\\"bumpMap\\\",\\\"roughnessMap\\\"]),this._defaultNormalMap=qi.createBlank(\\\"#000\\\"),this._defaultBumpMap=qi.createBlank(\\\"#000\\\"),this._defaultRoughessMap=qi.createBlank(\\\"#000\\\"),this._debugPass=new hn({fragment:S.source(\\\"clay.compositor.output\\\")}),this._debugPass.setUniform(\\\"texture\\\",this._normalTex),this._debugPass.material.undefine(\\\"fragment\\\",\\\"OUTPUT_ALPHA\\\")}S[\\\"import\\\"](\\\"@export ecgl.normal.vertex\\\\n\\\\n@import ecgl.common.transformUniforms\\\\n\\\\n@import ecgl.common.uv.header\\\\n\\\\n@import ecgl.common.attributes\\\\n\\\\nvarying vec3 v_Normal;\\\\nvarying vec3 v_WorldPosition;\\\\n\\\\n@import ecgl.common.normalMap.vertexHeader\\\\n\\\\n@import ecgl.common.vertexAnimation.header\\\\n\\\\nvoid main()\\\\n{\\\\n\\\\n @import ecgl.common.vertexAnimation.main\\\\n\\\\n @import ecgl.common.uv.main\\\\n\\\\n v_Normal = normalize((worldInverseTranspose * vec4(normal, 0.0)).xyz);\\\\n v_WorldPosition = (world * vec4(pos, 1.0)).xyz;\\\\n\\\\n @import ecgl.common.normalMap.vertexMain\\\\n\\\\n gl_Position = worldViewProjection * vec4(pos, 1.0);\\\\n\\\\n}\\\\n\\\\n\\\\n@end\\\\n\\\\n\\\\n@export ecgl.normal.fragment\\\\n\\\\n#define ROUGHNESS_CHANEL 0\\\\n\\\\nuniform bool useBumpMap;\\\\nuniform bool useRoughnessMap;\\\\nuniform bool doubleSide;\\\\nuniform float roughness;\\\\n\\\\n@import ecgl.common.uv.fragmentHeader\\\\n\\\\nvarying vec3 v_Normal;\\\\nvarying vec3 v_WorldPosition;\\\\n\\\\nuniform mat4 viewInverse : VIEWINVERSE;\\\\n\\\\n@import ecgl.common.normalMap.fragmentHeader\\\\n@import ecgl.common.bumpMap.header\\\\n\\\\nuniform sampler2D roughnessMap;\\\\n\\\\nvoid main()\\\\n{\\\\n vec3 N = v_Normal;\\\\n \\\\n bool flipNormal = false;\\\\n if (doubleSide) {\\\\n vec3 eyePos = viewInverse[3].xyz;\\\\n vec3 V = normalize(eyePos - v_WorldPosition);\\\\n\\\\n if (dot(N, V) < 0.0) {\\\\n flipNormal = true;\\\\n }\\\\n }\\\\n\\\\n @import ecgl.common.normalMap.fragmentMain\\\\n\\\\n if (useBumpMap) {\\\\n N = bumpNormal(v_WorldPosition, v_Normal, N);\\\\n }\\\\n\\\\n float g = 1.0 - roughness;\\\\n\\\\n if (useRoughnessMap) {\\\\n float g2 = 1.0 - texture2D(roughnessMap, v_DetailTexcoord)[ROUGHNESS_CHANEL];\\\\n g = clamp(g2 + (g - 0.5) * 2.0, 0.0, 1.0);\\\\n }\\\\n\\\\n if (flipNormal) {\\\\n N = -N;\\\\n }\\\\n\\\\n gl_FragColor.rgb = (N.xyz + 1.0) * 0.5;\\\\n gl_FragColor.a = g;\\\\n}\\\\n@end\\\"),Js.prototype.getDepthTexture=function(){return this._depthTex},Js.prototype.getNormalTexture=function(){return this._normalTex},Js.prototype.update=function(e,t,r){var m,g,_,v,y,x,b,w,T,i=e.getWidth(),n=e.getHeight(),a=this._depthTex,o=this._normalTex,s=this._normalMaterial,a=(a.width=i,a.height=n,o.width=i,o.height=n,t.getRenderList(r).opaque);this._framebuffer.bind(e),e.gl.clearColor(0,0,0,0),e.gl.clear(e.gl.COLOR_BUFFER_BIT|e.gl.DEPTH_BUFFER_BIT),e.gl.disable(e.gl.BLEND),e.renderPass(a,r,{getMaterial:function(){return s},ifRender:function(e){return e.renderNormal},beforeRender:(m=e,g=this._defaultNormalMap,_=this._defaultBumpMap,v=this._defaultRoughessMap,this._normalMaterial,T=m.gl,function(e,t,r){var i,n,a,o,s,l,h,u,c,d,f,p;w&&w.material===e.material||(d=e.material,i=e.__program,null==(n=d.get(\\\"roughness\\\"))&&(n=1),a=d.get(\\\"normalMap\\\")||g,p=d.get(\\\"roughnessMap\\\"),f=d.get(\\\"bumpMap\\\"),o=d.get(\\\"uvRepeat\\\"),s=d.get(\\\"uvOffset\\\"),l=d.get(\\\"detailUvRepeat\\\"),h=d.get(\\\"detailUvOffset\\\"),u=!!f&&d.isTextureEnabled(\\\"bumpMap\\\"),c=!!p&&d.isTextureEnabled(\\\"roughnessMap\\\"),d=d.isDefined(\\\"fragment\\\",\\\"DOUBLE_SIDED\\\"),f=f||_,p=p||v,r!==t?(t.set(\\\"normalMap\\\",a),t.set(\\\"bumpMap\\\",f),t.set(\\\"roughnessMap\\\",p),t.set(\\\"useBumpMap\\\",u),t.set(\\\"useRoughnessMap\\\",c),t.set(\\\"doubleSide\\\",d),null!=o&&t.set(\\\"uvRepeat\\\",o),null!=s&&t.set(\\\"uvOffset\\\",s),null!=l&&t.set(\\\"detailUvRepeat\\\",l),null!=h&&t.set(\\\"detailUvOffset\\\",h),t.set(\\\"roughness\\\",n)):(i.setUniform(T,\\\"1f\\\",\\\"roughness\\\",n),y!==a&&Qs(m,i,\\\"normalMap\\\",a,0),x!==f&&f&&Qs(m,i,\\\"bumpMap\\\",f,1),b!==p&&p&&Qs(m,i,\\\"roughnessMap\\\",p,2),null!=o&&i.setUniform(T,\\\"2f\\\",\\\"uvRepeat\\\",o),null!=s&&i.setUniform(T,\\\"2f\\\",\\\"uvOffset\\\",s),null!=l&&i.setUniform(T,\\\"2f\\\",\\\"detailUvRepeat\\\",l),null!=h&&i.setUniform(T,\\\"2f\\\",\\\"detailUvOffset\\\",h),i.setUniform(T,\\\"1i\\\",\\\"useBumpMap\\\",+u),i.setUniform(T,\\\"1i\\\",\\\"useRoughnessMap\\\",+c),i.setUniform(T,\\\"1i\\\",\\\"doubleSide\\\",+d)),y=a,x=f,b=p,w=e)}),sort:e.opaqueSortCompare}),this._framebuffer.unbind(e)},Js.prototype.renderDebug=function(e){this._debugPass.render(e)},Js.prototype.dispose=function(e){this._depthTex.dispose(e),this._normalTex.dispose(e)};const $s=Js;function el(e){e=e||{},this._edgePass=new hn({fragment:S.source(\\\"ecgl.edge\\\")}),this._edgePass.setUniform(\\\"normalTexture\\\",e.normalTexture),this._edgePass.setUniform(\\\"depthTexture\\\",e.depthTexture),this._targetTexture=new k({type:B.HALF_FLOAT}),this._frameBuffer=new Li,this._frameBuffer.attach(this._targetTexture)}el.prototype.update=function(e,t,r,i){var n=e.getWidth(),a=e.getHeight(),o=this._targetTexture,o=(o.width=n,o.height=a,this._frameBuffer);o.bind(e),this._edgePass.setUniform(\\\"projectionInv\\\",t.invProjectionMatrix.array),this._edgePass.setUniform(\\\"textureSize\\\",[n,a]),this._edgePass.setUniform(\\\"texture\\\",r),this._edgePass.render(e),o.unbind(e)},el.prototype.getTargetTexture=function(){return this._targetTexture},el.prototype.setParameter=function(e,t){this._edgePass.setUniform(e,t)},el.prototype.dispose=function(e){this._targetTexture.dispose(e),this._frameBuffer.dispose(e)};const tl=el,rl={type:\\\"compositor\\\",nodes:[{name:\\\"source\\\",type:\\\"texture\\\",outputs:{color:{}}},{name:\\\"source_half\\\",shader:\\\"#source(clay.compositor.downsample)\\\",inputs:{texture:\\\"source\\\"},outputs:{color:{parameters:{width:\\\"expr(width * 1.0 / 2)\\\",height:\\\"expr(height * 1.0 / 2)\\\",type:\\\"HALF_FLOAT\\\"}}},parameters:{textureSize:\\\"expr( [width * 1.0, height * 1.0] )\\\"}},{name:\\\"bright\\\",shader:\\\"#source(clay.compositor.bright)\\\",inputs:{texture:\\\"source_half\\\"},outputs:{color:{parameters:{width:\\\"expr(width * 1.0 / 2)\\\",height:\\\"expr(height * 1.0 / 2)\\\",type:\\\"HALF_FLOAT\\\"}}},parameters:{threshold:2,scale:4,textureSize:\\\"expr([width * 1.0 / 2, height / 2])\\\"}},{name:\\\"bright_downsample_4\\\",shader:\\\"#source(clay.compositor.downsample)\\\",inputs:{texture:\\\"bright\\\"},outputs:{color:{parameters:{width:\\\"expr(width * 1.0 / 4)\\\",height:\\\"expr(height * 1.0 / 4)\\\",type:\\\"HALF_FLOAT\\\"}}},parameters:{textureSize:\\\"expr( [width * 1.0 / 2, height / 2] )\\\"}},{name:\\\"bright_downsample_8\\\",shader:\\\"#source(clay.compositor.downsample)\\\",inputs:{texture:\\\"bright_downsample_4\\\"},outputs:{color:{parameters:{width:\\\"expr(width * 1.0 / 8)\\\",height:\\\"expr(height * 1.0 / 8)\\\",type:\\\"HALF_FLOAT\\\"}}},parameters:{textureSize:\\\"expr( [width * 1.0 / 4, height / 4] )\\\"}},{name:\\\"bright_downsample_16\\\",shader:\\\"#source(clay.compositor.downsample)\\\",inputs:{texture:\\\"bright_downsample_8\\\"},outputs:{color:{parameters:{width:\\\"expr(width * 1.0 / 16)\\\",height:\\\"expr(height * 1.0 / 16)\\\",type:\\\"HALF_FLOAT\\\"}}},parameters:{textureSize:\\\"expr( [width * 1.0 / 8, height / 8] )\\\"}},{name:\\\"bright_downsample_32\\\",shader:\\\"#source(clay.compositor.downsample)\\\",inputs:{texture:\\\"bright_downsample_16\\\"},outputs:{color:{parameters:{width:\\\"expr(width * 1.0 / 32)\\\",height:\\\"expr(height * 1.0 / 32)\\\",type:\\\"HALF_FLOAT\\\"}}},parameters:{textureSize:\\\"expr( [width * 1.0 / 16, height / 16] )\\\"}},{name:\\\"bright_upsample_16_blur_h\\\",shader:\\\"#source(clay.compositor.gaussian_blur)\\\",inputs:{texture:\\\"bright_downsample_32\\\"},outputs:{color:{parameters:{width:\\\"expr(width * 1.0 / 16)\\\",height:\\\"expr(height * 1.0 / 16)\\\",type:\\\"HALF_FLOAT\\\"}}},parameters:{blurSize:1,blurDir:0,textureSize:\\\"expr( [width * 1.0 / 32, height / 32] )\\\"}},{name:\\\"bright_upsample_16_blur_v\\\",shader:\\\"#source(clay.compositor.gaussian_blur)\\\",inputs:{texture:\\\"bright_upsample_16_blur_h\\\"},outputs:{color:{parameters:{width:\\\"expr(width * 1.0 / 16)\\\",height:\\\"expr(height * 1.0 / 16)\\\",type:\\\"HALF_FLOAT\\\"}}},parameters:{blurSize:1,blurDir:1,textureSize:\\\"expr( [width * 1.0 / 16, height * 1.0 / 16] )\\\"}},{name:\\\"bright_upsample_8_blur_h\\\",shader:\\\"#source(clay.compositor.gaussian_blur)\\\",inputs:{texture:\\\"bright_downsample_16\\\"},outputs:{color:{parameters:{width:\\\"expr(width * 1.0 / 8)\\\",height:\\\"expr(height * 1.0 / 8)\\\",type:\\\"HALF_FLOAT\\\"}}},parameters:{blurSize:1,blurDir:0,textureSize:\\\"expr( [width * 1.0 / 16, height * 1.0 / 16] )\\\"}},{name:\\\"bright_upsample_8_blur_v\\\",shader:\\\"#source(clay.compositor.gaussian_blur)\\\",inputs:{texture:\\\"bright_upsample_8_blur_h\\\"},outputs:{color:{parameters:{width:\\\"expr(width * 1.0 / 8)\\\",height:\\\"expr(height * 1.0 / 8)\\\",type:\\\"HALF_FLOAT\\\"}}},parameters:{blurSize:1,blurDir:1,textureSize:\\\"expr( [width * 1.0 / 8, height * 1.0 / 8] )\\\"}},{name:\\\"bright_upsample_8_blend\\\",shader:\\\"#source(clay.compositor.blend)\\\",inputs:{texture1:\\\"bright_upsample_8_blur_v\\\",texture2:\\\"bright_upsample_16_blur_v\\\"},outputs:{color:{parameters:{width:\\\"expr(width * 1.0 / 8)\\\",height:\\\"expr(height * 1.0 / 8)\\\",type:\\\"HALF_FLOAT\\\"}}},parameters:{weight1:.3,weight2:.7}},{name:\\\"bright_upsample_4_blur_h\\\",shader:\\\"#source(clay.compositor.gaussian_blur)\\\",inputs:{texture:\\\"bright_downsample_8\\\"},outputs:{color:{parameters:{width:\\\"expr(width * 1.0 / 4)\\\",height:\\\"expr(height * 1.0 / 4)\\\",type:\\\"HALF_FLOAT\\\"}}},parameters:{blurSize:1,blurDir:0,textureSize:\\\"expr( [width * 1.0 / 8, height * 1.0 / 8] )\\\"}},{name:\\\"bright_upsample_4_blur_v\\\",shader:\\\"#source(clay.compositor.gaussian_blur)\\\",inputs:{texture:\\\"bright_upsample_4_blur_h\\\"},outputs:{color:{parameters:{width:\\\"expr(width * 1.0 / 4)\\\",height:\\\"expr(height * 1.0 / 4)\\\",type:\\\"HALF_FLOAT\\\"}}},parameters:{blurSize:1,blurDir:1,textureSize:\\\"expr( [width * 1.0 / 4, height * 1.0 / 4] )\\\"}},{name:\\\"bright_upsample_4_blend\\\",shader:\\\"#source(clay.compositor.blend)\\\",inputs:{texture1:\\\"bright_upsample_4_blur_v\\\",texture2:\\\"bright_upsample_8_blend\\\"},outputs:{color:{parameters:{width:\\\"expr(width * 1.0 / 4)\\\",height:\\\"expr(height * 1.0 / 4)\\\",type:\\\"HALF_FLOAT\\\"}}},parameters:{weight1:.3,weight2:.7}},{name:\\\"bright_upsample_2_blur_h\\\",shader:\\\"#source(clay.compositor.gaussian_blur)\\\",inputs:{texture:\\\"bright_downsample_4\\\"},outputs:{color:{parameters:{width:\\\"expr(width * 1.0 / 2)\\\",height:\\\"expr(height * 1.0 / 2)\\\",type:\\\"HALF_FLOAT\\\"}}},parameters:{blurSize:1,blurDir:0,textureSize:\\\"expr( [width * 1.0 / 4, height * 1.0 / 4] )\\\"}},{name:\\\"bright_upsample_2_blur_v\\\",shader:\\\"#source(clay.compositor.gaussian_blur)\\\",inputs:{texture:\\\"bright_upsample_2_blur_h\\\"},outputs:{color:{parameters:{width:\\\"expr(width * 1.0 / 2)\\\",height:\\\"expr(height * 1.0 / 2)\\\",type:\\\"HALF_FLOAT\\\"}}},parameters:{blurSize:1,blurDir:1,textureSize:\\\"expr( [width * 1.0 / 2, height * 1.0 / 2] )\\\"}},{name:\\\"bright_upsample_2_blend\\\",shader:\\\"#source(clay.compositor.blend)\\\",inputs:{texture1:\\\"bright_upsample_2_blur_v\\\",texture2:\\\"bright_upsample_4_blend\\\"},outputs:{color:{parameters:{width:\\\"expr(width * 1.0 / 2)\\\",height:\\\"expr(height * 1.0 / 2)\\\",type:\\\"HALF_FLOAT\\\"}}},parameters:{weight1:.3,weight2:.7}},{name:\\\"bright_upsample_full_blur_h\\\",shader:\\\"#source(clay.compositor.gaussian_blur)\\\",inputs:{texture:\\\"bright\\\"},outputs:{color:{parameters:{width:\\\"expr(width * 1.0)\\\",height:\\\"expr(height * 1.0)\\\",type:\\\"HALF_FLOAT\\\"}}},parameters:{blurSize:1,blurDir:0,textureSize:\\\"expr( [width * 1.0 / 2, height * 1.0 / 2] )\\\"}},{name:\\\"bright_upsample_full_blur_v\\\",shader:\\\"#source(clay.compositor.gaussian_blur)\\\",inputs:{texture:\\\"bright_upsample_full_blur_h\\\"},outputs:{color:{parameters:{width:\\\"expr(width * 1.0)\\\",height:\\\"expr(height * 1.0)\\\",type:\\\"HALF_FLOAT\\\"}}},parameters:{blurSize:1,blurDir:1,textureSize:\\\"expr( [width * 1.0, height * 1.0] )\\\"}},{name:\\\"bloom_composite\\\",shader:\\\"#source(clay.compositor.blend)\\\",inputs:{texture1:\\\"bright_upsample_full_blur_v\\\",texture2:\\\"bright_upsample_2_blend\\\"},outputs:{color:{parameters:{width:\\\"expr(width * 1.0)\\\",height:\\\"expr(height * 1.0)\\\",type:\\\"HALF_FLOAT\\\"}}},parameters:{weight1:.3,weight2:.7}},{name:\\\"coc\\\",shader:\\\"#source(ecgl.dof.coc)\\\",outputs:{color:{parameters:{minFilter:\\\"NEAREST\\\",magFilter:\\\"NEAREST\\\",width:\\\"expr(width * 1.0)\\\",height:\\\"expr(height * 1.0)\\\"}}},parameters:{focalDist:50,focalRange:30}},{name:\\\"dof_far_blur\\\",shader:\\\"#source(ecgl.dof.diskBlur)\\\",inputs:{texture:\\\"source\\\",coc:\\\"coc\\\"},outputs:{color:{parameters:{width:\\\"expr(width * 1.0)\\\",height:\\\"expr(height * 1.0)\\\",type:\\\"HALF_FLOAT\\\"}}},parameters:{textureSize:\\\"expr( [width * 1.0, height * 1.0] )\\\"}},{name:\\\"dof_near_blur\\\",shader:\\\"#source(ecgl.dof.diskBlur)\\\",inputs:{texture:\\\"source\\\",coc:\\\"coc\\\"},outputs:{color:{parameters:{width:\\\"expr(width * 1.0)\\\",height:\\\"expr(height * 1.0)\\\",type:\\\"HALF_FLOAT\\\"}}},parameters:{textureSize:\\\"expr( [width * 1.0, height * 1.0] )\\\"},defines:{BLUR_NEARFIELD:null}},{name:\\\"dof_coc_blur\\\",shader:\\\"#source(ecgl.dof.diskBlur)\\\",inputs:{texture:\\\"coc\\\"},outputs:{color:{parameters:{minFilter:\\\"NEAREST\\\",magFilter:\\\"NEAREST\\\",width:\\\"expr(width * 1.0)\\\",height:\\\"expr(height * 1.0)\\\"}}},parameters:{textureSize:\\\"expr( [width * 1.0, height * 1.0] )\\\"},defines:{BLUR_COC:null}},{name:\\\"dof_composite\\\",shader:\\\"#source(ecgl.dof.composite)\\\",inputs:{original:\\\"source\\\",blurred:\\\"dof_far_blur\\\",nearfield:\\\"dof_near_blur\\\",coc:\\\"coc\\\",nearcoc:\\\"dof_coc_blur\\\"},outputs:{color:{parameters:{width:\\\"expr(width * 1.0)\\\",height:\\\"expr(height * 1.0)\\\",type:\\\"HALF_FLOAT\\\"}}}},{name:\\\"composite\\\",shader:\\\"#source(clay.compositor.hdr.composite)\\\",inputs:{texture:\\\"source\\\",bloom:\\\"bloom_composite\\\"},outputs:{color:{parameters:{width:\\\"expr(width * 1.0)\\\",height:\\\"expr(height * 1.0)\\\"}}},defines:{}},{name:\\\"FXAA\\\",shader:\\\"#source(clay.compositor.fxaa)\\\",inputs:{texture:\\\"composite\\\"}}]};function il(e,t){return{color:{parameters:{width:e,height:t}}}}S[\\\"import\\\"](Cs),S[\\\"import\\\"](Ds),S[\\\"import\\\"](Ls),S[\\\"import\\\"](Ps),S[\\\"import\\\"](Os),S[\\\"import\\\"](Ns),S[\\\"import\\\"](Is),S[\\\"import\\\"](Rs),S[\\\"import\\\"](Bs),S[\\\"import\\\"](\\\"@export ecgl.dof.coc\\\\n\\\\nuniform sampler2D depth;\\\\n\\\\nuniform float zNear: 0.1;\\\\nuniform float zFar: 2000;\\\\n\\\\nuniform float focalDistance: 3;\\\\nuniform float focalRange: 1;\\\\nuniform float focalLength: 30;\\\\nuniform float fstop: 2.8;\\\\n\\\\nvarying vec2 v_Texcoord;\\\\n\\\\n@import clay.util.encode_float\\\\n\\\\nvoid main()\\\\n{\\\\n float z = texture2D(depth, v_Texcoord).r * 2.0 - 1.0;\\\\n\\\\n float dist = 2.0 * zNear * zFar / (zFar + zNear - z * (zFar - zNear));\\\\n\\\\n float aperture = focalLength / fstop;\\\\n\\\\n float coc;\\\\n\\\\n float uppper = focalDistance + focalRange;\\\\n float lower = focalDistance - focalRange;\\\\n if (dist <= uppper && dist >= lower) {\\\\n coc = 0.5;\\\\n }\\\\n else {\\\\n float focalAdjusted = dist > uppper ? uppper : lower;\\\\n\\\\n coc = abs(aperture * (focalLength * (dist - focalAdjusted)) / (dist * (focalAdjusted - focalLength)));\\\\n coc = clamp(coc, 0.0, 2.0) / 2.00001;\\\\n\\\\n if (dist < lower) {\\\\n coc = -coc;\\\\n }\\\\n coc = coc * 0.5 + 0.5;\\\\n }\\\\n\\\\n gl_FragColor = encodeFloat(coc);\\\\n}\\\\n@end\\\\n\\\\n\\\\n@export ecgl.dof.composite\\\\n\\\\n#define DEBUG 0\\\\n\\\\nuniform sampler2D original;\\\\nuniform sampler2D blurred;\\\\nuniform sampler2D nearfield;\\\\nuniform sampler2D coc;\\\\nuniform sampler2D nearcoc;\\\\nvarying vec2 v_Texcoord;\\\\n\\\\n@import clay.util.rgbm\\\\n@import clay.util.float\\\\n\\\\nvoid main()\\\\n{\\\\n vec4 blurredColor = texture2D(blurred, v_Texcoord);\\\\n vec4 originalColor = texture2D(original, v_Texcoord);\\\\n\\\\n float fCoc = decodeFloat(texture2D(coc, v_Texcoord));\\\\n\\\\n fCoc = abs(fCoc * 2.0 - 1.0);\\\\n\\\\n float weight = smoothstep(0.0, 1.0, fCoc);\\\\n \\\\n#ifdef NEARFIELD_ENABLED\\\\n vec4 nearfieldColor = texture2D(nearfield, v_Texcoord);\\\\n float fNearCoc = decodeFloat(texture2D(nearcoc, v_Texcoord));\\\\n fNearCoc = abs(fNearCoc * 2.0 - 1.0);\\\\n\\\\n gl_FragColor = encodeHDR(\\\\n mix(\\\\n nearfieldColor, mix(originalColor, blurredColor, weight),\\\\n pow(1.0 - fNearCoc, 4.0)\\\\n )\\\\n );\\\\n#else\\\\n gl_FragColor = encodeHDR(mix(originalColor, blurredColor, weight));\\\\n#endif\\\\n\\\\n}\\\\n\\\\n@end\\\\n\\\\n\\\\n\\\\n@export ecgl.dof.diskBlur\\\\n\\\\n#define POISSON_KERNEL_SIZE 16;\\\\n\\\\nuniform sampler2D texture;\\\\nuniform sampler2D coc;\\\\nvarying vec2 v_Texcoord;\\\\n\\\\nuniform float blurRadius : 10.0;\\\\nuniform vec2 textureSize : [512.0, 512.0];\\\\n\\\\nuniform vec2 poissonKernel[POISSON_KERNEL_SIZE];\\\\n\\\\nuniform float percent;\\\\n\\\\nfloat nrand(const in vec2 n) {\\\\n return fract(sin(dot(n.xy ,vec2(12.9898,78.233))) * 43758.5453);\\\\n}\\\\n\\\\n@import clay.util.rgbm\\\\n@import clay.util.float\\\\n\\\\n\\\\nvoid main()\\\\n{\\\\n vec2 offset = blurRadius / textureSize;\\\\n\\\\n float rnd = 6.28318 * nrand(v_Texcoord + 0.07 * percent );\\\\n float cosa = cos(rnd);\\\\n float sina = sin(rnd);\\\\n vec4 basis = vec4(cosa, -sina, sina, cosa);\\\\n\\\\n#if !defined(BLUR_NEARFIELD) && !defined(BLUR_COC)\\\\n offset *= abs(decodeFloat(texture2D(coc, v_Texcoord)) * 2.0 - 1.0);\\\\n#endif\\\\n\\\\n#ifdef BLUR_COC\\\\n float cocSum = 0.0;\\\\n#else\\\\n vec4 color = vec4(0.0);\\\\n#endif\\\\n\\\\n\\\\n float weightSum = 0.0;\\\\n\\\\n for (int i = 0; i < POISSON_KERNEL_SIZE; i++) {\\\\n vec2 ofs = poissonKernel[i];\\\\n\\\\n ofs = vec2(dot(ofs, basis.xy), dot(ofs, basis.zw));\\\\n\\\\n vec2 uv = v_Texcoord + ofs * offset;\\\\n vec4 texel = texture2D(texture, uv);\\\\n\\\\n float w = 1.0;\\\\n#ifdef BLUR_COC\\\\n float fCoc = decodeFloat(texel) * 2.0 - 1.0;\\\\n cocSum += clamp(fCoc, -1.0, 0.0) * w;\\\\n#else\\\\n texel = texel;\\\\n #if !defined(BLUR_NEARFIELD)\\\\n float fCoc = decodeFloat(texture2D(coc, uv)) * 2.0 - 1.0;\\\\n w *= abs(fCoc);\\\\n #endif\\\\n texel.rgb *= texel.a;\\\\n color += texel * w;\\\\n#endif\\\\n\\\\n weightSum += w;\\\\n }\\\\n\\\\n#ifdef BLUR_COC\\\\n gl_FragColor = encodeFloat(clamp(cocSum / weightSum, -1.0, 0.0) * 0.5 + 0.5);\\\\n#else\\\\n color /= weightSum;\\\\n color.rgb /= (color.a + 0.0001);\\\\n gl_FragColor = color;\\\\n#endif\\\\n}\\\\n\\\\n@end\\\"),S[\\\"import\\\"](\\\"@export ecgl.edge\\\\n\\\\nuniform sampler2D texture;\\\\n\\\\nuniform sampler2D normalTexture;\\\\nuniform sampler2D depthTexture;\\\\n\\\\nuniform mat4 projectionInv;\\\\n\\\\nuniform vec2 textureSize;\\\\n\\\\nuniform vec4 edgeColor: [0,0,0,0.8];\\\\n\\\\nvarying vec2 v_Texcoord;\\\\n\\\\nvec3 packColor(vec2 coord) {\\\\n float z = texture2D(depthTexture, coord).r * 2.0 - 1.0;\\\\n vec4 p = vec4(v_Texcoord * 2.0 - 1.0, z, 1.0);\\\\n vec4 p4 = projectionInv * p;\\\\n\\\\n return vec3(\\\\n texture2D(normalTexture, coord).rg,\\\\n -p4.z / p4.w / 5.0\\\\n );\\\\n}\\\\n\\\\nvoid main() {\\\\n vec2 cc = v_Texcoord;\\\\n vec3 center = packColor(cc);\\\\n\\\\n float size = clamp(1.0 - (center.z - 10.0) / 100.0, 0.0, 1.0) * 0.5;\\\\n float dx = size / textureSize.x;\\\\n float dy = size / textureSize.y;\\\\n\\\\n vec2 coord;\\\\n vec3 topLeft = packColor(cc+vec2(-dx, -dy));\\\\n vec3 top = packColor(cc+vec2(0.0, -dy));\\\\n vec3 topRight = packColor(cc+vec2(dx, -dy));\\\\n vec3 left = packColor(cc+vec2(-dx, 0.0));\\\\n vec3 right = packColor(cc+vec2(dx, 0.0));\\\\n vec3 bottomLeft = packColor(cc+vec2(-dx, dy));\\\\n vec3 bottom = packColor(cc+vec2(0.0, dy));\\\\n vec3 bottomRight = packColor(cc+vec2(dx, dy));\\\\n\\\\n vec3 v = -topLeft-2.0*top-topRight+bottomLeft+2.0*bottom+bottomRight;\\\\n vec3 h = -bottomLeft-2.0*left-topLeft+bottomRight+2.0*right+topRight;\\\\n\\\\n float edge = sqrt(dot(h, h) + dot(v, v));\\\\n\\\\n edge = smoothstep(0.8, 1.0, edge);\\\\n\\\\n gl_FragColor = mix(texture2D(texture, v_Texcoord), vec4(edgeColor.rgb, 1.0), edgeColor.a * edge);\\\\n}\\\\n@end\\\");var nl=[\\\"composite\\\",\\\"FXAA\\\"];function T(){this._width,this._height,this._dpr,this._sourceTexture=new k({type:B.HALF_FLOAT}),this._depthTexture=new k({format:B.DEPTH_COMPONENT,type:B.UNSIGNED_INT}),this._framebuffer=new Li,this._framebuffer.attach(this._sourceTexture),this._framebuffer.attach(this._depthTexture,Li.DEPTH_ATTACHMENT),this._normalPass=new $s,this._compositor=function(i,n){var e,t,a,o,s,l,h,u=new Ss,c=(n={},{textures:{},parameters:{}});for(e in i.parameters){var r=i.parameters[e];c.parameters[e]=ks(r)}return a=function(e){c.textures=e;for(var t=0;t<i.nodes.length;t++){var r=zs(i.nodes[t],c,n);r&&u.addNode(r)}},(t=i).textures?(s=0,l=!(o={}),h=n.textureRootPath,X.each(t.textures,function(e,t){var r,i=e.path,n=ks(e.parameters);if(Array.isArray(i)&&6===i.length)h&&(i=i.map(function(e){return X.relative2absolute(e,h)})),r=new yi(n);else{if(\\\"string\\\"!=typeof i)return;h&&(i=X.relative2absolute(i,h)),r=new k(n)}r.load(i),s++,r.once(\\\"success\\\",function(){o[t]=r,0==--s&&(a(o),l=!0)})}),0!==s||l||a(o)):a({}),u}(rl);var e=this._compositor.getNodeByName(\\\"source\\\"),t=(e.texture=this._sourceTexture,this._compositor.getNodeByName(\\\"coc\\\")),e=(this._sourceNode=e,this._cocNode=t,this._compositeNode=this._compositor.getNodeByName(\\\"composite\\\"),this._fxaaNode=this._compositor.getNodeByName(\\\"FXAA\\\"),this._dofBlurNodes=[\\\"dof_far_blur\\\",\\\"dof_near_blur\\\",\\\"dof_coc_blur\\\"].map(function(e){return this._compositor.getNodeByName(e)},this),this._dofBlurKernel=0,this._dofBlurKernelSize=new Float32Array(0),this._finalNodesChain=nl.map(function(e){return this._compositor.getNodeByName(e)},this),{normalTexture:this._normalPass.getNormalTexture(),depthTexture:this._normalPass.getDepthTexture()});this._ssaoPass=new qs(e),this._ssrPass=new Ys(e),this._edgePass=new tl(e)}T.prototype.resize=function(e,t,r){e*=r=r||1,t*=r;var i=this._sourceTexture,n=this._depthTexture,a=(i.width=e,i.height=t,n.width=e,n.height=t,{getWidth:function(){return e},getHeight:function(){return t},getDevicePixelRatio:function(){return r}});function o(e,t){var r;\\\"function\\\"==typeof e[t]&&(r=e[t].__original||e[t],e[t]=function(e){return r.call(this,a)},e[t].__original=r)}this._compositor.nodes.forEach(function(e){for(var t in e.outputs){t=e.outputs[t].parameters;t&&(o(t,\\\"width\\\"),o(t,\\\"height\\\"))}for(var r in e.parameters)o(e.parameters,r)}),this._width=e,this._height=t,this._dpr=r},T.prototype.getWidth=function(){return this._width},T.prototype.getHeight=function(){return this._height},T.prototype._ifRenderNormalPass=function(){return this._enableSSAO||this._enableEdge||this._enableSSR},T.prototype._getPrevNode=function(e){for(var t=nl.indexOf(e.name)-1,r=this._finalNodesChain[t];r&&!this._compositor.getNodeByName(r.name);)r=this._finalNodesChain[--t];return r},T.prototype._getNextNode=function(e){for(var t=nl.indexOf(e.name)+1,r=this._finalNodesChain[t];r&&!this._compositor.getNodeByName(r.name);)r=this._finalNodesChain[t+=1];return r},T.prototype._addChainNode=function(e){var t=this._getPrevNode(e),r=this._getNextNode(e);t&&(e.inputs.texture=t.name,r?(e.outputs=il(this.getWidth.bind(this),this.getHeight.bind(this)),r.inputs.texture=e.name):e.outputs=null,this._compositor.addNode(e))},T.prototype._removeChainNode=function(e){var t=this._getPrevNode(e),r=this._getNextNode(e);t&&(r?(t.outputs=il(this.getWidth.bind(this),this.getHeight.bind(this)),r.inputs.texture=t.name):t.outputs=null,this._compositor.removeNode(e))},T.prototype.updateNormal=function(e,t,r,i){this._ifRenderNormalPass()&&this._normalPass.update(e,t,r)},T.prototype.updateSSAO=function(e,t,r,i){this._ssaoPass.update(e,r,i)},T.prototype.enableSSAO=function(){this._enableSSAO=!0},T.prototype.disableSSAO=function(){this._enableSSAO=!1},T.prototype.enableSSR=function(){this._enableSSR=!0},T.prototype.disableSSR=function(){this._enableSSR=!1},T.prototype.getSSAOTexture=function(){return this._ssaoPass.getTargetTexture()},T.prototype.getSourceFrameBuffer=function(){return this._framebuffer},T.prototype.getSourceTexture=function(){return this._sourceTexture},T.prototype.disableFXAA=function(){this._removeChainNode(this._fxaaNode)},T.prototype.enableFXAA=function(){this._addChainNode(this._fxaaNode)},T.prototype.enableBloom=function(){this._compositeNode.inputs.bloom=\\\"bloom_composite\\\",this._compositor.dirty()},T.prototype.disableBloom=function(){this._compositeNode.inputs.bloom=null,this._compositor.dirty()},T.prototype.enableDOF=function(){this._compositeNode.inputs.texture=\\\"dof_composite\\\",this._compositor.dirty()},T.prototype.disableDOF=function(){this._compositeNode.inputs.texture=\\\"source\\\",this._compositor.dirty()},T.prototype.enableColorCorrection=function(){this._compositeNode.define(\\\"COLOR_CORRECTION\\\"),this._enableColorCorrection=!0},T.prototype.disableColorCorrection=function(){this._compositeNode.undefine(\\\"COLOR_CORRECTION\\\"),this._enableColorCorrection=!1},T.prototype.enableEdge=function(){this._enableEdge=!0},T.prototype.disableEdge=function(){this._enableEdge=!1},T.prototype.setBloomIntensity=function(e){this._compositeNode.setParameter(\\\"bloomIntensity\\\",e)},T.prototype.setSSAOParameter=function(e,t){switch(e){case\\\"quality\\\":this._ssaoPass.setParameter(\\\"kernelSize\\\",{low:6,medium:12,high:32,ultra:62}[t]||12);break;case\\\"radius\\\":this._ssaoPass.setParameter(e,t),this._ssaoPass.setParameter(\\\"bias\\\",t/200);break;case\\\"intensity\\\":this._ssaoPass.setParameter(e,t)}},T.prototype.setDOFParameter=function(e,t){switch(e){case\\\"focalDistance\\\":case\\\"focalRange\\\":case\\\"fstop\\\":this._cocNode.setParameter(e,t);break;case\\\"blurRadius\\\":for(var r=0;r<this._dofBlurNodes.length;r++)this._dofBlurNodes[r].setParameter(\\\"blurRadius\\\",t);break;case\\\"quality\\\":var i={low:4,medium:8,high:16,ultra:32}[t]||8;for(this._dofBlurKernelSize=i,r=0;r<this._dofBlurNodes.length;r++)this._dofBlurNodes[r].pass.material.define(\\\"POISSON_KERNEL_SIZE\\\",i);this._dofBlurKernel=new Float32Array(2*i)}},T.prototype.setSSRParameter=function(e,t){if(null!=t)switch(e){case\\\"quality\\\":var r={low:32,medium:16,high:8,ultra:4}[t]||16;this._ssrPass.setParameter(\\\"maxIteration\\\",{low:10,medium:15,high:30,ultra:80}[t]||20),this._ssrPass.setParameter(\\\"pixelStride\\\",r);break;case\\\"maxRoughness\\\":this._ssrPass.setParameter(\\\"minGlossiness\\\",Math.max(Math.min(1-t,1),0));break;case\\\"physical\\\":this.setPhysicallyCorrectSSR(t);break;default:console.warn(\\\"Unkown SSR parameter \\\"+e)}},T.prototype.setPhysicallyCorrectSSR=function(e){this._ssrPass.setPhysicallyCorrect(e)},T.prototype.setEdgeColor=function(e){var t=Z.parseColor(e);this._edgePass.setParameter(\\\"edgeColor\\\",t)},T.prototype.setExposure=function(e){this._compositeNode.setParameter(\\\"exposure\\\",Math.pow(2,e))},T.prototype.setColorLookupTexture=function(e,t){this._compositeNode.pass.material.setTextureImage(\\\"lut\\\",this._enableColorCorrection?e:\\\"none\\\",t,{minFilter:Z.Texture.NEAREST,magFilter:Z.Texture.NEAREST,flipY:!1})},T.prototype.setColorCorrection=function(e,t){this._compositeNode.setParameter(e,t)},T.prototype.isSSREnabled=function(){return this._enableSSR},T.prototype.composite=function(e,t,r,i,n){var a=this._sourceTexture,o=a;this._enableEdge&&(this._edgePass.update(e,r,a,n),a=o=this._edgePass.getTargetTexture()),this._enableSSR&&(this._ssrPass.update(e,r,a,n),o=this._ssrPass.getTargetTexture(),this._ssrPass.setSSAOTexture(this._enableSSAO?this._ssaoPass.getTargetTexture():null)),this._sourceNode.texture=o,this._cocNode.setParameter(\\\"depth\\\",this._depthTexture);for(var s=this._dofBlurKernel,l=this._dofBlurKernelSize,h=n%Math.floor(Ks.length/2/l),u=0;u<2*l;u++)s[u]=Ks[u+h*l*2];for(u=0;u<this._dofBlurNodes.length;u++)this._dofBlurNodes[u].setParameter(\\\"percent\\\",n/30),this._dofBlurNodes[u].setParameter(\\\"poissonKernel\\\",s);this._cocNode.setParameter(\\\"zNear\\\",r.near),this._cocNode.setParameter(\\\"zFar\\\",r.far),this._compositor.render(e,i)},T.prototype.dispose=function(e){this._sourceTexture.dispose(e),this._depthTexture.dispose(e),this._framebuffer.dispose(e),this._compositor.dispose(e),this._normalPass.dispose(e),this._ssaoPass.dispose(e)};const al=T;function ol(e){for(var t=[],r=0;r<30;r++)t.push([Hs(r,2),Hs(r,3)]);this._haltonSequence=t,this._frame=0,this._sourceTex=new k,this._sourceFb=new Li,this._sourceFb.attach(this._sourceTex),this._prevFrameTex=new k,this._outputTex=new k;var i=this._blendPass=new hn({fragment:S.source(\\\"clay.compositor.blend\\\")});i.material.disableTexturesAll(),i.material.enableTexture([\\\"texture1\\\",\\\"texture2\\\"]),this._blendFb=new Li({depthBuffer:!1}),this._outputPass=new hn({fragment:S.source(\\\"clay.compositor.output\\\"),blendWithPrevious:!0}),this._outputPass.material.define(\\\"fragment\\\",\\\"OUTPUT_ALPHA\\\"),this._outputPass.material.blend=function(e){e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)}}ol.prototype={constructor:ol,jitterProjection:function(e,t){var r=e.viewport,i=r.devicePixelRatio||e.getDevicePixelRatio(),n=r.width*i,r=r.height*i,i=this._haltonSequence[this._frame%this._haltonSequence.length],a=new M;a.array[12]=(2*i[0]-1)/n,a.array[13]=(2*i[1]-1)/r,M.mul(t.projectionMatrix,a,t.projectionMatrix),M.invert(t.invProjectionMatrix,t.projectionMatrix)},resetFrame:function(){this._frame=0},getFrame:function(){return this._frame},getSourceFrameBuffer:function(){return this._sourceFb},getOutputTexture:function(){return this._outputTex},resize:function(e,t){this._prevFrameTex.width=e,this._prevFrameTex.height=t,this._outputTex.width=e,this._outputTex.height=t,this._sourceTex.width=e,this._sourceTex.height=t,this._prevFrameTex.dirty(),this._outputTex.dirty(),this._sourceTex.dirty()},isFinished:function(){return this._frame>=this._haltonSequence.length},render:function(e,t,r){var i=this._blendPass,i=(0===this._frame?(i.setUniform(\\\"weight1\\\",0),i.setUniform(\\\"weight2\\\",1)):(i.setUniform(\\\"weight1\\\",.9),i.setUniform(\\\"weight2\\\",.1)),i.setUniform(\\\"texture1\\\",this._prevFrameTex),i.setUniform(\\\"texture2\\\",t||this._sourceTex),this._blendFb.attach(this._outputTex),this._blendFb.bind(e),i.render(e),this._blendFb.unbind(e),r||(this._outputPass.setUniform(\\\"texture\\\",this._outputTex),this._outputPass.render(e)),this._prevFrameTex);this._prevFrameTex=this._outputTex,this._outputTex=i,this._frame++},dispose:function(e){this._sourceFb.dispose(e),this._blendFb.dispose(e),this._prevFrameTex.dispose(e),this._outputTex.dispose(e),this._sourceTex.dispose(e),this._outputPass.dispose(e),this._blendPass.dispose(e)}};const sl=ol;function A(e){e=e||\\\"perspective\\\",this.layer=null,this.scene=new hi,this.rootNode=this.scene,this.viewport={x:0,y:0,width:0,height:0},this.setProjection(e),this._compositor=new al,this._temporalSS=new sl,this._shadowMapPass=new bs;for(var t=[],r=0,i=0;i<30;i++){for(var n=[],a=0;a<6;a++)n.push(4*Hs(r,2)-2),n.push(4*Hs(r,3)-2),r++;t.push(n)}this._pcfKernels=t,this.scene.on(\\\"beforerender\\\",function(e,t,r){this.needsTemporalSS()&&this._temporalSS.jitterProjection(e,r)},this)}A.prototype.setProjection=function(e){var t=this.camera;t&&t.update(),\\\"perspective\\\"===e?this.camera instanceof xi||(this.camera=new xi,t&&this.camera.setLocalTransform(t.localTransform)):this.camera instanceof on||(this.camera=new on,t&&this.camera.setLocalTransform(t.localTransform)),this.camera.near=.1,this.camera.far=2e3},A.prototype.setViewport=function(e,t,r,i,n){this.camera instanceof xi&&(this.camera.aspect=r/i),n=n||1,this.viewport.x=e,this.viewport.y=t,this.viewport.width=r,this.viewport.height=i,this.viewport.devicePixelRatio=n,this._compositor.resize(r*n,i*n),this._temporalSS.resize(r*n,i*n)},A.prototype.containPoint=function(e,t){var r=this.viewport;return t=this.layer.renderer.getHeight()-t,e>=r.x&&t>=r.y&&e<=r.x+r.width&&t<=r.y+r.height};var ll=new ke;A.prototype.castRay=function(e,t,r){var i=this.layer.renderer,n=i.viewport;return i.viewport=this.viewport,i.screenToNDC(e,t,ll),this.camera.castRay(ll,r),i.viewport=n,r},A.prototype.prepareRender=function(){this.scene.update(),this.camera.update(),this.scene.updateLights();var e=this.scene.updateRenderList(this.camera);this._needsSortProgressively=!1;for(var t=0;t<e.transparent.length;t++){var r=e.transparent[t].geometry;r.needsSortVerticesProgressively&&r.needsSortVerticesProgressively()&&(this._needsSortProgressively=!0),r.needsSortTrianglesProgressively&&r.needsSortTrianglesProgressively()&&(this._needsSortProgressively=!0)}this._frame=0,this._temporalSS.resetFrame()},A.prototype.render=function(e,t){this._doRender(e,t,this._frame),this._frame++},A.prototype.needsAccumulate=function(){return this.needsTemporalSS()||this._needsSortProgressively},A.prototype.needsTemporalSS=function(){var e=this._enableTemporalSS;return e=\\\"auto\\\"===e?this._enablePostEffect:e},A.prototype.hasDOF=function(){return this._enableDOF},A.prototype.isAccumulateFinished=function(){return this.needsTemporalSS()?this._temporalSS.isFinished():30<this._frame},A.prototype._doRender=function(e,t,r){var i=this.scene,n=this.camera;this._updateTransparent(e,i,n,r=r||0),t||(this._shadowMapPass.kernelPCF=this._pcfKernels[0],this._shadowMapPass.render(e,i,n,!0)),this._updateShadowPCFKernel(r);var a,o=e.clearColor;e.gl.clearColor(o[0],o[1],o[2],o[3]),this._enablePostEffect&&(this.needsTemporalSS()&&this._temporalSS.jitterProjection(e,n),this._compositor.updateNormal(e,i,n,this._temporalSS.getFrame())),this._updateSSAO(e,i,n,this._temporalSS.getFrame()),this._enablePostEffect?((a=this._compositor.getSourceFrameBuffer()).bind(e),e.gl.clear(e.gl.DEPTH_BUFFER_BIT|e.gl.COLOR_BUFFER_BIT),e.render(i,n,!0,!0),a.unbind(e),this.needsTemporalSS()&&t?(this._compositor.composite(e,i,n,this._temporalSS.getSourceFrameBuffer(),this._temporalSS.getFrame()),e.setViewport(this.viewport),this._temporalSS.render(e)):(e.setViewport(this.viewport),this._compositor.composite(e,i,n,null,0))):this.needsTemporalSS()&&t?((a=this._temporalSS.getSourceFrameBuffer()).bind(e),e.saveClear(),e.clearBit=e.gl.DEPTH_BUFFER_BIT|e.gl.COLOR_BUFFER_BIT,e.render(i,n,!0,!0),e.restoreClear(),a.unbind(e),e.setViewport(this.viewport),this._temporalSS.render(e)):(e.setViewport(this.viewport),e.render(i,n,!0,!0))},A.prototype._updateTransparent=function(e,t,r,i){for(var n=new z,a=new M,o=r.getWorldPosition(),s=t.getRenderList(r).transparent,l=0;l<s.length;l++){var h=s[l],u=h.geometry;M.invert(a,h.worldTransform),z.transformMat4(n,o,a),u.needsSortTriangles&&u.needsSortTriangles()&&u.doSortTriangles(n,i),u.needsSortVertices&&u.needsSortVertices()&&u.doSortVertices(n,i)}},A.prototype._updateSSAO=function(e,t,r){var i=this._enableSSAO&&this._enablePostEffect;i&&this._compositor.updateSSAO(e,t,r,this._temporalSS.getFrame());for(var n=t.getRenderList(r),a=0;a<n.opaque.length;a++){var o=n.opaque[a];o.renderNormal&&o.material[i?\\\"enableTexture\\\":\\\"disableTexture\\\"](\\\"ssaoMap\\\"),i&&o.material.set(\\\"ssaoMap\\\",this._compositor.getSSAOTexture())}},A.prototype._updateShadowPCFKernel=function(e){for(var t=this._pcfKernels[e%this._pcfKernels.length],r=this.scene.getRenderList(this.camera).opaque,i=0;i<r.length;i++)r[i].receiveShadow&&(r[i].material.set(\\\"pcfKernel\\\",t),r[i].material.define(\\\"fragment\\\",\\\"PCF_KERNEL_SIZE\\\",t.length/2))},A.prototype.dispose=function(e){this._compositor.dispose(e.gl),this._temporalSS.dispose(e.gl),this._shadowMapPass.dispose(e)},A.prototype.setPostEffect=function(e,t){var r=this._compositor,i=(this._enablePostEffect=e.get(\\\"enable\\\"),e.getModel(\\\"bloom\\\")),n=e.getModel(\\\"edge\\\"),a=e.getModel(\\\"DOF\\\",e.getModel(\\\"depthOfField\\\")),o=e.getModel(\\\"SSAO\\\",e.getModel(\\\"screenSpaceAmbientOcclusion\\\")),s=e.getModel(\\\"SSR\\\",e.getModel(\\\"screenSpaceReflection\\\")),l=e.getModel(\\\"FXAA\\\"),h=e.getModel(\\\"colorCorrection\\\");i.get(\\\"enable\\\")?r.enableBloom():r.disableBloom(),a.get(\\\"enable\\\")?r.enableDOF():r.disableDOF(),s.get(\\\"enable\\\")?r.enableSSR():r.disableSSR(),h.get(\\\"enable\\\")?r.enableColorCorrection():r.disableColorCorrection(),n.get(\\\"enable\\\")?r.enableEdge():r.disableEdge(),l.get(\\\"enable\\\")?r.enableFXAA():r.disableFXAA(),this._enableDOF=a.get(\\\"enable\\\"),this._enableSSAO=o.get(\\\"enable\\\"),this._enableSSAO?r.enableSSAO():r.disableSSAO(),r.setBloomIntensity(i.get(\\\"intensity\\\")),r.setEdgeColor(n.get(\\\"color\\\")),r.setColorLookupTexture(h.get(\\\"lookupTexture\\\"),t),r.setExposure(h.get(\\\"exposure\\\")),[\\\"radius\\\",\\\"quality\\\",\\\"intensity\\\"].forEach(function(e){r.setSSAOParameter(e,o.get(e))}),[\\\"quality\\\",\\\"maxRoughness\\\",\\\"physical\\\"].forEach(function(e){r.setSSRParameter(e,s.get(e))}),[\\\"quality\\\",\\\"focalDistance\\\",\\\"focalRange\\\",\\\"blurRadius\\\",\\\"fstop\\\"].forEach(function(e){r.setDOFParameter(e,a.get(e))}),[\\\"brightness\\\",\\\"contrast\\\",\\\"saturation\\\"].forEach(function(e){r.setColorCorrection(e,h.get(e))})},A.prototype.setDOFFocusOnPoint=function(e){if(this._enablePostEffect&&!(e>this.camera.far||e<this.camera.near))return this._compositor.setDOFParameter(\\\"focalDistance\\\",e),!0},A.prototype.setTemporalSuperSampling=function(e){this._enableTemporalSS=e.get(\\\"enable\\\")},A.prototype.isLinearSpace=function(){return this._enablePostEffect},A.prototype.setRootNode=function(e){if(this.rootNode!==e){for(var t=this.rootNode.children(),r=0;r<t.length;r++)e.add(t[r]);e!==this.scene&&this.scene.add(e),this.rootNode=e}},A.prototype.add=function(e){this.rootNode.add(e)},A.prototype.remove=function(e){this.rootNode.remove(e)},A.prototype.removeAll=function(e){this.rootNode.removeAll(e)},Object.assign(A.prototype,V);const hl=A;function ul(e,t){var r=rs(e.getBoxLayoutParams(),{width:t.getWidth(),height:t.getHeight()}),r=(r.y=t.getHeight()-r.y-r.height,this.viewGL.setViewport(r.x,r.y,r.width,r.height,t.getDevicePixelRatio()),e.get(\\\"boxWidth\\\")),i=e.get(\\\"boxHeight\\\"),n=e.get(\\\"boxDepth\\\");this.getAxis(\\\"x\\\").setExtent(-r/2,r/2),this.getAxis(\\\"y\\\").setExtent(n/2,-n/2),this.getAxis(\\\"z\\\").setExtent(-i/2,i/2),this.size=[r,i,n]}function cl(e,t){var s={};e.eachSeries(function(e){var n;e.coordinateSystem===this&&(n=e.getData(),[\\\"x\\\",\\\"y\\\",\\\"z\\\"].forEach(function(i){n.mapDimensionsAll(i,!0).forEach(function(e){var t=i,r=n.getDataExtent(e,!0);s[t]=s[t]||[1/0,-1/0],s[t][0]=Math.min(r[0],s[t][0]),s[t][1]=Math.max(r[1],s[t][1])})}))},this),[\\\"xAxis3D\\\",\\\"yAxis3D\\\",\\\"zAxis3D\\\"].forEach(function(o){e.eachComponent(o,function(e){var t,r,i=o.charAt(0),n=e.getReferringComponents(\\\"grid3D\\\").models[0],a=n.coordinateSystem;a!==this||(t=a.getAxis(i))||(r=F.helper.createScale(s[i]||[1/0,-1/0],e),(t=new Vo(i,r)).type=e.get(\\\"type\\\"),i=\\\"category\\\"===t.type,t.onBand=i&&e.get(\\\"boundaryGap\\\"),t.inverse=e.get(\\\"inverse\\\"),(e.axis=t).model=e,t.getLabelModel=function(){return e.getModel(\\\"axisLabel\\\",n.getModel(\\\"axisLabel\\\"))},t.getTickModel=function(){return e.getModel(\\\"axisTick\\\",n.getModel(\\\"axisTick\\\"))},a.addAxis(t))},this)},this),this.resize(this.model,t)}const dl={dimensions:Uo.prototype.dimensions,create:function(a,e){var r=[],o=(a.eachComponent(\\\"grid3D\\\",function(e){e.__viewGL=e.__viewGL||new hl;var t=new Uo;t.model=e,t.viewGL=e.__viewGL,e.coordinateSystem=t,r.push(t),t.resize=ul,t.update=cl}),[\\\"xAxis3D\\\",\\\"yAxis3D\\\",\\\"zAxis3D\\\"]);return a.eachSeries(function(e){var t,r,i,n;\\\"cartesian3D\\\"===e.get(\\\"coordinateSystem\\\")&&(null==(t=e.getReferringComponents(\\\"grid3D\\\").models[0])&&(i=e,n=a,t=(r=o.map(function(e){var t=i.getReferringComponents(e).models[0];return t=null==t?n.getComponent(e):t}))[0].getCoordSysModel(),r.forEach(function(e){e.getCoordSysModel()})),r=t.coordinateSystem,e.coordinateSystem=r)}),r}};Dn=F.ComponentModel.extend({type:\\\"cartesian3DAxis\\\",axis:null,getCoordSysModel:function(){return this.ecModel.queryComponents({mainType:\\\"grid3D\\\",index:this.option.gridIndex,id:this.option.gridId})[0]}});F.helper.mixinAxisModelCommonMethods(Dn);const fl=Dn;var x={show:!0,grid3DIndex:0,inverse:!1,name:\\\"\\\",nameLocation:\\\"middle\\\",nameTextStyle:{fontSize:16},nameGap:20,axisPointer:{},axisLine:{},axisTick:{},axisLabel:{},splitArea:{}},V=F.util.merge({boundaryGap:!0,axisTick:{alignWithLabel:!1,interval:\\\"auto\\\"},axisLabel:{interval:\\\"auto\\\"},axisPointer:{label:{show:!1}}},x),Dn=F.util.merge({boundaryGap:[0,0],splitNumber:5,axisPointer:{label:{}}},x),x=F.util.defaults({scale:!0,min:\\\"dataMin\\\",max:\\\"dataMax\\\"},Dn),pl=F.util.defaults({logBase:10},Dn);pl.scale=!0;const ml={categoryAxis3D:V,valueAxis3D:Dn,timeAxis3D:x,logAxis3D:pl};function gl(e){return(\\\"function\\\"==(t=typeof e)||e&&\\\"object\\\"==t)&&null!=e.value?e.value:e+\\\"\\\";var t}vl.createByAxisModel=function(e){var t=e.option,r=t.data,r=r&&ra(r,gl);return new vl({categories:r,needCollect:!r,deduplication:!1!==t.dedplication})},vl.prototype.getOrdinal=function(e){return this._getOrCreateMap().get(e)},vl.prototype.parseAndCollect=function(e){var t,r,i=this._needCollect;return\\\"string\\\"==typeof e||i?(i&&!this._deduplication?(t=this.categories.length,this.categories[t]=e):null==(t=(r=this._getOrCreateMap()).get(e))&&(i?(t=this.categories.length,this.categories[t]=e,r.set(e,t)):t=NaN),t):e},vl.prototype._getOrCreateMap=function(){return this._map||(this._map=(e=this.categories,new sa(e)));var e};const _l=vl;function vl(e){this.categories=e.categories||[],this._needCollect=e.needCollect,this._deduplication=e.deduplication}var yl=[\\\"value\\\",\\\"category\\\",\\\"time\\\",\\\"log\\\"];function xl(e,t){return t.type||(t.data?\\\"category\\\":\\\"value\\\")}(0,F.use)(function(s){s.registerComponentModel(Wa),s.registerComponentView(Bo),s.registerCoordinateSystem(\\\"grid3D\\\",dl),[\\\"x\\\",\\\"y\\\",\\\"z\\\"].forEach(function(e){t=s,n=e,r=fl,a=xl,o={name:e.toUpperCase()},yl.forEach(function(i){var e=r.extend({type:n+\\\"Axis3D.\\\"+i,__ordinalMeta:null,mergeDefaultAndTheme:function(e,t){var r=t.getTheme();F.util.merge(e,r.get(i+\\\"Axis3D\\\")),F.util.merge(e,this.getDefaultOption()),e.type=a(n,e)},optionUpdated:function(){\\\"category\\\"===this.option.type&&(this.__ordinalMeta=_l.createByAxisModel(this))},getCategories:function(){if(\\\"category\\\"===this.option.type)return this.__ordinalMeta.categories},getOrdinalMeta:function(){return this.__ordinalMeta},defaultOption:F.util.merge(F.util.clone(ml[i+\\\"Axis3D\\\"]),o,!0)});t.registerComponentModel(e)}),t.registerSubTypeDefaulter(n+\\\"Axis3D\\\",F.util.curry(a,n));var t,n,r,a,o,i=s.ComponentView.extend({type:e+\\\"Axis3D\\\"});s.registerComponentView(i)}),s.registerAction({type:\\\"grid3DChangeCamera\\\",event:\\\"grid3dcamerachanged\\\",update:\\\"series:updateCamera\\\"},function(t,e){e.eachComponent({mainType:\\\"grid3D\\\",query:t},function(e){e.setView(t)})}),s.registerAction({type:\\\"grid3DShowAxisPointer\\\",event:\\\"grid3dshowaxispointer\\\",update:\\\"grid3D:showAxisPointer\\\"},function(e,t){}),s.registerAction({type:\\\"grid3DHideAxisPointer\\\",event:\\\"grid3dhideaxispointer\\\",update:\\\"grid3D:hideAxisPointer\\\"},function(e,t){})});V={defaultOption:{shading:null,realisticMaterial:{textureTiling:1,textureOffset:0,detailTexture:null},lambertMaterial:{textureTiling:1,textureOffset:0,detailTexture:null},colorMaterial:{textureTiling:1,textureOffset:0,detailTexture:null},hatchingMaterial:{textureTiling:1,textureOffset:0,paperColor:\\\"#fff\\\"}}},Dn={getFilledRegions:function(e,t){var r,i=(e||[]).slice();if(\\\"string\\\"==typeof t?r=(t=F.getMap(t))&&t.geoJson:t&&t.features&&(r=t),!r)return[];for(var n={},a=r.features,o=0;o<i.length;o++)n[i[o].name]=i[o];for(o=0;o<a.length;o++){var s=a[o].properties.name;n[s]||i.push({name:s})}return i},defaultOption:{show:!0,zlevel:-10,map:\\\"\\\",left:0,top:0,width:\\\"100%\\\",height:\\\"100%\\\",boxWidth:100,boxHeight:10,boxDepth:\\\"auto\\\",regionHeight:3,environment:\\\"auto\\\",groundPlane:{show:!1,color:\\\"#aaa\\\"},shading:\\\"lambert\\\",light:{main:{alpha:40,beta:30}},viewControl:{alpha:40,beta:0,distance:100,orthographicSize:60,minAlpha:5,minBeta:-80,maxBeta:80},label:{show:!1,distance:2,textStyle:{fontSize:20,color:\\\"#000\\\",backgroundColor:\\\"rgba(255,255,255,0.7)\\\",padding:3,borderRadius:4}},itemStyle:{color:\\\"#fff\\\",borderWidth:0,borderColor:\\\"#333\\\"},emphasis:{itemStyle:{color:\\\"#639fc0\\\"},label:{show:!0}}}},x=F.ComponentModel.extend({type:\\\"geo3D\\\",layoutMode:\\\"box\\\",coordinateSystem:null,optionUpdated:function(){var e=this.option,t=(e.regions=this.getFilledRegions(e.regions,e.map),F.helper.createDimensions(e.data||[],{coordDimensions:[\\\"value\\\"],encodeDefine:this.get(\\\"encode\\\"),dimensionsDefine:this.get(\\\"dimensions\\\")})),i=new F.List(t,this),n=(i.initData(e.regions),{});i.each(function(e){var t=i.getName(e),r=i.getItemModel(e);n[t]=r}),this._regionModelMap=n,this._data=i},getData:function(){return this._data},getRegionModel:function(e){var t=this.getData().getName(e);return this._regionModelMap[t]||new F.Model(null,this)},getRegionPolygonCoords:function(e){var t=this.getData().getName(e),t=this.coordinateSystem.getRegion(t);return t?t.geometries:[]},getFormattedLabel:function(e,t){var r=this._data.getName(e),i=this.getRegionModel(e),n=i.get(\\\"normal\\\"===t?[\\\"label\\\",\\\"formatter\\\"]:[\\\"emphasis\\\",\\\"label\\\",\\\"formatter\\\"]),a={name:r};return\\\"function\\\"==typeof(n=null==n?i.get([\\\"label\\\",\\\"formatter\\\"]):n)?(a.status=t,n(a)):\\\"string\\\"==typeof n?n.replace(\\\"{a}\\\",null!=(i=a.seriesName)?i:\\\"\\\"):r},defaultOption:{regions:[]}});F.util.merge(x.prototype,Dn),F.util.merge(x.prototype,s),F.util.merge(x.prototype,v),F.util.merge(x.prototype,e),F.util.merge(x.prototype,V);const bl=x,wl=Tl;function Tl(e,t,r){r=r||2;var i,n,a,o,s,l=t&&t.length,h=l?t[0]*r:e.length,u=Sl(e,0,h,r,!0),c=[];if(u){if(l&&(u=function(e,t,r,i){for(var n,a,o=[],s=0,l=t.length;s<l;s++)(n=Sl(e,t[s]*i,s<l-1?t[s+1]*i:e.length,i,!1))===n.next&&(n.steiner=!0),o.push(function(e){var t=e,r=e;for(;t.x<r.x&&(r=t),t=t.next,t!==e;);return r}(n));for(o.sort(El),s=0;s<o.length;s++){{h=void 0;u=void 0;a=void 0;var h=o[s];var u=r;(u=function(e,t){var r,i=t,n=e.x,a=e.y,o=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var s=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=n&&o<s){if((o=s)===n){if(a===i.y)return i;if(a===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}}while((i=i.next)!==t);if(!r)return null;if(n===o)return r.prev;for(var l,h=r,u=r.x,c=r.y,d=1/0,i=r.next;i!==h;)n>=i.x&&i.x>=u&&n!==i.x&&Dl(a<c?n:o,a,u,c,a<c?o:n,a,i.x,i.y)&&((l=Math.abs(a-i.y)/(n-i.x))<d||l===d&&i.x>r.x)&&Nl(i,e)&&(r=i,d=l),i=i.next;return r}(h,u))&&Ml(a=Il(u,h),a.next)}r=Ml(r,r.next)}return r}(e,t,u,r)),e.length>80*r){for(var d=i=e[0],f=n=e[1],p=r;p<h;p+=r)(a=e[p])<d&&(d=a),(o=e[p+1])<f&&(f=o),i<a&&(i=a),n<o&&(n=o);s=Math.max(i-d,n-f)}Al(u,c,r,d,f,s)}return c}function Sl(e,t,r,i,n){var a,o;if(n===0<zl(e,t,r,i))for(a=t;a<r;a+=i)o=Rl(a,e[a],e[a+1],o);else for(a=r-i;t<=a;a-=i)o=Rl(a,e[a],e[a+1],o);return o&&Pl(o,o.next)&&(Bl(o),o=o.next),o}function Ml(e,t){if(!e)return e;t=t||e;var r,i=e;do{if(r=!1,i.steiner||!Pl(i,i.next)&&0!==Ll(i.prev,i,i.next))i=i.next;else{if(Bl(i),(i=t=i.prev)===i.next)return null;r=!0}}while(r||i!==t);return t}function Al(e,t,r,i,n,a,o){if(e){if(!o&&a){var s=e;var l=i;var h=n;var u=a;for(var c=s;null===c.z&&(c.z=Cl(c.x,c.y,l,h,u)),c.prevZ=c.prev,c.nextZ=c.next,(c=c.next)!==s;);c.prevZ.nextZ=null,c.prevZ=null;var d,f,p,m,g,_,v,y,x=c,b=1;do{for(f=x,g=x=null,_=0;f;){for(_++,p=f,d=v=0;d<b&&(v++,p=p.nextZ);d++);for(y=b;0<v||0<y&&p;)0!==v&&(0===y||!p||f.z<=p.z)?(f=(m=f).nextZ,v--):(p=(m=p).nextZ,y--),g?g.nextZ=m:x=m,m.prevZ=g,g=m;f=p}}while(g.nextZ=null,b*=2,1<_)}for(var w,T,S=e;e.prev!==e.next;)if(w=e.prev,T=e.next,a?function(e,t,r,i){var n=e.prev,a=e,o=e.next;if(0<=Ll(n,a,o))return;for(var s=(n.x<a.x?n.x<o.x?n:o:a.x<o.x?a:o).x,l=(n.y<a.y?n.y<o.y?n:o:a.y<o.y?a:o).y,h=(n.x>a.x?n.x>o.x?n:o:a.x>o.x?a:o).x,u=(n.y>a.y?n.y>o.y?n:o:a.y>o.y?a:o).y,c=Cl(s,l,t,r,i),d=Cl(h,u,t,r,i),f=e.nextZ;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&Dl(n.x,n.y,a.x,a.y,o.x,o.y,f.x,f.y)&&0<=Ll(f.prev,f,f.next))return;f=f.nextZ}for(f=e.prevZ;f&&f.z>=c;){if(f!==e.prev&&f!==e.next&&Dl(n.x,n.y,a.x,a.y,o.x,o.y,f.x,f.y)&&0<=Ll(f.prev,f,f.next))return;f=f.prevZ}return 1}(e,i,n,a):function(e){var t=e.prev,r=e,i=e.next;if(0<=Ll(t,r,i))return;for(var n=e.next.next;n!==e.prev;){if(Dl(t.x,t.y,r.x,r.y,i.x,i.y,n.x,n.y)&&0<=Ll(n.prev,n,n.next))return;n=n.next}return 1}(e))t.push(w.i/r),t.push(e.i/r),t.push(T.i/r),Bl(e),e=T.next,S=T.next;else if((e=T)===S){o?1===o?Al(e=function(e,t,r){var i=e;do{var n=i.prev,a=i.next.next}while(!Pl(n,a)&&Ol(n,i,i.next,a)&&Nl(n,a)&&Nl(a,n)&&(t.push(n.i/r),t.push(i.i/r),t.push(a.i/r),Bl(i),Bl(i.next),i=e=a),i=i.next,i!==e);return i}(e,t,r),t,r,i,n,a,2):2===o&&function(e,t,r,i,n,a){var o=e;do{for(var s,l=o.next.next;l!==o.prev;){if(o.i!==l.i&&function(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&Ol(r,r.next,e,t))return 1}while((r=r.next)!==e)}(e,t)&&Nl(e,t)&&Nl(t,e)&&function(e,t){for(var r=e,i=!1,n=(e.x+t.x)/2,a=(e.y+t.y)/2;r.y>a!=r.next.y>a&&r.next.y!==r.y&&n<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(i=!i),(r=r.next)!==e;);return i}(e,t)}(o,l))return s=Il(o,l),o=Ml(o,o.next),s=Ml(s,s.next),Al(o,t,r,i,n,a),Al(s,t,r,i,n,a);l=l.next}}while(o=o.next,o!==e)}(e,t,r,i,n,a):Al(Ml(e),t,r,i,n,a,1);break}}}function El(e,t){return e.x-t.x}function Cl(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)/n)|e<<8))|e<<4))|e<<2))|e<<1))|(1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)/n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Dl(e,t,r,i,n,a,o,s){return 0<=(n-o)*(t-s)-(e-o)*(a-s)&&0<=(e-o)*(i-s)-(r-o)*(t-s)&&0<=(r-o)*(a-s)-(n-o)*(i-s)}function Ll(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Pl(e,t){return e.x===t.x&&e.y===t.y}function Ol(e,t,r,i){return Pl(e,t)&&Pl(r,i)||Pl(e,i)&&Pl(r,t)||0<Ll(e,t,r)!=0<Ll(e,t,i)&&0<Ll(r,i,e)!=0<Ll(r,i,t)}function Nl(e,t){return Ll(e.prev,e,e.next)<0?0<=Ll(e,t,e.next)&&0<=Ll(e,e.prev,t):Ll(e,t,e.prev)<0||Ll(e,e.next,t)<0}function Il(e,t){var r=new Fl(e.i,e.x,e.y),i=new Fl(t.i,t.x,t.y),n=e.next,a=t.prev;return(e.next=t).prev=e,(r.next=n).prev=r,(i.next=r).prev=i,(a.next=i).prev=a,i}function Rl(e,t,r,i){var n=new Fl(e,t,r);return i?(n.next=i.next,(n.prev=i).next.prev=n,i.next=n):(n.prev=n).next=n,n}function Bl(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Fl(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function zl(e,t,r,i){for(var n=0,a=t,o=r-i;a<r;a+=i)n+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return n}function Gl(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function Ul(e,t,r,i,n){var a=r,o=e[t];Gl(e,t,i);for(var s=r;s<i;s++)n(e[s],o)<0&&(Gl(e,s,a),a++);return Gl(e,i,a),a}function kl(e,t,r,i){var n;r<i&&(kl(e,t,r,(n=Ul(e,Math.floor((r+i)/2),r,i,t))-1),kl(e,t,n+1,i))}function Vl(){this._parts=[]}Tl.deviation=function(e,t,r,i){var n=t&&t.length,a=n?t[0]*r:e.length,o=Math.abs(zl(e,0,a,r));if(n)for(var s=0,l=t.length;s<l;s++){var h=t[s]*r,u=s<l-1?t[s+1]*r:e.length;o-=Math.abs(zl(e,h,u,r))}for(var c=0,s=0;s<i.length;s+=3){var d=i[s]*r,f=i[s+1]*r,p=i[s+2]*r;c+=Math.abs((e[d]-e[p])*(e[1+f]-e[1+d])-(e[d]-e[f])*(e[1+p]-e[1+d]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},Vl.prototype.step=function(e,t,r){var i,n=e.length;if(0===r&&(this._parts=[],this._sorted=!1,i=Math.floor(n/2),this._parts.push({pivot:i,left:0,right:n-1}),this._currentSortPartIdx=0),!this._sorted){var a=this._parts;if(0===a.length)return this._sorted=!0;if(a.length<512){for(var o=0;o<a.length;o++)a[o].pivot=Ul(e,a[o].pivot,a[o].left,a[o].right,t);for(var s=[],o=0;o<a.length;o++){var l,h=a[o].left;(l=a[o].pivot-1)>h&&s.push({pivot:Math.floor((l+h)/2),left:h,right:l}),h=a[o].pivot+1,(l=a[o].right)>h&&s.push({pivot:Math.floor((l+h)/2),left:h,right:l})}a=this._parts=s}else for(o=0;o<Math.floor(a.length/10);o++){var u=a.length-1-this._currentSortPartIdx;if(kl(e,t,a[u].left,a[u].right),this._currentSortPartIdx++,this._currentSortPartIdx===a.length)return this._sorted=!0}return!1}},Vl.sort=kl;const Hl=Vl;var Wl=ao.vec3,jl=Wl.create(),Xl=Wl.create(),ql=Wl.create();const Zl={needsSortTriangles:function(){return this.indices&&this.sortTriangles},needsSortTrianglesProgressively:function(){return this.needsSortTriangles()&&2e4<=this.triangleCount},doSortTriangles:function(e,t){var r=this.indices;if(0===t){var i=this.attributes.position;e=e.array,this._triangleZList&&this._triangleZList.length===this.triangleCount||(this._triangleZList=new Float32Array(this.triangleCount),this._sortedTriangleIndices=new Uint32Array(this.triangleCount),this._indicesTmp=new r.constructor(r.length),this._triangleZListTmp=new Float32Array(this.triangleCount));for(var n,a=0,o=0;o<r.length;){i.get(r[o++],jl),i.get(r[o++],Xl),i.get(r[o++],ql);var s=Wl.sqrDist(jl,e),l=Wl.sqrDist(Xl,e),h=Wl.sqrDist(ql,e),s=Math.min(s,l),s=Math.min(s,h);3===o?(n=s,s=0):s-=n,this._triangleZList[a++]=s}}for(var u=this._sortedTriangleIndices,o=0;o<u.length;o++)u[o]=o;if(this.triangleCount<2e4)0===t&&this._simpleSort(!0);else for(o=0;o<3;o++)this._progressiveQuickSort(3*t+o);var c=this._indicesTmp,d=this._triangleZListTmp,f=this._triangleZList;for(o=0;o<this.triangleCount;o++){var p=3*u[o],m=3*o;c[m++]=r[p++],c[m++]=r[p++],c[m]=r[p],d[o]=f[u[o]]}var g=this._indicesTmp;this._indicesTmp=this.indices,this.indices=g,g=this._triangleZListTmp,this._triangleZListTmp=this._triangleZList,this._triangleZList=g,this.dirtyIndices()},_simpleSort:function(e){var r=this._triangleZList,t=this._sortedTriangleIndices;function i(e,t){return r[t]-r[e]}e?Array.prototype.sort.call(t,i):Hl.sort(t,i,0,t.length-1)},_progressiveQuickSort:function(e){var r=this._triangleZList,t=this._sortedTriangleIndices;this._quickSort=this._quickSort||new Hl,this._quickSort.step(t,function(e,t){return r[t]-r[e]},e)}};function Yl(e,t){var r=e.getItemVisual(t,\\\"style\\\");if(r)return r[e.getVisual(\\\"drawType\\\")]}function Kl(e,t){var r=e.getItemVisual(t,\\\"style\\\");return r&&r.opacity}function Ql(e,t,r){this._labelsMesh=new Eo,this._labelTextureSurface=new co({width:512,height:512,devicePixelRatio:r.getDevicePixelRatio(),onupdate:function(){r.getZr().refresh()}}),this._api=r,this._labelsMesh.material.set(\\\"textureAtlas\\\",this._labelTextureSurface.getTexture())}Ql.prototype.getLabelPosition=function(e,t,r){return[0,0,0]},Ql.prototype.getLabelDistance=function(e,t,r){return 0},Ql.prototype.getMesh=function(){return this._labelsMesh},Ql.prototype.updateData=function(e,t,r){null==t&&(t=0),null==r&&(r=e.count()),this._labelsVisibilitiesBits&&this._labelsVisibilitiesBits.length===r-t||(this._labelsVisibilitiesBits=new Uint8Array(r-t));for(var i=[\\\"label\\\",\\\"show\\\"],n=[\\\"emphasis\\\",\\\"label\\\",\\\"show\\\"],a=t;a<r;a++){var o=e.getItemModel(a),s=o.get(i),o=o.get(n),s=(s?1:0)|((o=null==o?s:o)?2:0);this._labelsVisibilitiesBits[a-t]=s}this._start=t,this._end=r,this._data=e},Ql.prototype.updateLabels=function(e){if(this._data){for(var t=0<(e=e||[]).length,r={},i=0;i<e.length;i++)r[e[i]]=!0;this._labelsMesh.geometry.convertToDynamicArray(!0),this._labelTextureSurface.clear();for(var n=[\\\"label\\\"],a=[\\\"emphasis\\\",\\\"label\\\"],o=this._data.hostModel,s=this._data,l=o.getModel(n),h=o.getModel(a,l),u={left:\\\"right\\\",right:\\\"left\\\",top:\\\"center\\\",bottom:\\\"center\\\"},c={left:\\\"middle\\\",right:\\\"middle\\\",top:\\\"bottom\\\",bottom:\\\"top\\\"},d=this._start;d<this._end;d++){var f=t&&r[d]?!0:!1;if(this._labelsVisibilitiesBits[d-this._start]&(f?2:1)){var p=s.getItemModel(d).getModel(f?a:n,f?h:l),m=p.get(\\\"distance\\\")||0,g=p.get(\\\"position\\\"),_=this._api.getDevicePixelRatio(),f=o.getFormattedLabel(d,f?\\\"emphasis\\\":\\\"normal\\\");if(null==f||\\\"\\\"===f)return;var f=new F.graphic.Text({style:Ya(p,{text:f,fill:p.get(\\\"color\\\")||Yl(s,d)||\\\"#000\\\",align:\\\"left\\\",verticalAlign:\\\"top\\\",opacity:E(p.get(\\\"opacity\\\"),Kl(s,d),1)})}),p=f.getBoundingRect(),f=(p.height*=1.2,this._labelTextureSurface.add(f)),v=u[g]||\\\"center\\\",y=c[g]||\\\"bottom\\\";this._labelsMesh.geometry.addSprite(this.getLabelPosition(d,g,m),[p.width*_,p.height*_],f,v,y,this.getLabelDistance(d,g,m)*_)}}this._labelsMesh.material.set(\\\"uvScale\\\",this._labelTextureSurface.getCoordsScale()),this._labelTextureSurface.getZr().refreshImmediately(),this._labelsMesh.geometry.convertToTypedArray(),this._labelsMesh.geometry.dirty()}},Ql.prototype.dispose=function(){this._labelTextureSurface.dispose()};const Jl=Ql;var $l=ao.vec3;function eh(e){this.rootNode=new Z.Node,this._triangulationResults={},this._shadersMap=Z.COMMON_SHADERS.filter(function(e){return\\\"shadow\\\"!==e}).reduce(function(e,t){return e[t]=Z.createShader(\\\"ecgl.\\\"+t),e},{}),this._linesShader=Z.createShader(\\\"ecgl.meshLines3D\\\");var t={};Z.COMMON_SHADERS.forEach(function(e){t[e]=new Z.Material({shader:Z.createShader(\\\"ecgl.\\\"+e)})}),this._groundMaterials=t,this._groundMesh=new Z.Mesh({geometry:new Z.PlaneGeometry({dynamic:!0}),castShadow:!1,renderNormal:!0,$ignorePicking:!0}),this._groundMesh.rotation.rotateX(-Math.PI/2),this._labelsBuilder=new Jl(512,512,e),this._labelsBuilder.getMesh().renderOrder=100,this._labelsBuilder.getMesh().material.depthTest=!1,this.rootNode.add(this._labelsBuilder.getMesh()),this._initMeshes(),this._api=e}Z.Shader[\\\"import\\\"](No),eh.prototype={constructor:eh,extrudeY:!0,update:function(e,t,r,i,n){var o=e.getData(),a=(null==i&&(i=0),null==n&&(n=o.count()),this._startIndex=i,this._endIndex=n-1,this._triangulation(e,i,n),this._getShader(e.get(\\\"shading\\\"))),s=(this._prepareMesh(e,a,r,i,n),this.rootNode.updateWorldTransform(),this._updateRegionMesh(e,r,i,n),e.coordinateSystem),l=(\\\"geo3D\\\"===s.type&&this._updateGroundPlane(e,s,r),this);this._labelsBuilder.updateData(o,i,n),this._labelsBuilder.getLabelPosition=function(e,t,r){var i=o.getName(e),n=r;if(\\\"geo3D\\\"===s.type)return(i=s.getRegion(i))?(a=i.getCenter(),s.dataToPoint([a[0],a[1],n])):[NaN,NaN,NaN];var i=l._triangulationResults[e-l._startIndex],a=l.extrudeY?[(i.max[0]+i.min[0])/2,i.max[1]+n,(i.max[2]+i.min[2])/2]:[(i.max[0]+i.min[0])/2,(i.max[1]+i.min[1])/2,i.max[2]+n]},this._data=o,this._labelsBuilder.updateLabels(),this._updateDebugWireframe(e),this._lastHoverDataIndex=0},_initMeshes:function(){var e=this,t=(e=new Z.Mesh({name:\\\"Polygon\\\",material:new Z.Material({shader:e._shadersMap.lambert}),geometry:new Z.Geometry({sortTriangles:!0,dynamic:!0}),culling:!1,ignorePicking:!0,renderNormal:!0}),Object.assign(e.geometry,Zl),new Z.Mesh({material:new Z.Material({shader:this._linesShader}),castShadow:!1,ignorePicking:!0,$ignorePicking:!0,geometry:new lo({useNativeLine:!1})}));this.rootNode.add(e),this.rootNode.add(t),e.material.define(\\\"both\\\",\\\"VERTEX_COLOR\\\"),e.material.define(\\\"fragment\\\",\\\"DOUBLE_SIDED\\\"),this._polygonMesh=e,this._linesMesh=t,this.rootNode.add(this._groundMesh)},_getShader:function(e){var t=this._shadersMap[e];return(t=t||this._shadersMap.lambert).__shading=e,t},_prepareMesh:function(e,t,r,i,n){for(var a=0,o=0,s=0,l=0,h=i;h<n;h++){var u=this._getRegionPolygonInfo(h),c=this._getRegionLinesInfo(h,e,this._linesMesh.geometry);a+=u.vertexCount,o+=u.triangleCount,s+=c.vertexCount,l+=c.triangleCount}var d=this._polygonMesh,f=d.geometry;[\\\"position\\\",\\\"normal\\\",\\\"texcoord0\\\",\\\"color\\\"].forEach(function(e){f.attributes[e].init(a)}),f.indices=new(65535<a?Uint32Array:Uint16Array)(3*o),d.material.shader!==t&&d.material.attachShader(t,!0),Z.setMaterialFromModel(t.__shading,d.material,e,r),0<s&&(this._linesMesh.geometry.resetOffset(),this._linesMesh.geometry.setVertexCount(s),this._linesMesh.geometry.setTriangleCount(l)),this._dataIndexOfVertex=new Uint32Array(a),this._vertexRangeOfDataIndex=new Uint32Array(2*(n-i))},_updateRegionMesh:function(e,t,r,i){for(var n=e.getData(),a=0,o=0,s=!1,l=this._polygonMesh,h=this._linesMesh,u=r;u<i;u++){var c=e.getRegionModel(u),d=c.getModel(\\\"itemStyle\\\"),f=E(Yl(n,u),d.get(\\\"color\\\"),\\\"#fff\\\"),p=E(Kl(n,u),1),f=Z.parseColor(f),m=Z.parseColor(d.get(\\\"borderColor\\\")),p=(f[3]*=p,m[3]*=p,f[3]<.99);l.material.set(\\\"color\\\",[1,1,1,1]);for(var s=s||p,p=E(c.get(\\\"height\\\",!0),e.get(\\\"regionHeight\\\")),g=this._updatePolygonGeometry(e,l.geometry,u,p,a,o,f),_=a;_<g.vertexOffset;_++)this._dataIndexOfVertex[_]=u;this._vertexRangeOfDataIndex[2*(u-r)]=a,this._vertexRangeOfDataIndex[2*(u-r)+1]=g.vertexOffset;a=g.vertexOffset,o=g.triangleOffset,c=d.get(\\\"borderWidth\\\"),f=0<c;f&&(c*=t.getDevicePixelRatio(),this._updateLinesGeometry(h.geometry,e,u,p,c,e.coordinateSystem.transform)),h.invisible=!f,h.material.set({color:m})}(l=this._polygonMesh).material.transparent=s,l.material.depthMask=!s,l.geometry.updateBoundingBox(),l.frontFace=this.extrudeY?Z.Mesh.CCW:Z.Mesh.CW,l.material.get(\\\"normalMap\\\")&&l.geometry.generateTangents(),l.seriesIndex=e.seriesIndex,l.on(\\\"mousemove\\\",this._onmousemove,this),l.on(\\\"mouseout\\\",this._onmouseout,this)},_updateDebugWireframe:function(e){var t,r,i=e.getModel(\\\"debug.wireframe\\\");i.get(\\\"show\\\")&&(t=Z.parseColor(i.get(\\\"lineStyle.color\\\")||\\\"rgba(0,0,0,0.5)\\\"),i=E(i.get(\\\"lineStyle.width\\\"),1),(r=this._polygonMesh).geometry.generateBarycentric(),r.material.define(\\\"both\\\",\\\"WIREFRAME_TRIANGLE\\\"),r.material.set(\\\"wireframeLineColor\\\",t),r.material.set(\\\"wireframeLineWidth\\\",i))},_onmousemove:function(e){var t=this._dataIndexOfVertex[e.triangle[0]];(t=null==t?-1:t)!==this._lastHoverDataIndex&&(this.downplay(this._lastHoverDataIndex),this.highlight(t),this._labelsBuilder.updateLabels([t])),this._lastHoverDataIndex=t,this._polygonMesh.dataIndex=t},_onmouseout:function(e){e.target&&(this.downplay(this._lastHoverDataIndex),this._lastHoverDataIndex=-1,this._polygonMesh.dataIndex=-1),this._labelsBuilder.updateLabels([])},_updateGroundPlane:function(e,t,r){var i,n,a=e.getModel(\\\"groundPlane\\\",e);this._groundMesh.invisible=!a.get(\\\"show\\\",!0),this._groundMesh.invisible||(i=e.get(\\\"shading\\\"),n=(n=this._groundMaterials[i])||this._groundMaterials.lambert,Z.setMaterialFromModel(i,n,a,r),n.get(\\\"normalMap\\\")&&this._groundMesh.geometry.generateTangents(),this._groundMesh.material=n,this._groundMesh.material.set(\\\"color\\\",Z.parseColor(a.get(\\\"color\\\"))),this._groundMesh.scale.set(t.size[0],t.size[2],1))},_triangulation:function(e,t,r){this._triangulationResults=[];for(var i=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0],a=e.coordinateSystem,o=t;o<r;o++){for(var s=[],l=e.getRegionPolygonCoords(o),h=0;h<l.length;h++){var u=l[h].exterior,c=l[h].interiors,d=[],f=[];if(!(u.length<3)){for(var p=0,m=0;m<u.length;m++){var g=u[m];d[p++]=g[0],d[p++]=g[1]}for(m=0;m<c.length;m++)if(!(c[m].length<3)){for(var _=d.length/2,v=0;v<c[m].length;v++)g=c[m][v],d.push(g[0]),d.push(g[1]);f.push(_)}for(var y=wl(d,f),x=new Float64Array(d.length/2*3),b=[],w=[1/0,1/0,1/0],T=[-1/0,-1/0,-1/0],S=0,m=0;m<d.length;)$l.set(b,d[m++],0,d[m++]),a&&a.transform&&$l.transformMat4(b,b,a.transform),$l.min(w,w,b),$l.max(T,T,b),x[S++]=b[0],x[S++]=b[1],x[S++]=b[2];$l.min(i,i,w),$l.max(n,n,T),s.push({points:x,indices:y,min:w,max:T})}}this._triangulationResults.push(s)}this._geoBoundingBox=[i,n]},_getRegionPolygonInfo:function(e){for(var t=this._triangulationResults[e-this._startIndex],r=0,i=0,n=0;n<t.length;n++)r+=t[n].points.length/3,i+=t[n].indices.length/3;return{vertexCount:2*r+4*r,triangleCount:2*i+2*r}},_updatePolygonGeometry:function(B,e,F,t,c,d,f){var z=B.get(\\\"projectUVOnGround\\\"),p=e.attributes.position,r=e.attributes.normal,m=e.attributes.texcoord0,g=e.attributes.color,i=this._triangulationResults[F-this._startIndex],_=g.value&&f,v=e.indices,y=this.extrudeY?1:2,x=this.extrudeY?2:1,b=[this.rootNode.worldTransform.x.len(),this.rootNode.worldTransform.y.len(),this.rootNode.worldTransform.z.len()],w=$l.mul([],this._geoBoundingBox[0],b),n=$l.mul([],this._geoBoundingBox[1],b),T=Math.max(n[0]-w[0],n[2]-w[2]);function a(e,t){for(var r=c,i=t,n=e.points,a=n.length,o=[],s=[],l=0;l<a;l+=3)o[0]=n[l],o[y]=i,o[x]=n[l+2],s[0]=(n[l]*b[0]-w[0])/T,s[1]=(n[l+2]*b[x]-w[2])/T,p.set(c,o),_&&g.set(c,f),m.set(c++,s);for(var h=e.indices.length,u=0;u<h;u++)v[3*d+u]=e.indices[u]+r;d+=e.indices.length/3}for(var o=this.extrudeY?[0,1,0]:[0,0,1],G=$l.negate([],o),s=0;s<i.length;s++){var l=c,h=i[s];a(h,0),a(h,t);for(var u=h.points.length/3,S=0;S<u;S++)r.set(l+S,G),r.set(l+S+u,o);for(var U=[0,3,1,1,3,2],M=[[],[],[],[]],A=[],E=[],C=[],D=[],L=0,S=0;S<u;S++){for(var P=(S+1)%u,O=(h.points[3*P]-h.points[3*S])*b[0],N=(h.points[3*P+2]-h.points[3*S+2])*b[x],k=Math.sqrt(O*O+N*N),I=0;I<4;I++){var V=0===I||3===I,R=3*(V?S:P);M[I][0]=h.points[R],M[I][y]=1<I?t:0,M[I][x]=h.points[2+R],p.set(c+I,M[I]),z?(D[0]=(h.points[R]*b[0]-w[0])/T,D[1]=(h.points[2+R]*b[x]-w[x])/T):(D[0]=(V?L:L+k)/T,D[1]=(M[I][y]*b[y]-w[y])/T),m.set(c+I,D)}for($l.sub(A,M[1],M[0]),$l.sub(E,M[3],M[0]),$l.cross(C,A,E),$l.normalize(C,C),I=0;I<4;I++)r.set(c+I,C),_&&g.set(c+I,f);for(I=0;I<6;I++)v[3*d+I]=U[I]+c;c+=4,d+=2,L+=k}}return e.dirty(),{vertexOffset:c,triangleOffset:d}},_getRegionLinesInfo:function(e,t,n){var a=0,o=0;return 0<t.getRegionModel(e).getModel(\\\"itemStyle\\\").get(\\\"borderWidth\\\")&&t.getRegionPolygonCoords(e).forEach(function(e){var t=e.exterior,r=e.interiors;a+=n.getPolylineVertexCount(t),o+=n.getPolylineTriangleCount(t);for(var i=0;i<r.length;i++)a+=n.getPolylineVertexCount(r[i]),o+=n.getPolylineTriangleCount(r[i])},this),{vertexCount:a,triangleCount:o}},_updateLinesGeometry:function(n,e,t,a,o,s){function l(e){for(var t=new Float64Array(3*e.length),r=0,i=[],n=0;n<e.length;n++)i[0]=e[n][0],i[1]=a+.1,i[2]=e[n][1],s&&$l.transformMat4(i,i,s),t[r++]=i[0],t[r++]=i[1],t[r++]=i[2];return t}var h=[1,1,1,1];e.getRegionPolygonCoords(t).forEach(function(e){var t=e.exterior,r=e.interiors;n.addPolyline(l(t),h,o);for(var i=0;i<r.length;i++)n.addPolyline(l(r[i]),h,o)})},highlight:function(e){var t,r,i,n=this._data;n&&(r=(t=n.getItemModel(e).getModel([\\\"emphasis\\\",\\\"itemStyle\\\"])).get(\\\"color\\\"),t=E(t.get(\\\"opacity\\\"),Kl(n,e),1),null==r&&(i=Yl(n,e),r=F.color.lift(i,-.4)),null==t&&(t=Kl(n,e)),(i=Z.parseColor(r))[3]*=t,this._setColorOfDataIndex(n,e,i))},downplay:function(e){var t,r,i=this._data;i&&(r=E(Yl(i,e),i.getItemModel(e).get([\\\"itemStyle\\\",\\\"color\\\"]),\\\"#fff\\\"),t=E(Kl(i,e),1),(r=Z.parseColor(r))[3]*=t,this._setColorOfDataIndex(i,e,r))},dispose:function(){this._labelsBuilder.dispose()},_setColorOfDataIndex:function(e,t,r){if(!(t<this._startIndex&&t>this._endIndex)){t-=this._startIndex;for(var i=this._vertexRangeOfDataIndex[2*t];i<this._vertexRangeOfDataIndex[2*t+1];i++)this._polygonMesh.geometry.attributes.color.set(i,r);this._polygonMesh.geometry.dirty(),this._api.getZr().refresh()}}};const th=eh,rh=F.ComponentView.extend({type:\\\"geo3D\\\",__ecgl__:!0,init:function(e,t){this._geo3DBuilder=new th(t),this.groupGL=new Z.Node,this._lightRoot=new Z.Node,this._sceneHelper=new po(this._lightRoot),this._sceneHelper.initLight(this._lightRoot),this._control=new io({zr:t.getZr()}),this._control.init()},render:function(e,t,r){this.groupGL.add(this._geo3DBuilder.rootNode);var i,n,a,o=e.coordinateSystem;o&&o.viewGL&&(o.viewGL.add(this._lightRoot),e.get(\\\"show\\\")?o.viewGL.add(this.groupGL):o.viewGL.remove(this.groupGL),(i=this._control).setViewGL(o.viewGL),n=e.getModel(\\\"viewControl\\\"),i.setFromViewControlModel(n,0),this._sceneHelper.setScene(o.viewGL.scene),this._sceneHelper.updateLight(e),o.viewGL.setPostEffect(e.getModel(\\\"postEffect\\\"),r),o.viewGL.setTemporalSuperSampling(e.getModel(\\\"temporalSuperSampling\\\")),this._geo3DBuilder.update(e,t,r,0,e.getData().count()),a=o.viewGL.isLinearSpace()?\\\"define\\\":\\\"undefine\\\",this._geo3DBuilder.rootNode.traverse(function(e){e.material&&e.material[a](\\\"fragment\\\",\\\"SRGB_DECODE\\\")}),i.off(\\\"update\\\"),i.on(\\\"update\\\",function(){r.dispatchAction({type:\\\"geo3DChangeCamera\\\",alpha:i.getAlpha(),beta:i.getBeta(),distance:i.getDistance(),center:i.getCenter(),from:this.uid,geo3DId:e.id})}),i.update())},afterRender:function(e,t,r,i){var n=i.renderer;this._sceneHelper.updateAmbientCubemap(n,e,r),this._sceneHelper.updateSkybox(n,e,r)},dispose:function(){this._control.dispose(),this._geo3DBuilder.dispose()}});var ih={\\\"南海诸岛\\\":[32,80],\\\"广东\\\":[0,-10],\\\"香港\\\":[10,5],\\\"澳门\\\":[-10,10],\\\"天津\\\":[5,5]},nh={Russia:[100,60],\\\"United States\\\":[-99,38],\\\"United States of America\\\":[-99,38]},ah=ao.vec3,oh=ao.mat4,sh=[function(e,t){var r,i;\\\"china\\\"===e&&(r=ih[t.name])&&((i=t.getCenter())[0]+=r[0]/10.5,i[1]+=-r[1]/14,t.setCenter(i))},function(e,t){var r;\\\"world\\\"===e&&(r=nh[t.name])&&(r=[r[0],r[1]],t.setCenter(r))}];function lh(e,t,r,i,n){this.name=e,this.map=t,this.regionHeight=0,this.regions=[],this._nameCoordMap={},this.loadGeoJson(r,i,n),this.transform=oh.identity(new Float64Array(16)),this.invTransform=oh.identity(new Float64Array(16)),this.extrudeY=!0,this.altitudeAxis}lh.prototype={constructor:lh,type:\\\"geo3D\\\",dimensions:[\\\"lng\\\",\\\"lat\\\",\\\"alt\\\"],containPoint:function(){},loadGeoJson:function(e,t,r){var i=F.parseGeoJSON||F.parseGeoJson;try{this.regions=e?i(e):[]}catch(e){throw\\\"Invalid geoJson format\\\\n\\\"+e}t=t||{},r=r||{};for(var n=this.regions,a={},o=0;o<n.length;o++){var s=r[s=n[o].name]||s,s=(a[n[o].name=s]=n[o],this.addGeoCoord(s,n[o].getCenter()),t[s]);s&&n[o].transformTo(s.left,s.top,s.width,s.height)}this._regionsMap=a,this._geoRect=null,sh.forEach(function(e){e(this)},this)},getGeoBoundingRect:function(){if(this._geoRect)return this._geoRect;for(var e,t=this.regions,r=0;r<t.length;r++){var i=t[r].getBoundingRect();(e=e||i.clone()).union(i)}return this._geoRect=e||new F.graphic.BoundingRect(0,0,0,0)},addGeoCoord:function(e,t){this._nameCoordMap[e]=t},getRegion:function(e){return this._regionsMap[e]},getRegionByCoord:function(e){for(var t=this.regions,r=0;r<t.length;r++)if(t[r].contain(e))return t[r]},setSize:function(e,t,r){this.size=[e,t,r];var i=this.getGeoBoundingRect(),n=e/i.width,a=-r/i.height,o=-e/2-i.x*n,i=r/2-i.y*a,o=this.extrudeY?[o,0,i]:[o,i,0],i=this.extrudeY?[n,1,a]:[n,a,1],n=this.transform;oh.identity(n),oh.translate(n,n,o),oh.scale(n,n,i),oh.invert(this.invTransform,n)},dataToPoint:function(e,t){t=t||[];var r=this.extrudeY?1:2,i=this.extrudeY?2:1,n=e[2];return isNaN(n)&&(n=0),t[0]=e[0],t[i]=e[1],this.altitudeAxis?t[r]=this.altitudeAxis.dataToCoord(n):t[r]=0,t[r]+=this.regionHeight,ah.transformMat4(t,t,this.transform),t},pointToData:function(e,t){}};const hh=lh;function uh(e,t){var r=rs(e.getBoxLayoutParams(),{width:t.getWidth(),height:t.getHeight()}),r=(r.y=t.getHeight()-r.y-r.height,this.viewGL.setViewport(r.x,r.y,r.width,r.height,t.getDevicePixelRatio()),this.getGeoBoundingRect()),r=r.width/r.height*(e.get(\\\"aspectScale\\\")||.75),i=e.get(\\\"boxWidth\\\"),n=e.get(\\\"boxDepth\\\"),a=e.get(\\\"boxHeight\\\");null==a&&(a=5),isNaN(i)&&isNaN(n)&&(i=100),isNaN(n)?n=i/r:isNaN(i)&&(i=n/r),this.setSize(i,a,n),this.regionHeight=e.get(\\\"regionHeight\\\"),this.altitudeAxis&&this.altitudeAxis.setExtent(0,Math.max(a-this.regionHeight,0))}function ch(e,t){var r,i=[1/0,-1/0];e.eachSeries(function(e){var t,r;e.coordinateSystem===this&&\\\"series.map3D\\\"!==e.type&&(t=e.getData(),r=(r=e.coordDimToDataDim(\\\"alt\\\"))&&r[0])&&(r=t.getDataExtent(r,!0),i[0]=Math.min(i[0],r[0]),i[1]=Math.max(i[1],r[1]))},this),i&&isFinite(i[1]-i[0])&&(r=F.helper.createScale(i,{type:\\\"value\\\",min:\\\"dataMin\\\",max:\\\"dataMax\\\"}),this.altitudeAxis=new F.Axis(\\\"altitude\\\",r),this.resize(this.model,t))}var dh=0,fh={dimensions:hh.prototype.dimensions,create:function(r,i){var n=[];if(F.getMap)return r.eachComponent(\\\"geo3D\\\",function(e,t){a(e)}),r.eachSeriesByType(\\\"map3D\\\",function(e,t){var r=e.get(\\\"coordinateSystem\\\");\\\"geo3D\\\"===(r=null==r?\\\"geo3D\\\":r)&&a(e)}),r.eachSeries(function(e){if(\\\"geo3D\\\"===e.get(\\\"coordinateSystem\\\")&&\\\"series.map3D\\\"!==e.type){var t=e.getReferringComponents(\\\"geo3D\\\").models[0];if(!(t=t||r.getComponent(\\\"geo3D\\\")))throw new Error('geo \\\"'+E(e.get(\\\"geo3DIndex\\\"),e.get(\\\"geo3DId\\\"),0)+'\\\" not found');e.coordinateSystem=t.coordinateSystem}}),n;throw new Error(\\\"geo3D component depends on geo component\\\");function a(e){var t=fh.createGeo3D(e);e.__viewGL=e.__viewGL||new hl,t.viewGL=e.__viewGL,(e.coordinateSystem=t).model=e,n.push(t),t.resize=uh,t.resize(e,i),t.update=ch}},createGeo3D:function(e){var t,r=e.get(\\\"map\\\");return\\\"string\\\"==typeof r?(t=r,r=F.getMap(r)):r&&r.features&&(r={geoJson:r}),null==t&&(t=\\\"GEO_ANONYMOUS_\\\"+dh++),new hh(t+dh++,t,r&&r.geoJson,r&&r.specialAreas,e.get(\\\"nameMap\\\"))}};const ph=fh;function mh(e){e.registerComponentModel(bl),e.registerComponentView(rh),e.registerAction({type:\\\"geo3DChangeCamera\\\",event:\\\"geo3dcamerachanged\\\",update:\\\"series:updateCamera\\\"},function(t,e){e.eachComponent({mainType:\\\"geo3D\\\",query:t},function(e){e.setView(t)})}),e.registerCoordinateSystem(\\\"geo3D\\\",ph)}function gh(e,t){e.id=e.id||e.name||t+\\\"\\\"}(0,F.use)(mh);var _h=F.ComponentModel.extend({type:\\\"globe\\\",layoutMode:\\\"box\\\",coordinateSystem:null,init:function(){_h.superApply(this,\\\"init\\\",arguments),F.util.each(this.option.layers,function(e,t){F.util.merge(e,this.defaultLayerOption),gh(e,t)},this)},mergeOption:function(e){var t=this.option.layers;function r(e){return F.util.reduce(e,function(e,t,r){return gh(t,r),e[t.id]=t,e},{})}if(this.option.layers=null,_h.superApply(this,\\\"mergeOption\\\",arguments),t&&t.length){var i,n=r(e.layers),a=r(t);for(i in n)a[i]?F.util.merge(a[i],n[i],!0):t.push(e.layers[i]);this.option.layers=t}F.util.each(this.option.layers,function(e){F.util.merge(e,this.defaultLayerOption)},this)},optionUpdated:function(){this.updateDisplacementHash()},defaultLayerOption:{show:!0,type:\\\"overlay\\\"},defaultOption:{show:!0,zlevel:-10,left:0,top:0,width:\\\"100%\\\",height:\\\"100%\\\",environment:\\\"auto\\\",baseColor:\\\"#fff\\\",baseTexture:\\\"\\\",heightTexture:\\\"\\\",displacementTexture:\\\"\\\",displacementScale:0,displacementQuality:\\\"medium\\\",globeRadius:100,globeOuterRadius:150,shading:\\\"lambert\\\",light:{main:{time:\\\"\\\"}},atmosphere:{show:!1,offset:5,color:\\\"#ffffff\\\",glowPower:6,innerGlowPower:2},viewControl:{autoRotate:!0,panSensitivity:0,targetCoord:null},layers:[]},setDisplacementData:function(e,t,r){this.displacementData=e,this.displacementWidth=t,this.displacementHeight=r},getDisplacementTexture:function(){return this.get(\\\"displacementTexture\\\")||this.get(\\\"heightTexture\\\")},getDisplacemenScale:function(){var e=this.getDisplacementTexture(),t=this.get(\\\"displacementScale\\\");return t=e&&\\\"none\\\"!==e?t:0},hasDisplacement:function(){return 0<this.getDisplacemenScale()},_displacementChanged:!0,_displacementScale:0,updateDisplacementHash:function(){var e=this.getDisplacementTexture(),t=this.getDisplacemenScale();this._displacementChanged=this._displacementTexture!==e||this._displacementScale!==t,this._displacementTexture=e,this._displacementScale=t},isDisplacementChanged:function(){return this._displacementChanged}});F.util.merge(_h.prototype,s),F.util.merge(_h.prototype,v),F.util.merge(_h.prototype,e),F.util.merge(_h.prototype,V);const vh=_h;var yh=Math.PI,xh=Math.sin,bh=Math.cos,wh=Math.tan,Th=Math.asin,Sh=Math.atan2,Mh=yh/180,Ah=23.4397*Mh;pl={};pl.getPosition=function(e,t,r){var i=Mh*-r,n=Mh*t,a=e.valueOf()/864e5-.5+2440588-2451545,o=(s=(s=Mh*(357.5291+.98560028*(r=a)))+Mh*(1.9148*xh(s)+.02*xh(2*s)+3e-4*xh(3*s))+102.9372*Mh+yh,{dec:(o=s,Th(xh(0)*bh(Ah)+bh(0)*xh(Ah)*xh(o))),ra:(r=0,Sh(xh(t=s)*bh(Ah)-wh(r)*xh(Ah),bh(t)))}),s=Mh*(280.16+360.9856235*a)-i-o.ra;return{azimuth:(e=n,r=o.dec,Sh(xh(t=s),bh(t)*xh(e)-wh(r)*bh(e))),altitude:(t=s,r=o.dec,Th(xh(e=n)*xh(r)+bh(e)*bh(r)*bh(t)))}};const Eh=pl,Ch=(Z.Shader[\\\"import\\\"](Ma),Z.Shader[\\\"import\\\"](\\\"@export ecgl.atmosphere.vertex\\\\nattribute vec3 position: POSITION;\\\\nattribute vec3 normal : NORMAL;\\\\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\\\\nuniform mat4 normalMatrix : WORLDINVERSETRANSPOSE;\\\\n\\\\nvarying vec3 v_Normal;\\\\n\\\\nvoid main() {\\\\n v_Normal = normalize((normalMatrix * vec4(normal, 0.0)).xyz);\\\\n gl_Position = worldViewProjection * vec4(position, 1.0);\\\\n}\\\\n@end\\\\n\\\\n\\\\n@export ecgl.atmosphere.fragment\\\\nuniform mat4 viewTranspose: VIEWTRANSPOSE;\\\\nuniform float glowPower;\\\\nuniform vec3 glowColor;\\\\n\\\\nvarying vec3 v_Normal;\\\\n\\\\nvoid main() {\\\\n float intensity = pow(1.0 - dot(v_Normal, (viewTranspose * vec4(0.0, 0.0, 1.0, 0.0)).xyz), glowPower);\\\\n gl_FragColor = vec4(glowColor, intensity * intensity);\\\\n}\\\\n@end\\\"),F.ComponentView.extend({type:\\\"globe\\\",__ecgl__:!0,_displacementScale:0,init:function(e,t){this.groupGL=new Z.Node,this._sphereGeometry=new Z.SphereGeometry({widthSegments:200,heightSegments:100,dynamic:!0}),this._overlayGeometry=new Z.SphereGeometry({widthSegments:80,heightSegments:40}),this._planeGeometry=new Z.PlaneGeometry,this._earthMesh=new Z.Mesh({renderNormal:!0}),this._atmosphereMesh=new Z.Mesh,this._atmosphereGeometry=new Z.SphereGeometry({widthSegments:80,heightSegments:40}),this._atmosphereMaterial=new Z.Material({shader:new Z.Shader(Z.Shader.source(\\\"ecgl.atmosphere.vertex\\\"),Z.Shader.source(\\\"ecgl.atmosphere.fragment\\\")),transparent:!0}),this._atmosphereMesh.geometry=this._atmosphereGeometry,this._atmosphereMesh.material=this._atmosphereMaterial,this._atmosphereMesh.frontFace=Z.Mesh.CW,this._lightRoot=new Z.Node,this._sceneHelper=new po,this._sceneHelper.initLight(this._lightRoot),this.groupGL.add(this._atmosphereMesh),this.groupGL.add(this._earthMesh),this._control=new io({zr:t.getZr()}),this._control.init(),this._layerMeshes={}},render:function(e,t,r){var i=e.coordinateSystem,n=e.get(\\\"shading\\\"),a=(i.viewGL.add(this._lightRoot),e.get(\\\"show\\\")?i.viewGL.add(this.groupGL):i.viewGL.remove(this.groupGL),this._sceneHelper.setScene(i.viewGL.scene),i.viewGL.setPostEffect(e.getModel(\\\"postEffect\\\"),r),i.viewGL.setTemporalSuperSampling(e.getModel(\\\"temporalSuperSampling\\\")),this._earthMesh),o=(a.geometry=this._sphereGeometry,\\\"ecgl.\\\"+n),o=(a.material&&a.material.shader.name===o||(a.material=Z.createMaterial(o)),Z.setMaterialFromModel(n,a.material,e,r),[\\\"roughnessMap\\\",\\\"metalnessMap\\\",\\\"detailMap\\\",\\\"normalMap\\\"].forEach(function(e){var t=a.material.get(e);t&&(t.flipY=!1)}),a.material.set(\\\"color\\\",Z.parseColor(e.get(\\\"baseColor\\\"))),.99*i.radius),i=(a.scale.set(o,o,o),e.get(\\\"atmosphere.show\\\")?(a.material.define(\\\"both\\\",\\\"ATMOSPHERE_ENABLED\\\"),this._atmosphereMesh.invisible=!1,this._atmosphereMaterial.setUniforms({glowPower:e.get(\\\"atmosphere.glowPower\\\")||6,glowColor:e.get(\\\"atmosphere.color\\\")||\\\"#ffffff\\\"}),a.material.setUniforms({glowPower:e.get(\\\"atmosphere.innerGlowPower\\\")||2,glowColor:e.get(\\\"atmosphere.color\\\")||\\\"#ffffff\\\"}),n=e.get(\\\"atmosphere.offset\\\")||5,this._atmosphereMesh.scale.set(o+n,o+n,o+n)):(a.material.undefine(\\\"both\\\",\\\"ATMOSPHERE_ENABLED\\\"),this._atmosphereMesh.invisible=!0),a.material.setTextureImage(\\\"diffuseMap\\\",e.get(\\\"baseTexture\\\"),r,{flipY:!1,anisotropic:8})),o=(i&&i.surface&&i.surface.attachToMesh(a),a.material.setTextureImage(\\\"bumpMap\\\",e.get(\\\"heightTexture\\\"),r,{flipY:!1,anisotropic:8}));o&&o.surface&&o.surface.attachToMesh(a),a.material[e.get(\\\"postEffect.enable\\\")?\\\"define\\\":\\\"undefine\\\"](\\\"fragment\\\",\\\"SRGB_DECODE\\\"),this._updateLight(e,r),this._displaceVertices(e,r),this._updateViewControl(e,r),this._updateLayers(e,r)},afterRender:function(e,t,r,i){var n=i.renderer;this._sceneHelper.updateAmbientCubemap(n,e,r),this._sceneHelper.updateSkybox(n,e,r)},_updateLayers:function(e,o){var t,s=e.coordinateSystem,r=e.get(\\\"layers\\\"),l=s.radius,h=[],u=[],c=[],d=[],r=(F.util.each(r,function(e){var t,r,i=new F.Model(e),n=i.get(\\\"type\\\"),a=Z.loadTexture(i.get(\\\"texture\\\"),o,{flipY:!1,anisotropic:8});a.surface&&a.surface.attachToMesh(this._earthMesh),\\\"blend\\\"===n?(n=i.get(\\\"blendTo\\\"),r=E(i.get(\\\"intensity\\\"),1),(\\\"emission\\\"===n?(c.push(a),d):(h.push(a),u)).push(r)):(n=i.get(\\\"id\\\"),t=(t=this._layerMeshes[n])||(this._layerMeshes[n]=new Z.Mesh({geometry:this._overlayGeometry,castShadow:!1,ignorePicking:!0})),\\\"lambert\\\"===i.get(\\\"shading\\\")?(t.material=t.__lambertMaterial||new Z.Material({autoUpdateTextureStatus:!1,shader:Z.createShader(\\\"ecgl.lambert\\\"),transparent:!0,depthMask:!1}),t.__lambertMaterial=t.material):(t.material=t.__colorMaterial||new Z.Material({autoUpdateTextureStatus:!1,shader:Z.createShader(\\\"ecgl.color\\\"),transparent:!0,depthMask:!1}),t.__colorMaterial=t.material),t.material.enableTexture(\\\"diffuseMap\\\"),a=i.get(\\\"distance\\\"),r=l+(null==a?s.radius/100:a),t.scale.set(r,r,r),l=r,n=this._blankTexture||(this._blankTexture=Z.createBlankTexture(\\\"rgba(255, 255, 255, 0)\\\")),t.material.set(\\\"diffuseMap\\\",n),Z.loadTexture(i.get(\\\"texture\\\"),o,{flipY:!1,anisotropic:8},function(e){e.surface&&e.surface.attachToMesh(t),t.material.set(\\\"diffuseMap\\\",e),o.getZr().refresh()}),i.get(\\\"show\\\")?this.groupGL.add(t):this.groupGL.remove(t))},this),this._earthMesh.material),i=(r.define(\\\"fragment\\\",\\\"LAYER_DIFFUSEMAP_COUNT\\\",h.length),r.define(\\\"fragment\\\",\\\"LAYER_EMISSIVEMAP_COUNT\\\",c.length),r.set(\\\"layerDiffuseMap\\\",h),r.set(\\\"layerDiffuseIntensity\\\",u),r.set(\\\"layerEmissiveMap\\\",c),r.set(\\\"layerEmissionIntensity\\\",d),e.getModel(\\\"debug.wireframe\\\"));i.get(\\\"show\\\")?(r.define(\\\"both\\\",\\\"WIREFRAME_TRIANGLE\\\"),t=Z.parseColor(i.get(\\\"lineStyle.color\\\")||\\\"rgba(0,0,0,0.5)\\\"),i=E(i.get(\\\"lineStyle.width\\\"),1),r.set(\\\"wireframeLineWidth\\\",i),r.set(\\\"wireframeLineColor\\\",t)):r.undefine(\\\"both\\\",\\\"WIREFRAME_TRIANGLE\\\")},_updateViewControl:function(e,t){var r=e.coordinateSystem,i=e.getModel(\\\"viewControl\\\"),n=(r.viewGL.camera,this),a=this._control;a.setViewGL(r.viewGL);var o,s,l=i.get(\\\"targetCoord\\\");null!=l&&(s=l[0]+90,o=l[1]),a.setFromViewControlModel(i,{baseDistance:r.radius,alpha:o,beta:s}),a.off(\\\"update\\\"),a.on(\\\"update\\\",function(){t.dispatchAction({type:\\\"globeChangeCamera\\\",alpha:a.getAlpha(),beta:a.getBeta(),distance:a.getDistance()-r.radius,center:a.getCenter(),from:n.uid,globeId:e.id})})},_displaceVertices:function(e,t){var r,i,n=e.get(\\\"displacementQuality\\\"),a=e.get(\\\"debug.wireframe.show\\\"),o=e.coordinateSystem;(e.isDisplacementChanged()||n!==this._displacementQuality||a!==this._showDebugWireframe)&&(this._displacementQuality=n,this._showDebugWireframe=a,r=this._sphereGeometry,i=(n={low:100,medium:200,high:400,ultra:800}[n]||200)/2,r.widthSegments===n&&!a||(r.widthSegments=n,r.heightSegments=i,r.build()),this._doDisplaceVertices(r,o),a)&&r.generateBarycentric()},_doDisplaceVertices:function(e,t){var r=e.attributes.position.value,i=e.attributes.texcoord0.value,n=e.__originalPosition;n&&n.length===r.length||((n=new Float32Array(r.length)).set(r),e.__originalPosition=n);for(var a=t.displacementWidth,o=t.displacementHeight,s=t.displacementData,l=0;l<e.vertexCount;l++){var h=3*l,u=2*l,c=n[1+h],d=n[2+h],f=n[3+h],p=i[u++],u=i[+u],p=Math.round(p*(a-1)),u=Math.round(u*(o-1)),u=s?s[u*a+p]:0;r[1+h]=c+c*u,r[2+h]=d+d*u,r[3+h]=f+f*u}e.generateVertexNormals(),e.dirty(),e.updateBoundingBox()},_updateLight:function(e,t){var r=this._earthMesh,i=(this._sceneHelper.updateLight(e),this._sceneHelper.mainLight),n=e.get(\\\"light.main.time\\\")||new Date,n=Eh.getPosition(F.number.parseDate(n),0,0),a=Math.cos(n.altitude);i.position.y=-a*Math.cos(n.azimuth),i.position.x=Math.sin(n.altitude),i.position.z=a*Math.sin(n.azimuth),i.lookAt(r.getWorldPosition())},dispose:function(e,t){this.groupGL.removeAll(),this._control.dispose()}}));var Dh=ao.vec3;function Lh(e){this.radius=e,this.viewGL=null,this.altitudeAxis,this.displacementData=null,this.displacementWidth,this.displacementHeight}Lh.prototype={constructor:Lh,dimensions:[\\\"lng\\\",\\\"lat\\\",\\\"alt\\\"],type:\\\"globe\\\",containPoint:function(){},setDisplacementData:function(e,t,r){this.displacementData=e,this.displacementWidth=t,this.displacementHeight=r},_getDisplacementScale:function(e,t){var r=(e+180)/360*(this.displacementWidth-1),i=(90-t)/180*(this.displacementHeight-1),r=Math.round(r)+Math.round(i)*this.displacementWidth;return this.displacementData[r]},dataToPoint:function(e,t){var r=e[0],i=e[1],n=e[2]||0,a=this.radius,n=(this.displacementData&&(a*=1+this._getDisplacementScale(r,i)),this.altitudeAxis&&(a+=this.altitudeAxis.dataToCoord(n)),r=r*Math.PI/180,i=i*Math.PI/180,Math.cos(i)*a);return(t=t||[])[0]=-n*Math.cos(r+Math.PI),t[1]=Math.sin(i)*a,t[2]=n*Math.sin(r+Math.PI),t},pointToData:function(e,t){var r=e[0],i=e[1],n=e[2],a=Dh.len(e),i=(r/=a,i/=a,n/=a,Math.asin(i)),n=Math.atan2(n,-r),r=(n<0&&(n=2*Math.PI+n),180*i/Math.PI),i=180*n/Math.PI-180;return(t=t||[])[0]=i,t[1]=r,t[2]=a-this.radius,this.altitudeAxis&&(t[2]=this.altitudeAxis.coordToData(t[2])),t}};const Ph=Lh;function Oh(e,t){var r=rs(e.getBoxLayoutParams(),{width:t.getWidth(),height:t.getHeight()}),r=(r.y=t.getHeight()-r.y-r.height,this.viewGL.setViewport(r.x,r.y,r.width,r.height,t.getDevicePixelRatio()),this.radius=e.get(\\\"globeRadius\\\"),e.get(\\\"globeOuterRadius\\\"));this.altitudeAxis&&this.altitudeAxis.setExtent(0,r-this.radius)}function Nh(e,t){var r,i=[1/0,-1/0];e.eachSeries(function(e){var t,r;e.coordinateSystem===this&&(t=e.getData(),r=(r=e.coordDimToDataDim(\\\"alt\\\"))&&r[0])&&(r=t.getDataExtent(r,!0),i[0]=Math.min(i[0],r[0]),i[1]=Math.max(i[1],r[1]))},this),i&&isFinite(i[1]-i[0])&&(r=F.helper.createScale(i,{type:\\\"value\\\",min:\\\"dataMin\\\",max:\\\"dataMax\\\"}),this.altitudeAxis=new F.Axis(\\\"altitude\\\",r),this.resize(this.model,t))}const Ih={dimensions:Ph.prototype.dimensions,create:function(r,o){var i=[];return r.eachComponent(\\\"globe\\\",function(e){e.__viewGL=e.__viewGL||new hl;var t=new Ph;t.viewGL=e.__viewGL,(e.coordinateSystem=t).model=e,i.push(t),t.resize=Oh,t.resize(e,o),t.update=Nh}),r.eachSeries(function(e){if(\\\"globe\\\"===e.get(\\\"coordinateSystem\\\")){var t=e.getReferringComponents(\\\"globe\\\").models[0];if(!(t=t||r.getComponent(\\\"globe\\\")))throw new Error('globe \\\"'+E(e.get(\\\"globe3DIndex\\\"),e.get(\\\"globe3DId\\\"),0)+'\\\" not found');t=t.coordinateSystem;e.coordinateSystem=t}}),r.eachComponent(\\\"globe\\\",function(r,e){var i,t=r.coordinateSystem,n=r.getDisplacementTexture(),a=r.getDisplacemenScale();r.isDisplacementChanged()&&(r.hasDisplacement()?(i=!0,Z.loadTexture(n,o,function(e){var t=function(e,t){var r=document.createElement(\\\"canvas\\\"),i=r.getContext(\\\"2d\\\"),n=e.width,a=e.height;r.width=n,r.height=a,i.drawImage(e,0,0,n,a);for(var o=i.getImageData(0,0,n,a).data,s=new Float32Array(o.length/4),l=0;l<o.length/4;l++){var h=o[4*l];s[l]=h/255*t}return{data:s,width:n,height:a}}(e.image,a);r.setDisplacementData(t.data,t.width,t.height),i||o.dispatchAction({type:\\\"globeUpdateDisplacment\\\"})}),i=!1):t.setDisplacementData(null,0,0),t.setDisplacementData(r.displacementData,r.displacementWidth,r.displacementHeight))}),i}};(0,F.use)(function(e){e.registerComponentModel(vh),e.registerComponentView(Ch),e.registerCoordinateSystem(\\\"globe\\\",Ih),e.registerAction({type:\\\"globeChangeCamera\\\",event:\\\"globecamerachanged\\\",update:\\\"series:updateCamera\\\"},function(t,e){e.eachComponent({mainType:\\\"globe\\\",query:t},function(e){e.setView(t)})}),e.registerAction({type:\\\"globeUpdateDisplacment\\\",event:\\\"globedisplacementupdated\\\",update:\\\"update\\\"},function(e,t){})});var Rh=[\\\"zoom\\\",\\\"center\\\",\\\"pitch\\\",\\\"bearing\\\"],x=F.ComponentModel.extend({type:\\\"mapbox3D\\\",layoutMode:\\\"box\\\",coordinateSystem:null,defaultOption:{zlevel:-10,style:\\\"mapbox://styles/mapbox/light-v9\\\",center:[0,0],zoom:0,pitch:0,bearing:0,light:{main:{alpha:20,beta:30}},altitudeScale:1,boxHeight:\\\"auto\\\"},getMapboxCameraOption:function(){var r=this;return Rh.reduce(function(e,t){return e[t]=r.get(t),e},{})},setMapboxCameraOption:function(t){null!=t&&Rh.forEach(function(e){null!=t[e]&&(this.option[e]=t[e])},this)},getMapbox:function(){return this._mapbox},setMapbox:function(e){this._mapbox=e}});F.util.merge(x.prototype,v),F.util.merge(x.prototype,e);const Bh=x;function Fh(e,t){if(this.id=e,this.zr=t,this.dom=document.createElement(\\\"div\\\"),this.dom.style.cssText=\\\"position:absolute;left:0;right:0;top:0;bottom:0;\\\",!mapboxgl)throw new Error(\\\"Mapbox GL library must be included. See https://www.mapbox.com/mapbox-gl-js/api/\\\");this._mapbox=new mapboxgl.Map({container:this.dom}),this._initEvents()}Fh.prototype.setUnpainted=function(){},Fh.prototype.resize=function(){this._mapbox.resize()},Fh.prototype.getMapbox=function(){return this._mapbox},Fh.prototype.clear=function(){},Fh.prototype.refresh=function(){this._mapbox.resize()};var zh=[\\\"mousedown\\\",\\\"mouseup\\\",\\\"click\\\",\\\"dblclick\\\",\\\"mousemove\\\",\\\"mousewheel\\\",\\\"wheel\\\",\\\"touchstart\\\",\\\"touchend\\\",\\\"touchmove\\\",\\\"touchcancel\\\"];Fh.prototype._initEvents=function(){var n=this._mapbox.getCanvasContainer();this._handlers=this._handlers||{contextmenu:function(e){return e.preventDefault(),!1}},zh.forEach(function(e){this._handlers[e]=function(e){var t,r={};for(t in e)r[t]=e[t];r.bubbles=!1;var i=new e.constructor(e.type,r);n.dispatchEvent(i)},this.zr.dom.addEventListener(e,this._handlers[e])},this),this.zr.dom.addEventListener(\\\"contextmenu\\\",this._handlers.contextmenu)},Fh.prototype.dispose=function(){zh.forEach(function(e){this.zr.dom.removeEventListener(e,this._handlers[e])},this)};const Gh=Fh,Uh=\\\"\\\\n@export ecgl.displayShadow.vertex\\\\n\\\\n@import ecgl.common.transformUniforms\\\\n\\\\n@import ecgl.common.uv.header\\\\n\\\\n@import ecgl.common.attributes\\\\n\\\\nvarying vec3 v_WorldPosition;\\\\n\\\\nvarying vec3 v_Normal;\\\\n\\\\nvoid main()\\\\n{\\\\n @import ecgl.common.uv.main\\\\n v_Normal = normalize((worldInverseTranspose * vec4(normal, 0.0)).xyz);\\\\n\\\\n v_WorldPosition = (world * vec4(position, 1.0)).xyz;\\\\n gl_Position = worldViewProjection * vec4(position, 1.0);\\\\n}\\\\n\\\\n@end\\\\n\\\\n\\\\n@export ecgl.displayShadow.fragment\\\\n\\\\n@import ecgl.common.uv.fragmentHeader\\\\n\\\\nvarying vec3 v_Normal;\\\\nvarying vec3 v_WorldPosition;\\\\n\\\\nuniform float roughness: 0.2;\\\\n\\\\n#ifdef DIRECTIONAL_LIGHT_COUNT\\\\n@import clay.header.directional_light\\\\n#endif\\\\n\\\\n@import ecgl.common.ssaoMap.header\\\\n\\\\n@import clay.plugin.compute_shadow_map\\\\n\\\\nvoid main()\\\\n{\\\\n float shadow = 1.0;\\\\n\\\\n @import ecgl.common.ssaoMap.main\\\\n\\\\n#if defined(DIRECTIONAL_LIGHT_COUNT) && defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\\\\n float shadowContribsDir[DIRECTIONAL_LIGHT_COUNT];\\\\n if(shadowEnabled)\\\\n {\\\\n computeShadowOfDirectionalLights(v_WorldPosition, shadowContribsDir);\\\\n }\\\\n for (int i = 0; i < DIRECTIONAL_LIGHT_COUNT; i++) {\\\\n shadow = min(shadow, shadowContribsDir[i] * 0.5 + 0.5);\\\\n }\\\\n#endif\\\\n\\\\n shadow *= 0.5 + ao * 0.5;\\\\n shadow = clamp(shadow, 0.0, 1.0);\\\\n\\\\n gl_FragColor = vec4(vec3(0.0), 1.0 - shadow);\\\\n}\\\\n\\\\n@end\\\",kh=(Z.Shader[\\\"import\\\"](Uh),F.ComponentView.extend({type:\\\"mapbox3D\\\",__ecgl__:!0,init:function(e,t){var r=t.getZr(),i=(this._zrLayer=new Gh(\\\"mapbox3D\\\",r),r.painter.insertLayer(-1e3,this._zrLayer),this._lightRoot=new Z.Node,this._sceneHelper=new po(this._lightRoot),this._sceneHelper.initLight(this._lightRoot),this._zrLayer.getMapbox()),n=this._dispatchInteractAction.bind(this,t,i);[\\\"zoom\\\",\\\"rotate\\\",\\\"drag\\\",\\\"pitch\\\",\\\"rotate\\\",\\\"move\\\"].forEach(function(e){i.on(e,n)}),this._groundMesh=new Z.Mesh({geometry:new Z.PlaneGeometry,material:new Z.Material({shader:new Z.Shader({vertex:Z.Shader.source(\\\"ecgl.displayShadow.vertex\\\"),fragment:Z.Shader.source(\\\"ecgl.displayShadow.fragment\\\")}),depthMask:!1}),renderOrder:-100,culling:!1,castShadow:!1,$ignorePicking:!0,renderNormal:!0})},render:function(e,t,r){var i=this._zrLayer.getMapbox(),n=e.get(\\\"style\\\"),a=JSON.stringify(n),n=(a!==this._oldStyleStr&&n&&i.setStyle(n),this._oldStyleStr=a,i.setCenter(e.get(\\\"center\\\")),i.setZoom(e.get(\\\"zoom\\\")),i.setPitch(e.get(\\\"pitch\\\")),i.setBearing(e.get(\\\"bearing\\\")),e.setMapbox(i),e.coordinateSystem);n.viewGL.scene.add(this._lightRoot),n.viewGL.add(this._groundMesh),this._updateGroundMesh(),this._sceneHelper.setScene(n.viewGL.scene),this._sceneHelper.updateLight(e),n.viewGL.setPostEffect(e.getModel(\\\"postEffect\\\"),r),n.viewGL.setTemporalSuperSampling(e.getModel(\\\"temporalSuperSampling\\\")),this._mapbox3DModel=e},afterRender:function(e,t,r,i){var n=i.renderer;this._sceneHelper.updateAmbientCubemap(n,e,r),this._sceneHelper.updateSkybox(n,e,r),e.coordinateSystem.viewGL.scene.traverse(function(e){e.material&&(e.material.define(\\\"fragment\\\",\\\"NORMAL_UP_AXIS\\\",2),e.material.define(\\\"fragment\\\",\\\"NORMAL_FRONT_AXIS\\\",1))})},updateCamera:function(e,t,r,i){e.coordinateSystem.setCameraOption(i),this._updateGroundMesh(),r.getZr().refresh()},_dispatchInteractAction:function(e,t,r){e.dispatchAction({type:\\\"mapbox3DChangeCamera\\\",pitch:t.getPitch(),zoom:t.getZoom(),center:t.getCenter().toArray(),bearing:t.getBearing(),mapbox3DId:this._mapbox3DModel&&this._mapbox3DModel.id})},_updateGroundMesh:function(){var e,t,r,i;this._mapbox3DModel&&(r=(e=this._mapbox3DModel.coordinateSystem).dataToPoint(e.center),this._groundMesh.position.set(r[0],r[1],-.001),r=new Z.Plane(new Z.Vector3(0,0,1),0),t=e.viewGL.camera.castRay(new Z.Vector2(-1,-1)),i=e.viewGL.camera.castRay(new Z.Vector2(1,1)),t=t.intersectPlane(r),r=i.intersectPlane(r),i=t.dist(r)/e.viewGL.rootNode.scale.x,this._groundMesh.scale.set(i,i,1))},dispose:function(e,t){this._zrLayer&&this._zrLayer.dispose(),t.getZr().painter.delLayer(-1e3)}}));var Vh=ao.mat4,Hh=.6435011087932844,Wh=Math.PI;function jh(){this.width=0,this.height=0,this.altitudeScale=1,this.boxHeight=\\\"auto\\\",this.altitudeExtent,this.bearing=0,this.pitch=0,this.center=[0,0],this._origin,this.zoom=0,this._initialZoom,this.maxPitch=60,this.zoomOffset=0}jh.prototype={constructor:jh,dimensions:[\\\"lng\\\",\\\"lat\\\",\\\"alt\\\"],containPoint:function(){},setCameraOption:function(e){this.bearing=e.bearing,this.pitch=e.pitch,this.center=e.center,this.zoom=e.zoom,this._origin||(this._origin=this.projectOnTileWithScale(this.center,512)),null==this._initialZoom&&(this._initialZoom=this.zoom),this.updateTransform()},updateTransform:function(){var e,t,r,i;this.height&&(e=.5/Math.tan(Hh/2)*this.height*.1,t=Math.max(Math.min(this.pitch,this.maxPitch),0)/180*Math.PI,r=Hh/2,i=Math.PI/2+t,i=Math.sin(r)*e/Math.sin(Math.PI-i-r),r=1.1*(Math.cos(Math.PI/2-t)*i+e),50<this.pitch&&(r=1e3),Vh.perspective(i=[],Hh,this.width/this.height,1,r),this.viewGL.camera.projectionMatrix.setArray(i),this.viewGL.camera.decomposeProjectionMatrix(),i=Vh.identity([]),r=this.dataToPoint(this.center),Vh.scale(i,i,[1,-1,1]),Vh.translate(i,i,[0,0,-e]),Vh.rotateX(i,i,t),Vh.rotateZ(i,i,-this.bearing/180*Math.PI),Vh.translate(i,i,[-r[0]*this.getScale()*.1,-r[1]*this.getScale()*.1,0]),this.viewGL.camera.viewMatrix.array=i,Vh.invert(e=[],i),this.viewGL.camera.worldTransform.array=e,this.viewGL.camera.decomposeWorldTransform(),t=512*this.getScale(),i=this.altitudeExtent&&!isNaN(this.boxHeight)?(r=this.altitudeExtent[1]-this.altitudeExtent[0],this.boxHeight/r*this.getScale()/Math.pow(2,this._initialZoom-this.zoomOffset)):t/(2*Math.PI*6378e3*Math.abs(Math.cos(this.center[1]*(Math.PI/180))))*this.altitudeScale*.1,this.viewGL.rootNode.scale.set(.1*this.getScale(),.1*this.getScale(),i))},getScale:function(){return Math.pow(2,this.zoom-this.zoomOffset)},projectOnTile:function(e,t){return this.projectOnTileWithScale(e,512*this.getScale(),t)},projectOnTileWithScale:function(e,t,r){var i=e[0],n=e[1]*Wh/180,i=t*(i*Wh/180+Wh)/(2*Wh),n=t*(Wh-Math.log(Math.tan(Wh/4+.5*n)))/(2*Wh);return(r=r||[])[0]=i,r[1]=n,r},unprojectFromTile:function(e,t){return this.unprojectOnTileWithScale(e,512*this.getScale(),t)},unprojectOnTileWithScale:function(e,t,r){var i=e[0],n=e[1],i=i/t*(2*Wh)-Wh,n=2*(Math.atan(Math.exp(Wh-n/t*(2*Wh)))-Wh/4);return(r=r||[])[0]=180*i/Wh,r[1]=180*n/Wh,r},dataToPoint:function(e,t){return(t=this.projectOnTileWithScale(e,512,t))[0]-=this._origin[0],t[1]-=this._origin[1],t[2]=isNaN(e[2])?0:e[2],isNaN(e[2])||(t[2]=e[2],this.altitudeExtent&&(t[2]-=this.altitudeExtent[0])),t}};const Xh=jh;function qh(){Xh.apply(this,arguments)}function Zh(a,o,e){function s(e,t){var r=t.getWidth(),i=t.getHeight(),n=t.getDevicePixelRatio();this.viewGL.setViewport(0,0,r,i,n),this.width=r,this.height=i,this.altitudeScale=e.get(\\\"altitudeScale\\\"),this.boxHeight=e.get(\\\"boxHeight\\\")}function l(e,t){var i;\\\"auto\\\"!==this.model.get(\\\"boxHeight\\\")&&(i=[1/0,-1/0],e.eachSeries(function(e){var t,r;e.coordinateSystem===this&&(t=e.getData(),r=e.coordDimToDataDim(\\\"alt\\\")[0])&&(r=t.getDataExtent(r,!0),i[0]=Math.min(i[0],r[0]),i[1]=Math.max(i[1],r[1]))},this),i)&&isFinite(i[1]-i[0])&&(this.altitudeExtent=i)}return{dimensions:o.prototype.dimensions,create:function(r,i){var n=[];return r.eachComponent(a,function(e){e.__viewGL||(e.__viewGL=new hl).setRootNode(new Z.Node);var t=new o;t.viewGL=e.__viewGL,t.resize=s,t.resize(e,i),n.push(t),(e.coordinateSystem=t).model=e,t.update=l}),r.eachSeries(function(e){if(e.get(\\\"coordinateSystem\\\")===a){var t=e.getReferringComponents(a).models[0];if(!(t=t||r.getComponent(a)))throw new Error(a+' \\\"'+E(e.get(a+\\\"Index\\\"),e.get(a+\\\"Id\\\"),0)+'\\\" not found');e.coordinateSystem=t.coordinateSystem}}),e&&e(n,r,i),n}}}const Yh=Zh(((qh.prototype=new Xh).constructor=qh).prototype.type=\\\"mapbox3D\\\",qh,function(e){e.forEach(function(e){e.setCameraOption(e.model.getMapboxCameraOption())})});(0,F.use)(function(e){e.registerComponentModel(Bh),e.registerComponentView(kh),e.registerCoordinateSystem(\\\"mapbox3D\\\",Yh),e.registerAction({type:\\\"mapbox3DChangeCamera\\\",event:\\\"mapbox3dcamerachanged\\\",update:\\\"mapbox3D:updateCamera\\\"},function(t,e){e.eachComponent({mainType:\\\"mapbox3D\\\",query:t},function(e){e.setMapboxCameraOption(t)})})});var Kh=[\\\"zoom\\\",\\\"center\\\",\\\"pitch\\\",\\\"bearing\\\"],pl=F.ComponentModel.extend({type:\\\"maptalks3D\\\",layoutMode:\\\"box\\\",coordinateSystem:null,defaultOption:{zlevel:-10,urlTemplate:\\\"http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png\\\",attribution:'&copy; <a href=\\\"http://osm.org\\\">OpenStreetMap</a> contributors, &copy; <a href=\\\"https://carto.com/\\\">CARTO</a>',center:[0,0],zoom:0,pitch:0,bearing:0,light:{main:{alpha:20,beta:30}},altitudeScale:1,boxHeight:\\\"auto\\\"},getMaptalksCameraOption:function(){var r=this;return Kh.reduce(function(e,t){return e[t]=r.get(t),e},{})},setMaptalksCameraOption:function(t){null!=t&&Kh.forEach(function(e){null!=t[e]&&(this.option[e]=t[e])},this)},getMaptalks:function(){return this._maptalks},setMaptalks:function(e){this._maptalks=e}});F.util.merge(pl.prototype,v),F.util.merge(pl.prototype,e);const Qh=pl;function Jh(e,t,r,i){if(this.id=e,this.zr=t,this.dom=document.createElement(\\\"div\\\"),this.dom.style.cssText=\\\"position:absolute;left:0;right:0;top:0;bottom:0;\\\",!maptalks)throw new Error(\\\"Maptalks library must be included. See https://maptalks.org\\\");this._maptalks=new maptalks.Map(this.dom,{center:r,zoom:i,doubleClickZoom:!1,fog:!1}),this._initEvents()}Jh.prototype.setUnpainted=function(){},Jh.prototype.resize=function(){this._maptalks.checkSize()},Jh.prototype.getMaptalks=function(){return this._maptalks},Jh.prototype.clear=function(){},Jh.prototype.refresh=function(){this._maptalks.checkSize()};var $h=[\\\"mousedown\\\",\\\"mouseup\\\",\\\"click\\\",\\\"dblclick\\\",\\\"mousemove\\\",\\\"mousewheel\\\",\\\"DOMMouseScroll\\\",\\\"touchstart\\\",\\\"touchend\\\",\\\"touchmove\\\",\\\"touchcancel\\\"];Jh.prototype._initEvents=function(){var a=this.dom;this._handlers=this._handlers||{contextmenu:function(e){return e.preventDefault(),!1}},$h.forEach(function(n){this._handlers[n]=function(e){var t,r={};for(t in e)r[t]=e[t];r.bubbles=!1;var i=new e.constructor(e.type,r);(\\\"mousewheel\\\"===n||\\\"DOMMouseScroll\\\"===n?a:a.firstElementChild).dispatchEvent(i)},this.zr.dom.addEventListener(n,this._handlers[n])},this),this.zr.dom.addEventListener(\\\"contextmenu\\\",this._handlers.contextmenu)},Jh.prototype.dispose=function(){$h.forEach(function(e){this.zr.dom.removeEventListener(e,this._handlers[e])},this),this._maptalks.remove()};const eu=Jh,tu=(Z.Shader[\\\"import\\\"](Uh),F.ComponentView.extend({type:\\\"maptalks3D\\\",__ecgl__:!0,init:function(e,t){this._groundMesh=new Z.Mesh({geometry:new Z.PlaneGeometry,material:new Z.Material({shader:new Z.Shader({vertex:Z.Shader.source(\\\"ecgl.displayShadow.vertex\\\"),fragment:Z.Shader.source(\\\"ecgl.displayShadow.fragment\\\")}),depthMask:!1}),renderOrder:-100,culling:!1,castShadow:!1,$ignorePicking:!0,renderNormal:!0})},_initMaptalksLayer:function(e,t){var r=t.getZr(),i=(this._zrLayer=new eu(\\\"maptalks3D\\\",r,e.get(\\\"center\\\"),e.get(\\\"zoom\\\")),r.painter.insertLayer(-1e3,this._zrLayer),this._lightRoot=new Z.Node,this._sceneHelper=new po(this._lightRoot),this._sceneHelper.initLight(this._lightRoot),this._zrLayer.getMaptalks()),n=this._dispatchInteractAction.bind(this,t,i);[\\\"zoomend\\\",\\\"zooming\\\",\\\"zoomstart\\\",\\\"dragrotating\\\",\\\"pitch\\\",\\\"pitchend\\\",\\\"movestart\\\",\\\"moving\\\",\\\"moveend\\\",\\\"resize\\\",\\\"touchstart\\\",\\\"touchmove\\\",\\\"touchend\\\",\\\"animating\\\"].forEach(function(e){i.on(e,n)})},render:function(e,t,r){this._zrLayer||this._initMaptalksLayer(e,r);var i=this._zrLayer.getMaptalks(),n=e.get(\\\"urlTemplate\\\"),a=i.getBaseLayer(),a=(n!==this._oldUrlTemplate&&(a?a.setOptions({urlTemplate:n,attribution:e.get(\\\"attribution\\\")}):(a=new maptalks.TileLayer(\\\"maptalks-echarts-gl-baselayer\\\",{urlTemplate:n,subdomains:[\\\"a\\\",\\\"b\\\",\\\"c\\\"],attribution:e.get(\\\"attribution\\\")}),i.setBaseLayer(a))),this._oldUrlTemplate=n,i.setCenter(e.get(\\\"center\\\")),i.setZoom(e.get(\\\"zoom\\\"),{animation:!1}),i.setPitch(e.get(\\\"pitch\\\")),i.setBearing(e.get(\\\"bearing\\\")),e.setMaptalks(i),e.coordinateSystem);a.viewGL.scene.add(this._lightRoot),a.viewGL.add(this._groundMesh),this._updateGroundMesh(),this._sceneHelper.setScene(a.viewGL.scene),this._sceneHelper.updateLight(e),a.viewGL.setPostEffect(e.getModel(\\\"postEffect\\\"),r),a.viewGL.setTemporalSuperSampling(e.getModel(\\\"temporalSuperSampling\\\")),this._maptalks3DModel=e},afterRender:function(e,t,r,i){var n=i.renderer;this._sceneHelper.updateAmbientCubemap(n,e,r),this._sceneHelper.updateSkybox(n,e,r),e.coordinateSystem.viewGL.scene.traverse(function(e){e.material&&(e.material.define(\\\"fragment\\\",\\\"NORMAL_UP_AXIS\\\",2),e.material.define(\\\"fragment\\\",\\\"NORMAL_FRONT_AXIS\\\",1))})},updateCamera:function(e,t,r,i){e.coordinateSystem.setCameraOption(i),this._updateGroundMesh(),r.getZr().refresh()},_dispatchInteractAction:function(e,t,r){var i;e.dispatchAction({type:\\\"maptalks3DChangeCamera\\\",pitch:t.getPitch(),zoom:(i=t.getResolution(),19-Math.log(i/ru)/Math.LN2+1),center:t.getCenter().toArray(),bearing:t.getBearing(),maptalks3DId:this._maptalks3DModel&&this._maptalks3DModel.id})},_updateGroundMesh:function(){var e,t,r,i;this._maptalks3DModel&&(r=(e=this._maptalks3DModel.coordinateSystem).dataToPoint(e.center),this._groundMesh.position.set(r[0],r[1],-.001),r=new Z.Plane(new Z.Vector3(0,0,1),0),t=e.viewGL.camera.castRay(new Z.Vector2(-1,-1)),i=e.viewGL.camera.castRay(new Z.Vector2(1,1)),t=t.intersectPlane(r),r=i.intersectPlane(r),i=t.dist(r)/e.viewGL.rootNode.scale.x,this._groundMesh.scale.set(i,i,1))},dispose:function(e,t){this._zrLayer&&this._zrLayer.dispose(),t.getZr().painter.delLayer(-1e3)}})),ru=12756274*Math.PI/(256*Math.pow(2,20));function iu(){Xh.apply(this,arguments),this.maxPitch=85,this.zoomOffset=1}const nu=Zh(((iu.prototype=new Xh).constructor=iu).prototype.type=\\\"maptalks3D\\\",iu,function(e){e.forEach(function(e){e.setCameraOption(e.model.getMaptalksCameraOption())})});(0,F.use)(function(e){e.registerComponentModel(Qh),e.registerComponentView(tu),e.registerCoordinateSystem(\\\"maptalks3D\\\",nu),e.registerAction({type:\\\"maptalks3DChangeCamera\\\",event:\\\"maptalks3dcamerachanged\\\",update:\\\"maptalks3D:updateCamera\\\"},function(t,e){e.eachComponent({mainType:\\\"maptalks3D\\\",query:t},function(e){e.setMaptalksCameraOption(t)})})});var au=ao.vec3,ou=F.helper.dataStack.isDimensionStacked;function su(e,t,r){for(var i=e.getDataExtent(t),n=e.getDataExtent(r),a=i[1]-i[0]||i[0],o=n[1]-n[0]||n[0],s=new Uint8Array(2500),l=0;l<e.count();l++){var h=e.get(t,l),u=e.get(r,l),h=Math.floor((h-i[0])/a*49),u=50*Math.floor((u-n[0])/o*49)+h;s[u]=s[u]||1}for(var c=0,l=0;l<s.length;l++)s[l]&&c++;return c/s.length}var lu=ao.vec3,hu=F.helper.dataStack.isDimensionStacked;function uu(e,t){var r=hu(e,t[2]);return{dimension:r?e.getCalculationInfo(\\\"stackResultDimension\\\"):t[2],isStacked:r}}function cu(e){e.registerLayout(function(e,t){e.eachSeriesByType(\\\"bar3D\\\",function(e){var o,s,l,h,u,t,c,r,d,f,p,m,g,_,i,v,y,x,n,a,b,w,T,S,M,A,E,C,D,L,B,P,O,N,I=e.coordinateSystem,R=I&&I.type;\\\"globe\\\"===R?(E=I,L=(A=e).getData(),B=A.get(\\\"minHeight\\\")||0,P=A.get(\\\"barSize\\\"),O=[\\\"lng\\\",\\\"lat\\\",\\\"alt\\\"].map(function(e){return A.coordDimToDataDim(e)[0]}),null==P?(C=E.radius*Math.PI,D=su(L,O[0],O[1]),P=[C/Math.sqrt(L.count()/D),C/Math.sqrt(L.count()/D)]):F.util.isArray(P)||(P=[P,P]),N=uu(L,O),L.each(O,function(e,t,r,i){var n=L.get(N.dimension,i),a=N.isStacked?n-r:E.altitudeAxis.scale.getExtent()[0],o=Math.max(E.altitudeAxis.dataToCoord(r),B),a=E.dataToPoint([e,t,a]),n=E.dataToPoint([e,t,n]),n=lu.sub([],n,a),o=(lu.normalize(n,n),[P[0],o,P[1]]);L.setItemLayout(i,[a,n,o])}),L.setLayout(\\\"orient\\\",z.UP.array)):\\\"cartesian3D\\\"===R?(v=I,y=(i=e).getData(),null==(x=i.get(\\\"barSize\\\"))?(T=v.size,n=v.getAxis(\\\"x\\\"),a=v.getAxis(\\\"y\\\"),x=[\\\"category\\\"===n.type?.7*n.getBandWidth():.6*Math.round(T[0]/Math.sqrt(y.count())),\\\"category\\\"===a.type?.7*a.getBandWidth():.6*Math.round(T[1]/Math.sqrt(y.count()))]):F.util.isArray(x)||(x=[x,x]),b=v.getAxis(\\\"z\\\").scale.getExtent(),n=b[0],a=b[1],w=!(0<n&&0<a||n<0&&a<0),T=[\\\"x\\\",\\\"y\\\",\\\"z\\\"].map(function(e){return i.coordDimToDataDim(e)[0]}),S=ou(y,T[2]),M=S?y.getCalculationInfo(\\\"stackResultDimension\\\"):T[2],y.each(T,function(e,t,r,i){var n=y.get(M,i),a=S?n-r:w?0:b[0],a=v.dataToPoint([e,t,a]),n=v.dataToPoint([e,t,n]),o=au.dist(a,n),n=[0,n[1]<a[1]?-1:1,0],o=(0===Math.abs(o)&&(o=.1),[x[0],o,x[1]]);y.setItemLayout(i,[a,n,o])}),y.setLayout(\\\"orient\\\",[1,0,0])):\\\"geo3D\\\"===R?(d=I,f=(r=e).getData(),p=r.get(\\\"barSize\\\"),m=r.get(\\\"minHeight\\\")||0,C=[\\\"lng\\\",\\\"lat\\\",\\\"alt\\\"].map(function(e){return r.coordDimToDataDim(e)[0]}),null==p?(D=Math.min(d.size[0],d.size[2]),O=su(f,C[0],C[1]),p=[D/Math.sqrt(f.count()/O),D/Math.sqrt(f.count()/O)]):F.util.isArray(p)||(p=[p,p]),g=[0,1,0],_=uu(f,C),f.each(C,function(e,t,r,i){var n=f.get(_.dimension,i),n=_.isStacked?n-r:d.altitudeAxis.scale.getExtent()[0],a=Math.max(d.altitudeAxis.dataToCoord(r),m),n=d.dataToPoint([e,t,n]),a=[p[0],a,p[1]];f.setItemLayout(i,[n,g,a])}),f.setLayout(\\\"orient\\\",[1,0,0])):\\\"mapbox3D\\\"!==R&&\\\"maptalks3D\\\"!==R||(o=I,s=(e=e).getData(),n=e.coordDimToDataDim(\\\"lng\\\")[0],a=e.coordDimToDataDim(\\\"lat\\\")[0],T=e.coordDimToDataDim(\\\"alt\\\")[0],l=e.get(\\\"barSize\\\"),h=e.get(\\\"minHeight\\\")||0,null==l?(t=s.getDataExtent(n),R=s.getDataExtent(a),I=o.dataToPoint([t[0],R[0]]),t=o.dataToPoint([t[1],R[1]]),R=Math.min(Math.abs(I[0]-t[0]),Math.abs(I[1]-t[1]))||1,I=su(s,n,a),l=[R/Math.sqrt(s.count()/I),R/Math.sqrt(s.count()/I)]):((l=F.util.isArray(l)?l:[l,l])[0]/=o.getScale()/16,l[1]/=o.getScale()/16),u=[0,0,1],c=uu(s,t=[n,a,T]),s.each(t,function(e,t,r,i){var n=s.get(c.dimension,i),a=c.isStacked?n-r:0,a=o.dataToPoint([e,t,a]),n=o.dataToPoint([e,t,n]),n=Math.max(n[2]-a[2],h),n=[l[0],n,l[1]];s.setItemLayout(i,[a,u,n])}),s.setLayout(\\\"orient\\\",[1,0,0]))})})}const du={getFormattedLabel:function(e,t,r,i,n){r=r||\\\"normal\\\";var a=e.getData(i).getItemModel(t),o=e.getDataParams(t,i);null!=n&&o.value instanceof Array&&(o.value=o.value[n]);var s,l=a.get(\\\"normal\\\"===r?[\\\"label\\\",\\\"formatter\\\"]:[\\\"emphasis\\\",\\\"label\\\",\\\"formatter\\\"]);return\\\"function\\\"==typeof(l=null==l?a.get([\\\"label\\\",\\\"formatter\\\"]):l)?(o.status=r,s=l(o)):\\\"string\\\"==typeof l&&(s=F.format.formatTpl(l,o)),s},normalizeToArray:function(e){return e instanceof Array?e:null==e?[]:[e]}};function fu(e,t,n){var r,i,a,o,s=e.getData(),l=e.getRawValue(t),h=F.util.isArray(l)?(r=l,o=[],i=s,a=[],F.util.each(i.dimensions,function(e){var t=i.getDimensionInfo(e),r=t.otherDims.tooltip;null!=r&&!1!==r&&(a[r]=t.name)}),(h=a).length?F.util.each(h,function(e){c(s.get(e,t),e)}):F.util.each(r,c),\\\"<br/>\\\"+o.join(\\\"<br/>\\\")):F.format.encodeHTML(F.format.addCommas(l)),l=s.getName(t),u=Yl(s,t);function c(e,t){var r,i=s.getDimensionInfo(t);i&&!1!==i.otherDims.tooltip&&(r=i.type,i=\\\"- \\\"+(i.tooltipName||i.name)+\\\": \\\"+(\\\"ordinal\\\"===r?e+\\\"\\\":\\\"time\\\"===r?n?\\\"\\\":F.format.formatTime(\\\"yyyy/MM/dd hh:mm:ss\\\",e):F.format.addCommas(e)))&&o.push(F.format.encodeHTML(i))}var u=(u=F.util.isObject(u)&&u.colorStops?(u.colorStops[0]||{}).color:u)||\\\"transparent\\\",u=F.format.getTooltipMarker(u),d=(d=\\\"\\\\0-\\\"===(d=e.name)?\\\"\\\":d)?F.format.encodeHTML(d)+(n?\\\": \\\":\\\"<br/>\\\"):\\\"\\\";return n?u+d+h:d+u+(l?F.format.encodeHTML(l)+\\\": \\\"+h:h)}function pu(r,e,t){t=t||r.getSource();var i=e||F.getCoordinateSystemDimensions(r.get(\\\"coordinateSystem\\\"))||[\\\"x\\\",\\\"y\\\",\\\"z\\\"],n=F.helper.createDimensions(t,{dimensionsDefine:t.dimensionsDefine||r.get(\\\"dimensions\\\"),encodeDefine:t.encodeDefine||r.get(\\\"encode\\\"),coordDimensions:i.map(function(e){var t=r.getReferringComponents(e+\\\"Axis3D\\\").models[0];return{type:t&&\\\"category\\\"===t.get(\\\"type\\\")?\\\"ordinal\\\":\\\"float\\\",name:e}})}),a=(\\\"cartesian3D\\\"===r.get(\\\"coordinateSystem\\\")&&n.forEach(function(e){var t;0<=i.indexOf(e.coordDim)&&(t=r.getReferringComponents(e.coordDim+\\\"Axis3D\\\").models[0])&&\\\"category\\\"===t.get(\\\"type\\\")&&(e.ordinalMeta=t.getOrdinalMeta())}),F.helper.dataStack.enableDataStack(r,n,{byIndex:!0,stackedCoordDimension:\\\"z\\\"})),n=new F.List(n,r);return n.setCalculationInfo(a),n.initData(t),n}x=F.SeriesModel.extend({type:\\\"series.bar3D\\\",dependencies:[\\\"globe\\\"],visualStyleAccessPathvisu:\\\"itemStyle\\\",getInitialData:function(e,t){return pu(this)},getFormattedLabel:function(e,t,r,i){var n=du.getFormattedLabel(this,e,t,r,i);return n=null==n?this.getData().get(\\\"z\\\",e):n},formatTooltip:function(e){return fu(this,e)},defaultOption:{coordinateSystem:\\\"cartesian3D\\\",globeIndex:0,grid3DIndex:0,zlevel:-10,bevelSize:0,bevelSmoothness:2,onGridPlane:\\\"xy\\\",shading:\\\"color\\\",minHeight:0,itemStyle:{opacity:1},label:{show:!1,distance:2,textStyle:{fontSize:14,color:\\\"#000\\\",backgroundColor:\\\"rgba(255,255,255,0.7)\\\",padding:3,borderRadius:3}},emphasis:{label:{show:!0}},animationDurationUpdate:500}});F.util.merge(x.prototype,V);const mu=x;var gu,_u,vu,yu,xu,bu,wu,Tu,Su=ao.vec3,pl=ao.mat3,x=_.extend(function(){return{attributes:{position:new _.Attribute(\\\"position\\\",\\\"float\\\",3,\\\"POSITION\\\"),normal:new _.Attribute(\\\"normal\\\",\\\"float\\\",3,\\\"NORMAL\\\"),color:new _.Attribute(\\\"color\\\",\\\"float\\\",4,\\\"COLOR\\\"),prevPosition:new _.Attribute(\\\"prevPosition\\\",\\\"float\\\",3),prevNormal:new _.Attribute(\\\"prevNormal\\\",\\\"float\\\",3)},dynamic:!0,enableNormal:!1,bevelSize:1,bevelSegments:0,_dataIndices:null,_vertexOffset:0,_triangleOffset:0}},{resetOffset:function(){this._vertexOffset=0,this._triangleOffset=0},setBarCount:function(e){var t=this.enableNormal,r=this.getBarVertexCount()*e,i=this.getBarTriangleCount()*e;this.vertexCount!==r&&(this.attributes.position.init(r),t?this.attributes.normal.init(r):this.attributes.normal.value=null,this.attributes.color.init(r)),this.triangleCount!==i&&(this.indices=new(65535<r?Uint32Array:Uint16Array)(3*i),this._dataIndices=new Uint32Array(r))},getBarVertexCount:function(){var e=0<this.bevelSize?this.bevelSegments:0;return 0<e?this._getBevelBarVertexCount(e):this.enableNormal?24:8},getBarTriangleCount:function(){var e=0<this.bevelSize?this.bevelSegments:0;return 0<e?this._getBevelBarTriangleCount(e):12},_getBevelBarVertexCount:function(e){return 4*(e+1)*(e+1)*2},_getBevelBarTriangleCount:function(e){return(4*e+3+1)*(2*e+1)*2+4},setColor:function(e,t){for(var r=this.getBarVertexCount(),i=r*(e+1),n=r*e;n<i;n++)this.attributes.color.set(n,t);this.dirtyAttribute(\\\"color\\\")},getDataIndexOfVertex:function(e){return this._dataIndices?this._dataIndices[e]:null},addBar:function(){for(var e=Su.create,m=Su.scaleAndAdd,g=e(),_=e(),v=e(),y=e(),x=e(),b=e(),w=e(),T=[],S=[],t=0;t<8;t++)T[t]=e();for(var M=[[0,1,5,4],[2,3,7,6],[4,5,6,7],[3,2,1,0],[0,4,7,3],[1,2,6,5]],A=[0,1,2,0,2,3],E=[],t=0;t<M.length;t++)for(var r=M[t],i=0;i<2;i++){for(var n=[],a=0;a<3;a++)n.push(r[A[3*i+a]]);E.push(n)}return function(e,t,r,i,n,a){var o=this._vertexOffset;if(0<this.bevelSize&&0<this.bevelSegments)this._addBevelBar(e,t,r,i,this.bevelSize,this.bevelSegments,n);else{Su.copy(v,t),Su.normalize(v,v),Su.cross(y,r,v),Su.normalize(y,y),Su.cross(_,v,y),Su.normalize(y,y),Su.negate(x,_),Su.negate(b,v),Su.negate(w,y),m(T[0],e,_,i[0]/2),m(T[0],T[0],y,i[2]/2),m(T[1],e,_,i[0]/2),m(T[1],T[1],w,i[2]/2),m(T[2],e,x,i[0]/2),m(T[2],T[2],w,i[2]/2),m(T[3],e,x,i[0]/2),m(T[3],T[3],y,i[2]/2),m(g,e,v,i[1]),m(T[4],g,_,i[0]/2),m(T[4],T[4],y,i[2]/2),m(T[5],g,_,i[0]/2),m(T[5],T[5],w,i[2]/2),m(T[6],g,x,i[0]/2),m(T[6],T[6],w,i[2]/2),m(T[7],g,x,i[0]/2),m(T[7],T[7],y,i[2]/2);var s=this.attributes;if(this.enableNormal){S[0]=_,S[1]=x,S[2]=v,S[3]=b,S[4]=y,S[5]=w;for(var l=this._vertexOffset,h=0;h<M.length;h++){for(var u=3*this._triangleOffset,c=0;c<6;c++)this.indices[u++]=l+A[c];l+=4,this._triangleOffset+=2}for(h=0;h<M.length;h++)for(var d=S[h],c=0;c<4;c++){var f=M[h][c];s.position.set(this._vertexOffset,T[f]),s.normal.set(this._vertexOffset,d),s.color.set(this._vertexOffset++,n)}}else{for(h=0;h<E.length;h++){for(u=3*this._triangleOffset,c=0;c<3;c++)this.indices[u+c]=E[h][c]+this._vertexOffset;this._triangleOffset++}for(h=0;h<T.length;h++)s.position.set(this._vertexOffset,T[h]),s.color.set(this._vertexOffset++,n)}}for(var p=this._vertexOffset,h=o;h<p;h++)this._dataIndices[h]=a}}(),_addBevelBar:(gu=Su.create(),_u=Su.create(),vu=Su.create(),yu=pl.create(),xu=[],bu=[1,-1,-1,1],wu=[1,1,-1,-1],Tu=[2,0],function(e,t,r,i,n,a,o){Su.copy(_u,t),Su.normalize(_u,_u),Su.cross(vu,r,_u),Su.normalize(vu,vu),Su.cross(gu,_u,vu),Su.normalize(vu,vu),yu[0]=gu[0],yu[1]=gu[1],yu[2]=gu[2],yu[3]=_u[0],yu[4]=_u[1],yu[5]=_u[2],yu[6]=vu[0],yu[7]=vu[1],yu[8]=vu[2],n=Math.min(i[0],i[2])/2*n;for(var s=0;s<3;s++)xu[s]=Math.max(i[s]-2*n,0);for(var l=(i[0]-xu[0])/2,h=(i[1]-xu[1])/2,u=(i[2]-xu[2])/2,c=[],d=[],f=this._vertexOffset,p=[],s=0;s<2;s++){p[s]=p[s]=[];for(var m=0;m<=a;m++)for(var g=0;g<4;g++){(0===m&&0===s||1===s&&m===a)&&p[s].push(f);for(var _=0;_<=a;_++){var v=_/a*Math.PI/2+Math.PI/2*g,y=m/a*Math.PI/2+Math.PI/2*s;d[0]=l*Math.cos(v)*Math.sin(y),d[1]=h*Math.cos(y),d[2]=u*Math.sin(v)*Math.sin(y),c[0]=d[0]+bu[g]*xu[0]/2,c[1]=d[1]+h+Tu[s]*xu[1]/2,c[2]=d[2]+wu[g]*xu[2]/2,Math.abs(l-h)<1e-6&&Math.abs(h-u)<1e-6||(d[0]/=l*l,d[1]/=h*h,d[2]/=u*u),Su.normalize(d,d),Su.transformMat3(c,c,yu),Su.transformMat3(d,d,yu),Su.add(c,c,e),this.attributes.position.set(f,c),this.enableNormal&&this.attributes.normal.set(f,d),this.attributes.color.set(f,o),f++}}}for(var x=4*a+3,b=2*a+1,w=1+x,g=0;g<b;g++)for(s=0;s<=x;s++){var T=g*w+s+this._vertexOffset,S=g*w+(s+1)%w+this._vertexOffset,M=(g+1)*w+(s+1)%w+this._vertexOffset,A=(g+1)*w+s+this._vertexOffset;this.setTriangleIndices(this._triangleOffset++,[M,T,S]),this.setTriangleIndices(this._triangleOffset++,[M,A,T])}this.setTriangleIndices(this._triangleOffset++,[p[0][0],p[0][2],p[0][1]]),this.setTriangleIndices(this._triangleOffset++,[p[0][0],p[0][3],p[0][2]]),this.setTriangleIndices(this._triangleOffset++,[p[1][0],p[1][1],p[1][2]]),this.setTriangleIndices(this._triangleOffset++,[p[1][0],p[1][2],p[1][3]]),this._vertexOffset=f})});F.util.defaults(x.prototype,no),F.util.defaults(x.prototype,Zl);const Mu=x;var Au=ao.vec3;const Eu=F.ChartView.extend({type:\\\"bar3D\\\",__ecgl__:!0,init:function(e,t){this.groupGL=new Z.Node,this._api=t,this._labelsBuilder=new Jl(256,256,t);var o=this;this._labelsBuilder.getLabelPosition=function(e,t,r){var i,n,a;return o._data?(i=(a=o._data.getItemLayout(e))[0],n=a[1],a=a[2][1],Au.scaleAndAdd([],i,n,r+a)):[0,0]},this._labelsBuilder.getMesh().renderOrder=100},render:function(e,t,r){var i=this._prevBarMesh,i=(this._prevBarMesh=this._barMesh,this._barMesh=i,this._barMesh||(this._barMesh=new Z.Mesh({geometry:new Mu,shadowDepthMaterial:new Z.Material({shader:new Z.Shader(Z.Shader.source(\\\"ecgl.sm.depth.vertex\\\"),Z.Shader.source(\\\"ecgl.sm.depth.fragment\\\"))}),culling:\\\"cartesian3D\\\"===e.coordinateSystem.type,renderOrder:10,renderNormal:!0})),this.groupGL.remove(this._prevBarMesh),this.groupGL.add(this._barMesh),this.groupGL.add(this._labelsBuilder.getMesh()),e.coordinateSystem);this._doRender(e,r),i&&i.viewGL&&(i.viewGL.add(this.groupGL),i=i.viewGL.isLinearSpace()?\\\"define\\\":\\\"undefine\\\",this._barMesh.material[i](\\\"fragment\\\",\\\"SRGB_DECODE\\\")),this._data=e.getData(),this._labelsBuilder.updateData(this._data),this._labelsBuilder.updateLabels(),this._updateAnimation(e)},_updateAnimation:function(e){Z.updateVertexAnimation([[\\\"prevPosition\\\",\\\"position\\\"],[\\\"prevNormal\\\",\\\"normal\\\"]],this._prevBarMesh,this._barMesh,e)},_doRender:function(e,t){var a=e.getData(),r=e.get(\\\"shading\\\"),i=\\\"color\\\"!==r,o=this,n=this._barMesh,s=\\\"ecgl.\\\"+r,s=(n.material&&n.material.shader.name===s||(n.material=Z.createMaterial(s,[\\\"VERTEX_COLOR\\\"])),Z.setMaterialFromModel(r,n.material,e,t),n.geometry.enableNormal=i,n.geometry.resetOffset(),e.get(\\\"bevelSize\\\")),r=e.get(\\\"bevelSmoothness\\\"),l=(n.geometry.bevelSegments=r,n.geometry.bevelSize=s,[]),h=new Float32Array(4*a.count()),u=0,c=0,d=!1,f=(a.each(function(e){var t,r;a.hasValue(e)&&(t=Yl(a,e),null==(r=Kl(a,e))&&(r=1),Z.parseColor(t,l),l[3]*=r,h[u++]=l[0],h[u++]=l[1],h[u++]=l[2],h[u++]=l[3],0<l[3])&&(c++,l[3]<.99)&&(d=!0)}),n.geometry.setBarCount(c),a.getLayout(\\\"orient\\\")),p=this._barIndexOfData=new Int32Array(a.count()),c=0,i=(a.each(function(e){var t,r,i,n;a.hasValue(e)?(t=(i=a.getItemLayout(e))[0],r=i[1],i=i[2],n=4*e,l[0]=h[n++],l[1]=h[n++],l[2]=h[n++],l[3]=h[n++],0<l[3]&&(o._barMesh.geometry.addBar(t,r,f,i,l,e),p[e]=c++)):p[e]=-1}),n.geometry.dirty(),n.geometry.updateBoundingBox(),n.material);i.transparent=d,i.depthMask=!d,n.geometry.sortTriangles=d,this._initHandler(e,t)},_initHandler:function(e,r){var i=e.getData(),n=this._barMesh,a=\\\"cartesian3D\\\"===e.coordinateSystem.type,o=(n.seriesIndex=e.seriesIndex,-1);n.off(\\\"mousemove\\\"),n.off(\\\"mouseout\\\"),n.on(\\\"mousemove\\\",function(e){var t=n.geometry.getDataIndexOfVertex(e.triangle[0]);t!==o&&(this._downplay(o),this._highlight(t),this._labelsBuilder.updateLabels([t]),a)&&r.dispatchAction({type:\\\"grid3DShowAxisPointer\\\",value:[i.get(\\\"x\\\",t),i.get(\\\"y\\\",t),i.get(\\\"z\\\",t,!0)]}),o=t,n.dataIndex=t},this),n.on(\\\"mouseout\\\",function(e){this._downplay(o),this._labelsBuilder.updateLabels(),o=-1,n.dataIndex=-1,a&&r.dispatchAction({type:\\\"grid3DHideAxisPointer\\\"})},this)},_highlight:function(e){var t,r,i,n,a=this._data;!a||(t=this._barIndexOfData[e])<0||(i=(r=a.getItemModel(e).getModel(\\\"emphasis.itemStyle\\\")).get(\\\"color\\\"),r=r.get(\\\"opacity\\\"),null==i&&(n=Yl(a,e),i=F.color.lift(n,-.4)),null==r&&(r=Kl(a,e)),(n=Z.parseColor(i))[3]*=r,this._barMesh.geometry.setColor(t,n),this._api.getZr().refresh())},_downplay:function(e){var t,r,i=this._data;!i||(t=this._barIndexOfData[e])<0||(r=Yl(i,e),i=Kl(i,e),(r=Z.parseColor(r))[3]*=i,this._barMesh.geometry.setColor(t,r),this._api.getZr().refresh())},highlight:function(e,t,r,i){this._toggleStatus(\\\"highlight\\\",e,t,r,i)},downplay:function(e,t,r,i){this._toggleStatus(\\\"downplay\\\",e,t,r,i)},_toggleStatus:function(t,e,r,i,n){var a=e.getData(),o=vn(a,n),s=this;null!=o?F.util.each(du.normalizeToArray(o),function(e){\\\"highlight\\\"===t?this._highlight(e):this._downplay(e)},this):a.each(function(e){\\\"highlight\\\"===t?s._highlight(e):s._downplay(e)})},remove:function(){this.groupGL.removeAll()},dispose:function(){this._labelsBuilder.dispose(),this.groupGL.removeAll()}}),Cu=((0,F.use)(function(e){e.registerChartView(Eu),e.registerSeriesModel(mu),cu(e),e.registerProcessor(function(e,t){e.eachSeriesByType(\\\"bar3d\\\",function(e){var t=e.getData();t.filterSelf(function(e){return t.hasValue(e)})})})}),F.SeriesModel.extend({type:\\\"series.line3D\\\",dependencies:[\\\"grid3D\\\"],visualStyleAccessPath:\\\"lineStyle\\\",visualDrawType:\\\"stroke\\\",getInitialData:function(e,t){return pu(this)},formatTooltip:function(e){return fu(this,e)},defaultOption:{coordinateSystem:\\\"cartesian3D\\\",zlevel:-10,grid3DIndex:0,lineStyle:{width:2},animationDurationUpdate:500}}));var Du=ao.vec3;Z.Shader[\\\"import\\\"](No);const Lu=F.ChartView.extend({type:\\\"line3D\\\",__ecgl__:!0,init:function(e,t){this.groupGL=new Z.Node,this._api=t},render:function(e,t,r){var i,n=this._prevLine3DMesh,n=(this._prevLine3DMesh=this._line3DMesh,this._line3DMesh=n,this._line3DMesh||(this._line3DMesh=new Z.Mesh({geometry:new lo({useNativeLine:!1,sortTriangles:!0}),material:new Z.Material({shader:Z.createShader(\\\"ecgl.meshLines3D\\\")}),renderOrder:10}),this._line3DMesh.geometry.pick=this._pick.bind(this)),this.groupGL.remove(this._prevLine3DMesh),this.groupGL.add(this._line3DMesh),e.coordinateSystem);n&&n.viewGL&&(n.viewGL.add(this.groupGL),i=n.viewGL.isLinearSpace()?\\\"define\\\":\\\"undefine\\\",this._line3DMesh.material[i](\\\"fragment\\\",\\\"SRGB_DECODE\\\")),this._doRender(e,r),this._data=e.getData(),this._camera=n.viewGL.camera,this.updateCamera(),this._updateAnimation(e)},updateCamera:function(){this._updateNDCPosition()},_doRender:function(e,t){var i=e.getData(),r=this._line3DMesh,n=(r.geometry.resetOffset(),i.getLayout(\\\"points\\\")),a=[],o=new Float32Array(n.length/3*4),s=0,l=!1,h=(i.each(function(e){var t=Yl(i,e),r=Kl(i,e);null==r&&(r=1),Z.parseColor(t,a),a[3]*=r,o[s++]=a[0],o[s++]=a[1],o[s++]=a[2],o[s++]=a[3],a[3]<.99&&(l=!0)}),r.geometry.setVertexCount(r.geometry.getPolylineVertexCount(n)),r.geometry.setTriangleCount(r.geometry.getPolylineTriangleCount(n)),r.geometry.addPolyline(n,o,E(e.get(\\\"lineStyle.width\\\"),1)),r.geometry.dirty(),r.geometry.updateBoundingBox(),r.material),h=(h.transparent=l,h.depthMask=!l,e.getModel(\\\"debug.wireframe\\\"));h.get(\\\"show\\\")?(r.geometry.createAttribute(\\\"barycentric\\\",\\\"float\\\",3),r.geometry.generateBarycentric(),r.material.set(\\\"both\\\",\\\"WIREFRAME_TRIANGLE\\\"),r.material.set(\\\"wireframeLineColor\\\",Z.parseColor(h.get(\\\"lineStyle.color\\\")||\\\"rgba(0,0,0,0.5)\\\")),r.material.set(\\\"wireframeLineWidth\\\",E(h.get(\\\"lineStyle.width\\\"),1))):r.material.set(\\\"both\\\",\\\"WIREFRAME_TRIANGLE\\\"),this._points=n,this._initHandler(e,t)},_updateAnimation:function(e){Z.updateVertexAnimation([[\\\"prevPosition\\\",\\\"position\\\"],[\\\"prevPositionPrev\\\",\\\"positionPrev\\\"],[\\\"prevPositionNext\\\",\\\"positionNext\\\"]],this._prevLine3DMesh,this._line3DMesh,e)},_initHandler:function(e,r){var i=e.getData(),n=e.coordinateSystem,a=this._line3DMesh,o=-1;a.seriesIndex=e.seriesIndex,a.off(\\\"mousemove\\\"),a.off(\\\"mouseout\\\"),a.on(\\\"mousemove\\\",function(e){var t=n.pointToData(e.point.array),t=i.indicesOfNearest(\\\"x\\\",t[0])[0];t!==o&&(r.dispatchAction({type:\\\"grid3DShowAxisPointer\\\",value:[i.get(\\\"x\\\",t),i.get(\\\"y\\\",t),i.get(\\\"z\\\",t)]}),a.dataIndex=t),o=t},this),a.on(\\\"mouseout\\\",function(e){o=-1,a.dataIndex=-1,r.dispatchAction({type:\\\"grid3DHideAxisPointer\\\"})},this)},_updateNDCPosition:function(){var e=new M,t=this._camera,r=(M.multiply(e,t.projectionMatrix,t.viewMatrix),this._positionNDC),i=this._points,n=i.length/3;r&&r.length/2==n||(r=this._positionNDC=new Float32Array(2*n));for(var a=[],o=0;o<n;o++){var s=3*o,l=2*o;a[0]=i[s],a[1]=i[1+s],a[2]=i[2+s],a[3]=1,Du.transformMat4(a,a,e.array),r[l]=a[0]/a[3],r[1+l]=a[1]/a[3]}},_pick:function(e,t,r,i,n,a){var o=this._positionNDC,s=this._data.hostModel.get(\\\"lineStyle.width\\\"),l=-1,h=.5*r.viewport.width,u=.5*r.viewport.height;e=(e+1)*h,t=(t+1)*u;for(var c,d=1;d<o.length/2;d++){var f=(o[2*(d-1)]+1)*h,p=(o[2*(d-1)+1]+1)*u,m=(o[2*d]+1)*h,g=(o[2*d+1]+1)*u;!function(e,t,r,i,n,a,o){var s,l,h;if(0!==n)return!(t+(l=n)<o&&i+l<o||o<t-l&&o<i-l||e+l<a&&r+l<a||a<e-l&&a<r-l)&&(e===r?Math.abs(a-e)<=l/2:(h=(s=(t-i)/(e-r))*a-o+(e*i-r*t)/(e-r))*h/(s*s+1)<=l/2*l/2)}(f,p,m,g,s,e,t)||(l=(f-e)*(f-e)+(p-t)*(p-t)<(m-e)*(m-e)+(g-t)*(g-t)?d-1:d)}0<=l&&(c=3*l,c=new z(this._points[c],this._points[1+c],this._points[2+c]),a.push({dataIndex:l,point:c,pointWorld:c.clone(),target:this._line3DMesh,distance:this._camera.getWorldPosition().dist(c)}))},remove:function(){this.groupGL.removeAll()},dispose:function(){this.groupGL.removeAll()}}),Pu=((0,F.use)(function(e){e.registerChartView(Lu),e.registerSeriesModel(Cu),e.registerLayout(function(e,t){e.eachSeriesByType(\\\"line3D\\\",function(t){var n,a,o,e,r=t.getData(),s=t.coordinateSystem;s&&\\\"cartesian3D\\\"===s.type&&(n=new Float32Array(3*r.count()),a=[],o=[],e=s.dimensions.map(function(e){return t.coordDimToDataDim(e)[0]}),s&&r.each(e,function(e,t,r,i){a[0]=e,a[1]=t,a[2]=r,s.dataToPoint(a,o),n[3*i]=o[0],n[3*i+1]=o[1],n[3*i+2]=o[2]}),r.setLayout(\\\"points\\\",n))})})}),F.SeriesModel.extend({type:\\\"series.scatter3D\\\",dependencies:[\\\"globe\\\",\\\"grid3D\\\",\\\"geo3D\\\"],visualStyleAccessPath:\\\"itemStyle\\\",hasSymbolVisual:!0,getInitialData:function(e,t){return pu(this)},getFormattedLabel:function(e,t,r,i){var n,a,o=du.getFormattedLabel(this,e,t,r,i);return null==o&&(a=(n=this.getData()).dimensions[n.dimensions.length-1],o=n.get(a,e)),o},formatTooltip:function(e){return fu(this,e)},defaultOption:{coordinateSystem:\\\"cartesian3D\\\",zlevel:-10,progressive:1e5,progressiveThreshold:1e5,grid3DIndex:0,globeIndex:0,symbol:\\\"circle\\\",symbolSize:10,blendMode:\\\"source-over\\\",label:{show:!1,position:\\\"right\\\",distance:5,textStyle:{fontSize:14,color:\\\"#000\\\",backgroundColor:\\\"rgba(255,255,255,0.7)\\\",padding:3,borderRadius:3}},itemStyle:{opacity:.8},emphasis:{label:{show:!0}},animationDurationUpdate:500}}));function Ou(e,t,r){(t=t||document.createElement(\\\"canvas\\\")).width=e,t.height=e;var i=t.getContext(\\\"2d\\\");return r&&r(i),t}var Nu={getMarginByStyle:function(e){var t=e.minMargin||0,r=0,i=(e.stroke&&\\\"none\\\"!==e.stroke&&(r=null==e.lineWidth?1:e.lineWidth),e.shadowBlur||0),n=e.shadowOffsetX||0,a=e.shadowOffsetY||0,o={};return o.left=Math.max(r/2,-n+i,t),o.right=Math.max(r/2,n+i,t),o.top=Math.max(r/2,-a+i,t),o.bottom=Math.max(r/2,a+i,t),o},createSymbolSprite:function(e,t,r,i){e=e,t=t,n=r,F.util.isArray(t)||(t=[t,t]),a=Nu.getMarginByStyle(n,void 0),o=t[0]+a.left+a.right,u=t[1]+a.top+a.bottom,s=F.helper.createSymbol(e,0,0,t[0],t[1]),l=Math.max(o,u),s.x=a.left,s.y=a.top,u<o?s.y+=(l-u)/2:s.x+=(l-o)/2,a=s.getBoundingRect(),s.x-=a.x,s.y-=a.y,s.setStyle(n),s.update(),s.__size=l;var n,a,o,s,l,h=s,u=Nu.getMarginByStyle(r);return{image:Ou(h.__size,i,function(e){F.innerDrawElementOnCanvas(e,h)}),margin:u}},createSDFFromCanvas:function(r,e,i,t){return Ou(e,t,function(e){var t=r.getContext(\\\"2d\\\").getImageData(0,0,r.width,r.height);e.putImageData(function(e,h,u){var c=h.width,d=h.height,t=e.canvas.width,r=e.canvas.height,f=c/t,p=d/r;function m(e){return e<128?1:-1}for(var i=e.createImageData(t,r),n=0;n<r;n++)for(var a=0;a<t;a++){var o=function(e,t){var r=1/0;e=Math.floor(e*f);for(var i=(t=Math.floor(t*p))*c+e,n=m(h.data[4*i]),a=Math.max(t-u,0);a<Math.min(t+u,d);a++)for(var o=Math.max(e-u,0);o<Math.min(e+u,c);o++){var s=o-e,l=a-t;n!==m(h.data[4*(a*c+o)])&&(s=s*s+l*l)<r&&(r=s)}return n*Math.sqrt(r)}(a,n)/u*.5+.5,s=4*(n*t+a);i.data[s++]=255*(1-o),i.data[s++]=255*(1-o),i.data[s++]=255*(1-o),i.data[+s]=255}return i}(e,t,i),0,0)})},createSimpleSprite:function(r,e){return Ou(r,e,function(e){var t=r/2,t=(e.beginPath(),e.arc(t,t,60,0,2*Math.PI,!1),e.closePath(),e.createRadialGradient(t,t,0,t,t,t));t.addColorStop(0,\\\"rgba(255, 255, 255, 1)\\\"),t.addColorStop(.5,\\\"rgba(255, 255, 255, 0.5)\\\"),t.addColorStop(1,\\\"rgba(255, 255, 255, 0)\\\"),e.fillStyle=t,e.fill()})}};const Iu=Nu;var Ru=ao.vec3;const Bu={needsSortVertices:function(){return this.sortVertices},needsSortVerticesProgressively:function(){return this.needsSortVertices()&&2e4<=this.vertexCount},doSortVertices:function(e,t){var r=this.indices,i=Ru.create();if(!r)for(var r=this.indices=new(65535<this.vertexCount?Uint32Array:Uint16Array)(this.vertexCount),n=0;n<r.length;n++)r[n]=n;if(0===t){var a,o=this.attributes.position,s=(e=e.array,0);for(this._zList&&this._zList.length===this.vertexCount||(this._zList=new Float32Array(this.vertexCount)),n=0;n<this.vertexCount;n++){o.get(n,i);var l=Ru.sqrDist(i,e);isNaN(l)&&(l=1e7,s++),0===n?(a=l,l=0):l-=a,this._zList[n]=l}this._noneCount=s}if(this.vertexCount<2e4)0===t&&this._simpleSort(.05<this._noneCount/this.vertexCount);else for(n=0;n<3;n++)this._progressiveQuickSort(3*t+n);this.dirtyIndices()},_simpleSort:function(e){var r=this._zList,t=this.indices;function i(e,t){return r[t]-r[e]}e?Array.prototype.sort.call(t,i):Hl.sort(t,i,0,t.length-1)},_progressiveQuickSort:function(e){var r=this._zList,t=this.indices;this._quickSort=this._quickSort||new Hl,this._quickSort.step(t,function(e,t){return r[t]-r[e]},e)}};var Fu=ao.vec4;Z.Shader[\\\"import\\\"](\\\"@export ecgl.sdfSprite.vertex\\\\n\\\\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\\\\nuniform float elapsedTime : 0;\\\\n\\\\nattribute vec3 position : POSITION;\\\\n\\\\n#ifdef VERTEX_SIZE\\\\nattribute float size;\\\\n#else\\\\nuniform float u_Size;\\\\n#endif\\\\n\\\\n#ifdef VERTEX_COLOR\\\\nattribute vec4 a_FillColor: COLOR;\\\\nvarying vec4 v_Color;\\\\n#endif\\\\n\\\\n#ifdef VERTEX_ANIMATION\\\\nattribute vec3 prevPosition;\\\\nattribute float prevSize;\\\\nuniform float percent : 1.0;\\\\n#endif\\\\n\\\\n\\\\n#ifdef POSITIONTEXTURE_ENABLED\\\\nuniform sampler2D positionTexture;\\\\n#endif\\\\n\\\\nvarying float v_Size;\\\\n\\\\nvoid main()\\\\n{\\\\n\\\\n#ifdef POSITIONTEXTURE_ENABLED\\\\n gl_Position = worldViewProjection * vec4(texture2D(positionTexture, position.xy).xy, -10.0, 1.0);\\\\n#else\\\\n\\\\n #ifdef VERTEX_ANIMATION\\\\n vec3 pos = mix(prevPosition, position, percent);\\\\n #else\\\\n vec3 pos = position;\\\\n #endif\\\\n gl_Position = worldViewProjection * vec4(pos, 1.0);\\\\n#endif\\\\n\\\\n#ifdef VERTEX_SIZE\\\\n#ifdef VERTEX_ANIMATION\\\\n v_Size = mix(prevSize, size, percent);\\\\n#else\\\\n v_Size = size;\\\\n#endif\\\\n#else\\\\n v_Size = u_Size;\\\\n#endif\\\\n\\\\n#ifdef VERTEX_COLOR\\\\n v_Color = a_FillColor;\\\\n #endif\\\\n\\\\n gl_PointSize = v_Size;\\\\n}\\\\n\\\\n@end\\\\n\\\\n@export ecgl.sdfSprite.fragment\\\\n\\\\nuniform vec4 color: [1, 1, 1, 1];\\\\nuniform vec4 strokeColor: [1, 1, 1, 1];\\\\nuniform float smoothing: 0.07;\\\\n\\\\nuniform float lineWidth: 0.0;\\\\n\\\\n#ifdef VERTEX_COLOR\\\\nvarying vec4 v_Color;\\\\n#endif\\\\n\\\\nvarying float v_Size;\\\\n\\\\nuniform sampler2D sprite;\\\\n\\\\n@import clay.util.srgb\\\\n\\\\nvoid main()\\\\n{\\\\n gl_FragColor = color;\\\\n\\\\n vec4 _strokeColor = strokeColor;\\\\n\\\\n#ifdef VERTEX_COLOR\\\\n gl_FragColor *= v_Color;\\\\n #endif\\\\n\\\\n#ifdef SPRITE_ENABLED\\\\n float d = texture2D(sprite, gl_PointCoord).r;\\\\n gl_FragColor.a *= smoothstep(0.5 - smoothing, 0.5 + smoothing, d);\\\\n\\\\n if (lineWidth > 0.0) {\\\\n float sLineWidth = lineWidth / 2.0;\\\\n\\\\n float outlineMaxValue0 = 0.5 + sLineWidth;\\\\n float outlineMaxValue1 = 0.5 + sLineWidth + smoothing;\\\\n float outlineMinValue0 = 0.5 - sLineWidth - smoothing;\\\\n float outlineMinValue1 = 0.5 - sLineWidth;\\\\n\\\\n if (d <= outlineMaxValue1 && d >= outlineMinValue0) {\\\\n float a = _strokeColor.a;\\\\n if (d <= outlineMinValue1) {\\\\n a = a * smoothstep(outlineMinValue0, outlineMinValue1, d);\\\\n }\\\\n else {\\\\n a = a * smoothstep(outlineMaxValue1, outlineMaxValue0, d);\\\\n }\\\\n gl_FragColor.rgb = mix(gl_FragColor.rgb * gl_FragColor.a, _strokeColor.rgb, a);\\\\n gl_FragColor.a = gl_FragColor.a * (1.0 - a) + a;\\\\n }\\\\n }\\\\n#endif\\\\n\\\\n#ifdef SRGB_DECODE\\\\n gl_FragColor = sRGBToLinear(gl_FragColor);\\\\n#endif\\\\n}\\\\n@end\\\");const zu=Z.Mesh.extend(function(){var e=new Z.Geometry({dynamic:!0,attributes:{color:new Z.Geometry.Attribute(\\\"color\\\",\\\"float\\\",4,\\\"COLOR\\\"),position:new Z.Geometry.Attribute(\\\"position\\\",\\\"float\\\",3,\\\"POSITION\\\"),size:new Z.Geometry.Attribute(\\\"size\\\",\\\"float\\\",1),prevPosition:new Z.Geometry.Attribute(\\\"prevPosition\\\",\\\"float\\\",3),prevSize:new Z.Geometry.Attribute(\\\"prevSize\\\",\\\"float\\\",1)}}),t=(Object.assign(e,Bu),new Z.Material({shader:Z.createShader(\\\"ecgl.sdfSprite\\\"),transparent:!0,depthMask:!1})),r=(t.enableTexture(\\\"sprite\\\"),t.define(\\\"both\\\",\\\"VERTEX_COLOR\\\"),t.define(\\\"both\\\",\\\"VERTEX_SIZE\\\"),new Z.Texture2D({image:document.createElement(\\\"canvas\\\"),flipY:!1}));return t.set(\\\"sprite\\\",r),e.pick=this._pick.bind(this),{geometry:e,material:t,mode:Z.Mesh.POINTS,sizeScale:1}},{_pick:function(e,t,r,i,n,a){var o=this._positionNDC;if(o)for(var s=r.viewport,l=2/s.width,h=2/s.height,u=this.geometry.vertexCount-1;0<=u;u--){var c,d=o[2*(c=this.geometry.indices?this.geometry.indices[u]:u)],f=o[2*c+1],p=this.geometry.attributes.size.get(c)/this.sizeScale/2;d-p*l<e&&e<d+p*l&&f-p*h<t&&t<f+p*h&&(d=new Z.Vector3,f=new Z.Vector3,this.geometry.attributes.position.get(c,d.array),Z.Vector3.transformMat4(f,d,this.worldTransform),a.push({vertexIndex:c,point:d,pointWorld:f,target:this,distance:f.distance(i.getWorldPosition())}))}},updateNDCPosition:function(e,t,r){var i=this._positionNDC,n=this.geometry;i&&i.length/2===n.vertexCount||(i=this._positionNDC=new Float32Array(2*n.vertexCount));for(var a=Fu.create(),o=0;o<n.vertexCount;o++)n.attributes.position.get(o,a),a[3]=1,Fu.transformMat4(a,a,e.array),Fu.scale(a,a,1/a[3]),i[2*o]=a[0],i[2*o+1]=a[1]}});function Gu(e,t){this.rootNode=new Z.Node,this.is2D=e,this._labelsBuilder=new Jl(256,256,t),this._labelsBuilder.getMesh().renderOrder=100,this.rootNode.add(this._labelsBuilder.getMesh()),this._api=t,this._spriteImageCanvas=document.createElement(\\\"canvas\\\"),this._startDataIndex=0,this._endDataIndex=0,this._sizeScale=1}Gu.prototype={constructor:Gu,highlightOnMouseover:!0,update:function(e,t,r,i,n){var a,o,s,l=this._prevMesh,h=(this._prevMesh=this._mesh,this._mesh=l,e.getData()),l=(null==i&&(i=0),null==n&&(n=h.count()),this._startDataIndex=i,this._endDataIndex=n-1,this._mesh||(a=this._prevMesh&&this._prevMesh.material,this._mesh=new zu({renderOrder:10,frustumCulling:!1}),a&&(this._mesh.material=a)),a=this._mesh.material,this._mesh.geometry),u=l.attributes,c=(this.rootNode.remove(this._prevMesh),this.rootNode.add(this._mesh),this._setPositionTextureToMesh(this._mesh,this._positionTexture),this._getSymbolInfo(e,i,n)),d=r.getDevicePixelRatio(),f=e.getModel(\\\"itemStyle\\\").getItemStyle(),p=e.get(\\\"large\\\"),m=1,g=(2<c.maxSize?(m=this._updateSymbolSprite(e,f,c,d),a.enableTexture(\\\"sprite\\\")):a.disableTexture(\\\"sprite\\\"),u.position.init(n-i),[]);p?(a.undefine(\\\"VERTEX_SIZE\\\"),a.undefine(\\\"VERTEX_COLOR\\\"),o=function(e){var t=e.getVisual(\\\"style\\\");if(t)return t[e.getVisual(\\\"drawType\\\")]}(h),s=h.getVisual(\\\"style\\\").opacity,Z.parseColor(o,g),g[3]*=s,a.set({color:g,u_Size:c.maxSize*this._sizeScale})):(a.set({color:[1,1,1,1]}),a.define(\\\"VERTEX_SIZE\\\"),a.define(\\\"VERTEX_COLOR\\\"),u.size.init(n-i),u.color.init(n-i),this._originalOpacity=new Float32Array(n-i));for(var _=h.getLayout(\\\"points\\\"),v=u.position.value,y=0;y<n-i;y++){var x=3*y,b=2*y;this.is2D?(v[x]=_[b],v[1+x]=_[1+b],v[2+x]=-10):(v[x]=_[x],v[1+x]=_[1+x],v[2+x]=_[2+x]),p||(o=Yl(h,y),s=Kl(h,y),Z.parseColor(o,g),g[3]*=s,u.color.set(y,g),g[3],b=(b=h.getItemVisual(y,\\\"symbolSize\\\"))instanceof Array?Math.max(b[0],b[1]):b,isNaN(b)&&(b=0),u.size.value[y]=b*m*this._sizeScale,this._originalOpacity[y]=g[3])}this._mesh.sizeScale=m,l.updateBoundingBox(),l.dirty(),this._updateMaterial(e,f);d=e.coordinateSystem;d&&d.viewGL&&a[d.viewGL.isLinearSpace()?\\\"define\\\":\\\"undefine\\\"](\\\"fragment\\\",\\\"SRGB_DECODE\\\"),p||this._updateLabelBuilder(e,i,n),this._updateHandler(e,t,r),this._updateAnimation(e),this._api=r},getPointsMesh:function(){return this._mesh},updateLabels:function(e){this._labelsBuilder.updateLabels(e)},hideLabels:function(){this.rootNode.remove(this._labelsBuilder.getMesh())},showLabels:function(){this.rootNode.add(this._labelsBuilder.getMesh())},dispose:function(){this._labelsBuilder.dispose()},_updateSymbolSprite:function(e,t,r,i){r.maxSize=Math.min(2*r.maxSize,200);var n,a,o=[];return 1<r.aspect?(o[0]=r.maxSize,o[1]=r.maxSize/r.aspect):(o[1]=r.maxSize,o[0]=r.maxSize*r.aspect),o[0]=o[0]||1,o[1]=o[1]||1,this._symbolType===r.type&&(a=o,n=this._symbolSize)&&a&&n[0]===a[0]&&n[1]===a[1]&&this._lineWidth===t.lineWidth||(Iu.createSymbolSprite(r.type,o,{fill:\\\"#fff\\\",lineWidth:t.lineWidth,stroke:\\\"transparent\\\",shadowColor:\\\"transparent\\\",minMargin:Math.min(o[0]/2,10)},this._spriteImageCanvas),Iu.createSDFFromCanvas(this._spriteImageCanvas,Math.min(this._spriteImageCanvas.width,32),20,this._mesh.material.get(\\\"sprite\\\").image),this._symbolType=r.type,this._symbolSize=o,this._lineWidth=t.lineWidth),this._spriteImageCanvas.width/r.maxSize*i},_updateMaterial:function(e,t){var r=\\\"lighter\\\"===e.get(\\\"blendMode\\\")?Z.additiveBlend:null,i=this._mesh.material,r=(i.blend=r,i.set(\\\"lineWidth\\\",t.lineWidth/20),Z.parseColor(t.stroke));i.set(\\\"strokeColor\\\",r),i.transparent=!0,i.depthMask=!1,i.depthTest=!this.is2D,i.sortVertices=!this.is2D},_updateLabelBuilder:function(e,n,t){var r=e.getData(),i=this._mesh.geometry,a=i.attributes.position.value,o=(n=this._startDataIndex,this._mesh.sizeScale);this._labelsBuilder.updateData(r,n,t),this._labelsBuilder.getLabelPosition=function(e,t,r){var i=3*(e-n);return[a[i],a[1+i],a[2+i]]},this._labelsBuilder.getLabelDistance=function(e,t,r){return i.attributes.size.get(e-n)/o/2+r},this._labelsBuilder.updateLabels()},_updateAnimation:function(e){Z.updateVertexAnimation([[\\\"prevPosition\\\",\\\"position\\\"],[\\\"prevSize\\\",\\\"size\\\"]],this._prevMesh,this._mesh,e)},_updateHandler:function(r,e,i){var n,a=r.getData(),o=this._mesh,s=this,l=-1,h=r.coordinateSystem&&\\\"cartesian3D\\\"===r.coordinateSystem.type;h&&(n=r.coordinateSystem.model),o.seriesIndex=r.seriesIndex,o.off(\\\"mousemove\\\"),o.off(\\\"mouseout\\\"),o.on(\\\"mousemove\\\",function(e){var t=e.vertexIndex+s._startDataIndex;t!==l&&(this.highlightOnMouseover&&(this.downplay(a,l),this.highlight(a,t),this._labelsBuilder.updateLabels([t])),h)&&i.dispatchAction({type:\\\"grid3DShowAxisPointer\\\",value:[a.get(r.coordDimToDataDim(\\\"x\\\")[0],t),a.get(r.coordDimToDataDim(\\\"y\\\")[0],t),a.get(r.coordDimToDataDim(\\\"z\\\")[0],t)],grid3DIndex:n.componentIndex}),o.dataIndex=t,l=t},this),o.on(\\\"mouseout\\\",function(e){var t=e.vertexIndex+s._startDataIndex;this.highlightOnMouseover&&(this.downplay(a,t),this._labelsBuilder.updateLabels()),l=-1,o.dataIndex=-1,h&&i.dispatchAction({type:\\\"grid3DHideAxisPointer\\\",grid3DIndex:n.componentIndex})},this)},updateLayout:function(e,t,r){var i=e.getData();if(this._mesh){var n=this._mesh.geometry.attributes.position.value,a=i.getLayout(\\\"points\\\");if(this.is2D)for(var o=0;o<a.length/2;o++){var s=3*o,l=2*o;n[s]=a[l],n[1+s]=a[1+l],n[2+s]=-10}else for(o=0;o<a.length;o++)n[o]=a[o];this._mesh.geometry.dirty(),r.getZr().refresh()}},updateView:function(e){var t;this._mesh&&(t=new M,M.mul(t,e.viewMatrix,this._mesh.worldTransform),M.mul(t,e.projectionMatrix,t),this._mesh.updateNDCPosition(t,this.is2D,this._api))},highlight:function(e,t){var r,i,n;t>this._endDataIndex||t<this._startDataIndex||(i=(r=e.getItemModel(t).getModel(\\\"emphasis.itemStyle\\\")).get(\\\"color\\\"),r=r.get(\\\"opacity\\\"),null==i&&(n=Yl(e,t),i=F.color.lift(n,-.4)),null==r&&(r=Kl(e,t)),(n=Z.parseColor(i))[3]*=r,this._mesh.geometry.attributes.color.set(t-this._startDataIndex,n),this._mesh.geometry.dirtyAttribute(\\\"color\\\"),this._api.getZr().refresh())},downplay:function(e,t){var r,i;t>this._endDataIndex||t<this._startDataIndex||(i=Yl(e,t),r=Kl(e,t),(i=Z.parseColor(i))[3]*=r,this._mesh.geometry.attributes.color.set(t-this._startDataIndex,i),this._mesh.geometry.dirtyAttribute(\\\"color\\\"),this._api.getZr().refresh())},fadeOutAll:function(e){if(this._originalOpacity){for(var t=this._mesh.geometry,r=0;r<t.vertexCount;r++){var i=this._originalOpacity[r]*e;t.attributes.color.value[4*r+3]=i}t.dirtyAttribute(\\\"color\\\"),this._api.getZr().refresh()}},fadeInAll:function(){this.fadeOutAll(1)},setPositionTexture:function(e){this._mesh&&this._setPositionTextureToMesh(this._mesh,e),this._positionTexture=e},removePositionTexture:function(){this._positionTexture=null,this._mesh&&this._setPositionTextureToMesh(this._mesh,null)},setSizeScale:function(e){if(e!==this._sizeScale){if(this._mesh){var t=this._mesh.material.get(\\\"u_Size\\\"),r=(this._mesh.material.set(\\\"u_Size\\\",t/this._sizeScale*e),this._mesh.geometry.attributes);if(r.size.value)for(var i=0;i<r.size.value.length;i++)r.size.value[i]=r.size.value[i]/this._sizeScale*e}this._sizeScale=e}},_setPositionTextureToMesh:function(e,t){t&&e.material.set(\\\"positionTexture\\\",t),e.material[t?\\\"enableTexture\\\":\\\"disableTexture\\\"](\\\"positionTexture\\\")},_getSymbolInfo:function(e,t,r){if(e.get(\\\"large\\\"))return i=(h=E(e.get(\\\"symbolSize\\\"),1))instanceof Array?(o=Math.max(h[0],h[1]),h[0]/h[1]):(o=h,1),{maxSize:h,type:e.get(\\\"symbol\\\"),aspect:i};for(var i,n=e.getData(),a=n.getItemVisual(0,\\\"symbol\\\")||\\\"circle\\\",o=0,s=t;s<r;s++){var l,h=n.getItemVisual(s,\\\"symbolSize\\\"),u=n.getItemVisual(s,\\\"symbol\\\");if(h instanceof Array)l=h[0]/h[1],o=Math.max(Math.max(h[0],h[1]),o);else{if(isNaN(h))continue;l=1,o=Math.max(h,o)}a=u,i=l}return{maxSize:o,type:a,aspect:i}}};const Uu=Gu,ku=F.ChartView.extend({type:\\\"scatter3D\\\",hasSymbolVisual:!0,__ecgl__:!0,init:function(e,t){this.groupGL=new Z.Node,this._pointsBuilderList=[],this._currentStep=0},render:function(e,t,r){var i,n;this.groupGL.removeAll(),e.getData().count()&&(i=e.coordinateSystem)&&i.viewGL&&(i.viewGL.add(this.groupGL),this._camera=i.viewGL.camera,n=(n=this._pointsBuilderList[0])||(this._pointsBuilderList[0]=new Uu(!1,r)),this._pointsBuilderList.length=1,this.groupGL.add(n.rootNode),n.update(e,t,r),n.updateView(i.viewGL.camera))},incrementalPrepareRender:function(e,t,r){var i=e.coordinateSystem;i&&i.viewGL&&(i.viewGL.add(this.groupGL),this._camera=i.viewGL.camera),this.groupGL.removeAll(),this._currentStep=0},incrementalRender:function(e,t,r,i){var n;e.end<=e.start||((n=this._pointsBuilderList[this._currentStep])||(n=new Uu(!1,i),this._pointsBuilderList[this._currentStep]=n),this.groupGL.add(n.rootNode),n.update(t,r,i,e.start,e.end),n.updateView(t.coordinateSystem.viewGL.camera),this._currentStep++)},updateCamera:function(){this._pointsBuilderList.forEach(function(e){e.updateView(this._camera)},this)},highlight:function(e,t,r,i){this._toggleStatus(\\\"highlight\\\",e,t,r,i)},downplay:function(e,t,r,i){this._toggleStatus(\\\"downplay\\\",e,t,r,i)},_toggleStatus:function(e,t,r,i,n){var a=t.getData(),o=vn(a,n),s=\\\"highlight\\\"===e;null!=o?F.util.each(du.normalizeToArray(o),function(e){for(var t=0;t<this._pointsBuilderList.length;t++){var r=this._pointsBuilderList[t];s?r.highlight(a,e):r.downplay(a,e)}},this):a.each(function(e){for(var t=0;t<this._pointsBuilderList.length;t++){var r=this._pointsBuilderList[t];s?r.highlight(a,e):r.downplay(a,e)}})},dispose:function(){this._pointsBuilderList.forEach(function(e){e.dispose()}),this.groupGL.removeAll()},remove:function(){this.groupGL.removeAll()}});(0,F.use)(function(e){e.registerChartView(ku),e.registerSeriesModel(Pu),e.registerLayout({seriesType:\\\"scatter3D\\\",reset:function(t){var a=t.coordinateSystem;if(a){var o,s,l,e=a.dimensions;if(!(e.length<3))return o=e.map(function(e){return t.coordDimToDataDim(e)[0]}),s=[],l=[],{progress:function(e,t){for(var r=new Float32Array(3*(e.end-e.start)),i=e.start;i<e.end;i++){var n=3*(i-e.start);s[0]=t.get(o[0],i),s[1]=t.get(o[1],i),s[2]=t.get(o[2],i),a.dataToPoint(s,l),r[n]=l[0],r[1+n]=l[1],r[2+n]=l[2]}t.setLayout(\\\"points\\\",r)}}}}})});var Vu=ao.vec3,Hu=ao.vec2,Wu=Vu.normalize,ju=Vu.cross,Xu=Vu.sub,qu=Vu.add,Zu=Vu.create,Yu=Zu(),Ku=Zu(),Qu=Zu(),Ju=Zu(),$u=[],ec=[];function tc(e,t){Hu.copy($u,e[0]),Hu.copy(ec,e[1]);var r=[],i=r[0]=Zu(),n=r[1]=Zu(),a=r[2]=Zu(),o=r[3]=Zu(),s=(t.dataToPoint($u,i),t.dataToPoint(ec,o),Wu(Yu,i),Xu(Ku,o,i),Wu(Ku,Ku),ju(Qu,Ku,Yu),Wu(Qu,Qu),ju(Ku,Yu,Qu),qu(n,Yu,Ku),Wu(n,n),Wu(Yu,o),Xu(Ku,i,o),Wu(Ku,Ku),ju(Qu,Ku,Yu),Wu(Qu,Qu),ju(Ku,Yu,Qu),qu(a,Yu,Ku),Wu(a,a),qu(Ju,i,o),Wu(Ju,Ju),Vu.dot(i,Ju)),l=Vu.dot(Ju,n),s=(Math.max(Vu.len(i),Vu.len(o))-s)/l*2;return Vu.scaleAndAdd(n,i,n,s),Vu.scaleAndAdd(a,o,a,s),r}function rc(e,t){for(var r=new Float32Array(3*e.length),i=0,n=[],a=0;a<e.length;a++)t.dataToPoint(e[a],n),r[i++]=n[0],r[i++]=n[1],r[i++]=n[2];return r}function ic(r){var i=[];return r.each(function(e){var t=r.getItemModel(e),t=t.option instanceof Array?t.option:t.getShallow(\\\"coords\\\",!0);i.push(t)}),{coordsList:i}}function nc(e,u,c){var d=e.getData(),f=e.get(\\\"polyline\\\"),p=ic(d);d.setLayout(\\\"lineType\\\",f?\\\"polyline\\\":\\\"cubicBezier\\\"),d.each(function(e){var t,r,i,n,a,o,s,l=p.coordsList[e],h=f?rc(l,u):(t=l,r=u,i=c,h=(l=[])[0]=Vu.create(),n=l[1]=Vu.create(),a=l[2]=Vu.create(),o=l[3]=Vu.create(),r.dataToPoint(t[0],h),r.dataToPoint(t[1],o),s=Vu.dist(h,o),Vu.lerp(n,h,o,.3),Vu.lerp(a,h,o,.3),Vu.scaleAndAdd(n,n,i,Math.min(.1*s,10)),Vu.scaleAndAdd(a,a,i,Math.min(.1*s,10)),l);d.setItemLayout(e,h)})}function ac(e,t){e.eachSeriesByType(\\\"lines3D\\\",function(e){var t,i,n,a,o,r=e.coordinateSystem;\\\"globe\\\"===r.type?(i=r,n=(t=e).getData(),a=t.get(\\\"polyline\\\"),n.setLayout(\\\"lineType\\\",a?\\\"polyline\\\":\\\"cubicBezier\\\"),o=ic(n),n.each(function(e){var t=o.coordsList[e],r=a?rc:tc;n.setItemLayout(e,r(t,i))})):\\\"geo3D\\\"===r.type?nc(e,r,[0,1,0]):\\\"mapbox3D\\\"!==r.type&&\\\"maptalks3D\\\"!==r.type||nc(e,r,[0,0,1])})}const oc=F.SeriesModel.extend({type:\\\"series.lines3D\\\",dependencies:[\\\"globe\\\"],visualStyleAccessPath:\\\"lineStyle\\\",visualDrawType:\\\"stroke\\\",getInitialData:function(e,t){var a=new F.List([\\\"value\\\"],this);return a.hasItemOption=!1,a.initData(e.data,[],function(e,t,r,i){if(e instanceof Array)return NaN;a.hasItemOption=!0;var n=e.value;return null!=n?n instanceof Array?n[i]:n:void 0}),a},defaultOption:{coordinateSystem:\\\"globe\\\",globeIndex:0,geo3DIndex:0,zlevel:-10,polyline:!1,effect:{show:!1,period:4,trailWidth:4,trailLength:.2,spotIntensity:6},silent:!0,blendMode:\\\"source-over\\\",lineStyle:{width:1,opacity:.5}}});var sc=ao.vec3;Z.Shader[\\\"import\\\"](\\\"@export ecgl.trail2.vertex\\\\nattribute vec3 position: POSITION;\\\\nattribute vec3 positionPrev;\\\\nattribute vec3 positionNext;\\\\nattribute float offset;\\\\nattribute float dist;\\\\nattribute float distAll;\\\\nattribute float start;\\\\n\\\\nattribute vec4 a_Color : COLOR;\\\\n\\\\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\\\\nuniform vec4 viewport : VIEWPORT;\\\\nuniform float near : NEAR;\\\\n\\\\nuniform float speed : 0;\\\\nuniform float trailLength: 0.3;\\\\nuniform float time;\\\\nuniform float period: 1000;\\\\n\\\\nuniform float spotSize: 1;\\\\n\\\\nvarying vec4 v_Color;\\\\nvarying float v_Percent;\\\\nvarying float v_SpotPercent;\\\\n\\\\n@import ecgl.common.wireframe.vertexHeader\\\\n\\\\n@import ecgl.lines3D.clipNear\\\\n\\\\nvoid main()\\\\n{\\\\n @import ecgl.lines3D.expandLine\\\\n\\\\n gl_Position = currProj;\\\\n\\\\n v_Color = a_Color;\\\\n\\\\n @import ecgl.common.wireframe.vertexMain\\\\n\\\\n#ifdef CONSTANT_SPEED\\\\n float t = mod((speed * time + start) / distAll, 1. + trailLength) - trailLength;\\\\n#else\\\\n float t = mod((time + start) / period, 1. + trailLength) - trailLength;\\\\n#endif\\\\n\\\\n float trailLen = distAll * trailLength;\\\\n\\\\n v_Percent = (dist - t * distAll) / trailLen;\\\\n\\\\n v_SpotPercent = spotSize / distAll;\\\\n\\\\n }\\\\n@end\\\\n\\\\n\\\\n@export ecgl.trail2.fragment\\\\n\\\\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\\\\nuniform float spotIntensity: 5;\\\\n\\\\nvarying vec4 v_Color;\\\\nvarying float v_Percent;\\\\nvarying float v_SpotPercent;\\\\n\\\\n@import ecgl.common.wireframe.fragmentHeader\\\\n\\\\n@import clay.util.srgb\\\\n\\\\nvoid main()\\\\n{\\\\n if (v_Percent > 1.0 || v_Percent < 0.0) {\\\\n discard;\\\\n }\\\\n\\\\n float fade = v_Percent;\\\\n\\\\n#ifdef SRGB_DECODE\\\\n gl_FragColor = sRGBToLinear(color * v_Color);\\\\n#else\\\\n gl_FragColor = color * v_Color;\\\\n#endif\\\\n\\\\n @import ecgl.common.wireframe.fragmentMain\\\\n\\\\n if (v_Percent > (1.0 - v_SpotPercent)) {\\\\n gl_FragColor.rgb *= spotIntensity;\\\\n }\\\\n\\\\n gl_FragColor.a *= fade;\\\\n}\\\\n\\\\n@end\\\");const lc=Z.Mesh.extend(function(){var e=new Z.Material({shader:new Z.Shader(Z.Shader.source(\\\"ecgl.trail2.vertex\\\"),Z.Shader.source(\\\"ecgl.trail2.fragment\\\")),transparent:!0,depthMask:!1}),t=new lo({dynamic:!0});return t.createAttribute(\\\"dist\\\",\\\"float\\\",1),t.createAttribute(\\\"distAll\\\",\\\"float\\\",1),t.createAttribute(\\\"start\\\",\\\"float\\\",1),{geometry:t,material:e,culling:!1,$ignorePicking:!0}},{updateData:function(u,e,c){var t=u.hostModel,d=this.geometry,r=t.getModel(\\\"effect\\\"),f=r.get(\\\"trailWidth\\\")*e.getDevicePixelRatio(),i=r.get(\\\"trailLength\\\"),n=t.get(\\\"effect.constantSpeed\\\"),p=1e3*t.get(\\\"effect.period\\\"),m=null!=n,g=(m?this.material.set(\\\"speed\\\",n/1e3):this.material.set(\\\"period\\\",p),this.material[m?\\\"define\\\":\\\"undefine\\\"](\\\"vertex\\\",\\\"CONSTANT_SPEED\\\"),t.get(\\\"polyline\\\")),_=(d.trailLength=i,this.material.set(\\\"trailLength\\\",i),d.resetOffset(),[\\\"position\\\",\\\"positionPrev\\\",\\\"positionNext\\\"].forEach(function(e){d.attributes[e].value=c.attributes[e].value}),[\\\"dist\\\",\\\"distAll\\\",\\\"start\\\",\\\"offset\\\",\\\"color\\\"].forEach(function(e){d.attributes[e].init(d.vertexCount)}),d.indices=c.indices,[]),v=r.get(\\\"trailColor\\\"),y=r.get(\\\"trailOpacity\\\"),x=null!=v,b=null!=y,w=(this.updateWorldTransform(),this.worldTransform.x.len()),T=this.worldTransform.y.len(),S=this.worldTransform.z.len(),M=0,A=0;u.each(function(e){var t=u.getItemLayout(e),r=b?y:Kl(u,e),i=Yl(u,e);null==r&&(r=1),(_=Z.parseColor(x?v:i,_))[3]*=r;for(var n=g?c.getPolylineVertexCount(t):c.getCubicCurveVertexCount(t[0],t[1],t[2],t[3]),a=0,o=[],s=[],l=M;l<M+n;l++)d.attributes.position.get(l,o),o[0]*=w,o[1]*=T,o[2]*=S,M<l&&(a+=sc.dist(o,s)),d.attributes.dist.set(l,a),sc.copy(s,o);A=Math.max(A,a);for(var h=Math.random()*(m?a:p),l=M;l<M+n;l++)d.attributes.distAll.set(l,a),d.attributes.start.set(l,h),d.attributes.offset.set(l,(0<c.attributes.offset.get(l)?1:-1)*f/2),d.attributes.color.set(l,_);M+=n}),this.material.set(\\\"spotSize\\\",.1*A*i),this.material.set(\\\"spotIntensity\\\",r.get(\\\"spotIntensity\\\")),d.dirty()},setAnimationTime:function(e){this.material.set(\\\"time\\\",e)}}),hc=(Z.Shader[\\\"import\\\"](No),F.ChartView.extend({type:\\\"lines3D\\\",__ecgl__:!0,init:function(e,t){this.groupGL=new Z.Node,this._meshLinesMaterial=new Z.Material({shader:Z.createShader(\\\"ecgl.meshLines3D\\\"),transparent:!0,depthMask:!1}),this._linesMesh=new Z.Mesh({geometry:new lo,material:this._meshLinesMaterial,$ignorePicking:!0}),this._trailMesh=new lc},render:function(e,t,r){this.groupGL.add(this._linesMesh);var i=e.coordinateSystem,n=e.getData(),a=(i&&i.viewGL&&(i.viewGL.add(this.groupGL),this._updateLines(e,t,r),i=i.viewGL.isLinearSpace()?\\\"define\\\":\\\"undefine\\\",this._linesMesh.material[i](\\\"fragment\\\",\\\"SRGB_DECODE\\\"),this._trailMesh.material[i](\\\"fragment\\\",\\\"SRGB_DECODE\\\")),this._trailMesh);a.stopAnimation(),e.get(\\\"effect.show\\\")?(this.groupGL.add(a),a.updateData(n,r,this._linesMesh.geometry),a.__time=a.__time||0,this._curveEffectsAnimator=a.animate(\\\"\\\",{loop:!0}).when(36e5,{__time:36e5}).during(function(){a.setAnimationTime(a.__time)}).start()):(this.groupGL.remove(a),this._curveEffectsAnimator=null),this._linesMesh.material.blend=this._trailMesh.material.blend=\\\"lighter\\\"===e.get(\\\"blendMode\\\")?Z.additiveBlend:null},pauseEffect:function(){this._curveEffectsAnimator&&this._curveEffectsAnimator.pause()},resumeEffect:function(){this._curveEffectsAnimator&&this._curveEffectsAnimator.resume()},toggleEffect:function(){var e=this._curveEffectsAnimator;e&&(e.isPaused()?e.resume():e.pause())},_updateLines:function(e,t,r){var a=e.getData(),i=e.coordinateSystem,o=this._linesMesh.geometry,s=e.get(\\\"polyline\\\"),i=(o.expandLine=!0,null!=i.radius?i.radius:null!=i.size?Math.max(i.size[0],i.size[1],i.size[2]):100),n=(o.segmentScale=i/20,\\\"lineStyle.width\\\".split(\\\".\\\")),l=r.getDevicePixelRatio(),h=0,u=(a.each(function(e){var t=a.getItemModel(e).get(n);a.setItemVisual(e,\\\"lineWidth\\\",t=null==t?1:t),h=Math.max(t,h)}),o.useNativeLine=!1,0),c=0,d=(a.each(function(e){var t=a.getItemLayout(e);s?(u+=o.getPolylineVertexCount(t),c+=o.getPolylineTriangleCount(t)):(u+=o.getCubicCurveVertexCount(t[0],t[1],t[2],t[3]),c+=o.getCubicCurveTriangleCount(t[0],t[1],t[2],t[3]))}),o.setVertexCount(u),o.setTriangleCount(c),o.resetOffset(),[]);a.each(function(e){var t=a.getItemLayout(e),r=Yl(a,e),i=Kl(a,e),n=a.getItemVisual(e,\\\"lineWidth\\\")*l;null==i&&(i=1),(d=Z.parseColor(r,d))[3]*=i,s?o.addPolyline(t,d,n):o.addCubicCurve(t[0],t[1],t[2],t[3],d,n)}),o.dirty()},remove:function(){this.groupGL.removeAll()},dispose:function(){this.groupGL.removeAll()}}));function uc(e,t){for(var r=[],i=0;i<t.length;i++)r.push(e.dataToPoint(t[i]));return r}(0,F.use)(function(e){e.registerChartView(hc),e.registerSeriesModel(oc),e.registerLayout(ac),e.registerAction({type:\\\"lines3DPauseEffect\\\",event:\\\"lines3deffectpaused\\\",update:\\\"series.lines3D:pauseEffect\\\"},function(){}),e.registerAction({type:\\\"lines3DResumeEffect\\\",event:\\\"lines3deffectresumed\\\",update:\\\"series.lines3D:resumeEffect\\\"},function(){}),e.registerAction({type:\\\"lines3DToggleEffect\\\",event:\\\"lines3deffectchanged\\\",update:\\\"series.lines3D:toggleEffect\\\"},function(){})});pl=F.SeriesModel.extend({type:\\\"series.polygons3D\\\",getRegionModel:function(e){return this.getData().getItemModel(e)},getRegionPolygonCoords:function(e){var t=this.coordinateSystem,r=this.getData().getItemModel(e),i=r.option instanceof Array?r.option:r.getShallow(\\\"coords\\\");r.get(\\\"multiPolygon\\\")||(i=[i]);for(var n=[],a=0;a<i.length;a++){for(var o=[],s=1;s<i[a].length;s++)o.push(uc(t,i[a][s]));n.push({exterior:uc(t,i[a][0]),interiors:o})}return n},getInitialData:function(e){var a=new F.List([\\\"value\\\"],this);return a.hasItemOption=!1,a.initData(e.data,[],function(e,t,r,i){if(e instanceof Array)return NaN;a.hasItemOption=!0;var n=e.value;return null!=n?n instanceof Array?n[i]:n:void 0}),a},defaultOption:{show:!0,data:null,multiPolygon:!1,progressiveThreshold:1e3,progressive:1e3,zlevel:-10,label:{show:!1,distance:2,textStyle:{fontSize:20,color:\\\"#000\\\",backgroundColor:\\\"rgba(255,255,255,0.7)\\\",padding:3,borderRadius:4}},itemStyle:{color:\\\"#fff\\\",borderWidth:0,borderColor:\\\"#333\\\"},emphasis:{itemStyle:{color:\\\"#639fc0\\\"},label:{show:!0}}}});F.util.merge(pl.prototype,V);const cc=pl,dc=F.ChartView.extend({type:\\\"polygons3D\\\",__ecgl__:!0,init:function(e,t){this.groupGL=new Z.Node,this._geo3DBuilderList=[],this._currentStep=0},render:function(e,t,r){this.groupGL.removeAll();var i=e.coordinateSystem,n=(i&&i.viewGL&&i.viewGL.add(this.groupGL),this._geo3DBuilderList[0]);n||((n=new th(r)).extrudeY=\\\"mapbox3D\\\"!==i.type&&\\\"maptalks3D\\\"!==i.type,this._geo3DBuilderList[0]=n),this._updateShaderDefines(i,n),n.update(e,t,r),this._geo3DBuilderList.length=1,this.groupGL.add(n.rootNode)},incrementalPrepareRender:function(e,t,r){this.groupGL.removeAll();var i=e.coordinateSystem;i&&i.viewGL&&i.viewGL.add(this.groupGL),this._currentStep=0},incrementalRender:function(e,t,r,i){var n=this._geo3DBuilderList[this._currentStep],a=t.coordinateSystem;n||((n=new th(i)).extrudeY=\\\"mapbox3D\\\"!==a.type&&\\\"maptalks3D\\\"!==a.type,this._geo3DBuilderList[this._currentStep]=n),n.update(t,r,i,e.start,e.end),this.groupGL.add(n.rootNode),this._updateShaderDefines(a,n),this._currentStep++},_updateShaderDefines:function(t,e){var r=t.viewGL.isLinearSpace()?\\\"define\\\":\\\"undefine\\\";e.rootNode.traverse(function(e){e.material&&(e.material[r](\\\"fragment\\\",\\\"SRGB_DECODE\\\"),\\\"mapbox3D\\\"!==t.type&&\\\"maptalks3D\\\"!==t.type||(e.material.define(\\\"fragment\\\",\\\"NORMAL_UP_AXIS\\\",2),e.material.define(\\\"fragment\\\",\\\"NORMAL_FRONT_AXIS\\\",1)))})},remove:function(){this.groupGL.removeAll()},dispose:function(){this.groupGL.removeAll(),this._geo3DBuilderList.forEach(function(e){e.dispose()})}});(0,F.use)(function(e){e.registerChartView(dc),e.registerSeriesModel(cc)});x=F.SeriesModel.extend({type:\\\"series.surface\\\",dependencies:[\\\"globe\\\",\\\"grid3D\\\",\\\"geo3D\\\"],visualStyleAccessPath:\\\"itemStyle\\\",formatTooltip:function(e){return fu(this,e)},getInitialData:function(e,t){function r(e){isNaN(e.min)||isNaN(e.max)||isNaN(e.step)}function i(e){var t=F.number.getPrecisionSafe;return Math.max(t(e.min),t(e.max),t(e.step))+1}if(!(h=e.data))if(e.parametric)for(var n=e.parametricEquation||{},a=n.u||{},o=n.v||{},s=([\\\"u\\\",\\\"v\\\"].forEach(function(e){r(n[e])}),[\\\"x\\\",\\\"y\\\",\\\"z\\\"].forEach(function(e){n[e]}),Math.floor((a.max+a.step-a.min)/a.step)),l=Math.floor((o.max+o.step-o.min)/o.step),h=new Float32Array(s*l*5),u=i(a),c=i(o),d=0,f=0;f<l;f++)for(A=0;A<s;A++){var p=A*a.step+a.min,m=f*o.step+o.min,p=F.number.round(Math.min(p,a.max),u),m=F.number.round(Math.min(m,o.max),c),g=n.x(p,m),_=n.y(p,m),v=n.z(p,m);h[d++]=g,h[d++]=_,h[d++]=v,h[d++]=p,h[d++]=m}else{var y=e.equation||{},x=y.x||{},b=y.y||{};if([\\\"x\\\",\\\"y\\\"].forEach(function(e){r(y[e])}),\\\"function\\\"!=typeof y.z)return;var w=Math.floor((x.max+x.step-x.min)/x.step),T=Math.floor((b.max+b.step-b.min)/b.step);h=new Float32Array(w*T*3);for(var S=i(x),M=i(b),d=0,f=0;f<T;f++)for(var A=0;A<w;A++){var g=A*x.step+x.min,_=f*b.step+b.min,E=F.number.round(Math.min(g,x.max),S),C=F.number.round(Math.min(_,b.max),M),v=y.z(E,C);h[d++]=E,h[d++]=C,h[d++]=v}}var D=[\\\"x\\\",\\\"y\\\",\\\"z\\\"];return e.parametric&&D.push(\\\"u\\\",\\\"v\\\"),pu(this,D,h)},defaultOption:{coordinateSystem:\\\"cartesian3D\\\",zlevel:-10,grid3DIndex:0,shading:\\\"lambert\\\",parametric:!1,wireframe:{show:!0,lineStyle:{color:\\\"rgba(0,0,0,0.5)\\\",width:1}},equation:{x:{min:-1,max:1,step:.1},y:{min:-1,max:1,step:.1},z:null},parametricEquation:{u:{min:-1,max:1,step:.1},v:{min:-1,max:1,step:.1},x:null,y:null,z:null},dataShape:null,itemStyle:{},animationDurationUpdate:500}});F.util.merge(x.prototype,V);const fc=x;var pc=ao.vec3;const mc=F.ChartView.extend({type:\\\"surface\\\",__ecgl__:!0,init:function(e,t){this.groupGL=new Z.Node},render:function(e,t,r){var i=this._prevSurfaceMesh,i=(this._prevSurfaceMesh=this._surfaceMesh,this._surfaceMesh=i,this._surfaceMesh||(this._surfaceMesh=this._createSurfaceMesh()),this.groupGL.remove(this._prevSurfaceMesh),this.groupGL.add(this._surfaceMesh),e.coordinateSystem),n=e.get(\\\"shading\\\"),a=e.getData(),o=\\\"ecgl.\\\"+n,n=(this._surfaceMesh.material&&this._surfaceMesh.material.shader.name===o||(this._surfaceMesh.material=Z.createMaterial(o,[\\\"VERTEX_COLOR\\\",\\\"DOUBLE_SIDED\\\"])),Z.setMaterialFromModel(n,this._surfaceMesh.material,e,r),i&&i.viewGL&&(i.viewGL.add(this.groupGL),o=i.viewGL.isLinearSpace()?\\\"define\\\":\\\"undefine\\\",this._surfaceMesh.material[o](\\\"fragment\\\",\\\"SRGB_DECODE\\\")),e.get(\\\"parametric\\\")),i=(i=e.get(\\\"dataShape\\\"))||this._getDataShape(a,n),o=e.getModel(\\\"wireframe\\\"),a=o.get(\\\"lineStyle.width\\\"),n=o.get(\\\"show\\\")&&0<a,i=(this._updateSurfaceMesh(this._surfaceMesh,e,i,n),this._surfaceMesh.material);n?(i.define(\\\"WIREFRAME_QUAD\\\"),i.set(\\\"wireframeLineWidth\\\",a),i.set(\\\"wireframeLineColor\\\",Z.parseColor(o.get(\\\"lineStyle.color\\\")))):i.undefine(\\\"WIREFRAME_QUAD\\\"),this._initHandler(e,r),this._updateAnimation(e)},_updateAnimation:function(e){Z.updateVertexAnimation([[\\\"prevPosition\\\",\\\"position\\\"],[\\\"prevNormal\\\",\\\"normal\\\"]],this._prevSurfaceMesh,this._surfaceMesh,e)},_createSurfaceMesh:function(){var e=new Z.Mesh({geometry:new Z.Geometry({dynamic:!0,sortTriangles:!0}),shadowDepthMaterial:new Z.Material({shader:new Z.Shader(Z.Shader.source(\\\"ecgl.sm.depth.vertex\\\"),Z.Shader.source(\\\"ecgl.sm.depth.fragment\\\"))}),culling:!1,renderOrder:10,renderNormal:!0});return e.geometry.createAttribute(\\\"barycentric\\\",\\\"float\\\",4),e.geometry.createAttribute(\\\"prevPosition\\\",\\\"float\\\",3),e.geometry.createAttribute(\\\"prevNormal\\\",\\\"float\\\",3),Object.assign(e.geometry,Zl),e},_initHandler:function(e,h){var u=e.getData(),c=this._surfaceMesh,d=e.coordinateSystem,f=(c.seriesIndex=e.seriesIndex,-1);c.off(\\\"mousemove\\\"),c.off(\\\"mouseout\\\"),c.on(\\\"mousemove\\\",function(e){var t=function(e,t){for(var r=1/0,i=-1,n=[],a=0;a<e.length;a++){c.geometry.attributes.position.get(e[a],n);var o=pc.dist(t.array,n);o<r&&(r=o,i=e[a])}return i}(e.triangle,e.point);if(0<=t){var r=[];c.geometry.attributes.position.get(t,r);for(var i=d.pointToData(r),n=1/0,a=-1,o=[],s=0;s<u.count();s++){o[0]=u.get(\\\"x\\\",s),o[1]=u.get(\\\"y\\\",s),o[2]=u.get(\\\"z\\\",s);var l=pc.squaredDistance(o,i);l<n&&(a=s,n=l)}a!==f&&h.dispatchAction({type:\\\"grid3DShowAxisPointer\\\",value:i}),f=a,c.dataIndex=a}else c.dataIndex=-1},this),c.on(\\\"mouseout\\\",function(e){f=-1,c.dataIndex=-1,h.dispatchAction({type:\\\"grid3DHideAxisPointer\\\"})},this)},_updateSurfaceMesh:function(e,t,r,i){var n,a=e.geometry,o=t.getData(),s=o.getLayout(\\\"points\\\"),B=0,F=(o.each(function(e){o.hasValue(e)||B++}),B||i),l=a.attributes.position,h=a.attributes.normal,u=a.attributes.texcoord0,z=a.attributes.barycentric,c=a.attributes.color,d=r[0],f=r[1],p=\\\"color\\\"!==t.get(\\\"shading\\\");F?(l.init(n=(d-1)*(f-1)*4),i&&z.init(n)):l.value=new Float32Array(s),c.init(a.vertexCount),u.init(a.vertexCount);var m,g,_=[0,3,1,1,3,2],G=[[1,1,0,0],[0,1,0,1],[1,0,0,1],[1,0,1,0]],U=a.indices=new(65535<a.vertexCount?Uint32Array:Uint16Array)((d-1)*(f-1)*6),v=function(e,t,r){r[1]=e*f+t,r[0]=e*f+t+1,r[3]=(e+1)*f+t+1,r[2]=(e+1)*f+t},y=!1;if(F){var x=[],b=[],k=0;p?h.init(a.vertexCount):h.value=null;for(var w=[[],[],[]],V=[],H=[],T=pc.create(),S=function(e,t,r){var i=3*t;return r[0]=e[i],r[1]=e[1+i],r[2]=e[2+i],r},M=new Float32Array(s.length),W=new Float32Array(s.length/3*4),A=0;A<o.count();A++)if(o.hasValue(A)){var E=Z.parseColor(Yl(o,A));null!=(g=Kl(o,A))&&(E[3]*=g),E[3]<.99&&(y=!0);for(var C=0;C<4;C++)W[4*A+C]=E[C]}for(var j=[1e7,1e7,1e7],A=0;A<d-1;A++)for(var D=0;D<f-1;D++){for(var L=4*(A*(f-1)+D),P=(v(A,D,x),!1),C=0;C<4;C++)S(s,x[C],b),m=b,(isNaN(m[0])||isNaN(m[1])||isNaN(m[2]))&&(P=!0);for(C=0;C<4;C++)P?l.set(L+C,j):(S(s,x[C],b),l.set(L+C,b)),i&&z.set(L+C,G[C]);for(C=0;C<6;C++)U[k++]=_[C]+L;if(p&&!P)for(C=0;C<2;C++){for(var X=3*C,O=0;O<3;O++)S(s,R=x[_[X]+O],w[O]);for(pc.sub(V,w[0],w[1]),pc.sub(H,w[1],w[2]),pc.cross(T,V,H),O=0;O<3;O++){var N=3*x[_[X]+O];M[N]=M[N]+T[0],M[1+N]=M[1+N]+T[1],M[2+N]=M[2+N]+T[2]}}}if(p)for(A=0;A<M.length/3;A++)S(M,A,T),pc.normalize(T,T),M[3*A]=T[0],M[3*A+1]=T[1],M[3*A+2]=T[2];var E=[],I=[];for(A=0;A<d-1;A++)for(D=0;D<f-1;D++)for(L=4*(A*(f-1)+D),v(A,D,x),C=0;C<4;C++){for(O=0;O<4;O++)E[O]=W[4*x[C]+O];c.set(L+C,E),p&&(S(M,x[C],T),h.set(L+C,T));var R=x[C];I[0]=R%f/(f-1),I[1]=Math.floor(R/f)/(d-1),u.set(L+C,I)}}else{for(I=[],A=0;A<o.count();A++)I[0]=A%f/(f-1),I[1]=Math.floor(A/f)/(d-1),E=Z.parseColor(Yl(o,A)),null!=(g=Kl(o,A))&&(E[3]*=g),E[3]<.99&&(y=!0),c.set(A,E),u.set(A,I);var x=[],q=0;for(A=0;A<d-1;A++)for(D=0;D<f-1;D++)for(v(A,D,x),C=0;C<6;C++)U[q++]=x[_[C]];p?a.generateVertexNormals():h.value=null}e.material.get(\\\"normalMap\\\")&&a.generateTangents(),a.updateBoundingBox(),a.dirty(),e.material.transparent=y,e.material.depthMask=!y},_getDataShape:function(e,t){for(var r=-1/0,i=0,n=0,a=!1,o=t?\\\"u\\\":\\\"x\\\",s=e.count(),l=0;l<s;l++){var h=e.get(o,l);h<r&&(n=0,i++),r=h,n++}if(!(a=i&&1!==n?a:!0))return[i+1,n];for(var u=Math.floor(Math.sqrt(s));0<u;){if(Math.floor(s/u)===s/u)return[u,s/u];u--}return[u=Math.floor(Math.sqrt(s)),u]},dispose:function(){this.groupGL.removeAll()},remove:function(){this.groupGL.removeAll()}});function gc(e,t){for(var r=[],i=0;i<t.length;i++)r.push(e.dataToPoint(t[i]));return r}(0,F.use)(function(e){e.registerChartView(mc),e.registerSeriesModel(fc),e.registerLayout(function(e,t){e.eachSeriesByType(\\\"surface\\\",function(t){var e,a=t.coordinateSystem,o=(a&&a.type,t.getData()),s=new Float32Array(3*o.count()),l=[NaN,NaN,NaN];a&&\\\"cartesian3D\\\"===a.type&&(e=a.dimensions.map(function(e){return t.coordDimToDataDim(e)[0]}),o.each(e,function(e,t,r,i){var n=o.hasValue(i)?a.dataToPoint([e,t,r]):l;s[3*i]=n[0],s[3*i+1]=n[1],s[3*i+2]=n[2]})),o.setLayout(\\\"points\\\",s)})})});pl=F.SeriesModel.extend({type:\\\"series.map3D\\\",layoutMode:\\\"box\\\",coordinateSystem:null,visualStyleAccessPath:\\\"itemStyle\\\",optionUpdated:function(e){var t=this.get(\\\"coordinateSystem\\\");null!=t&&\\\"geo3D\\\"!==t&&(this.get(\\\"groundPlane.show\\\")&&(this.option.groundPlane.show=!1),this._geo=null)},getInitialData:function(e){e.data=this.getFilledRegions(e.data,e.map);var t=F.helper.createDimensions(e.data,{coordDimensions:[\\\"value\\\"]}),i=new F.List(t,this),n=(i.initData(e.data),{});return i.each(function(e){var t=i.getName(e),r=i.getItemModel(e);n[t]=r}),this._regionModelMap=n,i},formatTooltip:function(e){return fu(this,e)},getRegionModel:function(e){var t=this.getData().getName(e);return this._regionModelMap[t]||new F.Model(null,this)},getRegionPolygonCoords:function(e){var t=this.coordinateSystem,r=this.getData().getName(e);if(t.transform)return(i=t.getRegion(r))?i.geometries:[];this._geo||(this._geo=ph.createGeo3D(this));for(var i=this._geo.getRegion(r),n=[],a=0;a<i.geometries.length;a++){var o=i.geometries[a],s=[],l=gc(t,o.exterior);if(s&&s.length)for(var h=0;h<o.interiors.length;h++)s.push(gc(t,s[h]));n.push({interiors:s,exterior:l})}return n},getFormattedLabel:function(e,t){var r=du.getFormattedLabel(this,e,t);return r=null==r?this.getData().getName(e):r},defaultOption:{coordinateSystem:\\\"geo3D\\\",data:null}});F.util.merge(pl.prototype,Dn),F.util.merge(pl.prototype,s),F.util.merge(pl.prototype,v),F.util.merge(pl.prototype,e),F.util.merge(pl.prototype,V);const _c=pl,vc=F.ChartView.extend({type:\\\"map3D\\\",__ecgl__:!0,init:function(e,t){this._geo3DBuilder=new th(t),this.groupGL=new Z.Node},render:function(e,t,r){var i,n,a,o=e.coordinateSystem;o&&o.viewGL&&(this.groupGL.add(this._geo3DBuilder.rootNode),o.viewGL.add(this.groupGL),\\\"geo3D\\\"===o.type?(this._sceneHelper||(this._sceneHelper=new po,this._sceneHelper.initLight(this.groupGL)),this._sceneHelper.setScene(o.viewGL.scene),this._sceneHelper.updateLight(e),o.viewGL.setPostEffect(e.getModel(\\\"postEffect\\\"),r),o.viewGL.setTemporalSuperSampling(e.getModel(\\\"temporalSuperSampling\\\")),(i=this._control)||(i=this._control=new io({zr:r.getZr()}),this._control.init()),n=e.getModel(\\\"viewControl\\\"),i.setViewGL(o.viewGL),i.setFromViewControlModel(n,0),i.off(\\\"update\\\"),i.on(\\\"update\\\",function(){r.dispatchAction({type:\\\"map3DChangeCamera\\\",alpha:i.getAlpha(),beta:i.getBeta(),distance:i.getDistance(),from:this.uid,map3DId:e.id})}),this._geo3DBuilder.extrudeY=!0):(this._control&&(this._control.dispose(),this._control=null),this._sceneHelper&&(this._sceneHelper.dispose(),this._sceneHelper=null),e.getData().getLayout(\\\"geo3D\\\"),this._geo3DBuilder.extrudeY=!1),this._geo3DBuilder.update(e,t,r,0,e.getData().count()),a=o.viewGL.isLinearSpace()?\\\"define\\\":\\\"undefine\\\",this._geo3DBuilder.rootNode.traverse(function(e){e.material&&e.material[a](\\\"fragment\\\",\\\"SRGB_DECODE\\\")}))},afterRender:function(e,t,r,i){var n=i.renderer,a=e.coordinateSystem;a&&\\\"geo3D\\\"===a.type&&(this._sceneHelper.updateAmbientCubemap(n,e,r),this._sceneHelper.updateSkybox(n,e,r))},dispose:function(){this.groupGL.removeAll(),this._control.dispose(),this._geo3DBuilder.dispose()}}),yc=((0,F.use)(function(e){mh(e),e.registerChartView(vc),e.registerSeriesModel(_c),e.registerAction({type:\\\"map3DChangeCamera\\\",event:\\\"map3dcamerachanged\\\",update:\\\"series:updateCamera\\\"},function(t,e){e.eachComponent({mainType:\\\"series\\\",subType:\\\"map3D\\\",query:t},function(e){e.setView(t)})})}),F.SeriesModel.extend({type:\\\"series.scatterGL\\\",dependencies:[\\\"grid\\\",\\\"polar\\\",\\\"geo\\\",\\\"singleAxis\\\"],visualStyleAccessPath:\\\"itemStyle\\\",hasSymbolVisual:!0,getInitialData:function(){return F.helper.createList(this)},defaultOption:{coordinateSystem:\\\"cartesian2d\\\",zlevel:10,progressive:1e5,progressiveThreshold:1e5,large:!1,symbol:\\\"circle\\\",symbolSize:10,zoomScale:0,blendMode:\\\"source-over\\\",itemStyle:{opacity:.8},postEffect:{enable:!1,colorCorrection:{exposure:0,brightness:0,contrast:1,saturation:1,enable:!0}}}}));function xc(e,t,r){var i=t[0],n=t[1];e[0]=r[0]*i+r[2]*n+r[4],e[1]=r[1]*i+r[3]*n+r[5]}function bc(e){this.viewGL=e}bc.prototype.reset=function(e,t){this._updateCamera(t.getWidth(),t.getHeight(),t.getDevicePixelRatio()),this._viewTransform=[1,0,0,1,0,0],this.updateTransform(e,t)},bc.prototype.updateTransform=function(e,t){var r,i,n,a,o,s,l,h=e.coordinateSystem;h.getRoamTransform&&(r=this._viewTransform,i=(h=h.getRoamTransform())[0],n=h[2],a=h[4],o=h[1],s=h[3],h=h[5],(l=i*s-o*n)&&(r[0]=s*(l=1/l),r[1]=-o*l,r[2]=-n*l,r[3]=i*l,r[4]=(n*h-s*a)*l,r[5]=(o*a-i*h)*l),this._setCameraTransform(this._viewTransform),t.getZr().refresh())},bc.prototype.dataToPoint=function(e,t,r){r=e.dataToPoint(t,null,r);var i=this._viewTransform;i&&xc(r,r,i)},bc.prototype.removeTransformInPoint=function(e){return this._viewTransform&&xc(e,e,this._viewTransform),e},bc.prototype.getZoom=function(){var e;return this._viewTransform?(e=this._viewTransform,1/Math.max(Math.sqrt(e[0]*e[0]+e[1]*e[1]),Math.sqrt(e[2]*e[2]+e[3]*e[3]))):1},bc.prototype._setCameraTransform=function(e){var t=this.viewGL.camera;t.position.set(e[4],e[5],0),t.scale.set(Math.sqrt(e[0]*e[0]+e[1]*e[1]),Math.sqrt(e[2]*e[2]+e[3]*e[3]),1)},bc.prototype._updateCamera=function(e,t,r){this.viewGL.setViewport(0,0,e,t,r);var i=this.viewGL.camera;i.left=i.top=0,i.bottom=t,i.right=e,i.near=0,i.far=100};const wc=bc,Tc=F.ChartView.extend({type:\\\"scatterGL\\\",__ecgl__:!0,init:function(e,t){this.groupGL=new Z.Node,this.viewGL=new hl(\\\"orthographic\\\"),this.viewGL.add(this.groupGL),this._pointsBuilderList=[],this._currentStep=0,this._sizeScale=1,this._glViewHelper=new wc(this.viewGL)},render:function(e,t,r){var i;this.groupGL.removeAll(),this._glViewHelper.reset(e,r),e.getData().count()&&(i=(i=this._pointsBuilderList[0])||(this._pointsBuilderList[0]=new Uu(!0,r)),this._pointsBuilderList.length=1,this.groupGL.add(i.rootNode),this._removeTransformInPoints(e.getData().getLayout(\\\"points\\\")),i.update(e,t,r),this.viewGL.setPostEffect(e.getModel(\\\"postEffect\\\"),r))},incrementalPrepareRender:function(e,t,r){this.groupGL.removeAll(),this._glViewHelper.reset(e,r),this._currentStep=0,this.viewGL.setPostEffect(e.getModel(\\\"postEffect\\\"),r)},incrementalRender:function(e,t,r,i){var n;e.end<=e.start||((n=this._pointsBuilderList[this._currentStep])||(n=new Uu(!0,i),this._pointsBuilderList[this._currentStep]=n),this.groupGL.add(n.rootNode),this._removeTransformInPoints(t.getData().getLayout(\\\"points\\\")),n.setSizeScale(this._sizeScale),n.update(t,r,i,e.start,e.end),i.getZr().refresh(),this._currentStep++)},updateTransform:function(e,t,r){var i,n;e.coordinateSystem.getRoamTransform&&(this._glViewHelper.updateTransform(e,r),i=this._glViewHelper.getZoom(),n=Math.max((e.get(\\\"zoomScale\\\")||0)*(i-1)+1,0),this._sizeScale=n,this._pointsBuilderList.forEach(function(e){e.setSizeScale(n)}))},_removeTransformInPoints:function(e){if(e)for(var t=[],r=0;r<e.length;r+=2)t[0]=e[r],t[1]=e[r+1],this._glViewHelper.removeTransformInPoint(t),e[r]=t[0],e[r+1]=t[1]},dispose:function(){this.groupGL.removeAll(),this._pointsBuilderList.forEach(function(e){e.dispose()})},remove:function(){this.groupGL.removeAll()}});function Sc(e){return\\\"_EC_\\\"+e}(0,F.use)(function(e){e.registerChartView(Tc),e.registerSeriesModel(yc),e.registerLayout({seriesType:\\\"scatterGL\\\",reset:function(e){var t,o,s,l=e.coordinateSystem,h=e.getData();return l&&(o=l.dimensions.map(function(e){return h.mapDimension(e)}).slice(0,2),s=[],1===o.length?t=function(e){for(var t=new Float32Array(2*(e.end-e.start)),r=e.start;r<e.end;r++){var i=2*(r-e.start),n=h.get(o[0],r),n=l.dataToPoint(n);t[i]=n[0],t[1+i]=n[1]}h.setLayout(\\\"points\\\",t)}:2===o.length&&(t=function(e){for(var t=new Float32Array(2*(e.end-e.start)),r=e.start;r<e.end;r++){var i=2*(r-e.start),n=h.get(o[0],r),a=h.get(o[1],r);s[0]=n,s[1]=a,s=l.dataToPoint(s),t[i]=s[0],t[1+i]=s[1]}h.setLayout(\\\"points\\\",t)})),{progress:t}}})});Dc.prototype.isDirected=function(){return this._directed},Dc.prototype.addNode=function(e,t){var r,i=this._nodesMap;if(!i[Sc(e=null==e?\\\"\\\"+t:\\\"\\\"+e)])return((r=new Mc(e,t)).hostGraph=this).nodes.push(r),i[Sc(e)]=r},Dc.prototype.getNodeByIndex=function(e){var t=this.data.getRawIndex(e);return this.nodes[t]},Dc.prototype.getNodeById=function(e){return this._nodesMap[Sc(e)]},Dc.prototype.addEdge=function(e,t,r){var i,n=this._nodesMap,a=this._edgesMap;if(\\\"number\\\"==typeof e&&(e=this.nodes[e]),\\\"number\\\"==typeof t&&(t=this.nodes[t]),e instanceof Mc||(e=n[Sc(e)]),t instanceof Mc||(t=n[Sc(t)]),e&&t)return n=e.id+\\\"-\\\"+t.id,((i=new Ac(e,t,r)).hostGraph=this)._directed&&(e.outEdges.push(i),t.inEdges.push(i)),e.edges.push(i),e!==t&&t.edges.push(i),this.edges.push(i),a[n]=i},Dc.prototype.getEdgeByIndex=function(e){var t=this.edgeData.getRawIndex(e);return this.edges[t]},Dc.prototype.getEdge=function(e,t){e instanceof Mc&&(e=e.id),t instanceof Mc&&(t=t.id);var r=this._edgesMap;return this._directed?r[e+\\\"-\\\"+t]:r[e+\\\"-\\\"+t]||r[t+\\\"-\\\"+e]},Dc.prototype.eachNode=function(e,t){for(var r=this.nodes,i=r.length,n=0;n<i;n++)0<=r[n].dataIndex&&e.call(t,r[n],n)},Dc.prototype.eachEdge=function(e,t){for(var r=this.edges,i=r.length,n=0;n<i;n++)0<=r[n].dataIndex&&0<=r[n].node1.dataIndex&&0<=r[n].node2.dataIndex&&e.call(t,r[n],n)},Dc.prototype.breadthFirstTraverse=function(e,t,r,i){if(t=t instanceof Mc?t:this._nodesMap[Sc(t)]){for(var n=\\\"out\\\"===r?\\\"outEdges\\\":\\\"in\\\"===r?\\\"inEdges\\\":\\\"edges\\\",a=0;a<this.nodes.length;a++)this.nodes[a].__visited=!1;if(!e.call(i,t,null))for(var o=[t];o.length;)for(var s=o.shift(),l=s[n],a=0;a<l.length;a++){var h=l[a],h=h.node1===s?h.node2:h.node1;if(!h.__visited){if(e.call(i,h,s))return;o.push(h),h.__visited=!0}}}},Dc.prototype.update=function(){for(var e=this.data,r=this.edgeData,t=this.nodes,i=this.edges,n=0,a=t.length;n<a;n++)t[n].dataIndex=-1;for(n=0,a=e.count();n<a;n++)t[e.getRawIndex(n)].dataIndex=n;for(r.filterSelf(function(e){var t=i[r.getRawIndex(e)];return 0<=t.node1.dataIndex&&0<=t.node2.dataIndex}),n=0,a=i.length;n<a;n++)i[n].dataIndex=-1;for(n=0,a=r.count();n<a;n++)i[r.getRawIndex(n)].dataIndex=n},Dc.prototype.clone=function(){for(var e=new Dc(this._directed),t=this.nodes,r=this.edges,i=0;i<t.length;i++)e.addNode(t[i].id,t[i].dataIndex);for(i=0;i<r.length;i++){var n=r[i];e.addEdge(n.node1.id,n.node2.id,n.dataIndex)}return e};var x=Dc,Mc=(Cc.prototype.degree=function(){return this.edges.length},Cc.prototype.inDegree=function(){return this.inEdges.length},Cc.prototype.outDegree=function(){return this.outEdges.length},Cc.prototype.getModel=function(e){if(!(this.dataIndex<0))return this.hostGraph.data.getItemModel(this.dataIndex).getModel(e)},Cc.prototype.getAdjacentDataIndices=function(){for(var e={edge:[],node:[]},t=0;t<this.edges.length;t++){var r=this.edges[t];r.dataIndex<0||(e.edge.push(r.dataIndex),e.node.push(r.node1.dataIndex,r.node2.dataIndex))}return e},Cc),Ac=(Ec.prototype.getModel=function(e){if(!(this.dataIndex<0))return this.hostGraph.edgeData.getItemModel(this.dataIndex).getModel(e)},Ec.prototype.getAdjacentDataIndices=function(){return{edge:[this.dataIndex],node:[this.node1.dataIndex,this.node2.dataIndex]}},Ec);function Ec(e,t,r){this.dataIndex=-1,this.node1=e,this.node2=t,this.dataIndex=null==r?-1:r}function Cc(e,t){this.inEdges=[],this.outEdges=[],this.edges=[],this.dataIndex=-1,this.id=null==e?\\\"\\\":e,this.dataIndex=null==t?-1:t}function Dc(e){this.type=\\\"graph\\\",this.nodes=[],this.edges=[],this._nodesMap={},this._edgesMap={},this._directed=e||!1}function Lc(r,i){return{getValue:function(e){var t=this[r][i];return t.get(t.getDimension(e||\\\"value\\\"),this.dataIndex)},setVisual:function(e,t){0<=this.dataIndex&&this[r][i].setItemVisual(this.dataIndex,e,t)},getVisual:function(e){return this[r][i].getItemVisual(this.dataIndex,e)},setLayout:function(e,t){0<=this.dataIndex&&this[r][i].setItemLayout(this.dataIndex,e,t)},getLayout:function(){return this[r][i].getItemLayout(this.dataIndex)},getGraphicEl:function(){return this[r][i].getItemGraphicEl(this.dataIndex)},getRawIndex:function(){return this[r][i].getRawIndex(this.dataIndex)}}}$n(Mc,Lc(\\\"hostGraph\\\",\\\"data\\\")),$n(Ac,Lc(\\\"hostGraph\\\",\\\"edgeData\\\"));const Pc=x;var Oc=Xa();function Nc(e,t){var r;return Oc(this).mainData===this?zc((r=Jn({},Oc(this).datas))[this.dataType]=t,r,e):Gc(t,this.dataType,Oc(this).mainData,e),t}function Ic(e,t){return e.struct&&e.struct.update(),t}function Rc(r,i){return ta(Oc(i).datas,function(e,t){e!==i&&Gc(e.cloneShallow(),t,i,r)}),i}function Bc(e){var t=Oc(this).mainData;return null==e||null==t?t:Oc(t).datas[e]}function Fc(){var t=Oc(this).mainData;return null==t?[{data:t}]:ra(ia(Oc(t).datas),function(e){return{type:e,data:Oc(t).datas[e]}})}function zc(r,e,i){Oc(r).datas={},ta(e,function(e,t){Gc(e,t,r,i)})}function Gc(e,t,r,i){Oc(r).datas[t]=e,Oc(e).mainData=r,e.dataType=t,i.struct&&(e[i.structAttr]=i.struct,i.struct[i.datasAttr[t]]=e),e.getLinkedData=Bc,e.getLinkedDataAll=Fc}var Uc=F.SeriesModel.extend({type:\\\"series.graphGL\\\",visualStyleAccessPath:\\\"itemStyle\\\",hasSymbolVisual:!0,init:function(e){Uc.superApply(this,\\\"init\\\",arguments),this.legendDataProvider=function(){return this._categoriesData},this._updateCategoriesData()},mergeOption:function(e){Uc.superApply(this,\\\"mergeOption\\\",arguments),this._updateCategoriesData()},getFormattedLabel:function(e,t,r,i){var n,a,o=du.getFormattedLabel(this,e,t,r,i);return null==o&&(a=(n=this.getData()).dimensions[n.dimensions.length-1],o=n.get(a,e)),o},getInitialData:function(e,a){var t=e.edges||e.links||[],r=e.data||e.nodes||[],o=this;if(r&&t)return function(e,t,r,i){for(var n=new Pc(!0),a=0;a<e.length;a++)n.addNode(E(e[a].id,e[a].name,a),a);for(var o=[],s=[],l=0,a=0;a<t.length;a++){var h=t[a],u=h.source,c=h.target;n.addEdge(u,c,l)&&(s.push(h),o.push(E(h.id,u+\\\" > \\\"+c)),l++)}var d=F.helper.createDimensions(e,{coordDimensions:[\\\"value\\\"]});(d=new F.List(d,r)).initData(e);var f,p,m=new F.List([\\\"value\\\"],r);if(m.initData(s,o),i(d,m),p=(f={mainData:d,struct:n,structAttr:\\\"graph\\\",datas:{node:d,edge:m},datasAttr:{node:\\\"data\\\",edge:\\\"edgeData\\\"}}).mainData,(d=f.datas)||(d={main:p},f.datasAttr={main:\\\"data\\\"}),f.datas=f.mainData=null,zc(p,d,f),ta(d,function(t){ta(p.TRANSFERABLE_METHODS,function(e){t.wrapMethod(e,na(Nc,f))})}),p.wrapMethod(\\\"cloneShallow\\\",na(Rc,f)),ta(p.CHANGABLE_METHODS,function(e){p.wrapMethod(e,na(Ic,f))}),d[p.dataType]===p)return n.update(),n;throw new Error(void 0)}(r,t,this,function(e,t){e.wrapMethod(\\\"getItemModel\\\",function(e){var t=o._categoriesModels[e.getShallow(\\\"category\\\")];return t&&(t.parentModel=e.parentModel,e.parentModel=t),e});const i=a.getModel([]).getModel;function r(e,t){var r=i.call(this,e,t);return r.resolveParentPath=n,r}function n(e){var t;return!e||\\\"label\\\"!==e[0]&&\\\"label\\\"!==e[1]?e:(t=e.slice(),\\\"label\\\"===e[0]?t[0]=\\\"edgeLabel\\\":\\\"label\\\"===e[1]&&(t[1]=\\\"edgeLabel\\\"),t)}t.wrapMethod(\\\"getItemModel\\\",function(e){return e.resolveParentPath=n,e.getModel=r,e})}).data},getGraph:function(){return this.getData().graph},getEdgeData:function(){return this.getGraph().edgeData},getCategoriesData:function(){return this._categoriesData},formatTooltip:function(e,t,r){var i,n,a,o;return\\\"edge\\\"===r?(o=this.getData(),i=this.getDataParams(e,r),a=o.graph.getEdgeByIndex(e),n=o.getName(a.node1.dataIndex),a=o.getName(a.node2.dataIndex),o=[],null!=n&&o.push(n),null!=a&&o.push(a),o=F.format.encodeHTML(o.join(\\\" > \\\")),i.value&&(o+=\\\" : \\\"+F.format.encodeHTML(i.value)),o):Uc.superApply(this,\\\"formatTooltip\\\",arguments)},_updateCategoriesData:function(){var e=(this.option.categories||[]).map(function(e){return null!=e.value?e:Object.assign({value:0},e)}),t=new F.List([\\\"value\\\"],this);t.initData(e),this._categoriesData=t,this._categoriesModels=t.mapArray(function(e){return t.getItemModel(e,!0)})},setView:function(e){null!=e.zoom&&(this.option.zoom=e.zoom),null!=e.offset&&(this.option.offset=e.offset)},setNodePosition:function(e){for(var t=0;t<e.length/2;t++){var r=e[2*t],i=e[2*t+1],n=this.getData().getRawDataItem(t);n.x=r,n.y=i}},isAnimationEnabled:function(){return Uc.superCall(this,\\\"isAnimationEnabled\\\")&&!(\\\"force\\\"===this.get(\\\"layout\\\")&&this.get(\\\"force.layoutAnimation\\\"))},defaultOption:{zlevel:10,z:2,legendHoverLink:!0,layout:\\\"forceAtlas2\\\",forceAtlas2:{initLayout:null,GPU:!0,steps:1,maxSteps:1e3,repulsionByDegree:!0,linLogMode:!1,strongGravityMode:!1,gravity:1,edgeWeightInfluence:1,edgeWeight:[1,4],nodeWeight:[1,4],preventOverlap:!1,gravityCenter:null},focusNodeAdjacency:!0,focusNodeAdjacencyOn:\\\"mouseover\\\",left:\\\"center\\\",top:\\\"center\\\",symbol:\\\"circle\\\",symbolSize:5,roam:!1,center:null,zoom:1,label:{show:!1,formatter:\\\"{b}\\\",position:\\\"right\\\",distance:5,textStyle:{fontSize:14}},itemStyle:{},lineStyle:{color:\\\"#aaa\\\",width:1,opacity:.5},emphasis:{label:{show:!0}},animation:!1}});const kc=Uc;var Vc,Hc,Wc,jc,Xc,qc,Zc,Yc=ao.vec2,Kc=[[0,0],[1,1]],Dn=_.extend(function(){return{segmentScale:4,dynamic:!0,useNativeLine:!0,attributes:{position:new _.Attribute(\\\"position\\\",\\\"float\\\",2,\\\"POSITION\\\"),normal:new _.Attribute(\\\"normal\\\",\\\"float\\\",2),offset:new _.Attribute(\\\"offset\\\",\\\"float\\\",1),color:new _.Attribute(\\\"color\\\",\\\"float\\\",4,\\\"COLOR\\\")}}},{resetOffset:function(){this._vertexOffset=0,this._faceOffset=0,this._itemVertexOffsets=[]},setVertexCount:function(e){var t=this.attributes;this.vertexCount!==e&&(t.position.init(e),t.color.init(e),this.useNativeLine||(t.offset.init(e),t.normal.init(e)),65535<e?this.indices instanceof Uint16Array&&(this.indices=new Uint32Array(this.indices)):this.indices instanceof Uint32Array&&(this.indices=new Uint16Array(this.indices)))},setTriangleCount:function(e){this.triangleCount!==e&&(this.indices=0===e?null:new(65535<this.vertexCount?Uint32Array:Uint16Array)(3*e))},_getCubicCurveApproxStep:function(e,t,r,i){return 1/(Yc.dist(e,t)+Yc.dist(r,t)+Yc.dist(i,r)+1)*this.segmentScale},getCubicCurveVertexCount:function(e,t,r,i){var n=this._getCubicCurveApproxStep(e,t,r,i),n=Math.ceil(1/n);return this.useNativeLine?2*n:2*n+2},getCubicCurveTriangleCount:function(e,t,r,i){var n=this._getCubicCurveApproxStep(e,t,r,i),n=Math.ceil(1/n);return this.useNativeLine?0:2*n},getLineVertexCount:function(){return this.getPolylineVertexCount(Kc)},getLineTriangleCount:function(){return this.getPolylineTriangleCount(Kc)},getPolylineVertexCount:function(e){var t=\\\"number\\\"==typeof e?e:\\\"number\\\"!=typeof e[0]?e.length:e.length/2;return this.useNativeLine?2*(t-1):2*(t-1)+2},getPolylineTriangleCount:function(e){var t=\\\"number\\\"==typeof e?e:\\\"number\\\"!=typeof e[0]?e.length:e.length/2;return this.useNativeLine?0:2*(t-1)},addCubicCurve:function(e,t,r,i,n,a){null==a&&(a=1);for(var o=e[0],s=e[1],l=t[0],h=t[1],u=r[0],c=r[1],d=i[0],f=i[1],p=this._getCubicCurveApproxStep(e,t,r,i),m=p*p,g=m*p,_=3*p,v=3*m,m=6*m,y=6*g,x=o-2*l+u,b=s-2*h+c,u=3*(l-u)-o+d,c=3*(h-c)-s+f,w=o,T=s,S=(l-o)*_+x*v+u*g,M=(h-s)*_+b*v+c*g,A=x*m+u*y,E=b*m+c*y,C=u*y,D=c*y,L=0,P=0,O=Math.ceil(1/p),N=new Float32Array(3*(O+1)),I=(N=[],0),P=0;P<O+1;P++)N[I++]=w,N[I++]=T,w+=S,T+=M,S+=A,M+=E,A+=C,E+=D,1<(L+=p)&&(w=0<S?Math.min(w,d):Math.max(w,d),T=0<M?Math.min(T,f):Math.max(T,f));this.addPolyline(N,n,a)},addLine:function(e,t,r,i){this.addPolyline([e,t],r,i)},addPolyline:(Vc=Yc.create(),Hc=Yc.create(),Wc=Yc.create(),jc=Yc.create(),Xc=[],qc=[],Zc=[],function(e,t,r,i,n){if(e.length){var a=\\\"number\\\"!=typeof e[0];if(!((n=null==n?a?e.length:e.length/2:n)<2)){null==i&&(i=0),null==r&&(r=1),this._itemVertexOffsets.push(this._vertexOffset);for(var o,s,l,h,u=a?\\\"number\\\"!=typeof t[0]:t.length/4===n,c=this.attributes.position,d=this.attributes.color,f=this.attributes.offset,p=this.attributes.normal,m=this.indices,g=this._vertexOffset,_=0;_<n;_++)a?(Xc=e[_+i],o=u?t[_+i]:t):((Xc=Xc||[])[0]=e[s=2*_+i],Xc[1]=e[s+1],u?((o=o||[])[0]=t[l=4*_+i],o[1]=t[l+1],o[2]=t[l+2],o[3]=t[l+3]):o=t),this.useNativeLine?1<_&&(c.copy(g,g-1),d.copy(g,g-1),g++):(h=_<n-1?(a?Yc.copy(qc,e[_+1]):((qc=qc||[])[0]=e[s=2*(_+1)+i],qc[1]=e[s+1]),0<_?(Yc.sub(Vc,Xc,Zc),Yc.sub(Hc,qc,Xc),Yc.normalize(Vc,Vc),Yc.normalize(Hc,Hc),Yc.add(jc,Vc,Hc),Yc.normalize(jc,jc),l=r/2*Math.min(1/Yc.dot(Vc,jc),2),Wc[0]=-jc[1],Wc[1]=jc[0],l):(Yc.sub(Vc,qc,Xc),Yc.normalize(Vc,Vc),Wc[0]=-Vc[1],Wc[1]=Vc[0],r/2)):(Yc.sub(Vc,Xc,Zc),Yc.normalize(Vc,Vc),Wc[0]=-Vc[1],Wc[1]=Vc[0],r/2),p.set(g,Wc),p.set(g+1,Wc),f.set(g,h),f.set(g+1,-h),Yc.copy(Zc,Xc),c.set(g,Xc),c.set(g+1,Xc),d.set(g,o),d.set(g+1,o),g+=2),this.useNativeLine?(d.set(g,o),c.set(g,Xc),g++):0<_&&(h=3*this._faceOffset,(m=this.indices)[h]=g-4,m[1+h]=g-3,m[2+h]=g-2,m[3+h]=g-3,m[4+h]=g-1,m[5+h]=g-2,this._faceOffset+=2);this._vertexOffset=g}}}),setItemColor:function(e,t){for(var r=this._itemVertexOffsets[e],i=e<this._itemVertexOffsets.length-1?this._itemVertexOffsets[e+1]:this._vertexOffset,n=r;n<i;n++)this.attributes.color.set(n,t);this.dirty(\\\"color\\\")}});F.util.defaults(Dn.prototype,no);const Qc=Dn;Z.Shader[\\\"import\\\"](\\\"@export ecgl.forceAtlas2.updateNodeRepulsion\\\\n\\\\n#define NODE_COUNT 0\\\\n\\\\nuniform sampler2D positionTex;\\\\n\\\\nuniform vec2 textureSize;\\\\nuniform float gravity;\\\\nuniform float scaling;\\\\nuniform vec2 gravityCenter;\\\\n\\\\nuniform bool strongGravityMode;\\\\nuniform bool preventOverlap;\\\\n\\\\nvarying vec2 v_Texcoord;\\\\n\\\\nvoid main() {\\\\n\\\\n vec4 n0 = texture2D(positionTex, v_Texcoord);\\\\n\\\\n vec2 force = vec2(0.0);\\\\n for (int i = 0; i < NODE_COUNT; i++) {\\\\n vec2 uv = vec2(\\\\n mod(float(i), textureSize.x) / (textureSize.x - 1.0),\\\\n floor(float(i) / textureSize.x) / (textureSize.y - 1.0)\\\\n );\\\\n vec4 n1 = texture2D(positionTex, uv);\\\\n\\\\n vec2 dir = n0.xy - n1.xy;\\\\n float d2 = dot(dir, dir);\\\\n\\\\n if (d2 > 0.0) {\\\\n float factor = 0.0;\\\\n if (preventOverlap) {\\\\n float d = sqrt(d2);\\\\n d = d - n0.w - n1.w;\\\\n if (d > 0.0) {\\\\n factor = scaling * n0.z * n1.z / (d * d);\\\\n }\\\\n else if (d < 0.0) {\\\\n factor = scaling * 100.0 * n0.z * n1.z;\\\\n }\\\\n }\\\\n else {\\\\n factor = scaling * n0.z * n1.z / d2;\\\\n }\\\\n force += dir * factor;\\\\n }\\\\n }\\\\n\\\\n vec2 dir = gravityCenter - n0.xy;\\\\n float d = 1.0;\\\\n if (!strongGravityMode) {\\\\n d = length(dir);\\\\n }\\\\n\\\\n force += dir * n0.z * gravity / (d + 1.0);\\\\n\\\\n gl_FragColor = vec4(force, 0.0, 1.0);\\\\n}\\\\n@end\\\\n\\\\n@export ecgl.forceAtlas2.updateEdgeAttraction.vertex\\\\n\\\\nattribute vec2 node1;\\\\nattribute vec2 node2;\\\\nattribute float weight;\\\\n\\\\nuniform sampler2D positionTex;\\\\nuniform float edgeWeightInfluence;\\\\nuniform bool preventOverlap;\\\\nuniform bool linLogMode;\\\\n\\\\nuniform vec2 windowSize: WINDOW_SIZE;\\\\n\\\\nvarying vec2 v_Force;\\\\n\\\\nvoid main() {\\\\n\\\\n vec4 n0 = texture2D(positionTex, node1);\\\\n vec4 n1 = texture2D(positionTex, node2);\\\\n\\\\n vec2 dir = n1.xy - n0.xy;\\\\n float d = length(dir);\\\\n float w;\\\\n if (edgeWeightInfluence == 0.0) {\\\\n w = 1.0;\\\\n }\\\\n else if (edgeWeightInfluence == 1.0) {\\\\n w = weight;\\\\n }\\\\n else {\\\\n w = pow(weight, edgeWeightInfluence);\\\\n }\\\\n vec2 offset = vec2(1.0 / windowSize.x, 1.0 / windowSize.y);\\\\n vec2 scale = vec2((windowSize.x - 1.0) / windowSize.x, (windowSize.y - 1.0) / windowSize.y);\\\\n vec2 pos = node1 * scale * 2.0 - 1.0;\\\\n gl_Position = vec4(pos + offset, 0.0, 1.0);\\\\n gl_PointSize = 1.0;\\\\n\\\\n float factor;\\\\n if (preventOverlap) {\\\\n d = d - n1.w - n0.w;\\\\n }\\\\n if (d <= 0.0) {\\\\n v_Force = vec2(0.0);\\\\n return;\\\\n }\\\\n\\\\n if (linLogMode) {\\\\n factor = w * log(d) / d;\\\\n }\\\\n else {\\\\n factor = w;\\\\n }\\\\n v_Force = dir * factor;\\\\n}\\\\n@end\\\\n\\\\n@export ecgl.forceAtlas2.updateEdgeAttraction.fragment\\\\n\\\\nvarying vec2 v_Force;\\\\n\\\\nvoid main() {\\\\n gl_FragColor = vec4(v_Force, 0.0, 0.0);\\\\n}\\\\n@end\\\\n\\\\n@export ecgl.forceAtlas2.calcWeightedSum.vertex\\\\n\\\\nattribute vec2 node;\\\\n\\\\nvarying vec2 v_NodeUv;\\\\n\\\\nvoid main() {\\\\n\\\\n v_NodeUv = node;\\\\n gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\\\\n gl_PointSize = 1.0;\\\\n}\\\\n@end\\\\n\\\\n@export ecgl.forceAtlas2.calcWeightedSum.fragment\\\\n\\\\nvarying vec2 v_NodeUv;\\\\n\\\\nuniform sampler2D positionTex;\\\\nuniform sampler2D forceTex;\\\\nuniform sampler2D forcePrevTex;\\\\n\\\\nvoid main() {\\\\n vec2 force = texture2D(forceTex, v_NodeUv).rg;\\\\n vec2 forcePrev = texture2D(forcePrevTex, v_NodeUv).rg;\\\\n\\\\n float mass = texture2D(positionTex, v_NodeUv).z;\\\\n float swing = length(force - forcePrev) * mass;\\\\n float traction = length(force + forcePrev) * 0.5 * mass;\\\\n\\\\n gl_FragColor = vec4(swing, traction, 0.0, 0.0);\\\\n}\\\\n@end\\\\n\\\\n@export ecgl.forceAtlas2.calcGlobalSpeed\\\\n\\\\nuniform sampler2D globalSpeedPrevTex;\\\\nuniform sampler2D weightedSumTex;\\\\nuniform float jitterTolerence;\\\\n\\\\nvoid main() {\\\\n vec2 weightedSum = texture2D(weightedSumTex, vec2(0.5)).xy;\\\\n float prevGlobalSpeed = texture2D(globalSpeedPrevTex, vec2(0.5)).x;\\\\n float globalSpeed = jitterTolerence * jitterTolerence\\\\n * weightedSum.y / weightedSum.x;\\\\n if (prevGlobalSpeed > 0.0) {\\\\n globalSpeed = min(globalSpeed / prevGlobalSpeed, 1.5) * prevGlobalSpeed;\\\\n }\\\\n gl_FragColor = vec4(globalSpeed, 0.0, 0.0, 1.0);\\\\n}\\\\n@end\\\\n\\\\n@export ecgl.forceAtlas2.updatePosition\\\\n\\\\nuniform sampler2D forceTex;\\\\nuniform sampler2D forcePrevTex;\\\\nuniform sampler2D positionTex;\\\\nuniform sampler2D globalSpeedTex;\\\\n\\\\nvarying vec2 v_Texcoord;\\\\n\\\\nvoid main() {\\\\n vec2 force = texture2D(forceTex, v_Texcoord).xy;\\\\n vec2 forcePrev = texture2D(forcePrevTex, v_Texcoord).xy;\\\\n vec4 node = texture2D(positionTex, v_Texcoord);\\\\n\\\\n float globalSpeed = texture2D(globalSpeedTex, vec2(0.5)).r;\\\\n float swing = length(force - forcePrev);\\\\n float speed = 0.1 * globalSpeed / (0.1 + globalSpeed * sqrt(swing));\\\\n\\\\n float df = length(force);\\\\n if (df > 0.0) {\\\\n speed = min(df * speed, 10.0) / df;\\\\n\\\\n gl_FragColor = vec4(node.xy + speed * force, node.zw);\\\\n }\\\\n else {\\\\n gl_FragColor = node;\\\\n }\\\\n}\\\\n@end\\\\n\\\\n@export ecgl.forceAtlas2.edges.vertex\\\\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\\\\n\\\\nattribute vec2 node;\\\\nattribute vec4 a_Color : COLOR;\\\\nvarying vec4 v_Color;\\\\n\\\\nuniform sampler2D positionTex;\\\\n\\\\nvoid main()\\\\n{\\\\n gl_Position = worldViewProjection * vec4(\\\\n texture2D(positionTex, node).xy, -10.0, 1.0\\\\n );\\\\n v_Color = a_Color;\\\\n}\\\\n@end\\\\n\\\\n@export ecgl.forceAtlas2.edges.fragment\\\\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\\\\nvarying vec4 v_Color;\\\\nvoid main() {\\\\n gl_FragColor = color * v_Color;\\\\n}\\\\n@end\\\");var Jc={repulsionByDegree:!0,linLogMode:!1,strongGravityMode:!1,gravity:1,scaling:1,edgeWeightInfluence:1,jitterTolerence:.1,preventOverlap:!1,dissuadeHubs:!1,gravityCenter:null};function $c(e){var t={type:Z.Texture.FLOAT,minFilter:Z.Texture.NEAREST,magFilter:Z.Texture.NEAREST},t=(this._positionSourceTex=new Z.Texture2D(t),this._positionSourceTex.flipY=!1,this._positionTex=new Z.Texture2D(t),this._positionPrevTex=new Z.Texture2D(t),this._forceTex=new Z.Texture2D(t),this._forcePrevTex=new Z.Texture2D(t),this._weightedSumTex=new Z.Texture2D(t),this._weightedSumTex.width=this._weightedSumTex.height=1,this._globalSpeedTex=new Z.Texture2D(t),this._globalSpeedPrevTex=new Z.Texture2D(t),this._globalSpeedTex.width=this._globalSpeedTex.height=1,this._globalSpeedPrevTex.width=this._globalSpeedPrevTex.height=1,this._nodeRepulsionPass=new hn({fragment:Z.Shader.source(\\\"ecgl.forceAtlas2.updateNodeRepulsion\\\")}),this._positionPass=new hn({fragment:Z.Shader.source(\\\"ecgl.forceAtlas2.updatePosition\\\")}),this._globalSpeedPass=new hn({fragment:Z.Shader.source(\\\"ecgl.forceAtlas2.calcGlobalSpeed\\\")}),this._copyPass=new hn({fragment:Z.Shader.source(\\\"clay.compositor.output\\\")}),function(e){e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ONE)});this._edgeForceMesh=new Z.Mesh({geometry:new Z.Geometry({attributes:{node1:new Z.Geometry.Attribute(\\\"node1\\\",\\\"float\\\",2),node2:new Z.Geometry.Attribute(\\\"node2\\\",\\\"float\\\",2),weight:new Z.Geometry.Attribute(\\\"weight\\\",\\\"float\\\",1)},dynamic:!0,mainAttribute:\\\"node1\\\"}),material:new Z.Material({transparent:!0,shader:Z.createShader(\\\"ecgl.forceAtlas2.updateEdgeAttraction\\\"),blend:t,depthMask:!1,depthText:!1}),mode:Z.Mesh.POINTS}),this._weightedSumMesh=new Z.Mesh({geometry:new Z.Geometry({attributes:{node:new Z.Geometry.Attribute(\\\"node\\\",\\\"float\\\",2)},dynamic:!0,mainAttribute:\\\"node\\\"}),material:new Z.Material({transparent:!0,shader:Z.createShader(\\\"ecgl.forceAtlas2.calcWeightedSum\\\"),blend:t,depthMask:!1,depthText:!1}),mode:Z.Mesh.POINTS}),this._framebuffer=new Li({depthBuffer:!1}),this._dummyCamera=new Z.OrthographicCamera({left:-1,right:1,top:1,bottom:-1,near:0,far:100}),this._globalSpeed=0}$c.prototype.updateOption=function(e){for(var t in Jc)this[t]=Jc[t];var r=this._nodes.length;if(this.jitterTolerence=5e4<r?10:5e3<r?1:.1,this.scaling=100<r?2:10,e)for(var t in Jc)null!=e[t]&&(this[t]=e[t]);if(this.repulsionByDegree)for(var i=this._positionSourceTex.pixels,n=0;n<this._nodes.length;n++)i[4*n+2]=(this._nodes[n].degree||0)+1},$c.prototype._updateGravityCenter=function(e){var t=this._nodes,r=this._edges;if(this.gravityCenter)this._gravityCenter=this.gravityCenter;else{for(var i=[1/0,1/0],n=[-1/0,-1/0],a=0;a<t.length;a++)i[0]=Math.min(t[a].x,i[0]),i[1]=Math.min(t[a].y,i[1]),n[0]=Math.max(t[a].x,n[0]),n[1]=Math.max(t[a].y,n[1]);this._gravityCenter=[.5*(i[0]+n[0]),.5*(i[1]+n[1])]}for(a=0;a<r.length;a++){var o=r[a].node1,s=r[a].node2;t[o].degree=(t[o].degree||0)+1,t[s].degree=(t[s].degree||0)+1}},$c.prototype.initData=function(e,t){this._nodes=e,this._edges=t,this._updateGravityCenter();var r=Math.ceil(Math.sqrt(e.length)),i=r,n=new Float32Array(r*i*4);this._resize(r,i);for(var a=0,o=0;o<e.length;o++){var s=e[o];n[a++]=s.x||0,n[a++]=s.y||0,n[a++]=s.mass||1,n[a++]=s.size||1}this._positionSourceTex.pixels=n;for(var l=this._edgeForceMesh.geometry,h=t.length,u=(l.attributes.node1.init(2*h),l.attributes.node2.init(2*h),l.attributes.weight.init(2*h),[]),o=0;o<t.length;o++){var c=l.attributes,d=t[o].weight;null==d&&(d=1),c.node1.set(o,this.getNodeUV(t[o].node1,u)),c.node2.set(o,this.getNodeUV(t[o].node2,u)),c.weight.set(o,d),c.node1.set(o+h,this.getNodeUV(t[o].node2,u)),c.node2.set(o+h,this.getNodeUV(t[o].node1,u)),c.weight.set(o+h,d)}var f=this._weightedSumMesh.geometry;for(f.attributes.node.init(e.length),o=0;o<e.length;o++)f.attributes.node.set(o,this.getNodeUV(o,u));l.dirty(),f.dirty(),this._nodeRepulsionPass.material.define(\\\"fragment\\\",\\\"NODE_COUNT\\\",e.length),this._nodeRepulsionPass.material.setUniform(\\\"textureSize\\\",[r,i]),this._inited=!1,this._frame=0},$c.prototype.getNodes=function(){return this._nodes},$c.prototype.getEdges=function(){return this._edges},$c.prototype.step=function(e){this._inited||(this._initFromSource(e),this._inited=!0),this._frame++,this._framebuffer.attach(this._forceTex),this._framebuffer.bind(e);var t=this._nodeRepulsionPass,t=(t.setUniform(\\\"strongGravityMode\\\",this.strongGravityMode),t.setUniform(\\\"gravity\\\",this.gravity),t.setUniform(\\\"gravityCenter\\\",this._gravityCenter),t.setUniform(\\\"scaling\\\",this.scaling),t.setUniform(\\\"preventOverlap\\\",this.preventOverlap),t.setUniform(\\\"positionTex\\\",this._positionPrevTex),t.render(e),this._edgeForceMesh),t=(t.material.set(\\\"linLogMode\\\",this.linLogMode),t.material.set(\\\"edgeWeightInfluence\\\",this.edgeWeightInfluence),t.material.set(\\\"preventOverlap\\\",this.preventOverlap),t.material.set(\\\"positionTex\\\",this._positionPrevTex),e.gl.enable(e.gl.BLEND),e.renderPass([t],this._dummyCamera),this._framebuffer.attach(this._weightedSumTex),e.gl.clearColor(0,0,0,0),e.gl.clear(e.gl.COLOR_BUFFER_BIT),e.gl.enable(e.gl.BLEND),this._weightedSumMesh),t=(t.material.set(\\\"positionTex\\\",this._positionPrevTex),t.material.set(\\\"forceTex\\\",this._forceTex),t.material.set(\\\"forcePrevTex\\\",this._forcePrevTex),e.renderPass([t],this._dummyCamera),this._framebuffer.attach(this._globalSpeedTex),this._globalSpeedPass),t=(t.setUniform(\\\"globalSpeedPrevTex\\\",this._globalSpeedPrevTex),t.setUniform(\\\"weightedSumTex\\\",this._weightedSumTex),t.setUniform(\\\"jitterTolerence\\\",this.jitterTolerence),e.gl.disable(e.gl.BLEND),t.render(e),this._positionPass);this._framebuffer.attach(this._positionTex),t.setUniform(\\\"globalSpeedTex\\\",this._globalSpeedTex),t.setUniform(\\\"positionTex\\\",this._positionPrevTex),t.setUniform(\\\"forceTex\\\",this._forceTex),t.setUniform(\\\"forcePrevTex\\\",this._forcePrevTex),t.render(e),this._framebuffer.unbind(e),this._swapTexture()},$c.prototype.update=function(e,t,r){null==t&&(t=1),t=Math.max(t,1);for(var i=0;i<t;i++)this.step(e);r&&r()},$c.prototype.getNodePositionTexture=function(){return this._inited?this._positionPrevTex:this._positionSourceTex},$c.prototype.getNodeUV=function(e,t){var r=this._positionTex.width,i=this._positionTex.height;return(t=t||[])[0]=e%r/(r-1),t[1]=Math.floor(e/r)/(i-1)||0,t},$c.prototype.getNodePosition=function(e,t){var r=this._positionArr,i=this._positionTex.width,n=this._positionTex.height,a=i*n;r&&r.length===4*a||(r=this._positionArr=new Float32Array(4*a)),this._framebuffer.bind(e),this._framebuffer.attach(this._positionPrevTex),e.gl.readPixels(0,0,i,n,e.gl.RGBA,e.gl.FLOAT,r),this._framebuffer.unbind(e),t=t||new Float32Array(2*this._nodes.length);for(var o=0;o<this._nodes.length;o++)t[2*o]=r[4*o],t[2*o+1]=r[4*o+1];return t},$c.prototype.getTextureData=function(e,t){var r=this[\\\"_\\\"+t+\\\"Tex\\\"],i=r.width,n=r.height,r=(this._framebuffer.bind(e),this._framebuffer.attach(r),new Float32Array(i*n*4));return e.gl.readPixels(0,0,i,n,e.gl.RGBA,e.gl.FLOAT,r),this._framebuffer.unbind(e),r},$c.prototype.getTextureSize=function(){return{width:this._positionTex.width,height:this._positionTex.height}},$c.prototype.isFinished=function(e){return this._frame>e},$c.prototype._swapTexture=function(){var e=this._positionPrevTex;this._positionPrevTex=this._positionTex,this._positionTex=e,e=this._forcePrevTex,this._forcePrevTex=this._forceTex,this._forceTex=e,e=this._globalSpeedPrevTex,this._globalSpeedPrevTex=this._globalSpeedTex,this._globalSpeedTex=e},$c.prototype._initFromSource=function(e){this._framebuffer.attach(this._positionPrevTex),this._framebuffer.bind(e),this._copyPass.setUniform(\\\"texture\\\",this._positionSourceTex),this._copyPass.render(e),e.gl.clearColor(0,0,0,0),this._framebuffer.attach(this._forcePrevTex),e.gl.clear(e.gl.COLOR_BUFFER_BIT),this._framebuffer.attach(this._globalSpeedPrevTex),e.gl.clear(e.gl.COLOR_BUFFER_BIT),this._framebuffer.unbind(e)},$c.prototype._resize=function(t,r){[\\\"_positionSourceTex\\\",\\\"_positionTex\\\",\\\"_positionPrevTex\\\",\\\"_forceTex\\\",\\\"_forcePrevTex\\\"].forEach(function(e){this[e].width=t,this[e].height=r,this[e].dirty()},this)},$c.prototype.dispose=function(e){this._framebuffer.dispose(e),this._copyPass.dispose(e),this._nodeRepulsionPass.dispose(e),this._positionPass.dispose(e),this._globalSpeedPass.dispose(e),this._edgeForceMesh.geometry.dispose(e),this._weightedSumMesh.geometry.dispose(e),this._positionSourceTex.dispose(e),this._positionTex.dispose(e),this._positionPrevTex.dispose(e),this._forceTex.dispose(e),this._forcePrevTex.dispose(e),this._weightedSumTex.dispose(e),this._globalSpeedTex.dispose(e),this._globalSpeedPrevTex.dispose(e)};const ed=$c;var td=(td=(function(){var T=function(){return new Float32Array(2)},S=function(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)},M=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e},o=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e};function t(){this.subRegions=[],this.nSubRegions=0,this.node=null,this.mass=0,this.centerOfMass=null,this.bbox=new Float32Array(4),this.size=0}var e=t.prototype;function s(){this.position=new Float32Array(2),this.force=T(),this.forcePrev=T(),this.mass=1,this.inDegree=0,this.outDegree=0}function l(e,t){this.source=e,this.target=t,this.weight=1}function h(){this.autoSettings=!0,this.barnesHutOptimize=!0,this.barnesHutTheta=1.5,this.repulsionByDegree=!0,this.linLogMode=!1,this.strongGravityMode=!1,this.gravity=1,this.scaling=1,this.edgeWeightInfluence=1,this.jitterTolerence=.1,this.preventOverlap=!1,this.dissuadeHubs=!1,this.rootRegion=new t,this.rootRegion.centerOfMass=T(),this.nodes=[],this.edges=[],this.bbox=new Float32Array(4),this.gravityCenter=null,this._massArr=null,this._swingingArr=null,this._sizeArr=null,this._globalSpeed=0}e.beforeUpdate=function(){for(var e=0;e<this.nSubRegions;e++)this.subRegions[e].beforeUpdate();this.mass=0,this.centerOfMass&&(this.centerOfMass[0]=0,this.centerOfMass[1]=0),this.nSubRegions=0,this.node=null},e.afterUpdate=function(){this.subRegions.length=this.nSubRegions;for(var e=0;e<this.nSubRegions;e++)this.subRegions[e].afterUpdate()},e.addNode=function(e){if(0===this.nSubRegions){if(null==this.node)return void(this.node=e);this._addNodeToSubRegion(this.node),this.node=null}this._addNodeToSubRegion(e),this._updateCenterOfMass(e)},e.findSubRegion=function(e,t){for(var r=0;r<this.nSubRegions;r++){var i=this.subRegions[r];if(i.contain(e,t))return i}},e.contain=function(e,t){return this.bbox[0]<=e&&this.bbox[2]>=e&&this.bbox[1]<=t&&this.bbox[3]>=t},e.setBBox=function(e,t,r,i){this.bbox[0]=e,this.bbox[1]=t,this.bbox[2]=r,this.bbox[3]=i,this.size=(r-e+i-t)/2},e._newSubRegion=function(){var e=this.subRegions[this.nSubRegions];return e||(e=new t,this.subRegions[this.nSubRegions]=e),this.nSubRegions++,e},e._addNodeToSubRegion=function(e){var t,r,i,n,a=this.findSubRegion(e.position[0],e.position[1]),o=this.bbox;a||(i=(o[0]+o[2])/2,n=(o[1]+o[3])/2,t=(o[2]-o[0])/2,r=(o[3]-o[1])/2,i=e.position[0]>=i?1:0,n=e.position[1]>=n?1:0,(a=this._newSubRegion()).setBBox(i*t+o[0],n*r+o[1],(1+i)*t+o[0],(1+n)*r+o[1])),a.addNode(e)},e._updateCenterOfMass=function(e){null==this.centerOfMass&&(this.centerOfMass=new Float32Array(2));var t=this.centerOfMass[0]*this.mass,r=this.centerOfMass[1]*this.mass;t+=e.position[0]*e.mass,r+=e.position[1]*e.mass,this.mass+=e.mass,this.centerOfMass[0]=t/this.mass,this.centerOfMass[1]=r/this.mass};var r,i,a,u,n,e=h.prototype,c=(e.initNodes=function(e,t,r){for(var i=t.length,n=void(this.nodes.length=0)!==r,a=0;a<i;a++){var o=new s;o.position[0]=e[2*a],o.position[1]=e[2*a+1],o.mass=t[a],n&&(o.size=r[a]),this.nodes.push(o)}this._massArr=t,this._swingingArr=new Float32Array(i),n&&(this._sizeArr=r)},e.initEdges=function(e,t){for(var r=e.length/2,i=this.edges.length=0;i<r;i++){var n=e[2*i],a=e[2*i+1],n=this.nodes[n],a=this.nodes[a];if(!n||!a)return void console.error(\\\"Node not exists, try initNodes before initEdges\\\");n.outDegree++,a.inDegree++;n=new l(n,a);t&&(n.weight=t[i]),this.edges.push(n)}},e.updateSettings=function(){if(this.repulsionByDegree)for(var e=0;e<this.nodes.length;e++)(t=this.nodes[e]).mass=t.inDegree+t.outDegree+1;else for(e=0;e<this.nodes.length;e++){var t;(t=this.nodes[e]).mass=this._massArr[e]}},e.update=function(){var e,t,r,i=this.nodes.length;if(this.updateSettings(),this.updateBBox(),this.barnesHutOptimize){this.rootRegion.setBBox(this.bbox[0],this.bbox[1],this.bbox[2],this.bbox[3]),this.rootRegion.beforeUpdate();for(var n=0;n<i;n++)this.rootRegion.addNode(this.nodes[n]);this.rootRegion.afterUpdate()}for(n=0;n<i;n++){var a=this.nodes[n],o=a.forcePrev,s=a.force;o[0]=s[0],o[1]=s[1],(e=a.force)[r=t=0]=t,e[1]=r}for(n=0;n<i;n++){var l=this.nodes[n];if(this.barnesHutOptimize)this.applyRegionToNodeRepulsion(this.rootRegion,l);else for(var h=n+1;h<i;h++){var u=this.nodes[h];this.applyNodeToNodeRepulsion(l,u,!1)}0<this.gravity&&(this.strongGravityMode?this.applyNodeStrongGravity(l):this.applyNodeGravity(l))}for(n=0;n<this.edges.length;n++)this.applyEdgeAttraction(this.edges[n]);for(var c,d,f,p,m,g=0,_=0,v=T(),n=0;n<i;n++)a=this.nodes[n],g+=(d=a.force,f=a.forcePrev,m=p=void 0,p=f[0]-d[0],m=f[1]-d[1],(x=Math.sqrt(p*p+m*m))*a.mass),f=v,d=a.force,c=a.forcePrev,f[0]=d[0]+c[0],f[1]=d[1]+c[1],_+=.5*S(v)*a.mass,this._swingingArr[n]=x;var y=this.jitterTolerence*this.jitterTolerence*_/g;for(0<this._globalSpeed&&(y=Math.min(y/this._globalSpeed,1.5)*this._globalSpeed),this._globalSpeed=y,n=0;n<i;n++){var a=this.nodes[n],x=this._swingingArr[n],b=.1*y/(1+y*Math.sqrt(x)),w=S(a.force);0<w&&(b=Math.min(w*b,10)/w,M(a.position,a.position,a.force,b))}},e.applyRegionToNodeRepulsion=(n=T(),function(e,t){if(e.node)this.applyNodeToNodeRepulsion(e.node,t,!0);else{o(n,t.position,e.centerOfMass);var r=n[0]*n[0]+n[1]*n[1];if(r>this.barnesHutTheta*e.size*e.size){r=this.scaling*t.mass*e.mass/r;M(t.force,t.force,n,r)}else for(var i=0;i<e.nSubRegions;i++)this.applyRegionToNodeRepulsion(e.subRegions[i],t)}}),e.applyNodeToNodeRepulsion=(u=T(),function(e,t,r){if(e!=t){o(u,e.position,t.position);var i,n,a=u[0]*u[0]+u[1]*u[1];if(0!=a){if(this.preventOverlap)if(0<(n=Math.sqrt(a)-e.size-t.size))i=this.scaling*e.mass*t.mass/(n*n);else{if(!(n<0))return;i=100*this.scaling*e.mass*t.mass}else i=this.scaling*e.mass*t.mass/a;M(e.force,e.force,u,i),M(t.force,t.force,u,-i)}}}),e.applyEdgeAttraction=(a=T(),function(e){var t=e.source,r=e.target;o(a,t.position,r.position);var i=S(a),n=0===this.edgeWeightInfluence?1:1===this.edgeWeightInfluence?e.weight:Math.pow(e.weight,this.edgeWeightInfluence);this.preventOverlap&&(i=i-t.size-r.size)<=0||(i=this.linLogMode?-n*Math.log(i+1)/(i+1):-n,M(t.force,t.force,a,i),M(r.force,r.force,a,-i))}),e.applyNodeGravity=(i=T(),function(e){o(i,this.gravityCenter,e.position);var t=S(i);M(e.force,e.force,i,this.gravity*e.mass/(t+1))}),e.applyNodeStrongGravity=(r=T(),function(e){o(r,this.gravityCenter,e.position),M(e.force,e.force,r,this.gravity*e.mass)}),e.updateBBox=function(){for(var e=1/0,t=1/0,r=-1/0,i=-1/0,n=0;n<this.nodes.length;n++)var a=this.nodes[n].position,e=Math.min(e,a[0]),t=Math.min(t,a[1]),r=Math.max(r,a[0]),i=Math.max(i,a[1]);this.bbox[0]=e,this.bbox[1]=t,this.bbox[2]=r,this.bbox[3]=i},e.getGlobalSpeed=function(){return this._globalSpeed},null);self.onmessage=function(e){switch(e.data.cmd){case\\\"init\\\":(c=new h).initNodes(e.data.nodesPosition,e.data.nodesMass,e.data.nodesSize),c.initEdges(e.data.edges,e.data.edgesWeight);break;case\\\"updateConfig\\\":if(c)for(var t in e.data.config)c[t]=e.data.config[t];break;case\\\"update\\\":var r=e.data.steps;if(c){for(var i=0;i<r;i++)c.update();for(var n=c.nodes.length,a=new Float32Array(2*n),i=0;i<n;i++){var o=c.nodes[i];a[2*i]=o.position[0],a[2*i+1]=o.position[1]}self.postMessage({buffer:a.buffer,globalSpeed:c.getGlobalSpeed()},[a.buffer])}else{var s=new Float32Array;self.postMessage({buffer:s.buffer,globalSpeed:c.getGlobalSpeed()},[s.buffer])}}}}).toString()).slice(td.indexOf(\\\"{\\\")+1,td.lastIndexOf(\\\"}\\\")),rd={barnesHutOptimize:!0,barnesHutTheta:1.5,repulsionByDegree:!0,linLogMode:!1,strongGravityMode:!1,gravity:1,scaling:1,edgeWeightInfluence:1,jitterTolerence:.1,preventOverlap:!1,dissuadeHubs:!1,gravityCenter:null},s=function(e){for(var t in rd)this[t]=rd[t];if(e)for(var t in e)this[t]=e[t];this._nodes=[],this._edges=[],this._disposed=!1,this._positionTex=new k({type:B.FLOAT,flipY:!1,minFilter:B.NEAREST,magFilter:B.NEAREST})};s.prototype.initData=function(e,t){var r=new Blob([td]),r=window.URL.createObjectURL(r);this._worker=new Worker(r),this._worker.onmessage=this._$onupdate.bind(this),this._nodes=e,this._edges=t,this._frame=0;for(var r=e.length,i=t.length,n=new Float32Array(2*r),a=new Float32Array(r),o=new Float32Array(r),s=new Float32Array(2*i),l=new Float32Array(i),h=0;h<e.length;h++){var u=e[h];n[2*h]=u.x,n[2*h+1]=u.y,a[h]=null==u.mass?1:u.mass,o[h]=null==u.size?1:u.size}for(h=0;h<t.length;h++){var c=t[h],d=c.node1,f=c.node2;s[2*h]=d,s[2*h+1]=f,l[h]=null==c.weight?1:c.weight}var r=Math.ceil(Math.sqrt(e.length)),i=r,p=new Float32Array(r*i*4),m=this._positionTex;m.width=r,m.height=i,m.pixels=p,this._worker.postMessage({cmd:\\\"init\\\",nodesPosition:n,nodesMass:a,nodesSize:o,edges:s,edgesWeight:l}),this._globalSpeed=1/0},s.prototype.updateOption=function(e){var t={};for(a in rd)t[a]=rd[a];var r=this._nodes,i=this._edges,n=r.length;if(t.jitterTolerence=5e4<n?10:5e3<n?1:.1,t.scaling=100<n?2:10,t.barnesHutOptimize=1e3<n,e)for(var a in rd)null!=e[a]&&(t[a]=e[a]);if(!t.gravityCenter){for(var o=[1/0,1/0],s=[-1/0,-1/0],l=0;l<r.length;l++)o[0]=Math.min(r[l].x,o[0]),o[1]=Math.min(r[l].y,o[1]),s[0]=Math.max(r[l].x,s[0]),s[1]=Math.max(r[l].y,s[1]);t.gravityCenter=[.5*(o[0]+s[0]),.5*(o[1]+s[1])]}for(l=0;l<i.length;l++){var h=i[l].node1,u=i[l].node2;r[h].degree=(r[h].degree||0)+1,r[u].degree=(r[u].degree||0)+1}this._worker&&this._worker.postMessage({cmd:\\\"updateConfig\\\",config:t})},s.prototype.update=function(e,t,r){null==t&&(t=1),t=Math.max(t,1),this._frame+=t,this._onupdate=r,this._worker&&this._worker.postMessage({cmd:\\\"update\\\",steps:Math.round(t)})},s.prototype._$onupdate=function(e){var t;this._disposed||(t=new Float32Array(e.data.buffer),this._globalSpeed=e.data.globalSpeed,this._positionArr=t,this._updateTexture(t),this._onupdate&&this._onupdate())},s.prototype.getNodePositionTexture=function(){return this._positionTex},s.prototype.getNodeUV=function(e,t){var r=this._positionTex.width,i=this._positionTex.height;return(t=t||[])[0]=e%r/(r-1),t[1]=Math.floor(e/r)/(i-1),t},s.prototype.getNodes=function(){return this._nodes},s.prototype.getEdges=function(){return this._edges},s.prototype.isFinished=function(e){return this._frame>e},s.prototype.getNodePosition=function(e,t){if(t=t||new Float32Array(2*this._nodes.length),this._positionArr)for(var r=0;r<this._positionArr.length;r++)t[r]=this._positionArr[r];return t},s.prototype._updateTexture=function(e){for(var t=this._positionTex.pixels,r=0,i=0;i<e.length;)t[r++]=e[i++],t[r++]=e[i++],t[r++]=1,t[r++]=1;this._positionTex.dirty()},s.prototype.dispose=function(e){this._disposed=!0,this._worker=null};const id=s,nd=N.extend(function(){return{zr:null,viewGL:null,minZoom:.2,maxZoom:5,_needsUpdate:!1,_dx:0,_dy:0,_zoom:1}},function(){this._mouseDownHandler=this._mouseDownHandler.bind(this),this._mouseWheelHandler=this._mouseWheelHandler.bind(this),this._mouseMoveHandler=this._mouseMoveHandler.bind(this),this._mouseUpHandler=this._mouseUpHandler.bind(this),this._update=this._update.bind(this)},{init:function(){var e=this.zr;e.on(\\\"mousedown\\\",this._mouseDownHandler),e.on(\\\"mousewheel\\\",this._mouseWheelHandler),e.on(\\\"globalout\\\",this._mouseUpHandler),e.animation.on(\\\"frame\\\",this._update)},setTarget:function(e){this._target=e},setZoom:function(e){this._zoom=Math.max(Math.min(e,this.maxZoom),this.minZoom),this._needsUpdate=!0},setOffset:function(e){this._dx=e[0],this._dy=e[1],this._needsUpdate=!0},getZoom:function(){return this._zoom},getOffset:function(){return[this._dx,this._dy]},_update:function(){var e,t;this._target&&this._needsUpdate&&(e=this._target,t=this._zoom,e.position.x=this._dx,e.position.y=this._dy,e.scale.set(t,t,t),this.zr.refresh(),this._needsUpdate=!1,this.trigger(\\\"update\\\"))},_mouseDownHandler:function(e){var t,r;e.target||(r=e.offsetX,t=e.offsetY,this.viewGL&&!this.viewGL.containPoint(r,t))||(this.zr.on(\\\"mousemove\\\",this._mouseMoveHandler),this.zr.on(\\\"mouseup\\\",this._mouseUpHandler),r=this._convertPos(r,t),this._x=r.x,this._y=r.y)},_convertPos:function(e,t){var r=this.viewGL.camera,i=this.viewGL.viewport;return{x:(e-i.x)/i.width*(r.right-r.left)+r.left,y:(t-i.y)/i.height*(r.bottom-r.top)+r.top}},_mouseMoveHandler:function(e){var t=this._convertPos(e.offsetX,e.offsetY);this._dx+=t.x-this._x,this._dy+=t.y-this._y,this._x=t.x,this._y=t.y,this._needsUpdate=!0},_mouseUpHandler:function(e){this.zr.off(\\\"mousemove\\\",this._mouseMoveHandler),this.zr.off(\\\"mouseup\\\",this._mouseUpHandler)},_mouseWheelHandler:function(e){var t,r,i,n=(e=e.event).wheelDelta||-e.detail;0!==n&&(i=e.offsetX,r=e.offsetY,this.viewGL&&!this.viewGL.containPoint(i,r)||(n=0<n?1.1:.9,n=(t=Math.max(Math.min(this._zoom*n,this.maxZoom),this.minZoom))/this._zoom,r=((i=this._convertPos(i,r)).x-this._dx)*(n-1),i=(i.y-this._dy)*(n-1),this._dx-=r,this._dy-=i,this._zoom=t,this._needsUpdate=!0))},dispose:function(){var e=this.zr;e.off(\\\"mousedown\\\",this._mouseDownHandler),e.off(\\\"mousemove\\\",this._mouseMoveHandler),e.off(\\\"mouseup\\\",this._mouseUpHandler),e.off(\\\"mousewheel\\\",this._mouseWheelHandler),e.off(\\\"globalout\\\",this._mouseUpHandler),e.animation.off(\\\"frame\\\",this._update)}});var ad,od=ao.vec2,sd=(Z.Shader[\\\"import\\\"](\\\"@export ecgl.lines2D.vertex\\\\n\\\\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\\\\n\\\\nattribute vec2 position: POSITION;\\\\nattribute vec4 a_Color : COLOR;\\\\nvarying vec4 v_Color;\\\\n\\\\n#ifdef POSITIONTEXTURE_ENABLED\\\\nuniform sampler2D positionTexture;\\\\n#endif\\\\n\\\\nvoid main()\\\\n{\\\\n gl_Position = worldViewProjection * vec4(position, -10.0, 1.0);\\\\n\\\\n v_Color = a_Color;\\\\n}\\\\n\\\\n@end\\\\n\\\\n@export ecgl.lines2D.fragment\\\\n\\\\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\\\\n\\\\nvarying vec4 v_Color;\\\\n\\\\nvoid main()\\\\n{\\\\n gl_FragColor = color * v_Color;\\\\n}\\\\n@end\\\\n\\\\n\\\\n@export ecgl.meshLines2D.vertex\\\\n\\\\nattribute vec2 position: POSITION;\\\\nattribute vec2 normal;\\\\nattribute float offset;\\\\nattribute vec4 a_Color : COLOR;\\\\n\\\\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\\\\nuniform vec4 viewport : VIEWPORT;\\\\n\\\\nvarying vec4 v_Color;\\\\nvarying float v_Miter;\\\\n\\\\nvoid main()\\\\n{\\\\n vec4 p2 = worldViewProjection * vec4(position + normal, -10.0, 1.0);\\\\n gl_Position = worldViewProjection * vec4(position, -10.0, 1.0);\\\\n\\\\n p2.xy /= p2.w;\\\\n gl_Position.xy /= gl_Position.w;\\\\n\\\\n vec2 N = normalize(p2.xy - gl_Position.xy);\\\\n gl_Position.xy += N * offset / viewport.zw * 2.0;\\\\n\\\\n gl_Position.xy *= gl_Position.w;\\\\n\\\\n v_Color = a_Color;\\\\n}\\\\n@end\\\\n\\\\n\\\\n@export ecgl.meshLines2D.fragment\\\\n\\\\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\\\\n\\\\nvarying vec4 v_Color;\\\\nvarying float v_Miter;\\\\n\\\\nvoid main()\\\\n{\\\\n gl_FragColor = color * v_Color;\\\\n}\\\\n\\\\n@end\\\"),1);const ld=F.ChartView.extend({type:\\\"graphGL\\\",__ecgl__:!0,init:function(e,t){this.groupGL=new Z.Node,this.viewGL=new hl(\\\"orthographic\\\"),this.viewGL.camera.left=this.viewGL.camera.right=0,this.viewGL.add(this.groupGL),this._pointsBuilder=new Uu(!0,t),this._forceEdgesMesh=new Z.Mesh({material:new Z.Material({shader:Z.createShader(\\\"ecgl.forceAtlas2.edges\\\"),transparent:!0,depthMask:!1,depthTest:!1}),$ignorePicking:!0,geometry:new Z.Geometry({attributes:{node:new Z.Geometry.Attribute(\\\"node\\\",\\\"float\\\",2),color:new Z.Geometry.Attribute(\\\"color\\\",\\\"float\\\",4,\\\"COLOR\\\")},dynamic:!0,mainAttribute:\\\"node\\\"}),renderOrder:-1,mode:Z.Mesh.LINES}),this._edgesMesh=new Z.Mesh({material:new Z.Material({shader:Z.createShader(\\\"ecgl.meshLines2D\\\"),transparent:!0,depthMask:!1,depthTest:!1}),$ignorePicking:!0,geometry:new Qc({useNativeLine:!1,dynamic:!0}),renderOrder:-1,culling:!1}),this._layoutId=0,this._control=new nd({zr:t.getZr(),viewGL:this.viewGL}),this._control.setTarget(this.groupGL),this._control.init(),this._clickHandler=this._clickHandler.bind(this)},render:function(e,t,r){this.groupGL.add(this._pointsBuilder.rootNode),this._model=e,this._api=r,this._initLayout(e,t,r),this._pointsBuilder.update(e,t,r),this._forceLayoutInstance instanceof ed||this.groupGL.remove(this._forceEdgesMesh),this._updateCamera(e,r),this._control.off(\\\"update\\\"),this._control.on(\\\"update\\\",function(){r.dispatchAction({type:\\\"graphGLRoam\\\",seriesId:e.id,zoom:this._control.getZoom(),offset:this._control.getOffset()}),this._pointsBuilder.updateView(this.viewGL.camera)},this),this._control.setZoom(E(e.get(\\\"zoom\\\"),1)),this._control.setOffset(e.get(\\\"offset\\\")||[0,0]);var i,n=this._pointsBuilder.getPointsMesh();n.off(\\\"mousemove\\\",this._mousemoveHandler),n.off(\\\"mouseout\\\",this._mouseOutHandler,this),r.getZr().off(\\\"click\\\",this._clickHandler),this._pointsBuilder.highlightOnMouseover=!0,e.get(\\\"focusNodeAdjacency\\\")&&(\\\"click\\\"===(i=e.get(\\\"focusNodeAdjacencyOn\\\"))?r.getZr().on(\\\"click\\\",this._clickHandler):\\\"mouseover\\\"===i&&(n.on(\\\"mousemove\\\",this._mousemoveHandler,this),n.on(\\\"mouseout\\\",this._mouseOutHandler,this),this._pointsBuilder.highlightOnMouseover=!1)),this._lastMouseOverDataIndex=-1},_clickHandler:function(e){var t;this._layouting||(0<=(t=this._pointsBuilder.getPointsMesh().dataIndex)?this._api.dispatchAction({type:\\\"graphGLFocusNodeAdjacency\\\",seriesId:this._model.id,dataIndex:t}):this._api.dispatchAction({type:\\\"graphGLUnfocusNodeAdjacency\\\",seriesId:this._model.id}))},_mousemoveHandler:function(e){var t;this._layouting||(0<=(t=this._pointsBuilder.getPointsMesh().dataIndex)?t!==this._lastMouseOverDataIndex&&this._api.dispatchAction({type:\\\"graphGLFocusNodeAdjacency\\\",seriesId:this._model.id,dataIndex:t}):this._mouseOutHandler(e),this._lastMouseOverDataIndex=t)},_mouseOutHandler:function(e){this._layouting||(this._api.dispatchAction({type:\\\"graphGLUnfocusNodeAdjacency\\\",seriesId:this._model.id}),this._lastMouseOverDataIndex=-1)},_updateForceEdgesGeometry:function(i,e){var n=this._forceEdgesMesh.geometry,a=e.getEdgeData(),o=0,s=this._forceLayoutInstance,t=2*a.count();n.attributes.node.init(t),n.attributes.color.init(t),a.each(function(e){var t=i[e],r=(n.attributes.node.set(o,s.getNodeUV(t.node1)),n.attributes.node.set(o+1,s.getNodeUV(t.node2)),Yl(a,t.dataIndex)),r=Z.parseColor(r);r[3]*=E(Kl(a,t.dataIndex),1),n.attributes.color.set(o,r),n.attributes.color.set(o+1,r),o+=2}),n.dirty()},_updateMeshLinesGeometry:function(){var o=this._model.getEdgeData(),s=this._edgesMesh.geometry,l=(o=this._model.getEdgeData(),this._model.getData().getLayout(\\\"points\\\")),h=(s.resetOffset(),s.setVertexCount(o.count()*s.getLineVertexCount()),s.setTriangleCount(o.count()*s.getLineTriangleCount()),[]),u=[],c=[\\\"lineStyle\\\",\\\"width\\\"];this._originalEdgeColors=new Float32Array(4*o.count()),this._edgeIndicesMap=new Float32Array(o.count()),o.each(function(e){var t=o.graph.getEdgeByIndex(e),r=2*t.node1.dataIndex,i=2*t.node2.dataIndex,r=(h[0]=l[r],h[1]=l[1+r],u[0]=l[i],u[1]=l[1+i],Yl(o,t.dataIndex)),n=Z.parseColor(r),i=(n[3]*=E(Kl(o,t.dataIndex),1),o.getItemModel(t.dataIndex)),r=E(i.get(c),1)*this._api.getDevicePixelRatio();s.addLine(h,u,n,r);for(var a=0;a<4;a++)this._originalEdgeColors[4*t.dataIndex+a]=n[a];this._edgeIndicesMap[t.dataIndex]=e},this),s.dirty()},_updateForceNodesGeometry:function(e){for(var t=this._pointsBuilder.getPointsMesh(),r=[],i=0;i<e.count();i++)this._forceLayoutInstance.getNodeUV(i,r),t.geometry.attributes.position.set(i,r);t.geometry.dirty(\\\"position\\\")},_initLayout:function(e,t,r){var i,a,n,o,s,l,h,u,c,d,f=e.get(\\\"layout\\\"),p=e.getGraph(),m=rs(e.getBoxLayoutParams(),{width:r.getWidth(),height:r.getHeight()}),g=(\\\"force\\\"===f&&(f=\\\"forceAtlas2\\\"),this.stopLayout(e,t,r,{beforeLayout:!0}),e.getData()),_=e.getData();\\\"forceAtlas2\\\"===f?(f=e.getModel(\\\"forceAtlas2\\\"),i=this._forceLayoutInstance,a=[],n=[],o=g.getDataExtent(\\\"value\\\"),s=_.getDataExtent(\\\"value\\\"),l=E(f.get(\\\"edgeWeight\\\"),1),h=E(f.get(\\\"nodeWeight\\\"),1),\\\"number\\\"==typeof l&&(l=[l,l]),\\\"number\\\"==typeof h&&(h=[h,h]),u=0,c={},d=new Float32Array(2*g.count()),p.eachNode(function(e){var t,r,i=e.dataIndex,n=g.get(\\\"value\\\",i),n=(g.hasItemOption&&(t=(r=g.getItemModel(i)).get(\\\"x\\\"),r=r.get(\\\"y\\\")),null==t&&(t=m.x+Math.random()*m.width,r=m.y+Math.random()*m.height),d[2*u]=t,d[2*u+1]=r,c[e.id]=u++,F.number.linearMap(n,o,h));isNaN(n)&&(n=isNaN(h[0])?1:h[0]),a.push({x:t,y:r,mass:n,size:g.getItemVisual(i,\\\"symbolSize\\\")})}),g.setLayout(\\\"points\\\",d),p.eachEdge(function(e){var t=e.dataIndex,r=g.get(\\\"value\\\",t),r=F.number.linearMap(r,s,l);isNaN(r)&&(r=isNaN(l[0])?1:l[0]),n.push({node1:c[e.node1.id],node2:c[e.node2.id],weight:r,dataIndex:t})}),i||(_=f.get(\\\"GPU\\\"),!this._forceLayoutInstance||(!_||this._forceLayoutInstance instanceof ed)&&(_||this._forceLayoutInstance instanceof id)||(this._forceLayoutInstanceToDispose=this._forceLayoutInstance),i=this._forceLayoutInstance=new(_?ed:id)),i.initData(a,n),i.updateOption(f.option),this._updateForceEdgesGeometry(i.getEdges(),e),this._updatePositionTexture(),r.dispatchAction({type:\\\"graphGLStartLayout\\\",from:this.uid})):(d=new Float32Array(2*g.count()),u=0,p.eachNode(function(e){var t,r,i=e.dataIndex;g.hasItemOption&&(t=(i=g.getItemModel(i)).get(\\\"x\\\"),r=i.get(\\\"y\\\")),d[u++]=t,d[u++]=r}),g.setLayout(\\\"points\\\",d),this._updateAfterLayout(e,t,r))},_updatePositionTexture:function(){var e=this._forceLayoutInstance.getNodePositionTexture();this._pointsBuilder.setPositionTexture(e),this._forceEdgesMesh.material.set(\\\"positionTex\\\",e)},startLayout:function(t,e,r,i){var n,a,o,s,l,h,u,c,d,f,p;i&&null!=i.from&&i.from!==this.uid||(n=this.viewGL,r=this._api,a=this._forceLayoutInstance,o=this._model.getData(),s=this._model.getModel(\\\"forceAtlas2\\\"),a&&(this.groupGL.remove(this._edgesMesh),this.groupGL.add(this._forceEdgesMesh),this._forceLayoutInstance)&&(this._updateForceNodesGeometry(t.getData()),this._pointsBuilder.hideLabels(),h=(l=this)._layoutId=sd++,u=s.getShallow(\\\"maxSteps\\\"),c=s.getShallow(\\\"steps\\\"),d=0,f=Math.max(2*c,20),p=function(e){if(e===l._layoutId)return a.isFinished(u)?(r.dispatchAction({type:\\\"graphGLStopLayout\\\",from:l.uid}),void r.dispatchAction({type:\\\"graphGLFinishLayout\\\",points:o.getLayout(\\\"points\\\"),from:l.uid})):void a.update(n.layer.renderer,c,function(){l._updatePositionTexture(),(d+=c)>=f&&(l._syncNodePosition(t),d=0),r.getZr().refresh(),Na(function(){p(e)})})},Na(function(){l._forceLayoutInstanceToDispose&&(l._forceLayoutInstanceToDispose.dispose(n.layer.renderer),l._forceLayoutInstanceToDispose=null),p(h)}),this._layouting=!0))},stopLayout:function(e,t,r,i){i&&null!=i.from&&i.from!==this.uid||(this._layoutId=0,this.groupGL.remove(this._forceEdgesMesh),this.groupGL.add(this._edgesMesh),this._forceLayoutInstance&&this.viewGL.layer&&(i&&i.beforeLayout||(this._syncNodePosition(e),this._updateAfterLayout(e,t,r)),this._api.getZr().refresh(),this._layouting=!1))},_syncNodePosition:function(e){var t=this._forceLayoutInstance.getNodePosition(this.viewGL.layer.renderer);e.getData().setLayout(\\\"points\\\",t),e.setNodePosition(t)},_updateAfterLayout:function(e,t,r){this._updateMeshLinesGeometry(),this._pointsBuilder.removePositionTexture(),this._pointsBuilder.updateLayout(e,t,r),this._pointsBuilder.updateView(this.viewGL.camera),this._pointsBuilder.updateLabels(),this._pointsBuilder.showLabels()},focusNodeAdjacency:function(e,t,r,i){var n=this._model.getData(),a=(this._downplayAll(),i.dataIndex),o=n.graph,s=[],l=o.getNodeByIndex(a),h=(s.push(l),l.edges.forEach(function(e){e.dataIndex<0||(e.node1!==l&&s.push(e.node1),e.node2!==l&&s.push(e.node2))},this),this._pointsBuilder.fadeOutAll(.05),this._fadeOutEdgesAll(.05),s.forEach(function(e){this._pointsBuilder.highlight(n,e.dataIndex)},this),this._pointsBuilder.updateLabels(s.map(function(e){return e.dataIndex})),[]);l.edges.forEach(function(e){0<=e.dataIndex&&(this._highlightEdge(e.dataIndex),h.push(e))},this),this._focusNodes=s,this._focusEdges=h},unfocusNodeAdjacency:function(e,t,r,i){this._downplayAll(),this._pointsBuilder.fadeInAll(),this._fadeInEdgesAll(),this._pointsBuilder.updateLabels()},_highlightEdge:function(e){var t=this._model.getEdgeData().getItemModel(e),r=Z.parseColor(t.get(\\\"emphasis.lineStyle.color\\\")||t.get(\\\"lineStyle.color\\\")),t=E(t.get(\\\"emphasis.lineStyle.opacity\\\"),t.get(\\\"lineStyle.opacity\\\"),1);r[3]*=t,this._edgesMesh.geometry.setItemColor(this._edgeIndicesMap[e],r)},_downplayAll:function(){this._focusNodes&&this._focusNodes.forEach(function(e){this._pointsBuilder.downplay(this._model.getData(),e.dataIndex)},this),this._focusEdges&&this._focusEdges.forEach(function(e){this._downplayEdge(e.dataIndex)},this)},_downplayEdge:function(e){var t=this._getColor(e,[]);this._edgesMesh.geometry.setItemColor(this._edgeIndicesMap[e],t)},_setEdgeFade:(ad=[],function(e,t){this._getColor(e,ad),ad[3]*=t,this._edgesMesh.geometry.setItemColor(this._edgeIndicesMap[e],ad)}),_getColor:function(e,t){for(var r=0;r<4;r++)t[r]=this._originalEdgeColors[4*e+r];return t},_fadeOutEdgesAll:function(t){this._model.getData().graph.eachEdge(function(e){this._setEdgeFade(e.dataIndex,t)},this)},_fadeInEdgesAll:function(){this._fadeOutEdgesAll(1)},_updateCamera:function(e,t){this.viewGL.setViewport(0,0,t.getWidth(),t.getHeight(),t.getDevicePixelRatio());for(var r=this.viewGL.camera,i=e.getData().getLayout(\\\"points\\\"),n=od.create(1/0,1/0),a=od.create(-1/0,-1/0),o=[],s=0;s<i.length;)o[0]=i[s++],o[1]=i[s++],od.min(n,n,o),od.max(a,a,o);var l,h=(a[1]+n[1])/2,u=(a[0]+n[0])/2;u>r.left&&u<r.right&&h<r.bottom&&h>r.top||(l=(u=Math.max(a[0]-n[0],10))/t.getWidth()*t.getHeight(),l*=1.4,n[0]-=.2*(u*=1.4),r.left=n[0],r.top=h-l/2,r.bottom=h+l/2,r.right=u+n[0],r.near=0,r.far=100)},dispose:function(){var e=this.viewGL.layer.renderer;this._forceLayoutInstance&&this._forceLayoutInstance.dispose(e),this.groupGL.removeAll(),this._layoutId=-1,this._pointsBuilder.dispose()},remove:function(){this.groupGL.removeAll(),this._control.dispose()}});function hd(e){return e=e instanceof Array?e:[e,e]}(0,F.use)(function(e){function t(){}e.registerChartView(ld),e.registerSeriesModel(kc),e.registerVisual(function(e){const u={};e.eachSeriesByType(\\\"graphGL\\\",function(s){var l=s.getCategoriesData(),o=s.getData(),h={};l.each(function(e){var t=l.getName(e),r=(h[\\\"ec-\\\"+t]=e,l.getItemModel(e)),i=r.getModel(\\\"itemStyle\\\").getItemStyle(),n=(i.fill||(i.fill=s.getColorFromPalette(t,u)),l.setItemVisual(e,\\\"style\\\",i),[\\\"symbol\\\",\\\"symbolSize\\\",\\\"symbolKeepAspect\\\"]);for(let o=0;o<n.length;o++){var a=r.getShallow(n[o],!0);null!=a&&l.setItemVisual(e,n[o],a)}}),l.count()&&o.each(function(t){let r=o.getItemModel(t).getShallow(\\\"category\\\");if(null!=r){\\\"string\\\"==typeof r&&(r=h[\\\"ec-\\\"+r]);var i=l.getItemVisual(r,\\\"style\\\"),n=o.ensureUniqueItemVisual(t,\\\"style\\\"),a=(F.util.extend(n,i),[\\\"symbol\\\",\\\"symbolSize\\\",\\\"symbolKeepAspect\\\"]);for(let e=0;e<a.length;e++)o.setItemVisual(t,a[e],l.getItemVisual(r,a[e]))}})})}),e.registerVisual(function(e){e.eachSeriesByType(\\\"graphGL\\\",function(e){var s=e.getGraph(),l=e.getEdgeData(),t=hd(e.get(\\\"edgeSymbol\\\")),r=hd(e.get(\\\"edgeSymbolSize\\\"));l.setVisual(\\\"drawType\\\",\\\"stroke\\\"),l.setVisual(\\\"fromSymbol\\\",t&&t[0]),l.setVisual(\\\"toSymbol\\\",t&&t[1]),l.setVisual(\\\"fromSymbolSize\\\",r&&r[0]),l.setVisual(\\\"toSymbolSize\\\",r&&r[1]),l.setVisual(\\\"style\\\",e.getModel(\\\"lineStyle\\\").getLineStyle()),l.each(function(e){var t=l.getItemModel(e),r=s.getEdgeByIndex(e),i=hd(t.getShallow(\\\"symbol\\\",!0)),n=hd(t.getShallow(\\\"symbolSize\\\",!0)),t=t.getModel(\\\"lineStyle\\\").getLineStyle(),a=l.ensureUniqueItemVisual(e,\\\"style\\\");switch(F.util.extend(a,t),a.stroke){case\\\"source\\\":var o=r.node1.getVisual(\\\"style\\\");a.stroke=o&&o.fill;break;case\\\"target\\\":o=r.node2.getVisual(\\\"style\\\"),a.stroke=o&&o.fill}i[0]&&r.setVisual(\\\"fromSymbol\\\",i[0]),i[1]&&r.setVisual(\\\"toSymbol\\\",i[1]),n[0]&&r.setVisual(\\\"fromSymbolSize\\\",n[0]),n[1]&&r.setVisual(\\\"toSymbolSize\\\",n[1])})})}),e.registerAction({type:\\\"graphGLRoam\\\",event:\\\"graphglroam\\\",update:\\\"series.graphGL:roam\\\"},function(t,e){e.eachComponent({mainType:\\\"series\\\",query:t},function(e){e.setView(t)})}),e.registerAction({type:\\\"graphGLStartLayout\\\",event:\\\"graphgllayoutstarted\\\",update:\\\"series.graphGL:startLayout\\\"},t),e.registerAction({type:\\\"graphGLStopLayout\\\",event:\\\"graphgllayoutstopped\\\",update:\\\"series.graphGL:stopLayout\\\"},t),e.registerAction({type:\\\"graphGLFocusNodeAdjacency\\\",event:\\\"graphGLFocusNodeAdjacency\\\",update:\\\"series.graphGL:focusNodeAdjacency\\\"},t),e.registerAction({type:\\\"graphGLUnfocusNodeAdjacency\\\",event:\\\"graphGLUnfocusNodeAdjacency\\\",update:\\\"series.graphGL:unfocusNodeAdjacency\\\"},t)});const ud=F.SeriesModel.extend({type:\\\"series.flowGL\\\",dependencies:[\\\"geo\\\",\\\"grid\\\",\\\"bmap\\\"],visualStyleAccessPath:\\\"itemStyle\\\",getInitialData:function(e,t){var r=this.get(\\\"coordinateSystem\\\"),r=\\\"geo\\\"===r?[\\\"lng\\\",\\\"lat\\\"]:F.getCoordinateSystemDimensions(r)||[\\\"x\\\",\\\"y\\\"],r=(r.push(\\\"vx\\\",\\\"vy\\\"),F.helper.createDimensions(this.getSource(),{coordDimensions:r,encodeDefine:this.get(\\\"encode\\\"),dimensionsDefine:this.get(\\\"dimensions\\\")})),r=new F.List(r,this);return r.initData(this.getSource()),r},defaultOption:{coordinateSystem:\\\"cartesian2d\\\",zlevel:10,supersampling:1,particleType:\\\"point\\\",particleDensity:128,particleSize:1,particleSpeed:1,particleTrail:2,colorTexture:null,gridWidth:\\\"auto\\\",gridHeight:\\\"auto\\\",itemStyle:{color:\\\"#fff\\\",opacity:.8}}}),cd=_.extend(function(){return{dynamic:!0,attributes:{position:new _.Attribute(\\\"position\\\",\\\"float\\\",3,\\\"POSITION\\\")}}},{resetOffset:function(){this._vertexOffset=0,this._faceOffset=0},setLineCount:function(e){var t=this.attributes,r=4*e,i=2*e;this.vertexCount!==r&&t.position.init(r),this.triangleCount!==i&&(this.indices=0==i?null:new(65535<this.vertexCount?Uint32Array:Uint16Array)(3*i))},addLine:function(e){var t=this._vertexOffset;this.attributes.position.set(t,[e[0],e[1],1]),this.attributes.position.set(t+1,[e[0],e[1],-1]),this.attributes.position.set(t+2,[e[0],e[1],2]),this.attributes.position.set(t+3,[e[0],e[1],-2]),this.setTriangleIndices(this._faceOffset++,[t,t+1,t+2]),this.setTriangleIndices(this._faceOffset++,[t+1,t+2,t+3]),this._vertexOffset+=4}});S[\\\"import\\\"](\\\"@export ecgl.vfParticle.particle.fragment\\\\n\\\\nuniform sampler2D particleTexture;\\\\nuniform sampler2D spawnTexture;\\\\nuniform sampler2D velocityTexture;\\\\n\\\\nuniform float deltaTime;\\\\nuniform float elapsedTime;\\\\n\\\\nuniform float speedScaling : 1.0;\\\\n\\\\nuniform vec2 textureSize;\\\\nuniform vec4 region : [0, 0, 1, 1];\\\\nuniform float firstFrameTime;\\\\n\\\\nvarying vec2 v_Texcoord;\\\\n\\\\n\\\\nvoid main()\\\\n{\\\\n vec4 p = texture2D(particleTexture, v_Texcoord);\\\\n bool spawn = false;\\\\n if (p.w <= 0.0) {\\\\n p = texture2D(spawnTexture, fract(v_Texcoord + elapsedTime / 10.0));\\\\n p.w -= firstFrameTime;\\\\n spawn = true;\\\\n }\\\\n vec2 v = texture2D(velocityTexture, fract(p.xy * region.zw + region.xy)).xy;\\\\n v = (v - 0.5) * 2.0;\\\\n p.z = length(v);\\\\n p.xy += v * deltaTime / 10.0 * speedScaling;\\\\n p.w -= deltaTime;\\\\n\\\\n if (spawn || p.xy != fract(p.xy)) {\\\\n p.z = 0.0;\\\\n }\\\\n p.xy = fract(p.xy);\\\\n\\\\n gl_FragColor = p;\\\\n}\\\\n@end\\\\n\\\\n@export ecgl.vfParticle.renderPoints.vertex\\\\n\\\\n#define PI 3.1415926\\\\n\\\\nattribute vec2 texcoord : TEXCOORD_0;\\\\n\\\\nuniform sampler2D particleTexture;\\\\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\\\\n\\\\nuniform float size : 1.0;\\\\n\\\\nvarying float v_Mag;\\\\nvarying vec2 v_Uv;\\\\n\\\\nvoid main()\\\\n{\\\\n vec4 p = texture2D(particleTexture, texcoord);\\\\n\\\\n if (p.w > 0.0 && p.z > 1e-5) {\\\\n gl_Position = worldViewProjection * vec4(p.xy * 2.0 - 1.0, 0.0, 1.0);\\\\n }\\\\n else {\\\\n gl_Position = vec4(100000.0, 100000.0, 100000.0, 1.0);\\\\n }\\\\n\\\\n v_Mag = p.z;\\\\n v_Uv = p.xy;\\\\n\\\\n gl_PointSize = size;\\\\n}\\\\n\\\\n@end\\\\n\\\\n@export ecgl.vfParticle.renderPoints.fragment\\\\n\\\\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\\\\nuniform sampler2D gradientTexture;\\\\nuniform sampler2D colorTexture;\\\\nuniform sampler2D spriteTexture;\\\\n\\\\nvarying float v_Mag;\\\\nvarying vec2 v_Uv;\\\\n\\\\nvoid main()\\\\n{\\\\n gl_FragColor = color;\\\\n#ifdef SPRITETEXTURE_ENABLED\\\\n gl_FragColor *= texture2D(spriteTexture, gl_PointCoord);\\\\n if (color.a == 0.0) {\\\\n discard;\\\\n }\\\\n#endif\\\\n#ifdef GRADIENTTEXTURE_ENABLED\\\\n gl_FragColor *= texture2D(gradientTexture, vec2(v_Mag, 0.5));\\\\n#endif\\\\n#ifdef COLORTEXTURE_ENABLED\\\\n gl_FragColor *= texture2D(colorTexture, v_Uv);\\\\n#endif\\\\n}\\\\n\\\\n@end\\\\n\\\\n@export ecgl.vfParticle.renderLines.vertex\\\\n\\\\n#define PI 3.1415926\\\\n\\\\nattribute vec3 position : POSITION;\\\\n\\\\nuniform sampler2D particleTexture;\\\\nuniform sampler2D prevParticleTexture;\\\\n\\\\nuniform float size : 1.0;\\\\nuniform vec4 vp: VIEWPORT;\\\\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\\\\n\\\\nvarying float v_Mag;\\\\nvarying vec2 v_Uv;\\\\n\\\\n@import clay.util.rand\\\\n\\\\nvoid main()\\\\n{\\\\n vec4 p = texture2D(particleTexture, position.xy);\\\\n vec4 p2 = texture2D(prevParticleTexture, position.xy);\\\\n\\\\n p.xy = p.xy * 2.0 - 1.0;\\\\n p2.xy = p2.xy * 2.0 - 1.0;\\\\n\\\\n if (p.w > 0.0 && p.z > 1e-5) {\\\\n vec2 dir = normalize(p.xy - p2.xy);\\\\n vec2 norm = vec2(dir.y / vp.z, -dir.x / vp.w) * sign(position.z) * size;\\\\n if (abs(position.z) == 2.0) {\\\\n gl_Position = vec4(p.xy + norm, 0.0, 1.0);\\\\n v_Uv = p.xy;\\\\n v_Mag = p.z;\\\\n }\\\\n else {\\\\n gl_Position = vec4(p2.xy + norm, 0.0, 1.0);\\\\n v_Mag = p2.z;\\\\n v_Uv = p2.xy;\\\\n }\\\\n gl_Position = worldViewProjection * gl_Position;\\\\n }\\\\n else {\\\\n gl_Position = vec4(100000.0, 100000.0, 100000.0, 1.0);\\\\n }\\\\n}\\\\n\\\\n@end\\\\n\\\\n@export ecgl.vfParticle.renderLines.fragment\\\\n\\\\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\\\\nuniform sampler2D gradientTexture;\\\\nuniform sampler2D colorTexture;\\\\n\\\\nvarying float v_Mag;\\\\nvarying vec2 v_Uv;\\\\n\\\\nvoid main()\\\\n{\\\\n gl_FragColor = color;\\\\n #ifdef GRADIENTTEXTURE_ENABLED\\\\n gl_FragColor *= texture2D(gradientTexture, vec2(v_Mag, 0.5));\\\\n#endif\\\\n#ifdef COLORTEXTURE_ENABLED\\\\n gl_FragColor *= texture2D(colorTexture, v_Uv);\\\\n#endif\\\\n}\\\\n\\\\n@end\\\\n\\\");v=function(){this.motionBlurFactor=.99,this.vectorFieldTexture=new k({type:B.FLOAT,flipY:!1}),this.particleLife=[5,20],this._particleType=\\\"point\\\",this._particleSize=1,this.particleColor=[1,1,1,1],this.particleSpeedScaling=1,this._thisFrameTexture=null,this._particlePass=null,this._spawnTexture=null,this._particleTexture0=null,this._particleTexture1=null,this._particlePointsMesh=null,this._surfaceFrameBuffer=null,this._elapsedTime=0,this._scene=null,this._camera=null,this._lastFrameTexture=null,this._supersampling=1,this._downsampleTextures=[],this._width=512,this._height=512,this.init()};v.prototype={constructor:v,init:function(){var e={type:B.FLOAT,minFilter:B.NEAREST,magFilter:B.NEAREST,useMipmap:!1},e=(this._spawnTexture=new k(e),this._particleTexture0=new k(e),this._particleTexture1=new k(e),this._frameBuffer=new Li({depthBuffer:!1}),this._particlePass=new hn({fragment:S.source(\\\"ecgl.vfParticle.particle.fragment\\\")}),this._particlePass.setUniform(\\\"velocityTexture\\\",this.vectorFieldTexture),this._particlePass.setUniform(\\\"spawnTexture\\\",this._spawnTexture),this._downsamplePass=new hn({fragment:S.source(\\\"clay.compositor.downsample\\\")}),new Er({renderOrder:10,material:new Fe({shader:new S(S.source(\\\"ecgl.vfParticle.renderPoints.vertex\\\"),S.source(\\\"ecgl.vfParticle.renderPoints.fragment\\\"))}),mode:Er.POINTS,geometry:new _({dynamic:!0,mainAttribute:\\\"texcoord0\\\"})})),t=new Er({renderOrder:10,material:new Fe({shader:new S(S.source(\\\"ecgl.vfParticle.renderLines.vertex\\\"),S.source(\\\"ecgl.vfParticle.renderLines.fragment\\\"))}),geometry:new cd,culling:!1}),r=new Er({material:new Fe({shader:new S(S.source(\\\"ecgl.color.vertex\\\"),S.source(\\\"ecgl.color.fragment\\\"))}),geometry:new Ni});r.material.enableTexture(\\\"diffuseMap\\\"),this._particlePointsMesh=e,this._particleLinesMesh=t,this._lastFrameFullQuadMesh=r,this._camera=new on,this._thisFrameTexture=new k,this._lastFrameTexture=new k},setParticleDensity:function(e,t){for(var r=new Float32Array(e*t*4),i=0,n=this.particleLife,a=0;a<e;a++)for(var o=0;o<t;o++,i++){r[4*i]=Math.random(),r[4*i+1]=Math.random(),r[4*i+2]=Math.random();var s=(n[1]-n[0])*Math.random()+n[0];r[4*i+3]=s}\\\"line\\\"===this._particleType?this._setLineGeometry(e,t):this._setPointsGeometry(e,t),this._spawnTexture.width=e,this._spawnTexture.height=t,this._spawnTexture.pixels=r,this._particleTexture0.width=this._particleTexture1.width=e,this._particleTexture0.height=this._particleTexture1.height=t,this._particlePass.setUniform(\\\"textureSize\\\",[e,t])},_setPointsGeometry:function(e,t){var r=this._particlePointsMesh.geometry,i=r.attributes;i.texcoord0.init(e*t);for(var n=0,a=0;a<e;a++)for(var o=0;o<t;o++,n++)i.texcoord0.value[2*n]=a/e,i.texcoord0.value[2*n+1]=o/t;r.dirty()},_setLineGeometry:function(e,t){var r=e*t,i=this._getParticleMesh().geometry;i.setLineCount(r),i.resetOffset();for(var n=0;n<e;n++)for(var a=0;a<t;a++)i.addLine([n/e,a/t]);i.dirty()},_getParticleMesh:function(){return\\\"line\\\"===this._particleType?this._particleLinesMesh:this._particlePointsMesh},update:function(e,t,r,i){var n=this._getParticleMesh(),a=this._frameBuffer,o=this._particlePass,o=(i&&this._updateDownsampleTextures(e,t),n.material.set(\\\"size\\\",this._particleSize*this._supersampling),n.material.set(\\\"color\\\",this.particleColor),o.setUniform(\\\"speedScaling\\\",this.particleSpeedScaling),a.attach(this._particleTexture1),o.setUniform(\\\"firstFrameTime\\\",i?(this.particleLife[1]+this.particleLife[0])/2:0),o.setUniform(\\\"particleTexture\\\",this._particleTexture0),o.setUniform(\\\"deltaTime\\\",r),o.setUniform(\\\"elapsedTime\\\",this._elapsedTime),o.render(e,a),n.material.set(\\\"particleTexture\\\",this._particleTexture1),n.material.set(\\\"prevParticleTexture\\\",this._particleTexture0),a.attach(this._thisFrameTexture),a.bind(e),e.gl.clear(e.gl.DEPTH_BUFFER_BIT|e.gl.COLOR_BUFFER_BIT),this._lastFrameFullQuadMesh);o.material.set(\\\"diffuseMap\\\",this._lastFrameTexture),o.material.set(\\\"color\\\",[1,1,1,this.motionBlurFactor]),this._camera.update(!0),e.renderPass([o,n],this._camera),a.unbind(e),this._downsample(e),this._swapTexture(),this._elapsedTime+=r},_downsample:function(e){var t=this._downsampleTextures;if(0!==t.length)for(var r=0,i=this._thisFrameTexture,n=t[r];n;)this._frameBuffer.attach(n),this._downsamplePass.setUniform(\\\"texture\\\",i),this._downsamplePass.setUniform(\\\"textureSize\\\",[i.width,i.height]),this._downsamplePass.render(e,this._frameBuffer),i=n,n=t[++r]},getSurfaceTexture:function(){var e=this._downsampleTextures;return 0<e.length?e[e.length-1]:this._lastFrameTexture},setRegion:function(e){this._particlePass.setUniform(\\\"region\\\",e)},resize:function(e,t){this._lastFrameTexture.width=e*this._supersampling,this._lastFrameTexture.height=t*this._supersampling,this._thisFrameTexture.width=e*this._supersampling,this._thisFrameTexture.height=t*this._supersampling,this._width=e,this._height=t},setParticleSize:function(e){var t,r,i,n=this._getParticleMesh();e<=2?(n.material.disableTexture(\\\"spriteTexture\\\"),n.material.transparent=!1):(this._spriteTexture||(this._spriteTexture=new k),this._spriteTexture.image&&this._spriteTexture.image.width===e||(this._spriteTexture.image=(t=e,(r=document.createElement(\\\"canvas\\\")).width=r.height=t,(i=r.getContext(\\\"2d\\\")).fillStyle=\\\"#fff\\\",i.arc(t/2,t/2,t/2,0,2*Math.PI),i.fill(),r),this._spriteTexture.dirty()),n.material.transparent=!0,n.material.enableTexture(\\\"spriteTexture\\\"),n.material.set(\\\"spriteTexture\\\",this._spriteTexture),this._particleSize=e)},setGradientTexture:function(e){var t=this._getParticleMesh().material;t[e?\\\"enableTexture\\\":\\\"disableTexture\\\"](\\\"gradientTexture\\\"),t.setUniform(\\\"gradientTexture\\\",e)},setColorTextureImage:function(e,t){this._getParticleMesh().material.setTextureImage(\\\"colorTexture\\\",e,t,{flipY:!0})},setParticleType:function(e){this._particleType=e},clearFrame:function(e){var t=this._frameBuffer;t.attach(this._lastFrameTexture),t.bind(e),e.gl.clear(e.gl.DEPTH_BUFFER_BIT|e.gl.COLOR_BUFFER_BIT),t.unbind(e)},setSupersampling:function(e){this._supersampling=e,this.resize(this._width,this._height)},_updateDownsampleTextures:function(e,t){for(var r=this._downsampleTextures,i=Math.max(Math.floor(Math.log(this._supersampling/t.getDevicePixelRatio())/Math.log(2)),0),n=2,a=this._width*this._supersampling,o=this._height*this._supersampling,s=0;s<i;s++)r[s]=r[s]||new k,r[s].width=a/n,r[s].height=o/n,n*=2;for(;s<r.length;s++)r[s].dispose(e);r.length=i},_swapTexture:function(){var e=this._particleTexture0;this._particleTexture0=this._particleTexture1,this._particleTexture1=e,e=this._thisFrameTexture,this._thisFrameTexture=this._lastFrameTexture,this._lastFrameTexture=e},dispose:function(t){t.disposeFrameBuffer(this._frameBuffer),t.disposeTexture(this.vectorFieldTexture),t.disposeTexture(this._spawnTexture),t.disposeTexture(this._particleTexture0),t.disposeTexture(this._particleTexture1),t.disposeTexture(this._thisFrameTexture),t.disposeTexture(this._lastFrameTexture),t.disposeGeometry(this._particleLinesMesh.geometry),t.disposeGeometry(this._particlePointsMesh.geometry),t.disposeGeometry(this._lastFrameFullQuadMesh.geometry),this._spriteTexture&&t.disposeTexture(this._spriteTexture),this._particlePass.dispose(t),this._downsamplePass.dispose(t),this._downsampleTextures.forEach(function(e){e.dispose(t)})}};const dd=v,fd=F.ChartView.extend({type:\\\"flowGL\\\",__ecgl__:!0,init:function(e,t){this.viewGL=new hl(\\\"orthographic\\\"),this.groupGL=new Z.Node,this.viewGL.add(this.groupGL),this._particleSurface=new dd;var r=new Z.Mesh({geometry:new Z.PlaneGeometry,material:new Z.Material({shader:new Z.Shader({vertex:Z.Shader.source(\\\"ecgl.color.vertex\\\"),fragment:Z.Shader.source(\\\"ecgl.color.fragment\\\")}),transparent:!0})});r.material.enableTexture(\\\"diffuseMap\\\"),this.groupGL.add(r),this._planeMesh=r},render:function(e,t,r){var i=this._particleSurface,n=(i.setParticleType(e.get(\\\"particleType\\\")),i.setSupersampling(e.get(\\\"supersampling\\\")),this._updateData(e,r),this._updateCamera(r.getWidth(),r.getHeight(),r.getDevicePixelRatio()),E(e.get(\\\"particleDensity\\\"),128)),a=(i.setParticleDensity(n,n),this._planeMesh),o=+new Date,s=this,l=!0,n=(a.__percent=0,a.stopAnimation(),a.animate(\\\"\\\",{loop:!0}).when(1e5,{__percent:1}).during(function(){var e=+new Date,e=Math.min(e-o,20);o+=e,s._renderer&&(i.update(s._renderer,r,e/1e3,l),a.material.set(\\\"diffuseMap\\\",i.getSurfaceTexture())),l=!1}).start(),e.getModel(\\\"itemStyle\\\")),h=Z.parseColor(n.get(\\\"color\\\"));h[3]*=E(n.get(\\\"opacity\\\"),1),a.material.set(\\\"color\\\",h),i.setColorTextureImage(e.get(\\\"colorTexture\\\"),r),i.setParticleSize(e.get(\\\"particleSize\\\")),i.particleSpeedScaling=e.get(\\\"particleSpeed\\\"),i.motionBlurFactor=1-Math.pow(.1,e.get(\\\"particleTrail\\\"))},updateTransform:function(e,t,r){this._updateData(e,r)},afterRender:function(e,t,r,i){var n=i.renderer;this._renderer=n},_updateData:function(t,e){var a=t.coordinateSystem,r=a.dimensions.map(function(e){return t.coordDimToDataDim(e)[0]}),i=t.getData(),n=i.getDataExtent(r[0]),o=i.getDataExtent(r[1]),s=t.get(\\\"gridWidth\\\"),l=t.get(\\\"gridHeight\\\"),o=(null!=s&&\\\"auto\\\"!==s||(n=(n[1]-n[0])/(o[1]-o[0]),s=Math.round(Math.sqrt(n*i.count()))),null!=l&&\\\"auto\\\"!==l||(l=Math.ceil(i.count()/s)),this._particleSurface.vectorFieldTexture),h=o.pixels;if(h&&h.length===l*s*4)for(var u=0;u<h.length;u++)h[u]=0;else h=o.pixels=new Float32Array(s*l*4);var c=0,d=1/0,f=new Float32Array(2*i.count()),p=0,m=[[1/0,1/0],[-1/0,-1/0]];i.each([r[0],r[1],\\\"vx\\\",\\\"vy\\\"],function(e,t,r,i){var n=a.dataToPoint([e,t]),n=(f[p++]=n[0],f[p++]=n[1],m[0][0]=Math.min(n[0],m[0][0]),m[0][1]=Math.min(n[1],m[0][1]),m[1][0]=Math.max(n[0],m[1][0]),m[1][1]=Math.max(n[1],m[1][1]),Math.sqrt(r*r+i*i));c=Math.max(c,n),d=Math.min(d,n)}),i.each([\\\"vx\\\",\\\"vy\\\"],function(e,t,r){var i=Math.round((f[2*r]-m[0][0])/(m[1][0]-m[0][0])*(s-1)),i=4*((l-1-Math.round((f[2*r+1]-m[0][1])/(m[1][1]-m[0][1])*(l-1)))*s+i);h[i]=e/c*.5+.5,h[1+i]=t/c*.5+.5,h[3+i]=1}),o.width=s,o.height=l,\\\"bmap\\\"===t.get(\\\"coordinateSystem\\\")&&this._fillEmptyPixels(o),o.dirty(),this._updatePlanePosition(m[0],m[1],t,e),this._updateGradientTexture(i.getVisual(\\\"visualMeta\\\"),[d,c])},_fillEmptyPixels:function(e){var n=e.pixels,a=e.width,o=e.height;function t(e,t,r){e=Math.max(Math.min(e,a-1),0);var i=4*((t=Math.max(Math.min(t,o-1),0))*(a-1)+e);return 0!==n[3+i]&&(r[0]=n[i],r[1]=n[1+i],1)}function r(e,t,r){r[0]=e[0]+t[0],r[1]=e[1]+t[1]}for(var i=[],s=[],l=[],h=[],u=[],c=0,d=0;d<o;d++)for(var f=0;f<a;f++){var p=4*(d*(a-1)+f);0===n[3+p]&&(c=i[0]=i[1]=0,t(f-1,d,s)&&(c++,r(s,i,i)),t(f+1,d,l)&&(c++,r(l,i,i)),t(f,d-1,h)&&(c++,r(h,i,i)),t(f,d+1,u)&&(c++,r(u,i,i)),i[0]/=c,i[1]/=c,n[p]=i[0],n[1+p]=i[1]),n[3+p]=1}},_updateGradientTexture:function(e,r){var t,i,n,a;e&&e.length?(this._gradientTexture=this._gradientTexture||new Z.Texture2D({image:document.createElement(\\\"canvas\\\")}),(i=(t=this._gradientTexture).image).width=200,i.height=1,n=i.getContext(\\\"2d\\\"),a=n.createLinearGradient(0,.5,i.width,.5),e[0].stops.forEach(function(e){var t=r[1]===r[0]?0:(t=e.value/r[1],Math.min(Math.max(t,0),1));a.addColorStop(t,e.color)}),n.fillStyle=a,n.fillRect(0,0,i.width,i.height),t.dirty(),this._particleSurface.setGradientTexture(this._gradientTexture)):this._particleSurface.setGradientTexture(null)},_updatePlanePosition:function(e,t,r,i){var n=this._limitInViewportAndFullFill(e,t,r,i),n=(e=n.leftTop,t=n.rightBottom,this._particleSurface.setRegion(n.region),this._planeMesh.position.set((e[0]+t[0])/2,i.getHeight()-(e[1]+t[1])/2,0),t[0]-e[0]),a=t[1]-e[1];this._planeMesh.scale.set(n/2,a/2,1),this._particleSurface.resize(Math.max(Math.min(n,2048),1),Math.max(Math.min(a,2048),1)),this._renderer&&this._particleSurface.clearFrame(this._renderer)},_limitInViewportAndFullFill:function(e,t,r,i){var n=[Math.max(e[0],0),Math.max(e[1],0)],a=[Math.min(t[0],i.getWidth()),Math.min(t[1],i.getHeight())],o=(\\\"bmap\\\"===r.get(\\\"coordinateSystem\\\")&&(o=r.getData().getDataExtent(r.coordDimToDataDim(\\\"lng\\\")[0]),359<=Math.floor(o[1]-o[0]))&&(0<n[0]&&(n[0]=0),a[0]<i.getWidth())&&(a[0]=i.getWidth()),t[0]-e[0]),s=t[1]-e[1],l=a[1]-n[1];return{leftTop:n,rightBottom:a,region:[(n[0]-e[0])/o,1-l/s-(n[1]-e[1])/s,(a[0]-n[0])/o,l/s]}},_updateCamera:function(e,t,r){this.viewGL.setViewport(0,0,e,t,r);var i=this.viewGL.camera;i.left=i.bottom=0,i.top=t,i.right=e,i.near=0,i.far=100,i.position.z=10},remove:function(){this._planeMesh.stopAnimation(),this.groupGL.removeAll()},dispose:function(){this._renderer&&this._particleSurface.dispose(this._renderer),this.groupGL.removeAll()}});(0,F.use)(function(e){e.registerChartView(fd),e.registerSeriesModel(ud)});var pd=F.SeriesModel.extend({type:\\\"series.linesGL\\\",dependencies:[\\\"grid\\\",\\\"geo\\\"],visualStyleAccessPath:\\\"lineStyle\\\",visualDrawType:\\\"stroke\\\",streamEnabled:!0,init:function(e){var t=this._processFlatCoordsArray(e.data);this._flatCoords=t.flatCoords,this._flatCoordsOffset=t.flatCoordsOffset,t.flatCoords&&(e.data=new Float32Array(t.count)),pd.superApply(this,\\\"init\\\",arguments)},mergeOption:function(e){var t=this._processFlatCoordsArray(e.data);this._flatCoords=t.flatCoords,this._flatCoordsOffset=t.flatCoordsOffset,t.flatCoords&&(e.data=new Float32Array(t.count)),pd.superApply(this,\\\"mergeOption\\\",arguments)},appendData:function(e){var t=this._processFlatCoordsArray(e.data);t.flatCoords&&(this._flatCoords?(this._flatCoords=ha(this._flatCoords,t.flatCoords),this._flatCoordsOffset=ha(this._flatCoordsOffset,t.flatCoordsOffset)):(this._flatCoords=t.flatCoords,this._flatCoordsOffset=t.flatCoordsOffset),e.data=new Float32Array(t.count)),this.getRawData().appendData(e.data)},_getCoordsFromItemModel:function(e){var t=this.getData().getItemModel(e);return t.option instanceof Array?t.option:t.getShallow(\\\"coords\\\")},getLineCoordsCount:function(e){return this._flatCoordsOffset?this._flatCoordsOffset[2*e+1]:this._getCoordsFromItemModel(e).length},getLineCoords:function(e,t){if(this._flatCoordsOffset){for(var r=this._flatCoordsOffset[2*e],i=this._flatCoordsOffset[2*e+1],n=0;n<i;n++)t[n]=t[n]||[],t[n][0]=this._flatCoords[r+2*n],t[n][1]=this._flatCoords[r+2*n+1];return i}for(var a=this._getCoordsFromItemModel(e),n=0;n<a.length;n++)t[n]=t[n]||[],t[n][0]=a[n][0],t[n][1]=a[n][1];return a.length},_processFlatCoordsArray:function(e){var t=0;if(this._flatCoords&&(t=this._flatCoords.length),\\\"number\\\"!=typeof e[0])return{flatCoordsOffset:null,flatCoords:null,count:e.length};for(var r=e.length,i=new Uint32Array(r),n=new Float64Array(r),a=0,o=0,s=0,l=0;l<r;){s++;var h=e[l++];i[o++]=a+t,i[o++]=h;for(var u=0;u<h;u++){var c=e[l++],d=e[l++];n[a++]=c,n[a++]=d}}return{flatCoordsOffset:new Uint32Array(i.buffer,0,o),flatCoords:n,count:s}},getInitialData:function(e,t){var a=new F.List([\\\"value\\\"],this);return a.hasItemOption=!1,a.initData(e.data,[],function(e,t,r,i){if(e instanceof Array)return NaN;a.hasItemOption=!0;var n=e.value;return null!=n?n instanceof Array?n[i]:n:void 0}),a},defaultOption:{coordinateSystem:\\\"geo\\\",zlevel:10,progressive:1e4,progressiveThreshold:5e4,blendMode:\\\"source-over\\\",lineStyle:{opacity:.8},postEffect:{enable:!1,colorCorrection:{exposure:0,brightness:0,contrast:1,saturation:1,enable:!0}}}});const md=pd,gd=F.ChartView.extend({type:\\\"linesGL\\\",__ecgl__:!0,init:function(e,t){this.groupGL=new Z.Node,this.viewGL=new hl(\\\"orthographic\\\"),this.viewGL.add(this.groupGL),this._glViewHelper=new wc(this.viewGL),this._nativeLinesShader=Z.createShader(\\\"ecgl.lines3D\\\"),this._meshLinesShader=Z.createShader(\\\"ecgl.meshLines3D\\\"),this._linesMeshes=[],this._currentStep=0},render:function(e,t,r){this.groupGL.removeAll(),this._glViewHelper.reset(e,r);var i=(i=this._linesMeshes[0])||(this._linesMeshes[0]=this._createLinesMesh(e));this._linesMeshes.length=1,this.groupGL.add(i),this._updateLinesMesh(e,i,0,e.getData().count()),this.viewGL.setPostEffect(e.getModel(\\\"postEffect\\\"),r)},incrementalPrepareRender:function(e,t,r){this.groupGL.removeAll(),this._glViewHelper.reset(e,r),this._currentStep=0,this.viewGL.setPostEffect(e.getModel(\\\"postEffect\\\"),r)},incrementalRender:function(e,t,r,i){var n=this._linesMeshes[this._currentStep];n||(n=this._createLinesMesh(t),this._linesMeshes[this._currentStep]=n),this._updateLinesMesh(t,n,e.start,e.end),this.groupGL.add(n),i.getZr().refresh(),this._currentStep++},updateTransform:function(e,t,r){e.coordinateSystem.getRoamTransform&&this._glViewHelper.updateTransform(e,r)},_createLinesMesh:function(e){return new Z.Mesh({$ignorePicking:!0,material:new Z.Material({shader:Z.createShader(\\\"ecgl.lines3D\\\"),transparent:!0,depthMask:!1,depthTest:!1}),geometry:new Qc({segmentScale:10,useNativeLine:!0,dynamic:!1}),mode:Z.Mesh.LINES,culling:!1})},_updateLinesMesh:function(e,t,r,i){var n=e.getData(),a=(t.material.blend=\\\"lighter\\\"===e.get(\\\"blendMode\\\")?Z.additiveBlend:null,e.get(\\\"lineStyle.curveness\\\")||0),o=e.get(\\\"polyline\\\"),s=t.geometry,l=e.coordinateSystem,h=E(e.get(\\\"lineStyle.width\\\"),1),u=(1<h?(t.material.shader!==this._meshLinesShader&&t.material.attachShader(this._meshLinesShader),t.mode=Z.Mesh.TRIANGLES):(t.material.shader!==this._nativeLinesShader&&t.material.attachShader(this._nativeLinesShader),t.mode=Z.Mesh.LINES),r=r||0,i=i||n.count(),s.resetOffset(),0),c=0,d=[],f=[],p=[],m=[],g=[],_=.3,v=.7;function y(){f[0]=d[0]*v+m[0]*_-(d[1]-m[1])*a,f[1]=d[1]*v+m[1]*_-(m[0]-d[0])*a,p[0]=d[0]*_+m[0]*v-(d[1]-m[1])*a,p[1]=d[1]*_+m[1]*v-(m[0]-d[0])*a}if(o||0!==a)for(var x=r;x<i;x++)o?(M=e.getLineCoordsCount(x),u+=s.getPolylineVertexCount(M),c+=s.getPolylineTriangleCount(M)):(e.getLineCoords(x,g),this._glViewHelper.dataToPoint(l,g[0],d),this._glViewHelper.dataToPoint(l,g[1],m),y(),u+=s.getCubicCurveVertexCount(d,f,p,m),c+=s.getCubicCurveTriangleCount(d,f,p,m));else{var b=i-r;u+=b*s.getLineVertexCount(),c+=b*s.getLineVertexCount()}s.setVertexCount(u),s.setTriangleCount(c);for(var w=r,T=[],x=r;x<i;x++){Z.parseColor(Yl(n,w),T);var S=E(Kl(n,w),1);T[3]*=S;for(var M=e.getLineCoords(x,g),A=0;A<M;A++)this._glViewHelper.dataToPoint(l,g[A],g[A]);o?s.addPolyline(g,T,h,0,M):0!==a?(d=g[0],m=g[1],y(),s.addCubicCurve(d,f,p,m,T,h)):s.addPolyline(g,T,h,0,2),w++}},dispose:function(){this.groupGL.removeAll()},remove:function(){this.groupGL.removeAll()}});(0,F.use)(function(e){e.registerChartView(gd),e.registerSeriesModel(md)})},83:e=>{e.exports=t}},i={};function n(e){var t;return(i[e]||(t=i[e]={exports:{}},r[e](t,t.exports,n),t)).exports}return n.g=function(){if(\\\"object\\\"==typeof globalThis)return globalThis;try{return this||new Function(\\\"return this\\\")()}catch(t){if(\\\"object\\\"==typeof window)return window}}(),n.r=e=>{\\\"undefined\\\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\\\"Module\\\"}),Object.defineProperty(e,\\\"__esModule\\\",{value:!0})},n(468)})()});\",\"type\":\"application/javascript\",\"module-type\":\"echarts-extension\",\"Modern.TiddlyDev#Minify\":\"false\"},\"$:/plugins/Gk0Wk/echarts-gl/readme\":{\"title\":\"$:/plugins/Gk0Wk/echarts-gl/readme\",\"text\":\"<$list filter=\\\"[[$:/language]get[text]removeprefix[$:/languages/]else[en-GB]]\\\" variable=\\\"lang\\\">\\n<$list filter=\\\"[<lang>search[zh]]\\\">\\n\\n[[ECharts-GL|https://github.com/ecomfe/echarts-gl]] 是Apache ECharts的一个扩展包，它提供3D绘图、地球仪可视化和WebGL加速。\\n\\n* 文档: https://echarts.apache.org/zh/option-gl.html\\n* 示例: https://www.makeapie.com/explore.html#tags=echarts-gl\\n\\n</$list>\\n\\n<$list filter=\\\"[<lang>!search[zh]]\\\">\\n\\n[[ECharts-GL|https://github.com/ecomfe/echarts-gl]] is an extension pack of Apache ECharts, which providing 3D plots, globe visualization and WebGL acceleration.\\n\\n* Doc: https://echarts.apache.org/en/option-gl.html\\n* Examples: https://www.makeapie.com/explore.html#tags=echarts-gl\\n\\n</$list>\\n</$list>\\n\\n[img[https://deyihu.github.io/images/maptalks-echarts-gl.png]]\\n\"}}}","Modern.TiddlyDev#SHA256-Hashed":"3af2c602aa344917e7f3be701ca335e92fdc92cd9f6c377b9fa557dd8c74ca26","author":"Gk0Wk","core-version":">=5.2.0"}